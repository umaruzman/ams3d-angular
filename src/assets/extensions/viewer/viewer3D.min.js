function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}var d={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},e=c("DXT1"),f=c("DXT3"),g=c("DXT5"),h=new Int32Array(a,0,31);if(542327876!==h[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),d;if(4&!h[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),d;var i,j=h[21],k=!1;switch(j){case e:i=8,d.format=THREE.RGB_S3TC_DXT1_Format;break;case f:i=16,d.format=THREE.RGBA_S3TC_DXT3_Format;break;case g:i=16,d.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==h[22]&&16711680&h[23]&&65280&h[24]&&255&h[25]&&4278190080&h[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",function(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}(j)),d;k=!0,i=64,d.format=THREE.RGBAFormat}d.mipmapCount=1,h[7]>0&&b!==!1&&(d.mipmapCount=Math.max(1,h[7])),d.isCubemap=!!(512&h[28]),d.width=h[4],d.height=h[3];for(var l=h[1]+4,m=d.width,n=d.height,o=d.isCubemap?6:1,p=0;p<o;p++){for(var q=0;q<d.mipmapCount;q++){if(k)var r=function(a,b,c,d){for(var e=c*d*4,f=new Uint8Array(a,b,e),g=new Uint8Array(e),h=0,i=0,j=0;j<d;j++)for(var k=0;k<c;k++){var l=f[i];i++;var m=f[i];i++;var n=f[i];i++;var o=f[i];i++,g[h]=n,h++,g[h]=m,h++,g[h]=l,h++,g[h]=o,h++}return g}(a,l,m,n),s=r.length;else var s=Math.max(4,m)/4*Math.max(4,n)/4*i,r=new Uint8Array(a,l,s);var t={data:r,width:m,height:n};d.mipmaps.push(t),l+=s,m=Math.max(.5*m,1),n=Math.max(.5*n,1)}m=d.width,n=d.height}return d}}function init_three_pvr_loader(){THREE.PVRLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager,this._parser=THREE.PVRLoader.parse},THREE.PVRLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.PVRLoader.prototype.constructor=THREE.PVRLoader,THREE.PVRLoader.parse=function(a,b){var c=new Uint32Array(a,0,13),d={buffer:a,header:c,loadMipmaps:b};if(55727696===c[0])return THREE.PVRLoader._parseV3(d);if(559044176===c[11])return THREE.PVRLoader._parseV2(d);throw new Error("[THREE.PVRLoader] Unknown PVR format")},THREE.PVRLoader._parseV3=function(a){var b,c,d=a.header,e=d[12],f=d[2],g=d[6],h=d[7],i=(d[9],d[10]),j=d[11];switch(f){case 0:b=2,c=THREE.RGB_PVRTC_2BPPV1_Format;break;case 1:b=2,c=THREE.RGBA_PVRTC_2BPPV1_Format;break;case 2:b=4,c=THREE.RGB_PVRTC_4BPPV1_Format;break;case 3:b=4,c=THREE.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+f)}return a.dataPtr=52+e,a.bpp=b,a.format=c,a.width=h,a.height=g,a.numSurfaces=i,a.numMipmaps=j,a.isCubemap=6===i,THREE.PVRLoader._extract(a)},THREE.PVRLoader._parseV2=function(a){var b,c,d=a.header,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],b=(d[5],d[6]),j=(d[7],d[8],d[9],d[10]),k=(d[11],d[12]),l=255&i,m=j>0;if(25===l)c=m?THREE.RGBA_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,b=4;else{if(24!==l)throw new Error("pvrtc - unknown format "+l);c=m?THREE.RGBA_PVRTC_2BPPV1_Format:THREE.RGB_PVRTC_2BPPV1_Format,b=2}return a.dataPtr=e,a.bpp=b,a.format=c,a.width=g,a.height=f,a.numSurfaces=k,a.numMipmaps=h+1,a.isCubemap=6===k,THREE.PVRLoader._extract(a)},THREE.PVRLoader._extract=function(a){var b={mipmaps:[],width:a.width,height:a.height,format:a.format,mipmapCount:a.numMipmaps,isCubemap:a.isCubemap},c=a.buffer,d=a.dataPtr,e=a.bpp,f=a.numSurfaces,g=0,h=0,i=0,j=0,k=0,l=0;2===e?(i=8,j=4):(i=4,j=4),h=i*j*e/8,b.mipmaps.length=a.numMipmaps*f;for(var m=0;m<a.numMipmaps;){var n=a.width>>m,o=a.height>>m;k=n/i,l=o/j,k<2&&(k=2),l<2&&(l=2),g=k*l*h;for(var p=0;p<f;p++){var q=new Uint8Array(c,d,g),r={data:q,width:n,height:o};b.mipmaps[p*a.numMipmaps+m]=r,d+=g}m++}return b}}function trace(a){"\n"==a[a.length-1]&&(a=a.substring(0,a.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+a)}function init_three_triangulator(){"use strict";Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function a(a,b,c){return c+":"+(a<b?a+":"+b:b+":"+a)}function b(b,c,d,e,f,g,h){this.pt1=b,this.pt2=c,this.p1=-1,this.p2=-1,this.eid1=a(d,e,h),this.eid2=a(f,g,h)}function c(){this.bbox=new THREE.Box2,this.left=null,this.right=null,this.node_edges=[]}function d(a,b,c){this.pts=a,this.edges=b,this.bbox=c,this.pipResult=!1}function e(a,b){this.edges=a,this.bbox=b,this.pts=[],this.idmap={},this.xymap={},this.contours=[],this.scale=1e6/this.bbox.size().length()}function f(a){this.indices=[],this.cset=a;var b=this.pts=a.pts;this.intervalTree=new d(a.pts,a.edges,a.bbox),this.intervalTree.build();for(var c=0;c<b.length;c++)b[c].id=c;var e=new lmv_poly2tri.SweepContext([]);if(e.points_=b.slice(),a.contours)for(var f=this.cset.contours,g=0;g<f.length;g++){for(var h=f[g],i=h[0]!==h[h.length-1],j=[],k=0;k<h.length-1;k++)j.push(b[h[k]]);e.initEdges(j,i)}else for(var l=this.cset.edges,c=0;c<l.length;c++){var m=l[c];if(m.p1!=m.p2){var n=[b[m.p1],b[m.p2]];e.initEdges(n,!0)}}this.triangulate(e),this.processResult(e)}var g=Autodesk.Viewing.Private;return d.prototype.splitNode=function(a){if(!(a.bbox.min.y>=a.bbox.max.y||a.node_edges.length<3)){var b=.5*(a.bbox.min.y+a.bbox.max.y);a.left=new c,a.right=new c;for(var d=this.pts,e=a.node_edges,f=[],g=new THREE.Vector2,h=0;h<e.length;h++){var i=this.edges[e[h]],j=d[i.p1].y,k=d[i.p2].y;if(j>k){var l=j;j=k,k=l}var m=null;k<b?(a.left.node_edges.push(e[h]),m=a.left.bbox):j>b?(a.right.node_edges.push(e[h]),m=a.right.bbox):f.push(e[h]),m&&(g.set(d[i.p1].x,d[i.p1].y),m.expandByPoint(g),g.set(d[i.p2].x,d[i.p2].y),m.expandByPoint(g))}a.node_edges=f,a.left.node_edges.length&&this.splitNode(a.left),a.right.node_edges.length&&this.splitNode(a.right)}},d.prototype.build=function(){this.root=new c;for(var a=this.root.node_edges,b=0;b<this.edges.length;b++)a.push(b);this.root.bbox.copy(this.bbox),this.splitNode(this.root)},d.prototype.pointInPolygonRec=function(a,b,c){if(a.bbox.min.y<=c&&a.bbox.max.y>=c)for(var d=this.pts,e=a.node_edges,f=0,g=e.length;f<g;f++){var h=this.edges[e[f]],i=d[h.p1],j=i.x,k=i.y,l=k>=c,m=d[h.p2],n=m.x,o=m.y,p=o>=c;l!=p&&(o-c)*(j-n)>=(n-b)*(k-o)==p&&(this.pipResult=!this.pipResult)}var q=a.left;q&&q.bbox.min.y<=c&&q.bbox.max.y>=c&&this.pointInPolygonRec(q,b,c);var r=a.right;r&&r.bbox.min.y<=c&&r.bbox.max.y>=c&&this.pointInPolygonRec(r,b,c)},d.prototype.pointInPolygon=function(a,b){return this.pipResult=!1,this.pointInPolygonRec(this.root,a,b),this.pipResult},e.prototype.getPointIndex=function(a,b,c){var d=this.idmap[c];if(void 0!==d)return d;var e,f=0|a*this.scale,g=0|b*this.scale,h=this.xymap[f];return void 0===h?(this.xymap[f]=h={},e=void 0):e=h[g],void 0===e&&(h[g]=e=this.pts.length,this.idmap[c]=e,this.pts.push({x:a,y:b})),e},e.prototype.snapEdges=function(){for(var a=0;a<this.edges.length;a++){var b=this.edges[a];b.p1=this.getPointIndex(b.pt1.x,b.pt1.y,b.eid1),b.p2=this.getPointIndex(b.pt2.x,b.pt2.y,b.eid2)}},e.prototype.sanitizeEdges=function(){for(var a={},b=[],c=0,d=this.edges.length;c<d;c++){var e=this.edges[c];if(e.p1!==e.p2){var f=Math.min(e.p1,e.p2)+":"+Math.max(e.p1,e.p2);a[f]!==!0&&(a[f]=!0,b.push(e))}}this.edges=b},e.prototype.stitchContours=function(){for(var a={},b=0;b<this.edges.length;b++){var c=this.edges[b];c.p1!==c.p2&&(void 0!==a[c.p1]?a[c.p1].push(c.p2):a[c.p1]=[c.p2],void 0!==a[c.p2]?a[c.p2].push(c.p1):a[c.p2]=[c.p1])}var d=[];for(var e in a)if(2!==a[e].length){g.logger.warn("Incomplete edge table");break}for(;;){var f=void 0;for(var e in a)if(a[e].length>1){f=e;break}if(!f)for(var e in a)if(a[e].length>0){f=e;break}if(!f)break;var h=-1,i=parseInt(f),j=a[f];for(d.push(i);j&&j.length;){var k=j.shift();if(k===h&&(k=j.shift()),void 0===k){delete a[i];break}d.push(k),0==j.length?delete a[i]:j[0]===h&&delete a[i],h=i,i=k,j=a[k]}d.length&&(this.contours.push(d),d=[])}for(var l=[],b=0;b<this.contours.length;b++){var m=this.contours[b];m[0]!==m[m.length-1]&&l.push(m)}if(l.length)for(var n=!0;n;){n=!1;for(var o={},p=this.contours,b=0;b<p.length;b++){var m=p[b],q=m[0],r=m[m.length-1];q!==r&&(o[q]?o[q].push(-b-1):o[q]=[-b-1],o[r]?o[r].push(b):o[r]=[b])}for(var e in o){var s=o[e];if(2==s.length){var t=void 0;if(s[0]<0&&s[1]<0){var u=-s[0]-1,v=-s[1]-1;p[v].shift(),Array.prototype.push.apply(p[u].reverse(),p[v]),t=v}if(s[0]<0&&s[1]>0){var u=-s[0]-1,v=s[1];p[v].pop(),Array.prototype.push.apply(p[v],p[u]),t=u}if(s[0]>0&&s[1]<0){var u=s[0],v=-s[1]-1;p[u].pop(),Array.prototype.push.apply(p[u],p[v]),t=v}if(s[0]>0&&s[1]>0){var u=s[0],v=s[1];p[u].pop(),Array.prototype.push.apply(p[u],p[v].reverse()),t=v}void 0!==t&&(p.splice(t,1),n=!0);break}}}},f.prototype.triangulate=function(a){try{a.triangulate()}catch(a){}},f.prototype.processResult=function(a){for(var b=0;b<a.map_.length;b++){var c=a.map_[b],d=c.points_[0],e=c.points_[1],f=c.points_[2];void 0!==d.id&&void 0!==e.id&&void 0!==f.id&&this.filterFace(d.id,e.id,f.id)}},f.prototype.pointInEdgeList=function(a,b){for(var c,d,e,f,g,h,i=this.cset.pts,j=this.cset.edges,k=!1,l=0,m=j.length;l<m;++l){var n=j[l];e=i[n.p1].x,f=i[n.p1].y,c=f>=b,g=i[n.p2].x,h=i[n.p2].y,d=h>=b,c!=d&&(h-b)*(e-g)>=(g-a)*(f-h)==d&&(k=!k)}return k},f.prototype.pointInContour=function(a,b,c){var d,e,f,g,h,i,j=!1,k=this.cset.pts;f=k[c[c.length-1]].x,g=k[c[c.length-1]].y,d=g>=b;for(var l=0,m=c.length;l<m;++l)h=k[c[l]].x,i=k[c[l]].y,e=i>=b,d!=e&&(i-b)*(f-h)>=(h-a)*(g-i)==e&&(j=!j),d=e,f=h,g=i;return j},f.prototype.pointInPolygon=function(a,b){for(var c=!1,d=0;d<this.cset.contours.length;d++)this.pointInContour(a,b,this.cset.contours[d])&&(c=!c);return c},f.prototype.filterFace=function(a,b,c){var d=this.pts[a],e=this.pts[b],f=this.pts[c],g=(d.x+e.x+f.x)/3,h=(d.y+e.y+f.y)/3;if(this.intervalTree.pointInPolygon(g,h)){var i=e.x-d.x,j=e.y-d.y,k=f.x-d.x;i*(f.y-d.y)-k*j>0?this.indices.push(a,b,c):this.indices.push(a,c,b)}},{TriangulatedSurface:f,ContourSet:e,Edge:b}}())}function init_three_intersector(){"use strict";Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function a(a){return Math.abs(a)<j}function b(b,c,d,e,f){var g=l.subVectors(d,c),h=b.normal.dot(g);if(a(h))return e.copy(c),f.copy(d),2;h=1/h;var i=-(c.dot(b.normal)*h+b.constant*h);if(i<-j||i>1+j)return 0;var k=g.multiplyScalar(i).add(c);return e.copy(k),1}function c(a,c,d,e,f,g,h,l,o){var p=a.distanceToPoint(c),q=a.distanceToPoint(d),r=a.distanceToPoint(e);if(p<-j&&q<-j&&r<-j)return null;if(p>j&&q>j&&r>j)return null;var s=Math.sign(p),t=Math.sign(q),u=Math.sign(r);if(0===s&&0===t&&0===u)return null;var v,w,x,y,z,A;if(s!==t){var B=b(a,c,d,m,n);if(2==B)return void l.push(new k(c.clone(),d.clone(),f,f,g,g,o));1==B?(x=f,y=g,v=m.clone()):i.logger.warn("Unexpected zero intersections where at least one was expected")}if(t!==u){var B=b(a,d,e,m,n);if(2==B)return void l.push(new k(d.clone(),e.clone(),g,g,h,h,o));1==B?v?m.distanceTo(v)>j&&(z=g,A=h,w=m.clone()):(x=g,y=h,v=m.clone()):i.logger.warn("Unexpected zero intersections where at least one was expected")}if(u!==s){var B=b(a,e,c,m,n);if(2==B)return void l.push(new k(e.clone(),c.clone(),h,h,f,f,o));1==B?v?m.distanceTo(v)>j&&(z=h,A=f,w=m.clone()):i.logger.warn("Unexpected single intersection point"):i.logger.warn("Unexpected zero intersections where at least one was expected")}v&&w?l.push(new k(v,w,x,y,z,A,o)):i.logger.warn("Unexpected one intersection where two were expected")}function d(a,b){o.set(b.min.x,b.min.y,b.min.z);var c=a.distanceToPoint(o),d=Math.sign(c);o.set(b.min.x,b.min.y,b.max.z);var e=a.distanceToPoint(o);return Math.sign(e)!==d||(o.set(b.min.x,b.max.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.min.x,b.max.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.min.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.min.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.max.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.max.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d))))))}function e(a,b,d){var e=b.geometry,f=d.length,g=e.attributes,h=b.matrixWorld;s.getInverse(h),t.copy(a).applyMatrix4(s);var i,j,k;if(void 0!==g.index){var l=g.index.array||e.ib,m=e.vb?e.vb:g.position.array,n=e.vb?e.vbstride:3,o=e.offsets;o&&0!==o.length||(o=[{start:0,count:l.length,index:0}]);for(var u=0,v=o.length;u<v;++u)for(var w=o[u].start,x=o[u].count,y=o[u].index,z=w,A=w+x;z<A;z+=3)i=y+l[z],j=y+l[z+1],k=y+l[z+2],p.x=m[i*n],p.y=m[i*n+1],p.z=m[i*n+2],q.x=m[j*n],q.y=m[j*n+1],q.z=m[j*n+2],r.x=m[k*n],r.y=m[k*n+1],r.z=m[k*n+2],c(t,p,q,r,i,j,k,d,b.fragId)}else for(var m=e.vb?e.vb:g.position.array,n=e.vb?e.vbstride:3,z=0,B=0,A=m.length;z<A;z+=3,B+=9)i=z,j=z+1,k=z+2,p.x=m[i*n],p.y=m[i*n+1],p.z=m[i*n+2],q.x=m[j*n],q.y=m[j*n+1],q.z=m[j*n+2],r.x=m[k*n],r.y=m[k*n+1],r.z=m[k*n+2],c(t,p,q,r,i,j,k,d,b.fragId);for(var z=f;z<d.length;z++)d[z].pt1.applyMatrix4(h),d[z].pt2.applyMatrix4(h)}function f(a,b,c){var d=b,e=Math.sqrt(1-d*d),f=1-d,g=a.x,h=a.y,i=a.z,j=f*g,k=f*h;c.set(j*g+d,j*h-e*i,j*i+e*h,0,j*h+e*i,k*h+d,k*i-e*g,0,j*i-e*h,k*i+e*g,f*i*i+d,0,0,0,0,1)}function g(b){var c=new THREE.Vector3(0,0,1),d=b.normal.clone().cross(c);d=d.normalize();var e=c.dot(b.normal),g=new THREE.Matrix4;return a(d.x)&&a(d.y)&&a(d.z)?g.elements[14]=e*b.constant:(f(d,e,g),g.elements[14]=b.constant),g}function h(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];e.pt1.applyMatrix4(a),e.pt2.applyMatrix4(a),c.expandByPoint(e.pt1),c.expandByPoint(e.pt2)}}var i=Autodesk.Viewing.Private,j=1e-10,k=Autodesk.Viewing.Private.Triangulator.Edge,l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Matrix4,t=new THREE.Plane;return{makePlaneBasis:g,convertToPlaneCoords:h,intersectTrianglePlane:c,intersectMeshPlane:e,intersectBoxPlane:d}}())}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(a,b,c){THREE.Mesh.call(this,a,b,!1),this.plane=c,this.planeVec=new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var a=this.plane.normal,b=-1*this.getWorldPosition().dot(a);this.planeVec.set(a.x,a.y,a.z,b),this.plane.constant=b})}function ResultCollection(){this.partialResults=[],this.resultIDArray={},this.resultSetArray=[],this.resultArrayBufferArray=[],this.metaInfoArray=[],this.resultSetIndex={},this.resultCount=0}function init_TransformGizmos(){"use strict";var a=function(a){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var b=function(a){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=j.vertices.push(b)-1;var c=g(a)/2/Math.PI+.5,d=h(a)/Math.PI+.5;return b.uv=new THREE.Vector2(c,1-d),b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);j.faces.push(d),s.copy(a).add(b).add(c).divideScalar(3);var e=g(s);j.faceVertexUvs[0].push([i(a.uv,a,e),i(b.uv,b,e),i(c.uv,c,e)])}function g(a){return Math.atan2(a.z,-a.x)}function h(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function i(a,b,c){return c<0&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y)),a.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:b,radius:c,detail:d},c=c||1,d=d||0;for(var j=this,k=0,l=a.length;k<l;k+=3)e(new THREE.Vector3(a[k],a[k+1],a[k+2]));for(var m=this.vertices,n=[],k=0,o=0,l=b.length;k<l;k+=3,o++){var p=m[b[k]],q=m[b[k+1]],r=m[b[k+2]];n[o]=new THREE.Face3(p.index,q.index,r.index,[p.clone(),q.clone(),r.clone()])}for(var s=new THREE.Vector3,k=0,l=n.length;k<l;k++)!function(a,b){for(var c=Math.pow(2,b),d=(Math.pow(4,b),e(j.vertices[a.a])),g=e(j.vertices[a.b]),h=e(j.vertices[a.c]),i=[],k=0;k<=c;k++){i[k]=[];for(var l=e(d.clone().lerp(h,k/c)),m=e(g.clone().lerp(h,k/c)),n=c-k,o=0;o<=n;o++)i[k][o]=0==o&&k==c?l:e(l.clone().lerp(m,o/n))}for(var k=0;k<c;k++)for(var o=0;o<2*(c-k)-1;o++){var p=Math.floor(o/2);o%2==0?f(i[k][p+1],i[k+1][p],i[k][p]):f(i[k][p+1],i[k+1][p+1],i[k+1][p])}}(n[k],d);for(var k=0,l=this.faceVertexUvs[0].length;k<l;k++){var t=this.faceVertexUvs[0][k],u=t[0].x,v=t[1].x,w=t[2].x,x=Math.max(u,Math.max(v,w)),y=Math.min(u,Math.min(v,w));x>.9&&y<.1&&(u<.2&&(t[0].x+=1),v<.2&&(t[1].x+=1),w<.2&&(t[2].x+=1))}for(var k=0,l=this.vertices.length;k<l;k++)this.vertices[k].multiplyScalar(c);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var c=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],d=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,c,d,a,b),this.type="OctahedronGeometry",this.parameters={radius:a,detail:b}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e},a=a||100,b=b||40,c=c||8,d=d||6,e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],i=0;i<=c;i++)for(var j=0;j<=d;j++){var k=j/d*e,l=i/c*Math.PI*2;f.x=a*Math.cos(k),f.y=a*Math.sin(k);var m=new THREE.Vector3;m.x=(a+b*Math.cos(l))*Math.cos(k),m.y=(a+b*Math.cos(l))*Math.sin(k),m.z=b*Math.sin(l),this.vertices.push(m),g.push(new THREE.Vector2(j/d,i/c)),h.push(m.clone().sub(f).normalize())}for(var i=1;i<=c;i++)for(var j=1;j<=d;j++){var n=(d+1)*i+j-1,o=(d+1)*(i-1)+j-1,p=(d+1)*(i-1)+j,q=(d+1)*i+j,r=new THREE.Face3(n,o,q,[h[n].clone(),h[o].clone(),h[q].clone()]);this.faces.push(r),this.faceVertexUvs[0].push([g[n].clone(),g[o].clone(),g[q].clone()]),r=new THREE.Face3(o,p,q,[h[o].clone(),h[p].clone(),h[q].clone()]),this.faces.push(r),this.faceVertexUvs[0].push([g[o].clone(),g[p].clone(),g[q].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var c=function(a,b,c){var d=new THREE.Geometry;c=c?c:1;for(var e=0;e<=64*c;++e)"x"==b&&d.vertices.push(new THREE.Vector3(0,Math.cos(e/32*Math.PI),Math.sin(e/32*Math.PI)).multiplyScalar(a)),"y"==b&&d.vertices.push(new THREE.Vector3(Math.cos(e/32*Math.PI),0,Math.sin(e/32*Math.PI)).multiplyScalar(a)),"z"==b&&d.vertices.push(new THREE.Vector3(Math.sin(e/32*Math.PI),Math.cos(e/32*Math.PI),0).multiplyScalar(a));return d},d=function(a,b,c,d,e,f){var g=new THREE.Geometry,h=new THREE.Mesh(new THREE.CylinderGeometry(a,b,c,d,e,f));return h.position.y=.5,h.updateMatrix(),g.merge(h.geometry,h.matrix),g},e=function(a){var b=new THREE.Geometry;return"X"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===a&&b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),b};THREE.TransformGizmo=function(){var a=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;var c={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=c.XYZE,c.YZ.rotation.set(0,Math.PI/2,0),c.XZ.rotation.set(-Math.PI/2,0,0);for(var d in c)c[d].name=d,this.planes.add(c[d]),this.planes[d]=c[d],c[d].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=new THREE.Geometry;a.geometry instanceof THREE.BufferGeometry&&(a.geometry=(new THREE.Geometry).fromBufferGeometry(a.geometry)),b.merge(a.geometry,a.matrix),a.geometry=b,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(a){a.visible=!1})},this.show=function(){this.traverse(function(b){b.visible=!0,b.parent!=a.pickers&&b.parent!=a.hemiPicker||(b.visible=!1),b.parent==a.planes&&(b.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})},this.setupGizmos=function(){var a=function(a,b){for(var c in a)for(var d=a[c].length;d--;){var e=a[c][d][0],f=a[c][d][1],g=a[c][d][2],h=a[c][d][3];e.name=c,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),h&&(e.visble=h),b.add(e)}};this.setHandlePickerGizmos(),a(this.handleGizmos,this.handles),a(this.pickerGizmos,this.pickers),a(this.highlightGizmos,this.highlights),a(this.hemiPickerGizmos,this.hemiPicker),a(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){f.name&&(f.name.search("E")!=-1?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):f.name.search("X")==-1&&f.name.search("Y")==-1&&f.name.search("Z")==-1||f.quaternion.setFromEuler(a))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(0,.05,.2,12,1,!1),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:15805484}))]],Y:[[new THREE.Mesh(c,new a({color:768011})),[0,.5,0]],[new THREE.Line(g,new b({color:768011}))]],Z:[[new THREE.Mesh(c,new a({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new a({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),"XY"==a&&(this.activePlane=this.planes.XY),"YZ"==a&&(this.activePlane=this.planes.YZ),"XZ"==a&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(c(1,"x",.5),new b({color:16711680}))]],RY:[[new THREE.Line(c(1,"y",.5),new b({color:65280}))]],RZ:[[new THREE.Line(c(1,"z",.5),new b({color:255}))]],RE:[[new THREE.Line(c(1.25,"z",1),new b({color:65535}))]],RXYZE:[[new THREE.Line(c(1,"z",1),new b({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new a({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(a){"RE"==a&&(this.activePlane=this.planes.XYZE),"RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var b=this;this.setHandlePickerGizmos=function(){var b=d(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(b,new a({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new a({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new a({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new a({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new a({color:255})),null,null,!1]]}},this.setActivePlane=function(a,b){if("translate"==this.activeMode){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(a,b){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})}},this.show=function(){this.traverse(function(a){(null==b.parent||b.parent.useAllPickers||a.parent!=b.handles)&&(a.visible=!0),a.material&&(a.material.opacity=a.material.oldOpacity),a.parent!=b.pickers&&a.parent!=b.hemiPicker&&a.parent!=b.subPickers||(a.visible=!1),a.parent!=b.planes&&a.parent!=b.highlights||(a.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(a){this.traverse(function(c){c.material&&c.material.highlight&&(c.name==a?(c.parent!=b.highlights&&c.parent!=b.handles||(c.visible=!0),c.material.highlight(!0)):(c.material.highlight(!1),c.material.opacity=.1))})},this.init()},
THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(.125,.125,.125),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(a,b,c){function d(c,d){var e=b.getBoundingClientRect(),f=(c.clientX-e.left)/e.width*2-1,g=2*-((c.clientY-e.top)/e.height)+1;a.isPerspective?(r.set(f,g,.5),r.unproject(a),q.set(a.position,r.sub(a.position).normalize())):(r.set(f,g,-1),r.unproject(a),s.set(0,0,-1),q.set(r,s.transformDirection(a.matrixWorld)));var h=q.intersectObjects(d,!0);return!!h[0]&&h[0]}switch(THREE.Object3D.call(this),b=void 0!==b?b:document,this.gizmo={},c){case"translate":this.gizmo[c]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[c]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[c]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[c]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[c]),this.gizmo[c].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===c){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var f=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});e.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(e,f);var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var e=new THREE.CircleGeometry(.1,32),f=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:g});this.centerMark=new THREE.Mesh(e,f),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={};var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var f=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:g}),h=.25;this.ticks.RX=new THREE.Object3D;var e=new THREE.PlaneBufferGeometry(.12,h),i=new THREE.Mesh(e,f);i.position.set(0,0,-1.275),i.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(i),i=i.clone(),i.position.set(0,1.275,0),i.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(i),i=i.clone(),i.position.set(0,0,1.275),i.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(i),i=i.clone(),i.position.set(0,-1.275,0),i.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(i),this.ticks.RY=new THREE.Object3D,i=i.clone(),i.position.set(0,0,-1.275),i.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(i),i=i.clone(),i.position.set(-1.275,0,0),i.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(i),i=i.clone(),i.position.set(0,0,1.275),i.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(i),i=i.clone(),i.position.set(1.275,0,0),i.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(i)}var j=this,k=!1,l=c,m={type:"change"},n={type:"mouseDown"},o={type:"mouseUp",mode:l},p={type:"objectChange"},q=new THREE.Raycaster,r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3,x=1,y=new THREE.Matrix4,z=new THREE.Vector3,A=new THREE.Matrix4,B=new THREE.Vector3,C=new THREE.Quaternion,D=new THREE.Vector3,E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Quaternion,H=new THREE.Quaternion,I=new THREE.Quaternion,J=new THREE.Quaternion,K=new THREE.Quaternion,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Matrix4,O=new THREE.Matrix4,P=new THREE.Vector3,Q=new THREE.Vector3,R=new THREE.Euler,S=new THREE.Matrix4,T=new THREE.Vector3;new THREE.Euler;this.attach=function(a){j.object=a,this.gizmo[l].show(),j.update(),j.updateUnitVectors()},this.detach=function(a){j.object=void 0,this.axis=null,this.gizmo[l].hide()},this.setMode=function(a){l=a?a:l,"scale"==l&&(j.space="local"),this.gizmo[l].show(),this.update(),j.dispatchEvent(m)},this.getPicker=function(){return j.gizmo[l].hemiPicker.children},this.setPosition=function(a){this.object.position.copy(a),this.update()},this.setNormal=function(a){C.setFromUnitVectors(this.normal,a),this.unitX.applyQuaternion(C),this.unitY.applyQuaternion(C),this.unitZ.applyQuaternion(C),this.normal.copy(a),this.object&&this.object.quaternion.multiply(C),this.update()},this.setSnap=function(a,b){j.snap=a,j.snapDelta=b},this.setSize=function(a){j.size=a,this.update(),j.dispatchEvent(m)},this.setSpace=function(a){j.space=a,this.update(),j.dispatchEvent(m)},this.update=function(c){if(void 0!==j.object){j.object.updateMatrixWorld(),Q.setFromMatrixPosition(j.object.matrixWorld),R.setFromRotationMatrix(A.extractRotation(j.object.matrixWorld)),a.updateMatrixWorld(),T.setFromMatrixPosition(a.matrixWorld),this.position.copy(Q),this.quaternion.setFromEuler(R),this.normal.set(0,0,1),this.normal.applyEuler(R);var d=Q.distanceTo(T);x=100*(a.isPerspective?2*Math.tan(a.fov*Math.PI/360)*d:d)/b.getBoundingClientRect().height,this.scale.set(x,x,x),c&&this.gizmo[l].highlight(j.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(R),this.unitY.applyEuler(R),this.unitZ.applyEuler(R)},this.showRotationGizmos=function(a){for(var b=this.gizmo[l].handles.children,c=0;c<b.length;c++){var d=b[c];d.visible=!0,d.name.search("R")!==-1&&(d.visible=a)}this.useAllPickers=a},this.highlight=function(){this.gizmo[l].highlight(this.axis||"Z")},this.onPointerHover=function(a){if(void 0===j.object||k===!0)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,j.useAllPickers?j.gizmo[l].pickers.children:j.gizmo[l].subPickers.children),e=null,f="";return c&&(e=c.object.name,f=e.search("R")!=-1?"rotate":"translate"),j.axis!==e&&(j.axis=e,j.gizmo[l].activeMode=f,j.update(!0),j.dispatchEvent(m)),null===j.axis&&j.gizmo[l].show(),!!c},this.onPointerDown=function(b){if(void 0===j.object||k===!0)return!1;var c=b.pointers?b.pointers[0]:b;if("touch"===b.pointerType){var e=d(c,j.useAllPickers?j.gizmo[l].pickers.children:j.gizmo[l].subPickers.children),f=null,g="";e&&(f=e.object.name,g=f.search("R")!=-1?"rotate":"translate"),j.axis!==f&&(j.axis=f,j.gizmo[l].activeMode=g)}var e=null;if((0===c.button||void 0===c.button)&&(e=d(c,j.useAllPickers?j.gizmo[l].pickers.children:j.gizmo[l].subPickers.children))){j.dispatchEvent(n),j.axis=e.object.name,j.update(),z.copy(a.position).sub(Q).normalize(),j.gizmo[l].setActivePlane(j.axis,z);var h=d(c,[j.gizmo[l].activePlane]);if(h&&u.copy(h.point),L.copy(j.object.position),M.copy(j.object.scale),N.extractRotation(j.object.matrix),S.extractRotation(j.object.matrixWorld),j.object.parent?(O.extractRotation(j.object.parent.matrixWorld),P.setFromMatrixScale(A.getInverse(j.object.parent.matrixWorld))):(O.extractRotation(j.object.matrixWorld),P.setFromMatrixScale(A.getInverse(j.object.matrixWorld))),"transrotate"===l&&"rotate"===j.gizmo[l].activeMode){j.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(j.matrixWorld),j.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(j.matrixWorld),j.startLine.geometry.verticesNeedUpdate=!0,j.parent.add(j.startLine);var i=j.object.geometry.getAttribute("position"),m=(new THREE.Vector3).fromAttribute(i,0).applyMatrix4(j.object.matrixWorld),o=(new THREE.Vector3).fromAttribute(i,1).applyMatrix4(j.object.matrixWorld),p=(new THREE.Vector3).fromAttribute(i,2).applyMatrix4(j.object.matrixWorld),q=(new THREE.Vector3).fromAttribute(i,3).applyMatrix4(j.object.matrixWorld);if("RX"===j.axis){m.lerp(p,.5),o.lerp(q,.5);var r=m.distanceTo(o);j.centerLine.material.dashSize=r/15,j.centerLine.material.gapSize=r/30,j.centerLine.geometry.vertices[0].copy(m),j.centerLine.geometry.vertices[1].copy(o)}else{m.lerp(o,.5),p.lerp(q,.5);var r=m.distanceTo(p);j.centerLine.material.dashSize=r/15,j.centerLine.material.gapSize=r/30,j.centerLine.geometry.vertices[0].copy(m),j.centerLine.geometry.vertices[1].copy(p)}j.centerLine.geometry.computeLineDistances(),j.centerLine.geometry.verticesNeedUpdate=!0,j.parent.add(j.centerLine),j.ticks[j.axis].position.copy(j.position),j.ticks[j.axis].quaternion.copy(j.quaternion),j.ticks[j.axis].scale.copy(j.scale),j.parent.add(j.ticks[j.axis])}}return k=!0,!!e},this.onPointerMove=function(a){if(void 0===j.object||null===j.axis||k===!1)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,[j.gizmo[l].activePlane]);c&&t.copy(c.point);var e=j.gizmo[l].activeMode;if("translate"==e)t.sub(u),t.multiply(P),"local"==j.space&&(t.applyMatrix4(A.getInverse(S)),D.copy(this.unitX),E.copy(this.unitY),F.copy(this.unitZ),B.set(0,0,0),j.axis.search("X")!=-1&&(D.multiplyScalar(t.dot(this.unitX)),B.add(D)),j.axis.search("Y")!=-1&&(E.multiplyScalar(t.dot(this.unitY)),B.add(E)),j.axis.search("Z")!=-1&&(F.multiplyScalar(t.dot(this.unitZ)),B.add(F)),t.copy(B),t.applyMatrix4(N),j.object.position.copy(L),j.object.position.add(t)),"world"!=j.space&&j.axis.search("XYZ")==-1||(D.copy(this.unitX),E.copy(this.unitY),F.copy(this.unitZ),B.set(0,0,0),j.axis.search("X")!=-1&&(D.multiplyScalar(t.dot(this.unitX)),B.add(D)),j.axis.search("Y")!=-1&&(E.multiplyScalar(t.dot(this.unitY)),B.add(E)),j.axis.search("Z")!=-1&&(F.multiplyScalar(t.dot(this.unitZ)),B.add(F)),t.copy(B),t.applyMatrix4(A.getInverse(O)),j.object.position.copy(L),j.object.position.add(t));else if("scale"==e)t.sub(u),t.multiply(P),"local"==j.space&&("XYZ"==j.axis?(x=1+t.y/50,j.object.scale.x=M.x*x,j.object.scale.y=M.y*x,j.object.scale.z=M.z*x):(t.applyMatrix4(A.getInverse(S)),"X"==j.axis&&(j.object.scale.x=M.x*(1+t.x/50)),"Y"==j.axis&&(j.object.scale.y=M.y*(1+t.y/50)),"Z"==j.axis&&(j.object.scale.z=M.z*(1+t.z/50))));else if("rotate"==e){if(t.sub(Q),t.multiply(P),B.copy(u).sub(Q),B.multiply(P),"RE"==j.axis){t.applyMatrix4(A.getInverse(y)),B.applyMatrix4(A.getInverse(y)),v.set(Math.atan2(t.z,t.y),Math.atan2(t.x,t.z),Math.atan2(t.y,t.x)),w.set(Math.atan2(B.z,B.y),Math.atan2(B.x,B.z),Math.atan2(B.y,B.x)),C.setFromRotationMatrix(A.getInverse(O));var f=v.z-w.z;if(null!==j.snap){var g=Math.round(f/j.snap)*j.snap;Math.abs(g-f)<j.snapDelta&&(f=g)}K.setFromAxisAngle(z,f),G.setFromRotationMatrix(S),C.multiplyQuaternions(C,K),C.multiplyQuaternions(C,G),j.object.quaternion.copy(C)}else if("RXYZE"==j.axis){var h=t.clone().cross(B).normalize();C.setFromRotationMatrix(A.getInverse(O));var i=-t.clone().angleTo(B);if(null!==j.snap){var g=Math.round(i/j.snap)*j.snap;Math.abs(g-i)<j.snapDelta&&(i=g)}H.setFromAxisAngle(h,i),G.setFromRotationMatrix(S),C.multiplyQuaternions(C,H),C.multiplyQuaternions(C,G),j.object.quaternion.copy(C)}else if("local"==j.space){t.applyMatrix4(A.getInverse(S)),B.applyMatrix4(A.getInverse(S));var n=t.dot(this.unitX),o=t.dot(this.unitY),q=t.dot(this.unitZ),r=B.dot(this.unitX),s=B.dot(this.unitY),R=B.dot(this.unitZ);v.set(Math.atan2(q,o),Math.atan2(n,q),Math.atan2(o,n)),w.set(Math.atan2(R,s),Math.atan2(r,R),Math.atan2(s,r));var T=v.x-w.x,U=v.y-w.y,f=v.z-w.z;if(null!==j.snap){if(j.axis.search("X")!=-1){var g=Math.round(T/j.snap)*j.snap;Math.abs(g-T)<j.snapDelta&&(T=g)}if(j.axis.search("Y")!=-1){var g=Math.round(U/j.snap)*j.snap;Math.abs(g-U)<j.snapDelta&&(U=g)}if(j.axis.search("Z")!=-1){var g=Math.round(f/j.snap)*j.snap;Math.abs(g-f)<j.snapDelta&&(f=g)}}H.setFromAxisAngle(this.unitX,T),I.setFromAxisAngle(this.unitY,U),J.setFromAxisAngle(this.unitZ,f),G.setFromRotationMatrix(N),"RX"==j.axis&&G.multiplyQuaternions(G,H),"RY"==j.axis&&G.multiplyQuaternions(G,I),"RZ"==j.axis&&G.multiplyQuaternions(G,J),j.object.quaternion.copy(G)}else if("world"==j.space){var n=t.dot(this.unitX),o=t.dot(this.unitY),q=t.dot(this.unitZ),r=B.dot(this.unitX),s=B.dot(this.unitY),R=B.dot(this.unitZ);v.set(Math.atan2(q,o),Math.atan2(n,q),Math.atan2(o,n)),w.set(Math.atan2(R,s),Math.atan2(r,R),Math.atan2(s,r)),C.setFromRotationMatrix(A.getInverse(O));var T=v.x-w.x,U=v.y-w.y,f=v.z-w.z;if(null!==j.snap){if(j.axis.search("X")!=-1){var g=Math.round(T/j.snap)*j.snap;Math.abs(g-T)<j.snapDelta&&(T=g)}if(j.axis.search("Y")!=-1){var g=Math.round(U/j.snap)*j.snap;Math.abs(g-U)<j.snapDelta&&(U=g)}if(j.axis.search("Z")!=-1){var g=Math.round(f/j.snap)*j.snap;Math.abs(g-f)<j.snapDelta&&(f=g)}}H.setFromAxisAngle(this.unitX,T),I.setFromAxisAngle(this.unitY,U),J.setFromAxisAngle(this.unitZ,f),G.setFromRotationMatrix(S),"RX"==j.axis&&C.multiplyQuaternions(C,H),"RY"==j.axis&&C.multiplyQuaternions(C,I),"RZ"==j.axis&&C.multiplyQuaternions(C,J),C.multiplyQuaternions(C,G),j.object.quaternion.copy(C)}"transrotate"===l&&(j.add(j.endLine),j.add(j.centerMark))}return j.object.matrixAutoUpdate=!0,j.update(!0),j.dispatchEvent(m),j.dispatchEvent(p),!!c},this.onPointerUp=function(a){return k&&null!==j.axis&&(o.mode=l,j.dispatchEvent(o)),k=!1,this.gizmo[l].show(),this.updateUnitVectors(),"transrotate"===l&&"rotate"===this.gizmo[l].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}var AutodeskNamespace=function(a){for(var b=getGlobal(),c=a.split("."),d=0;d<c.length;++d)b[c[d]]=b[c[d]]||{},b=b[c[d]];return b};AutodeskNamespace("Autodesk.Viewing.Private"),AutodeskNamespace("Autodesk.Viewing.Extensions"),AutodeskNamespace("Autodesk.Viewing.Shaders"),AutodeskNamespace("Autodesk.Viewing.UI"),AutodeskNamespace("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=getGlobal,Autodesk.Viewing.AutodeskNamespace=AutodeskNamespace,Autodesk.Viewing.Private.initializeLegacyNamespaces=function(a){var b=Autodesk.Viewing,c=b.Shaders,d=b.Private;d.InstanceTreeStorage=WGS.InstanceTreeStorage,d.InstanceTreeAccess=WGS.InstanceTreeAccess,d.BVHBuilder=WGS.BVHBuilder,d.NodeArray=WGS.NodeArray,a||(c.PackDepthShaderChunk=WGS.PackDepthShaderChunk,c.TonemapShaderChunk=WGS.TonemapShaderChunk,c.OrderedDitheringShaderChunk=WGS.OrderedDitheringShaderChunk,c.CutPlanesUniforms=WGS.CutPlanesUniforms,c.CutPlanesShaderChunk=WGS.CutPlanesShaderChunk,c.PackNormalsShaderChunk=WGS.PackNormalsShaderChunk,c.HatchPatternShaderChunk=WGS.HatchPatternShaderChunk,c.EnvSamplingShaderChunk=WGS.EnvSamplingShaderChunk,c.IdUniforms=WGS.IdUniforms,c.IdFragmentDeclaration=WGS.IdFragmentDeclaration,c.IdOutputShaderChunk=WGS.IdOutputShaderChunk,c.FinalOutputShaderChunk=WGS.FinalOutputShaderChunk,c.ThemingUniform=WGS.ThemingUniform,c.ThemingFragmentDeclaration=WGS.ThemingFragmentDeclaration,c.ThemingFragmentShaderChunk=WGS.ThemingFragmentShaderChunk,c.BackgroundShader=WGS.BackgroundShader,c.BlendShader=WGS.BlendShader,c.CelShader=WGS.CelShader,c.CopyShader=WGS.CopyShader,c.FXAAShader=WGS.FXAAShader,c.SAOBlurShader=WGS.SAOBlurShader,c.SAOMinifyFirstShader=WGS.SAOMinifyFirstShader,c.SAOMinifyShader=WGS.SAOMinifyShader,c.SAOShader=WGS.SAOShader,c.NormalsShader=WGS.NormalsShader,c.LineShader=WGS.LineShader,d.LineStyleDefs=WGS.LineStyleDefs,d.CreateLinePatternTexture=WGS.CreateLinePatternTexture,d.FloatToHalf=WGS.FloatToHalf,d.HalfToFloat=WGS.HalfToFloat,d.IntToHalf=WGS.IntToHalf,d.HalfToInt=WGS.HalfToInt,d.HalfTest=WGS.HalfTest,c.createShaderMaterial=WGS.createShaderMaterial,c.setMacro=WGS.setMacro,c.removeMacro=WGS.removeMacro,c.LmvShaderPass=WGS.ShaderPass,c.GaussianPass=WGS.GaussianPass,c.GroundShadow=WGS.GroundShadow,c.createGroundShape=WGS.createGroundShape,c.setGroundShapeTransform=WGS.setGroundShapeTransform,c.GroundReflection=WGS.GroundReflection,d.FireflyWebGLShader=WGS.WebGLShader,d.PrismMaps=WGS.PrismMaps,d.GetPrismMapChunk=WGS.GetPrismMapChunk,d.FireflyWebGLProgram=WGS.WebGLProgram,c.ShadowMapCommonUniforms=WGS.ShadowMapCommonUniforms,c.ShadowMapUniforms=WGS.ShadowMapUniforms,c.ShadowMapDeclareCommonUniforms=WGS.ShadowMapDeclareCommonUniforms,c.ShadowMapVertexDeclaration=WGS.ShadowMapVertexDeclaration,c.ShadowMapVertexShaderChunk=WGS.ShadowMapVertexShaderChunk,c.ShadowMapFragmentDeclaration=WGS.ShadowMapFragmentDeclaration,c.FireflyPhongShader=WGS.PhongShader,c.PrismShader=WGS.PrismShader,c.GetPrismMapUniforms=WGS.GetPrismMapUniforms,c.GetPrismMapSampleChunk=WGS.GetPrismMapSampleChunk,c.GetPrismMapUniformChunk=WGS.GetPrismMapUniformChunk,c.AverageOfFloat3=WGS.AverageOfFloat3,d.createPrismMaterial=WGS.createPrismMaterial,d.clonePrismMaterial=WGS.clonePrismMaterial,d.ShadowMapShader=WGS.ShadowMapShader,d.GroundShadowShader=WGS.GroundShadowShader,d.ShadowMapOverrideMaterials=WGS.ShadowMapOverrideMaterials,d.SHADOWMAP_NEEDS_UPDATE=WGS.SHADOWMAP_NEEDS_UPDATE,d.SHADOWMAP_INCOMPLETE=WGS.SHADOWMAP_INCOMPLETE,d.SHADOWMAP_VALID=WGS.SHADOWMAP_VALID,d.ShadowConfig=WGS.ShadowConfig,d.ShadowRender=WGS.ShadowRender,d.ShadowMaps=WGS.ShadowMaps,d.FrustumIntersector=WGS.FrustumIntersector,d.OUTSIDE=WGS.OUTSIDE,d.INTERSECTS=WGS.INTERSECTS,d.CONTAINS=WGS.CONTAINS,d.VBIntersector=WGS.VBIntersector,d.memoryOptimizedLoading=WGS.memoryOptimizedLoading,d.GPU_MEMORY_LIMIT=WGS.GPU_MEMORY_LIMIT,d.GPU_OBJECT_LIMIT=WGS.GPU_OBJECT_LIMIT,d.FRAGS_PERSISTENT_COUNT=WGS.FRAGS_PERSISTENT_COUNT,d.FRAGS_PERSISTENT_MAX_COUNT=WGS.FRAGS_PERSISTENT_MAX_COUNT,d.MAX_2D_PERSISTENT_BUFFER_COUNT=WGS.MAX_2D_PERSISTENT_BUFFER_COUNT,d.PAGE_OUT_COUNT_2D=WGS.PAGE_OUT_COUNT_2D,d.PAGE_OUT_GOAL_2D=WGS.PAGE_OUT_GOAL_2D,d.GEOMS_COUNT_LIMIT=WGS.GEOMS_COUNT_LIMIT,d.onDemandLoading=WGS.onDemandLoading,d.cullGeometryOnLoading=WGS.cullGeometryOnLoading,d.pageOutGeometryEnabled=WGS.pageOutGeometryEnabled,d.PAGEOUT_SUCCESS=WGS.PAGEOUT_SUCCESS,d.PAGEOUT_FAIL=WGS.PAGEOUT_FAIL,d.PAGEOUT_NONE=WGS.PAGEOUT_NONE,d.PAGEOUT_PERCENTAGE=WGS.PAGEOUT_PERCENTAGE,d.GEOMS_PAGEOUT_COUNT=WGS.GEOMS_PAGEOUT_COUNT,d.GeometryList=WGS.GeometryList,d.MESH_VISIBLE=WGS.MESH_VISIBLE,d.MESH_HIGHLIGHTED=WGS.MESH_HIGHLIGHTED,d.MESH_HIDE=WGS.MESH_HIDE,d.MESH_ISLINE=WGS.MESH_ISLINE,d.MESH_ISWIDELINE=WGS.MESH_ISWIDELINE,d.MESH_ISPOINT=WGS.MESH_ISPOINT,d.MESH_MOVED=WGS.MESH_MOVED,d.MESH_TRAVERSED=WGS.MESH_TRAVERSED,d.MESH_DRAWN=WGS.MESH_DRAWN,d.MESH_RENDERFLAG=WGS.MESH_RENDERFLAG,d.FragmentPointer=WGS.FragmentPointer,d.FragmentList=WGS.FragmentList,d.RENDER_NORMAL=WGS.RENDER_NORMAL,d.RENDER_HIGHLIGHTED=WGS.RENDER_HIGHLIGHTED,d.RENDER_HIDDEN=WGS.RENDER_HIDDEN,d.RENDER_SHADOWMAP=WGS.RENDER_SHADOWMAP,d.RENDER_FINISHED=WGS.RENDER_FINISHED,d.RenderBatch=WGS.RenderBatch,b.rescueFromPolymer=WGS.rescueFromPolymer,d.FireflyWebGLRenderer=WGS.WebGLRenderer,d.ModelIteratorLinear=WGS.ModelIteratorLinear,d.ModelIteratorBVH=WGS.ModelIteratorBVH,d.BufferGeometryUtils=WGS.BufferGeometry,d.RenderScene=WGS.RenderScene,d.SortedList=WGS.SortedList,d.ModelIteratorTexQuad=WGS.ModelIteratorTexQuad,d.TexQuadConfig=WGS.TexQuadConfig,d.InstanceTree=WGS.InstanceTree,b.SelectionMode=WGS.SelectionMode,d.MaterialConverter=WGS.MaterialConverter)};var av=Autodesk.Viewing,avp=av.Private;av.getGlobal=getGlobal;var isBrowser=av.isBrowser="undefined"!=typeof navigator,isIE11=av.isIE11=isBrowser&&!!navigator.userAgent.match(/Edge|Trident\/7\./);"undefined"!=typeof window&&isIE11&&function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.CustomEvent.prototype,window.CustomEvent=a}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){if(!b||b>this.byteLength?b=this.byteLength:b<0&&(b=this.byteLength+b)<0&&(b=0),a<0&&(a=this.byteLength+a)<0&&(a=0),b<=a)return new ArrayBuffer;for(var c=b-a,d=new Uint8Array(this,a,c),e=new Uint8Array(c),f=0;f<c;f++)e[f]=d[f];return e.buffer}),function(){Math.log2=Math.log2||function(a){return Math.log(a)/Math.LN2}}(),"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);var launchFullscreen=av.launchFullscreen=function(a,b){a.requestFullscreen?a.requestFullscreen(b):a.mozRequestFullScreen?a.mozRequestFullScreen(b):a.webkitRequestFullscreen?a.webkitRequestFullscreen(b):a.msRequestFullscreen&&a.msRequestFullscreen(b)},exitFullscreen=av.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},inFullscreen=av.inFullscreen=function(){return"webkitIsFullScreen"in document?document.webkitIsFullScreen:!!(document.mozFullScreenElement||document.msFullscreenElement||document.fullscreenElement||document.querySelector(".viewer-fill-browser"))},fullscreenElement=av.fullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},isFullscreenAvailable=av.isFullscreenAvailable=function(a){return a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen},getAndroidVersion=av.getAndroidVersion=function(a){var a=a||navigator.userAgent,b=a.match(/Android\s([0-9\.]*)/);return!!b&&b[1]},isTouchDevice=av.isTouchDevice=function(){return"undefined"!=typeof window&&"ontouchstart"in window};av.isIOSDevice=function(){return!!isBrowser&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())},av.isAndroidDevice=function(){return!!isBrowser&&navigator.userAgent.toLowerCase().indexOf("android")!==-1},av.isMobileDevice=function(){return!!isBrowser&&(av.isIOSDevice()||av.isAndroidDevice())},av.isSafari=function(){if(!isBrowser)return!1;var a=navigator.userAgent.toLowerCase();return a.indexOf("safari")!==-1&&a.indexOf("chrome")===-1},av.isFirefox=function(){return!!isBrowser&&navigator.userAgent.toLowerCase().indexOf("firefox")!==-1},av.isMac=function(){return!!isBrowser&&navigator.userAgent.toLowerCase().indexOf("mac os")!==-1},av.isWindows=function(){if(!isBrowser)return!1;var a=navigator.userAgent.toLowerCase();return a.indexOf("win32")!==-1||a.indexOf("windows")!==-1};var detectWebGL=av.detectWebGL=function(){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1,d=0;d<4;d++)try{if(c=a.getContext(b[d]),(c=rescueFromPolymer(c))&&"function"==typeof c.getParameter)return 1}catch(a){}return 0}return-1},touchStartToClick=av.touchStartToClick=function(a){a.preventDefault(),a.stopPropagation(),a.target.click()};!function(){var a=getGlobal();a.performance||(a.performance=Date)}(),Number.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},String.prototype.repeat=String.prototype.repeat||function(a){if(a<1)return"";for(var b="",c=this.valueOf();a>1;)1&a&&(b+=c),a>>=1,c+=c;return b+c};var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private;if(avp.BUILD_LMV_WORKER_URL="lmvworker.min.js",avp.LMV_WORKER_URL=avp.BUILD_LMV_WORKER_URL,avp.ENABLE_DEBUG=avp.ENABLE_DEBUG||!1,avp.ENABLE_TRACE=avp.ENABLE_TRACE||!1,avp.ENABLE_INLINE_WORKER=!0,function(){"use strict";function a(){this.adp=null,this.runtimeStats={},this.level=-1,this.setLevel(d.ENABLE_TRACE?d.LogLevels.DEBUG:d.LogLevels.ERROR)}function b(){return"undefined"!=typeof window?encodeURI(window.location.href):""}var c=Autodesk.Viewing,d=Autodesk.Viewing.Private;d.LogLevels={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0},a.prototype.initialize=function(a){if(a.eventCallback&&(this.callback=a.eventCallback),this.sessionId=a.sessionId,!this.sessionId){var e=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+e.substring(4))}this.environmentInfo={touch:c.isTouchDevice(),env:d.env,referer:b(),version:LMV_VIEWER_VERSION,patch:LMV_VIEWER_PATCH,build_type:LMV_BUILD_TYPE};var f={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,patch:this.environmentInfo.patch,build_type:this.environmentInfo.build_type};this.track(f);var g=this;this.interval=setInterval(function(){g.reportRuntimeStats()},6e4)},a.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},a.prototype.track=function(a){if(this.updateRuntimeStats(a),!d.offline&&this.sessionId){a.timestamp=Date.now(),a.sessionId=this.sessionId;var b=this.logToADP(a);this.callback&&this.callback(a,{adp:b})}},a.prototype.logToADP=function(a){if(!this.adp)return!1;var c="",d="";switch(a.category){case"tool_changed":case"pref_changed":c="CLICK_OPERATION",d=a.category+"/"+a.name;break;case"screen_mode":c="CLICK_OPERATION",d="pref_changed/"+a.category;break;case"metadata_load_stats":c="DOCUMENT_START",d="stats",a.full_url=b();break;case"model_load_stats":c="DOCUMENT_FULL",d="stats";break;case"error":c="BACKGROUND_CALL",d="error"}return!!c&&(this.adp.trackEvent(c,{operation:{id:a.sessionId,type:d,stage:"",status:"C",meta:a}}),!0)},a.prototype.updateRuntimeStats=function(a){if(a.hasOwnProperty("aggregate"))switch(a.aggregate){case"count":this.runtimeStats[a.name]>0?this.runtimeStats[a.name]++:this.runtimeStats[a.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[a.name]=a.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},a.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.adp&&this.adp.trackEvent("BACKGROUND_CALL",{operation:{id:this.sessionId,type:"stats",stage:"",status:"C",meta:this.runtimeStats}}),this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},a.prototype.setLevel=function(a){if(this.level!==a){this.level=a;var b=function(){},c=d.LogLevels,e=this,f=function(){if(e.callback){var a=Array.prototype.slice.call(arguments).join(" ");e.callback({category:"error",message:a},{adp:!1})}console.error.apply(console,arguments)};this.debug=a>=c.DEBUG?console.log.bind(console):b,this.log=a>=c.LOG?console.log.bind(console):b,this.info=a>=c.INFO?console.info.bind(console):b,this.warn=a>=c.WARNING?console.warn.bind(console):b,this.error=a>=c.ERROR?f:b}},Autodesk.Viewing.Private.logger=new a}(),"undefined"!=typeof window&&function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return!!Array.isArray(a)&&(g(a,c[b],c),!0)}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];s(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],(e=c?c+f:b)in a)return e;g++}return d}function w(){return oa++}function x(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow}function y(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){l(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a){var b=a.options.inputClass;return new(b?b:ra?N:sa?Q:qa?S:M)(a,A)}function A(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&wa&&d-e==0,g=b&(ya|za)&&d-e==0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,B(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function B(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=E(b)),e>1&&!c.firstMultiple?c.firstMultiple=E(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=F(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=J(h,i),b.distance=I(h,i),C(c,b),b.offsetDirection=H(b.deltaX,b.deltaY),b.scale=g?L(g.pointers,d):1,b.rotation=g?K(g.pointers,d):0,D(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function C(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===wa||f.eventType===ya)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function D(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=za&&(i>va||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=G(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=H(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function E(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:F(b),deltaX:a.deltaX,deltaY:a.deltaY}}function F(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function G(a,b,c){return{x:b/a||0,y:c/a||0}}function H(a,b){return a===b?Aa:ma(a)>=ma(b)?a>0?Ba:Ca:b>0?Da:Ea}function I(a,b,c){c||(c=Ia);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function J(a,b,c){c||(c=Ia);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function K(a,b){return J(b[1],b[0],Ja)-J(a[1],a[0],Ja)}function L(a,b){return I(b[0],b[1],Ja)/I(a[0],a[1],Ja)}function M(){this.evEl=La,this.evWin=Ma,this.allow=!0,this.pressed=!1,y.apply(this,arguments)}function N(){this.evEl=Pa,this.evWin=Qa,y.apply(this,arguments),
this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=Sa,this.evWin=Ta,this.started=!1,y.apply(this,arguments)}function P(a,b){var c=t(a.touches),d=t(a.changedTouches);return b&(ya|za)&&(c=u(c.concat(d),"identifier",!0)),[c,d]}function Q(){this.evTarget=Va,this.targetIds={},y.apply(this,arguments)}function R(a,b){var c=t(a.touches),d=this.targetIds;if(b&(wa|xa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return p(a.target,i)}),b===wa)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(ya|za)&&delete d[g[e].identifier],e++;return h.length?[u(f.concat(h),"identifier",!0),h]:void 0}function S(){y.apply(this,arguments);var a=k(this.handler,this);this.touch=new Q(this.manager,a),this.mouse=new M(this.manager,a)}function T(a,b){this.manager=a,this.set(b)}function U(a){if(q(a,_a))return _a;var b=q(a,ab),c=q(a,bb);return b&&c?ab+" "+bb:b||c?b?ab:bb:q(a,$a)?$a:Za}function V(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=cb,this.simultaneous={},this.requireFail=[]}function W(a){return a&hb?"cancel":a&fb?"end":a&eb?"move":a&db?"start":""}function X(a){return a==Ea?"down":a==Da?"up":a==Ba?"left":a==Ca?"right":""}function Y(a,b){var c=b.manager;return c?c.get(a):a}function Z(){V.apply(this,arguments)}function $(){Z.apply(this,arguments),this.pX=null,this.pY=null}function _(){Z.apply(this,arguments)}function aa(){V.apply(this,arguments),this._timer=null,this._input=null}function ba(){Z.apply(this,arguments)}function ca(){Z.apply(this,arguments)}function da(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ea(a,b){return b=b||{},b.recognizers=m(b.recognizers,ea.defaults.preset),new fa(a,b)}function fa(a,b){b=b||{},this.options=i(b,ea.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=z(this),this.touchAction=new T(this,this.options.touchAction),ga(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ga(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function ha(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ia=["","webkit","moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now,oa=1,pa=/mobile|tablet|ip(ad|hone|od)|android/i,qa="ontouchstart"in a,ra=v(a,"PointerEvent")!==d,sa=qa&&pa.test(navigator.userAgent),ta="touch",ua="mouse",va=25,wa=1,xa=2,ya=4,za=8,Aa=1,Ba=2,Ca=4,Da=8,Ea=16,Fa=Ba|Ca,Ga=Da|Ea,Ha=Fa|Ga,Ia=["x","y"],Ja=["clientX","clientY"];y.prototype={handler:function(){},init:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(x(this.element),this.evWin,this.domHandler)}};var Ka={mousedown:wa,mousemove:xa,mouseup:ya},La="mousedown",Ma="mousemove mouseup";j(M,y,{handler:function(a){var b=Ka[a.type];b&wa&&0===a.button&&(this.pressed=!0),b&xa&&1!==a.which&&(b=ya),this.pressed&&this.allow&&(b&ya&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:ua,srcEvent:a}))}});var Na={pointerdown:wa,pointermove:xa,pointerup:ya,pointercancel:za,pointerout:za},Oa={2:ta,3:"pen",4:ua,5:"kinect"},Pa="pointerdown",Qa="pointermove pointerup pointercancel";a.MSPointerEvent&&(Pa="MSPointerDown",Qa="MSPointerMove MSPointerUp MSPointerCancel"),j(N,y,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Na[d],f=Oa[a.pointerType]||a.pointerType,g=f==ta,h=s(b,a.pointerId,"pointerId");e&wa&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(ya|za)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Ra={touchstart:wa,touchmove:xa,touchend:ya,touchcancel:za},Sa="touchstart",Ta="touchstart touchmove touchend touchcancel";j(O,y,{handler:function(a){var b=Ra[a.type];if(b===wa&&(this.started=!0),this.started){var c=P.call(this,a,b);b&(ya|za)&&c[0].length-c[1].length==0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}});var Ua={touchstart:wa,touchmove:xa,touchend:ya,touchcancel:za},Va="touchstart touchmove touchend touchcancel";j(Q,y,{handler:function(a){var b=Ua[a.type],c=R.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}),j(S,y,{handler:function(a,b,c){var d=c.pointerType==ta,e=c.pointerType==ua;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(ya|za)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Wa=v(ja.style,"touchAction"),Xa=Wa!==d,Ya="compute",Za="auto",$a="manipulation",_a="none",ab="pan-x",bb="pan-y";T.prototype={set:function(a){a==Ya&&(a=this.compute()),Xa&&(this.manager.element.style[Wa]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(" "))},preventDefaults:function(a){if(!Xa){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,_a),f=q(d,bb),g=q(d,ab);return e||f&&c&Fa||g&&c&Ga?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var cb=1,db=2,eb=4,fb=8,gb=fb,hb=16;V.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=Y(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=Y(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=Y(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=Y(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?W(d):""),a)}var c=this,d=this.state;fb>d&&b(!0),b(),d>=fb&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=32)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(32|cb)))return!1;a++}return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(gb|hb|32)&&(this.state=cb),this.state=this.process(b),void(this.state&(db|eb|fb|hb)&&this.tryEmit(b))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}},j(Z,V,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(db|eb),e=this.attrTest(a);return d&&(c&za||!e)?b|hb:d||e?c&ya?b|fb:b&db?b|eb:db:32}}),j($,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ha},getTouchAction:function(){var a=this.options.direction,b=[];return a&Fa&&b.push(bb),a&Ga&&b.push(ab),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Fa?(e=0===f?Aa:0>f?Ba:Ca,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Aa:0>g?Da:Ea,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Z.prototype.attrTest.call(this,a)&&(this.state&db||!(this.state&db)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(_,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[_a]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&db)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(aa,V,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Za]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(ya|za)&&!f)this.reset();else if(a.eventType&wa)this.reset(),this._timer=e(function(){this.state=gb,this.tryEmit()},b.time,this);else if(a.eventType&ya)return gb;return 32},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===gb&&(a&&a.eventType&ya?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),j(ba,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[_a]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&db)}}),j(ca,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Fa|Ga,pointers:1},getTouchAction:function(){return $.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Fa|Ga)?b=a.velocity:c&Fa?b=a.velocityX:c&Ga&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&ma(b)>this.options.velocity&&a.eventType&ya},emit:function(a){var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(da,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[$a]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&wa&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=ya)return this.failTimeout();var g=!this.pTime||a.timeStamp-this.pTime<b.interval,h=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;if(0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=e(function(){this.state=gb,this.tryEmit()},b.interval,this),db):gb}return 32},failTimeout:function(){return this._timer=e(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==gb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ea.VERSION="2.0.4",ea.defaults={domEvents:!1,touchAction:Ya,enable:!0,inputTarget:null,inputClass:null,preset:[[ba,{enable:!1}],[_,{enable:!1},["rotate"]],[ca,{direction:Fa}],[$,{direction:Fa},["swipe"]],[da],[da,{event:"doubletap",taps:2},["tap"]],[aa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};fa.prototype={set:function(a){return h(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?2:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&gb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],2===b.stopped||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(db|eb|fb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof V)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ha(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ga(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(ea,{INPUT_START:wa,INPUT_MOVE:xa,INPUT_END:ya,INPUT_CANCEL:za,STATE_POSSIBLE:cb,STATE_BEGAN:db,STATE_CHANGED:eb,STATE_ENDED:fb,STATE_RECOGNIZED:gb,STATE_CANCELLED:hb,STATE_FAILED:32,DIRECTION_NONE:Aa,DIRECTION_LEFT:Ba,DIRECTION_RIGHT:Ca,DIRECTION_UP:Da,DIRECTION_DOWN:Ea,DIRECTION_HORIZONTAL:Fa,DIRECTION_VERTICAL:Ga,DIRECTION_ALL:Ha,Manager:fa,Input:y,TouchAction:T,TouchInput:Q,MouseInput:M,PointerEventInput:N,TouchMouseInput:S,SingleTouchInput:O,Recognizer:V,AttrRecognizer:Z,Tap:da,Pan:$,Swipe:ca,Pinch:_,Rotate:ba,Press:aa,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),"undefined"!=typeof module&&module.exports,a.Hammer=ea}(window,document),LmvMatrix4=function(a){this.elements=a?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},LmvMatrix4.prototype={constructor:LmvMatrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},multiply:function(a){return this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0==u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},transformPoint:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;return a.x=e[0]*b+e[4]*c+e[8]*d+e[12],a.y=e[1]*b+e[5]*c+e[9]*d+e[13],a.z=e[2]*b+e[6]*c+e[10]*d+e[14],a},transformDirection:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;a.x=e[0]*b+e[4]*c+e[8]*d,a.y=e[1]*b+e[5]*c+e[9]*d,a.z=e[2]*b+e[6]*c+e[10]*d;var f=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);if(f>0){var g=1/f;a.x*=g,a.y*=g,a.z*=g}return a},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return new LmvMatrix4(this.elements instanceof Float64Array).fromArray(this.elements)}},function(a){var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.lmv_poly2tri=function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={version:"1.3.5"}},{}],2:[function(a,b,c){"use strict";var d=function(a,b){this.point=a,this.triangle=b||null,this.next=null,this.prev=null,this.value=a.x},e=function(a,b){this.head_=a,this.tail_=b,this.search_node_=a};e.prototype.head=function(){return this.head_},e.prototype.setHead=function(a){this.head_=a},e.prototype.tail=function(){return this.tail_},e.prototype.setTail=function(a){this.tail_=a},e.prototype.search=function(){return this.search_node_},e.prototype.setSearch=function(a){this.search_node_=a},e.prototype.findSearchNode=function(){return this.search_node_},e.prototype.locateNode=function(a){var b=this.search_node_;if(a<b.value){for(;b=b.prev;)if(a>=b.value)return this.search_node_=b,b}else for(;b=b.next;)if(a<b.value)return this.search_node_=b.prev,b.prev;return null},e.prototype.locatePoint=function(a){var b=a.x,c=this.findSearchNode(b),d=c.point.x;if(b===d){if(a!==c.point)if(a===c.prev.point)c=c.prev;else{if(a!==c.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");c=c.next}}else if(b<d)for(;(c=c.prev)&&a!==c.point;);else for(;(c=c.next)&&a!==c.point;);return c&&(this.search_node_=c),c},b.exports=e,b.exports.Node=d},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!a)throw new Error(b||"Assert Failed")}b.exports=d},{}],4:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.x=+a||0,this.y=+b||0,this._p2t_edge_list=null};e.prototype.toString=function(){return d.toStringBase(this)},e.prototype.toJSON=function(){return{x:this.x,y:this.y}},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.set_zero=function(){return this.x=0,this.y=0,this},e.prototype.set=function(a,b){return this.x=+a||0,this.y=+b||0,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},e.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},e.prototype.mul=function(a){return this.x*=a,this.y*=a,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.normalize=function(){var a=this.length();return this.x/=a,this.y/=a,a},e.prototype.equals=function(a){return this.x===a.x&&this.y===a.y},e.negate=function(a){return new e(-a.x,-a.y)},e.add=function(a,b){return new e(a.x+b.x,a.y+b.y)},e.sub=function(a,b){return new e(a.x-b.x,a.y-b.y)},e.mul=function(a,b){return new e(a*b.x,a*b.y)},e.cross=function(a,b){return"number"==typeof a?"number"==typeof b?a*b:new e(-a*b.y,a*b.x):"number"==typeof b?new e(b*a.y,-b*a.x):a.x*b.y-a.y*b.x},e.toString=d.toString,e.compare=d.compare,e.cmp=d.compare,e.equals=d.equals,e.dot=function(a,b){return a.x*b.x+a.y*b.y},b.exports=e},{"./xy":11}],5:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.name="PointError",this.points=b=b||[],this.message=a||"Invalid Points!";for(var c=0;c<b.length;c++)this.message+=" "+d.toString(b[c])};e.prototype=new Error,e.prototype.constructor=e,b.exports=e},{"./xy":11}],6:[function(a,b,c){(function(b){"use strict";var d=b.poly2tri;c.noConflict=function(){return b.poly2tri=d,c},c.VERSION=a("../dist/version.json").version,c.PointError=a("./pointerror"),c.Point=a("./point"),c.Triangle=a("./triangle"),c.SweepContext=a("./sweepcontext");var e=a("./sweep");c.triangulate=e.triangulate,c.sweep={Triangulate:e.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(a,b,c){"use strict";function d(a){a.initTriangulation(),a.createAdvancingFront(),e(a),f(a)}function e(a){var b,c=a.pointCount();for(b=1;b<c;++b)for(var d=a.getPoint(b),e=g(a,d),f=d._p2t_edge_list,i=0;f&&i<f.length;++i)h(a,f[i],e)}function f(a){for(var b=a.front().head().next.triangle,c=a.front().head().next.point;!b.getConstrainedEdgeCW(c);)b=b.neighborCCW(c);a.meshClean(b)}function g(a,b){var c=a.locateNode(b),d=k(a,b,c);return b.x<=c.point.x+M&&l(a,c),m(a,d),d}function h(a,b,c){a.edge_event.constrained_edge=b,a.edge_event.right=b.p.x>b.q.x,j(c.triangle,b.p,b.q)||(u(a,b,c),i(a,b.p,b.q,c.triangle,b.q))}function i(a,b,c,d,e){if(!j(d,b,c)){var f=d.pointCCW(e),g=O(c,f,b);if(g===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,f,b]);var h=d.pointCW(e),k=O(c,h,b);if(k===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,h,b]);g===k?(d=g===N.CW?d.neighborCCW(e):d.neighborCW(e),i(a,b,c,d,e)):D(a,b,c,d,e)}}function j(a,b,c){var d=a.edgeIndex(b,c);if(d!==-1){a.markConstrainedEdgeByIndex(d);var e=a.getNeighbor(d);return e&&e.markConstrainedEdgeByPoints(b,c),!0}return!1}function k(a,b,c){var d=new J(b,c.point,c.next.point);d.markNeighbor(c.triangle),a.addToMap(d);var e=new K(b);return e.next=c.next,e.prev=c,c.next.prev=e,c.next=e,o(a,d)||a.mapTriangleToNodes(d),e}function l(a,b){var c=new J(b.prev.point,b.point,b.next.point);c.markNeighbor(b.prev.triangle),c.markNeighbor(b.triangle),a.addToMap(c),b.prev.next=b.next,b.next.prev=b.prev,o(a,c)||a.mapTriangleToNodes(c)}function m(a,b){for(var c=b.next;c.next&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.next;for(c=b.prev;c.prev&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.prev;b.next&&b.next.next&&n(b)&&r(a,b)}function n(a){var b=a.point.x-a.next.next.point.x,c=a.point.y-a.next.next.point.y;return H(c>=0,"unordered y"),b>=0||Math.abs(b)<c}function o(a,b){for(var c=0;c<3;++c)if(!b.delaunay_edge[c]){var d=b.getNeighbor(c);if(d){var e=b.getPoint(c),f=d.oppositePoint(b,e),g=d.index(f);if(d.constrained_edge[g]||d.delaunay_edge[g]){b.constrained_edge[c]=d.constrained_edge[g];continue}var h=p(e,b.pointCCW(e),b.pointCW(e),f);if(h){b.delaunay_edge[c]=!0,d.delaunay_edge[g]=!0,q(b,e,d,f);var i=!o(a,b);return i&&a.mapTriangleToNodes(b),i=!o(a,d),i&&a.mapTriangleToNodes(d),b.delaunay_edge[c]=!1,d.delaunay_edge[g]=!1,!0}}}return!1}function p(a,b,c,d){var e=a.x-d.x,f=a.y-d.y,g=b.x-d.x,h=b.y-d.y,i=e*h,j=g*f,k=i-j;if(k<=0)return!1;var l=c.x-d.x,m=c.y-d.y,n=l*f,o=e*m,p=n-o;return!(p<=0)&&(e*e+f*f)*(g*m-l*h)+(g*g+h*h)*p+(l*l+m*m)*k>0}function q(a,b,c,d){var e,f,g,h;e=a.neighborCCW(b),f=a.neighborCW(b),g=c.neighborCCW(d),h=c.neighborCW(d);var i,j,k,l;i=a.getConstrainedEdgeCCW(b),j=a.getConstrainedEdgeCW(b),k=c.getConstrainedEdgeCCW(d),l=c.getConstrainedEdgeCW(d);var m,n,o,p;m=a.getDelaunayEdgeCCW(b),n=a.getDelaunayEdgeCW(b),o=c.getDelaunayEdgeCCW(d),p=c.getDelaunayEdgeCW(d),a.legalize(b,d),c.legalize(d,b),c.setDelaunayEdgeCCW(b,m),a.setDelaunayEdgeCW(b,n),a.setDelaunayEdgeCCW(d,o),c.setDelaunayEdgeCW(d,p),c.setConstrainedEdgeCCW(b,i),a.setConstrainedEdgeCW(b,j),a.setConstrainedEdgeCCW(d,k),c.setConstrainedEdgeCW(d,l),a.clearNeighbors(),c.clearNeighbors(),e&&c.markNeighbor(e),f&&a.markNeighbor(f),g&&a.markNeighbor(g),h&&c.markNeighbor(h),a.markNeighbor(c)}function r(a,b){for(O(b.point,b.next.point,b.next.next.point)===N.CCW?a.basin.left_node=b.next.next:a.basin.left_node=b.next,a.basin.bottom_node=a.basin.left_node;a.basin.bottom_node.next&&a.basin.bottom_node.point.y>=a.basin.bottom_node.next.point.y;)a.basin.bottom_node=a.basin.bottom_node.next;if(a.basin.bottom_node!==a.basin.left_node){for(a.basin.right_node=a.basin.bottom_node;a.basin.right_node.next&&a.basin.right_node.point.y<a.basin.right_node.next.point.y;)a.basin.right_node=a.basin.right_node.next;a.basin.right_node!==a.basin.bottom_node&&(a.basin.width=a.basin.right_node.point.x-a.basin.left_node.point.x,a.basin.left_highest=a.basin.left_node.point.y>a.basin.right_node.point.y,s(a,a.basin.bottom_node))}}function s(a,b){if(!t(a,b)){l(a,b);if(b.prev!==a.basin.left_node||b.next!==a.basin.right_node){if(b.prev===a.basin.left_node){if(O(b.point,b.next.point,b.next.next.point)===N.CW)return;b=b.next}else if(b.next===a.basin.right_node){if(O(b.point,b.prev.point,b.prev.prev.point)===N.CCW)return;b=b.prev}else b=b.prev.point.y<b.next.point.y?b.prev:b.next;s(a,b)}}}function t(a,b){var c;return c=a.basin.left_highest?a.basin.left_node.point.y-b.point.y:a.basin.right_node.point.y-b.point.y,a.basin.width>c}function u(a,b,c){a.edge_event.right?v(a,b,c):z(a,b,c)}function v(a,b,c){for(;c.next.point.x<b.p.x;)O(b.q,c.next.point,b.p)===N.CCW?w(a,b,c):c=c.next}function w(a,b,c){c.point.x<b.p.x&&(O(c.point,c.next.point,c.next.next.point)===N.CCW?x(a,b,c):(y(a,b,c),w(a,b,c)))}function x(a,b,c){l(a,c.next),c.next.point!==b.p&&O(b.q,c.next.point,b.p)===N.CCW&&O(c.point,c.next.point,c.next.next.point)===N.CCW&&x(a,b,c)}function y(a,b,c){O(c.next.point,c.next.next.point,c.next.next.next.point)===N.CCW?x(a,b,c.next):O(b.q,c.next.next.point,b.p)===N.CCW&&y(a,b,c.next)}function z(a,b,c){for(;c.prev.point.x>b.p.x;)O(b.q,c.prev.point,b.p)===N.CW?A(a,b,c):c=c.prev}function A(a,b,c){c.point.x>b.p.x&&(O(c.point,c.prev.point,c.prev.prev.point)===N.CW?C(a,b,c):(B(a,b,c),A(a,b,c)))}function B(a,b,c){O(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)===N.CW?C(a,b,c.prev):O(b.q,c.prev.prev.point,b.p)===N.CW&&B(a,b,c.prev)}function C(a,b,c){l(a,c.prev),c.prev.point!==b.p&&O(b.q,c.prev.point,b.p)===N.CW&&O(c.point,c.prev.point,c.prev.prev.point)===N.CW&&C(a,b,c)}function D(a,b,c,d,e){var f=d.neighborAcross(e);H(f,"FLIP failed due to missing triangle!");var g=f.oppositePoint(d,e);if(d.getConstrainedEdgeAcross(e)){var h=d.index(e);throw new I("poly2tri Intersecting Constraints",[e,g,d.getPoint((h+1)%3),d.getPoint((h+2)%3)])}if(P(e,d.pointCCW(e),d.pointCW(e),g))if(q(d,e,f,g),a.mapTriangleToNodes(d),a.mapTriangleToNodes(f),e===c&&g===b)c===a.edge_event.constrained_edge.q&&b===a.edge_event.constrained_edge.p&&(d.markConstrainedEdgeByPoints(b,c),f.markConstrainedEdgeByPoints(b,c),o(a,d),o(a,f));else{var j=O(c,g,b);d=E(a,j,d,f,e,g),D(a,b,c,d,e)}else{G(a,b,c,d,f,F(b,c,f,g)),i(a,b,c,d,e)}}function E(a,b,c,d,e,f){var g;return b===N.CCW?(g=d.edgeIndex(e,f),d.delaunay_edge[g]=!0,o(a,d),d.clearDelaunayEdges(),c):(g=c.edgeIndex(e,f),c.delaunay_edge[g]=!0,o(a,c),c.clearDelaunayEdges(),d)}function F(a,b,c,d){var e=O(b,d,a);if(e===N.CW)return c.pointCCW(d);if(e===N.CCW)return c.pointCW(d);throw new I("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[b,d,a])}function G(a,b,c,d,e,f){var g=e.neighborAcross(f);H(g,"FLIP failed due to missing triangle");var h=g.oppositePoint(e,f);if(P(c,d.pointCCW(c),d.pointCW(c),h))D(a,c,h,g,h);else{G(a,b,c,d,g,F(b,c,g,h))}}var H=a("./assert"),I=a("./pointerror"),J=a("./triangle"),K=a("./advancingfront").Node,L=a("./utils"),M=L.EPSILON,N=L.Orientation,O=L.orient2d,P=L.inScanArea,Q=L.isAngleObtuse;c.triangulate=d},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(a,b,c){"use strict";var d=a("./pointerror"),e=a("./point"),f=a("./triangle"),g=a("./sweep"),h=a("./advancingfront"),i=h.Node,j=function(a,b){if(this.p=a,this.q=b,a.y>b.y)this.q=a,this.p=b;else if(a.y===b.y)if(a.x>b.x)this.q=a,this.p=b;else if(a.x===b.x)throw new d("poly2tri Invalid Edge constructor: repeated points!",[a]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},k=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};k.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var l=function(){this.constrained_edge=null,this.right=!1},m=function(a,b){b=b||{},this.triangles_=[],this.map_=[],this.points_=b.cloneArrays?a.slice(0):a,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new k,this.edge_event=new l,this.initEdges(this.points_)};m.prototype.addHole=function(a){this.initEdges(a);var b,c=a.length;for(b=0;b<c;b++)this.points_.push(a[b]);return this},m.prototype.AddHole=m.prototype.addHole,m.prototype.addHoles=function(a){var b,c=a.length;for(b=0;b<c;b++)this.initEdges(a[b])
;return this.points_=this.points_.concat.apply(this.points_,a),this},m.prototype.addPoint=function(a){return this.points_.push(a),this},m.prototype.AddPoint=m.prototype.addPoint,m.prototype.addPoints=function(a){return this.points_=this.points_.concat(a),this},m.prototype.triangulate=function(){return g.triangulate(this),this},m.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},m.prototype.getTriangles=function(){return this.triangles_},m.prototype.GetTriangles=m.prototype.getTriangles,m.prototype.front=function(){return this.front_},m.prototype.pointCount=function(){return this.points_.length},m.prototype.head=function(){return this.head_},m.prototype.setHead=function(a){this.head_=a},m.prototype.tail=function(){return this.tail_},m.prototype.setTail=function(a){this.tail_=a},m.prototype.getMap=function(){return this.map_},m.prototype.initTriangulation=function(){var a,b=this.points_[0].x,c=this.points_[0].x,d=this.points_[0].y,f=this.points_[0].y,g=this.points_.length;for(a=1;a<g;a++){var h=this.points_[a];h.x>b&&(b=h.x),h.x<c&&(c=h.x),h.y>d&&(d=h.y),h.y<f&&(f=h.y)}this.pmin_=new e(c,f),this.pmax_=new e(b,d);var i=.3*(b-c),j=.3*(d-f);this.head_=new e(b+i,f-j),this.tail_=new e(c-i,f-j),this.points_.sort(e.compare)},m.prototype.initEdges=function(a,b){var c,d=a.length,e=b?a.length-1:a.length;for(c=0;c<e;++c)this.edge_list.push(new j(a[c],a[(c+1)%d]))},m.prototype.getPoint=function(a){return this.points_[a]},m.prototype.addToMap=function(a){this.map_.push(a)},m.prototype.locateNode=function(a){return this.front_.locateNode(a.x)},m.prototype.createAdvancingFront=function(){var a,b,c,d=new f(this.points_[0],this.tail_,this.head_);this.map_.push(d),a=new i(d.getPoint(1),d),b=new i(d.getPoint(0),d),c=new i(d.getPoint(2)),this.front_=new h(a,c),a.next=b,b.next=c,b.prev=a,c.prev=b},m.prototype.removeNode=function(a){},m.prototype.mapTriangleToNodes=function(a){for(var b=0;b<3;++b)if(!a.getNeighbor(b)){var c=this.front_.locatePoint(a.pointCW(a.getPoint(b)));c&&(c.triangle=a)}},m.prototype.removeFromMap=function(a){var b,c=this.map_,d=c.length;for(b=0;b<d;b++)if(c[b]===a){c.splice(b,1);break}},m.prototype.meshClean=function(a){for(var b,c,d=[a];b=d.pop();)if(!b.isInterior())for(b.setInterior(!0),this.triangles_.push(b),c=0;c<3;c++)b.constrained_edge[c]||d.push(b.getNeighbor(c))},b.exports=m},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b,c){this.points_=[a,b,c],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},f=d.toString;e.prototype.toString=function(){return"["+f(this.points_[0])+f(this.points_[1])+f(this.points_[2])+"]"},e.prototype.getPoint=function(a){return this.points_[a]},e.prototype.GetPoint=e.prototype.getPoint,e.prototype.getPoints=function(){return this.points_},e.prototype.getNeighbor=function(a){return this.neighbors_[a]},e.prototype.containsPoint=function(a){var b=this.points_;return a===b[0]||a===b[1]||a===b[2]},e.prototype.containsEdge=function(a){return this.containsPoint(a.p)&&this.containsPoint(a.q)},e.prototype.containsPoints=function(a,b){return this.containsPoint(a)&&this.containsPoint(b)},e.prototype.isInterior=function(){return this.interior_},e.prototype.setInterior=function(a){return this.interior_=a,this},e.prototype.markNeighborPointers=function(a,b,c){var d=this.points_;if(a===d[2]&&b===d[1]||a===d[1]&&b===d[2])this.neighbors_[0]=c;else if(a===d[0]&&b===d[2]||a===d[2]&&b===d[0])this.neighbors_[1]=c;else{if(!(a===d[0]&&b===d[1]||a===d[1]&&b===d[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=c}},e.prototype.markNeighbor=function(a){var b=this.points_;a.containsPoints(b[1],b[2])?(this.neighbors_[0]=a,a.markNeighborPointers(b[1],b[2],this)):a.containsPoints(b[0],b[2])?(this.neighbors_[1]=a,a.markNeighborPointers(b[0],b[2],this)):a.containsPoints(b[0],b[1])&&(this.neighbors_[2]=a,a.markNeighborPointers(b[0],b[1],this))},e.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},e.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},e.prototype.pointCW=function(a){var b=this.points_;return a===b[0]?b[2]:a===b[1]?b[0]:a===b[2]?b[1]:null},e.prototype.pointCCW=function(a){var b=this.points_;return a===b[0]?b[1]:a===b[1]?b[2]:a===b[2]?b[0]:null},e.prototype.neighborCW=function(a){return a===this.points_[0]?this.neighbors_[1]:a===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},e.prototype.neighborCCW=function(a){return a===this.points_[0]?this.neighbors_[2]:a===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},e.prototype.getConstrainedEdgeCW=function(a){return a===this.points_[0]?this.constrained_edge[1]:a===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},e.prototype.getConstrainedEdgeCCW=function(a){return a===this.points_[0]?this.constrained_edge[2]:a===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},e.prototype.getConstrainedEdgeAcross=function(a){return a===this.points_[0]?this.constrained_edge[0]:a===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},e.prototype.setConstrainedEdgeCW=function(a,b){a===this.points_[0]?this.constrained_edge[1]=b:a===this.points_[1]?this.constrained_edge[2]=b:this.constrained_edge[0]=b},e.prototype.setConstrainedEdgeCCW=function(a,b){a===this.points_[0]?this.constrained_edge[2]=b:a===this.points_[1]?this.constrained_edge[0]=b:this.constrained_edge[1]=b},e.prototype.getDelaunayEdgeCW=function(a){return a===this.points_[0]?this.delaunay_edge[1]:a===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},e.prototype.getDelaunayEdgeCCW=function(a){return a===this.points_[0]?this.delaunay_edge[2]:a===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},e.prototype.setDelaunayEdgeCW=function(a,b){a===this.points_[0]?this.delaunay_edge[1]=b:a===this.points_[1]?this.delaunay_edge[2]=b:this.delaunay_edge[0]=b},e.prototype.setDelaunayEdgeCCW=function(a,b){a===this.points_[0]?this.delaunay_edge[2]=b:a===this.points_[1]?this.delaunay_edge[0]=b:this.delaunay_edge[1]=b},e.prototype.neighborAcross=function(a){return a===this.points_[0]?this.neighbors_[0]:a===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},e.prototype.oppositePoint=function(a,b){var c=a.pointCW(b);return this.pointCW(c)},e.prototype.legalize=function(a,b){var c=this.points_;if(a===c[0])c[1]=c[0],c[0]=c[2],c[2]=b;else if(a===c[1])c[2]=c[1],c[1]=c[0],c[0]=b;else{if(a!==c[2])throw new Error("poly2tri Invalid Triangle.legalize() call");c[0]=c[2],c[2]=c[1],c[1]=b}},e.prototype.index=function(a){var b=this.points_;if(a===b[0])return 0;if(a===b[1])return 1;if(a===b[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},e.prototype.edgeIndex=function(a,b){var c=this.points_;if(a===c[0]){if(b===c[1])return 2;if(b===c[2])return 1}else if(a===c[1]){if(b===c[2])return 0;if(b===c[0])return 2}else if(a===c[2]){if(b===c[0])return 1;if(b===c[1])return 0}return-1},e.prototype.markConstrainedEdgeByIndex=function(a){this.constrained_edge[a]=!0},e.prototype.markConstrainedEdgeByEdge=function(a){this.markConstrainedEdgeByPoints(a.p,a.q)},e.prototype.markConstrainedEdgeByPoints=function(a,b){var c=this.points_;b===c[0]&&a===c[1]||b===c[1]&&a===c[0]?this.constrained_edge[2]=!0:b===c[0]&&a===c[2]||b===c[2]&&a===c[0]?this.constrained_edge[1]=!0:(b===c[1]&&a===c[2]||b===c[2]&&a===c[1])&&(this.constrained_edge[0]=!0)},b.exports=e},{"./xy":11}],10:[function(a,b,c){"use strict";function d(a,b,c){var d=(a.x-c.x)*(b.y-c.y),e=(a.y-c.y)*(b.x-c.x),f=d-e;return f>-g&&f<g?h.COLLINEAR:f>0?h.CCW:h.CW}function e(a,b,c,d){return!((a.x-b.x)*(d.y-b.y)-(d.x-b.x)*(a.y-b.y)>=-g)&&!((a.x-c.x)*(d.y-c.y)-(d.x-c.x)*(a.y-c.y)<=g)}function f(a,b,c){var d=b.x-a.x,e=b.y-a.y;return d*(c.x-a.x)+e*(c.y-a.y)<0}var g=1e-12;c.EPSILON=g;var h={CW:1,CCW:-1,COLLINEAR:0};c.Orientation=h,c.orient2d=d,c.inScanArea=e,c.isAngleObtuse=f},{}],11:[function(a,b,c){"use strict";function d(a){return"("+a.x+";"+a.y+")"}function e(a){var b=a.toString();return"[object Object]"===b?d(a):b}function f(a,b){return a.y===b.y?a.x-b.x:a.y-b.y}function g(a,b){return a.x===b.x&&a.y===b.y}b.exports={toString:e,toStringBase:d,compare:f,equals:g}},{}]},{},[6])(6)}()}(),function(){"use strict";var a=Autodesk.Viewing;a.EventDispatcher=function(){},a.EventDispatcher.prototype={constructor:a.EventDispatcher,apply:function(b){b.addEventListener=a.EventDispatcher.prototype.addEventListener,b.hasEventListener=a.EventDispatcher.prototype.hasEventListener,b.removeEventListener=a.EventDispatcher.prototype.removeEventListener,b.fireEvent=a.EventDispatcher.prototype.fireEvent,b.dispatchEvent=a.EventDispatcher.prototype.fireEvent},addEventListener:function(a,b){a&&(void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b))},hasEventListener:function(a,b){if(!a)return!1;if(void 0===this.listeners)return!1;var c=this.listeners;return void 0!==c[a]&&c[a].indexOf(b)!==-1},removeEventListener:function(a,b){if(a&&(void 0===this.listeners&&(this.listeners={}),this.listeners[a]instanceof Array))for(var c=this.listeners[a],d=0,e=c.length;d<e;d++)if(c[d]===b){c.splice(d,1);break}},fireEvent:function(a){if(void 0===this.listeners&&(this.listeners={}),"string"==typeof a&&(a={type:a}),!a.target)try{a.target=this}catch(a){}if(!a.type)throw new Error("event type unknown.");if(this.listeners[a.type]instanceof Array)for(var b=this.listeners[a.type].slice(),c=0;c<b.length;c++)b[c].call(this,a)}}}(),Autodesk.Viewing.FileLoader=function(a){this.viewer=a},Autodesk.Viewing.FileLoader.prototype.constructor=Autodesk.Viewing.FileLoader,Autodesk.Viewing.FileLoader.prototype.loadFile=function(a,b,c,d){return!1},function(){"use strict";var a=function(){function a(a,b,c){return!e[a]&&(e[a]={loader:c,extensions:b},!0)}function b(a){return e[a]?e[a].loader:null}function c(a){return!!e[a]&&(delete e[a],!0)}function d(a){a=a?a.toLowerCase():"";for(var b in e){var c=e[b];if(c)for(var d=0;d<c.extensions.length;d++)if(c.extensions[d].toLowerCase()===a)return c.loader}return null}var e={};return{registerFileLoader:a,getFileLoader:b,getFileLoaderForExtension:d,unregisterFileLoader:c}};Autodesk.Viewing.FileLoaderManager=new a}(),function(){"use strict";function a(a){for(var b=0;b<f.length;++b)document.addEventListener(f[b],a,!1)}function b(a){for(var b=0;b<f.length;++b)document.removeEventListener(f[b],a,!1)}function c(b){this.viewer=b,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===d.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener)}var d=Autodesk.Viewing,e=d.Private,f=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];d.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2},d.ScreenModeDelegate=c,c.prototype.uninitialize=function(){b(this.bindFullscreenEventListener),this.viewer=null},c.prototype.isModeSupported=function(a){return!0},c.prototype.setMode=function(a){var b=this.getMode();return!(a===b||!this.isModeSupported(a))&&(this.doScreenModeChange(b,a),this.onScreenModeChanged(b,a),!0)},c.prototype.getMode=function(){throw"Implement getMode() in derived class"},c.prototype.getNextMode=function(){var a,b=this.getMode(),c=d.ScreenMode;return b===c.kNormal&&this.isModeSupported(c.kFullBrowser)?a=c.kFullBrowser:b===c.kNormal&&this.isModeSupported(c.kFullScreen)?a=c.kFullScreen:b===c.kFullBrowser&&this.isModeSupported(c.kFullScreen)?a=c.kFullScreen:b===c.kFullBrowser&&this.isModeSupported(c.kNormal)?a=c.kNormal:b===c.kFullScreen&&this.isModeSupported(c.kNormal)?a=c.kNormal:b===c.kFullScreen&&this.isModeSupported(c.kFullBrowser)&&(a=c.kFullBrowser),a},c.prototype.getEscapeMode=function(){return this.getMode()!==d.ScreenMode.kNormal?d.ScreenMode.kNormal:void 0},c.prototype.fullscreenEventListener=function(){if(d.inFullscreen())this.viewer.resize();else{var a=d.ScreenMode;this.doScreenModeChange(a.kFullScreen,a.kNormal),this.onScreenModeChanged(a.kFullScreen,a.kNormal)}},c.prototype.doScreenModeChange=function(a,b){throw"Implement doScreenModeChange() in derived class"},c.prototype.onScreenModeChanged=function(c,e){c===d.ScreenMode.kFullScreen?b(this.bindFullscreenEventListener):e===d.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.fireEvent({type:d.FULLSCREEN_MODE_EVENT,mode:e})},d.AppScreenModeDelegate=function(a){d.ScreenModeDelegate.call(this,a)},d.AppScreenModeDelegate.prototype=Object.create(d.ScreenModeDelegate.prototype),d.AppScreenModeDelegate.prototype.constructor=d.AppScreenModeDelegate,d.AppScreenModeDelegate.prototype.isModeSupported=function(a){return a!==d.ScreenMode.kFullBrowser},d.AppScreenModeDelegate.prototype.getMode=function(){return d.inFullscreen()?d.ScreenMode.kFullScreen:d.ScreenMode.kNormal},d.AppScreenModeDelegate.prototype.doScreenModeChange=function(a,b){var c=this.viewer.container;b===d.ScreenMode.kNormal?(c.classList.remove("viewer-fill-browser"),d.exitFullscreen()):b===d.ScreenMode.kFullScreen&&(c.classList.add("viewer-fill-browser"),d.launchFullscreen(c))},d.ApplicationScreenModeDelegate=d.AppScreenModeDelegate,d.NullScreenModeDelegate=function(a){d.ScreenModeDelegate.call(this,a)},d.NullScreenModeDelegate.prototype=Object.create(d.ScreenModeDelegate.prototype),d.NullScreenModeDelegate.prototype.constructor=d.ScreenModeDelegate,d.NullScreenModeDelegate.prototype.isModeSupported=function(a){return!1},d.NullScreenModeDelegate.prototype.getMode=function(){return d.ScreenMode.kNormal},d.ScreenModeMixin=function(){},d.ScreenModeMixin.prototype={setScreenModeDelegate:function(a){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=a?a:null===a?d.NullScreenModeDelegate:d.AppScreenModeDelegate},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(a){return this.getScreenModeDelegate().isModeSupported(a)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(a){var b={category:"screen_mode",value:a};return e.logger.track(b),this.getScreenModeDelegate().setMode(a)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var a=this.getScreenModeDelegate().getNextMode();return void 0!==a&&this.setScreenMode(a)},escapeScreenMode:function(){var a=this.getScreenModeDelegate().getEscapeMode();return void 0!==a&&this.setScreenMode(a)},apply:function(a){var b=d.ScreenModeMixin.prototype;a.setScreenModeDelegate=b.setScreenModeDelegate,a.getScreenModeDelegate=b.getScreenModeDelegate,a.isScreenModeSupported=b.isScreenModeSupported,a.canChangeScreenMode=b.canChangeScreenMode,a.setScreenMode=b.setScreenMode,a.getScreenMode=b.getScreenMode,a.nextScreenMode=b.nextScreenMode,a.escapeScreenMode=b.escapeScreenMode}}}(),/** @license Copyright (c) 2013 Autodesk Inc. */
function(){"use strict";var a=Autodesk.Viewing,b=a.Private,c={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};a.ModelUnits=c;var d=function(a){WGS.RenderModel.call(this),this.myData=a,this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)},this.is3d=function(){return!(this.myData&&this.myData.is2d)}};a.EventDispatcher.prototype.apply(d.prototype),d.prototype.constructor=d,d.prototype.setData=function(a){this.myData=a},d.prototype.getData=function(){return this.myData},d.prototype.getDocumentNode=function(){return this.myData.loadOptions?this.myData.loadOptions.bubbleNode||null:null},d.prototype.getRoot=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null},d.prototype.getRootId=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.getRootId():0},d.prototype.getUnitScale=function(){var a;switch(a=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),a&&(a=a.toLowerCase()),a){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}},d.prototype.getUnitString=function(){var a;switch(a=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),a&&(a=a.toLowerCase()),a){case"meter":case"meters":case"m":return c.METER;case"feet and inches":case"foot":case"feet":case"ft":return c.FOOT;case"inch":case"inches":case"in":return c.INCH;case"centimeter":case"centimeters":case"cm":return c.CENTIMETER;case"millimeter":case"millimeters":case"mm":return c.MILLIMETER;default:return null}},d.prototype.getDisplayUnit=function(){var a;switch(a=this.is2d()?this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),a&&(a=a.toLowerCase()),a){case"meter":case"meters":case"m":return c.METER;case"feet and inches":case"foot":case"feet":case"ft":return c.FOOT;case"inch":case"inches":case"in":return c.INCH;case"centimeter":case"centimeters":case"cm":return c.CENTIMETER;case"millimeter":case"millimeters":case"mm":return c.MILLIMETER;default:return null}},d.prototype.getMetadata=function(a,b,c){if(this.myData){var d=this.myData.metadata;if(d){var e=d[a];if(void 0!==e){if(!b)return e;var f=e[b];if(void 0!==f)return f}}}return c},d.prototype.getDefaultCamera=function(){var a=this.myData;if(!a)return null;var b=null,c=a.cameras?a.cameras.length:0;if(0<c){var d=this.getMetadata("default camera","index",null);if(null!==d&&a.cameras[d])b=a.cameras[d];else{for(var e=0;e<c;e++){var f=a.cameras[e];if(f.isPerspective){b=f;break}}b||(b=a.cameras[0])}}return b},d.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},d.prototype.geomPolyCount=function(){var a=this.getGeometryList();return a?a.geomPolyCount:null},d.prototype.instancePolyCount=function(){var a=this.getGeometryList();return a?a.instancePolyCount:null},d.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(b.logger.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)},d.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)},d.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree},d.prototype.getPropertyDb=function(){return this.myData&&this.myData.propDbLoader},d.prototype.getProperties=function(a,b,c){var d=this.getPropertyDb();if(!d||a<=0)return void(c&&c());d.getProperties(a,b,c)},d.prototype.getBulkProperties=function(a,b,c,d){Array.isArray(b)&&(b={propFilter:b}),b=b||{};var e=b.propFilter||null,f=b.ignoreHidden||!1,g=this.getPropertyDb();if(!g)return void(d&&d());g.getBulkProperties(a,e,c,d,f)},d.prototype.getExternalIdMapping=function(a,b){var c=this.getPropertyDb();if(!c)return void(b&&b());c.getExternalIdMapping(a,b)},d.prototype.getObjectTree=function(a,b){var c=this.getPropertyDb();if(!c)return void(b&&b());c.getObjectTree(a,b)},d.prototype.isObjectTreeLoaded=function(){var a=this.getPropertyDb();return!!a&&a.isObjectTreeLoaded()},d.prototype.search=function(a,b,c,d,e){var f=this.getPropertyDb();if(!f)return void(c&&c());f.getObjectTree(function(){f.searchProperties(a,d,b,c,e)},c)};var e=function(a){var b=a;if(Math.abs(b[0])<.001)if(Math.abs(b[4])>.001)for(var c=0;c<4;c++){var d=b[c];b[c]=b[c+4],b[c+4]=d}else for(var c=0;c<4;c++){var d=b[c];b[c]=b[c+8],b[c+8]=d}if(Math.abs(b[5])<.001)for(var c=4;c<8;c++){var d=b[c];b[c]=b[c+4],b[c+4]=d}},f=function(a,b,c,d){var e,f,g,h,i,j,k=!1;g=d[c[c.length-1]].x,h=d[c[c.length-1]].y,e=h>=b;for(var l=0,m=c.length;l<m;++l)i=d[c[l]].x,j=d[c[l]].y,f=j>=b,e!=f&&(j-b)*(g-i)>=(i-a)*(h-j)==f&&(k=!k),e=f,g=i,h=j;return k};d.prototype.pointInPolygon=function(a,b,c,d){for(var e=!1,g=0;g<c.length;g++)f(a,b,c[g],d)&&(e=!e);return e},d.prototype.getPageToModelTransform=function(a){if(this.myData.pageToModelTransform)return this.myData.pageToModelTransform;var b=this.myData,c=b.metadata,d=c.page_dimensions,f=b.viewports[a];if(!f)return new THREE.Matrix4;b.viewportTransforms||(b.viewportTransforms=new Array(b.viewports.length));var g=b.viewportTransforms[a];if(g)return g;var h=new LmvMatrix4(!0).set(d.logical_width/d.page_width,0,0,d.logical_offset_x,0,d.logical_height/d.page_height,0,d.logical_offset_y,0,0,1,0,0,0,0,1),i=f.transform.slice();e(i);var j=new LmvMatrix4(!0);j.elements.set(i);var k=new LmvMatrix4(!0);return k.getInverse(j),k.multiply(h),b.viewportTransforms[a]=k,k},d.prototype.pageToModel=function(a,b,c){var d=this.getPageToModelTransform(c),e=(new THREE.Vector3).set(a.x,a.y,0).applyMatrix4(d),f=(new THREE.Vector3).set(b.x,b.y,0).applyMatrix4(d);a.x=e.x,a.y=e.y,b.x=f.x,b.y=f.y},d.prototype.pointInClip=function(a,b){for(var c=this.myData.clips,d=[],e=1;e<c.length;e++)if(e!==b){for(var f=[],g=[],h=c[e].contourCounts,i=c[e].points,j=0,k=[],l=0;l<h.length;l++){for(var m=0;m<h[l];m++)f.push(j),j++;g.push(f),f=[]}for(var l=0;l<i.length;l+=2){var n={x:i[l],y:i[l+1]};k.push(n)}var o=this.pointInPolygon(a.x,a.y,g,k);o&&d.push(e)}return d},d.prototype.getClip=function(a){for(var b=this.myData.clips,c=[],d=[],e=b[a].contourCounts,f=b[a].points,g=0,h=[],i=0;i<e.length;i++){for(var j=0;j<e[i];j++)c.push(g),g++;d.push(c),c=[]}for(var i=0;i<f.length;i+=2){var k={x:f[i],y:f[i+1]};h.push(k)}return{contours:d,points:h}},d.prototype.getTopoIndex=function(a){if(this.myData&&this.myData.fragments){var b=this.myData.fragments.topoIndexes;if(b)return b[a]}},d.prototype.getTopology=function(a){if(this.myData){var b=this.myData.topology;if(b){var c=b[a];if(c)return c}}},d.prototype.hasTopology=function(){if(this.myData){if(this.myData.topology)return!0}return!1},d.prototype.hasGeometry=function(){return!!this.myData&&(!!this.myData.isLeaflet||this.myData.fragments.length>0)},a.Model=d}(),function(){"use strict";function a(a){var b=a.split("/");if(0==b.length)return a;for(var c=[],d=0;d<b.length;++d){var e=b[d];"."!==e&&(".."===e&&c.length?c.pop():c.push(e))}return 0==c.length?"":c.join("/")}function b(a,b){for(var c=a.length-b,d=new ArrayBuffer(c),e=new Uint8Array(d,0),f=0,g=b;f<c;f++,g++)e[f]=255&a.charCodeAt(g);return e}function c(a,b){return b.indexOf("file://")===-1&&(b.indexOf("://")!==-1||(!!a||void 0))}function d(a,b,c,d){function e(a){if("json"==d.responseType)try{return JSON.parse(a.toString("utf8"))}catch(a){c(a)}return a}0===a.indexOf("file://")&&(a=a.substr(7)),require("fs").readFile(a,function(f,g){f?c(0,0,{httpStatusText:f,url:a}):31==g[0]&&139==g[1]?require("zlib").gunzip(g,null,function(f,g){f?c(0,0,{httpStatusText:f,url:a}):(g=e(g),d.ondata&&d.ondata(g),b(g))}):(g=e(g),d.ondata&&d.ondata(g),b(g))})}function e(a,b){b.hasOwnProperty("asynchronous")?b.asynchronous||g.logger.warn("LMV: Sync XHR used. Performance warning."):b.asynchronous=!0,b.hasOwnProperty("responseType")||(b.responseType="arraybuffer"),b.hasOwnProperty("withCredentials")||(b.withCredentials=!!a.auth),b.headers=a.headers,b.queryParams=a.queryParams,b.endpoint=a.endpoint}var f=Autodesk.Viewing,g=f.Private;g.inWorkerThread="undefined"!=typeof self&&"undefined"==typeof window;var h;"undefined"!=typeof XMLHttpRequest?h=XMLHttpRequest:(h=require("xhr2"),h.prototype._restrictedHeaders.cookie=!1);var i={},j=!1;i.simplifyPath=a,i.OSS_PREFIX="urn:adsk.objects:os.object:",i.getDirectOSSUrl=function(b,c){var d=c.indexOf(i.OSS_PREFIX);if(d!==-1){var e=c.substr(d+i.OSS_PREFIX.length),g=e.substr(0,e.indexOf("/")),h=e.substr(e.indexOf("/")+1);return h=a(h),f.makeOssPath(b,g,h)}},i.generateUrl=function(b,d,e){if(f.isNodeJS&&!c(b,e))return e;e=a(e);var g=e.indexOf("urn:"),h=e.indexOf("?");g!=-1&&(e=h!==-1?e.slice(0,g)+encodeURIComponent(e.slice(g,h))+e.slice(h):e.slice(0,g)+encodeURIComponent(e.slice(g)));var j=i.getDirectOSSUrl(b,e);if(j)return j;if(0!==decodeURIComponent(e).indexOf("urn:"))return e;switch("items"!==d&&(e=e.substr(6)),d){case"items":return f.getItemApi(b)+e;case"bubbles":return f.getManifestApi(b)+e;case"thumbnails":return f.getThumbnailApi(b)+e}},i.rawGet=function(a,e,k,l,m,n){function o(a){m&&m(q.status,q.statusText,{url:k})}function p(a){if(200===q.status)if(q.response&&q.response instanceof ArrayBuffer){var b=new Uint8Array(q.response);if(!n.skipDecompress&&31==b[0]&&139==b[1]){j||(j=!0,g.logger.warn("An LMV resource ("+k+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{b=new Zlib.Gunzip(b).decompress()}catch(a){m(f.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:k,exception:a.toString(),stack:a.stack})}}l(b)}else l(q.response||q.responseText);else o(a)}var n=n?n:{};if(k=i.generateUrl(a,e,k),f.isNodeJS&&!c(a,k))return void d(k,l,m,n);n.queryParams&&(k=k+"?"+n.queryParams);var q=new h;try{var r=!n.hasOwnProperty("asynchronous")||n.asynchronous;if(q.open(n.noBody?"HEAD":"GET",k,r),n.hasOwnProperty("responseType")&&(q.responseType=n.responseType),q.withCredentials=!0,n.hasOwnProperty("withCredentials")&&(q.withCredentials=n.withCredentials),n.headers)for(var s in n.headers)q.setRequestHeader(s,n.headers[s]),"authorization"===s.toLocaleLowerCase()&&(q.withCredentials=!1);r&&(q.onload=p,q.onerror=o,q.ontimeout=o,n.ondata&&(q.overrideMimeType("text/plain; charset=x-user-defined"),n._dlProgress={streamOffset:0,counter:0},q.onreadystatechange=function(){if(q.readyState>2){var a=q.responseText;if(n._dlProgress.streamOffset>=a.length)return;var c=b(a,n._dlProgress.streamOffset);n._dlProgress.streamOffset=a.length,n.ondata(c)}})),q.send(),n.skipAssetCallback||(g.inWorkerThread?self.postMessage({assetRequest:[k,n.headers,null]}):g.assets.push([k,n.headers,null])),r||p()}catch(a){m(q.status,q.statusText,{url:k,exception:a})}},i.defaultFailureCallback=function(a,b,c){403==a?this.raiseError(f.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:c.url,httpStatus:a,httpStatusText:b}):404==a?this.raiseError(f.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:c.url,httpStatus:a,httpStatusText:b}):a>=500&&a<600?this.raiseError(f.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:c.url,httpStatus:a,httpStatusText:b}):c.exception?this.raiseError(f.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:c.url,exception:c.exception.toString(),stack:c.exception.stack}):this.raiseError(f.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:c.url,httpStatus:a,httpStatusText:b,data:c})},i.getItem=function(a,b,c,d,f){f=f||{},e(a,f),i.rawGet(a.endpoint,"items",b,c,d,f)},i.getManifest=function(a,b,c,d,f){f=f||{},f.hasOwnProperty("responseType")||(f.responseType="json"),e(a,f),i.rawGet(a.endpoint,"bubbles",b,c,d,f)},i.getThumbnail=function(a,b,c,d,f){if(f=f||{},e(a,f),!f.queryParams){var g=f.role||"rendered",h=f.size||400;f.queryParams="guid="+encodeURIComponent(f.guid)+"&role="+g+"&width="+h+"&height="+h}i.rawGet(a.endpoint,"thumbnails",b,c,d,f)},i.getACMSession=function(a,b,c,d){var e,g={};for(var h in b)"oauth2AccessToken"===h?e=b[h]:h.indexOf("x-ads-acm")!==-1&&(g[h]=b[h]),f.isMobileDevice()&&(f.HTTP_REQUEST_HEADERS=g);g.application="autodesk";var i=new XMLHttpRequest;i.open("POST",a+"/oss-ext/v2/acmsessions",!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Authorization","Bearer "+e),i.responseType="json",i.onload=function(){if(200===i.status&&i.response){var a="string"==typeof i.response?JSON.parse(i.response):i.response;a&&a.acmsession?c(a.acmsession):d(i.status,"Can't get acm session from response.")}else d(i.status)},i.onerror=d,i.ontimeout=d,i.send(JSON.stringify(g)),delete g.application},g.ViewingService=i}(),"undefined"!=typeof window){var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(navigator.mozGetUserMedia)webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(a,b,c){var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={url:a};else if(0===e[0].indexOf("turn")&&(a.indexOf("transport=udp")!==-1||a.indexOf("?transport")===-1)){var f=a.split("?");d={url:f[0],credential:c,username:b}}return d},attachMediaStream=function(a,b){console.log("Attaching media stream"),a.mozSrcObject=b,a.play()},reattachMediaStream=function(a,b){console.log("Reattaching media stream"),a.mozSrcObject=b.mozSrcObject,a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]};else if(navigator.webkitGetUserMedia){var match=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedBrowser="chrome",webrtcDetectedVersion=match?parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]):40,createIceServer=function(a,b,c){var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={url:a};else if(0===e[0].indexOf("turn"))if(webrtcDetectedVersion<28){var f=a.split("turn:");d={url:"turn:"+b+"@"+f[1],credential:c}}else d={url:a,credential:c,username:b};return d},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(a,b){void 0!==a.srcObject?a.srcObject=b:void 0!==a.mozSrcObject?a.mozSrcObject=b:void 0!==a.src?a.src=URL.createObjectURL(b):console.log("Error attaching stream to element.")},reattachMediaStream=function(a,b){a.src=b.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})}else console.log("Browser does not appear to be WebRTC-capable")}!function(){"use strict";function a(a,b){function e(){return c.config.userName&&c.config.userName.length?c.config.userName:p?p.slice(0,5):"Unknown"}function f(a){switch(a.type){case"txt":j(a);break;case"joinok":i(a);break;case"join_error":break;case"sessionId":c.logger.info("Connect successful, your id is: "+a.id),p=a.id;break;case"joined":a.userStatus="joined",g(a);break;case"left":a.userStatus="left",h(a);break;case"camera":case"pointer":break;default:c.logger.log(a)}var b=a.roomId,d={type:o[a.type],data:a,channelId:b};u.dispatchEvent(d)}function g(a){if(a.user.name&&a.user.name.length||(a.user.name=a.user.id.slice(0,5)),a.roomId){var b=t[a.roomId];b?(b.users.push(a.user),c.logger.info(a.user+" joined room "+a.roomId)):c.logger.warn("Channel "+a.roomId+" does not exist for socket "+p)}}function h(a){c.logger.info(a.user+" left room "+a.room);for(var b in t){for(var d=t[b].users,e=-1,f=0;f<d.length;f++)if(d[f].id==a.user){e=f;break}e!=-1&&d.splice(e,1),delete t[b].userSet[a.user]}}function i(a){var b=t[a.roomId];c.logger.info("joined channel "+a.roomId),a.users&&a.users.length?b.users=a.users:b.users=[];for(var d=0;d<b.users.length;d++)b.users[d].name&&b.users[d].name.length||(b.users[d].name=b.users[d].id.slice(0,5));var f=e(),g=Autodesk.Viewing.i18n.translate("you"),h={id:p,name:f+" ("+g+")",isSelf:!0,status:0};b.userSet[p]||(b.users.push(h),b.userSet[p]=h),0!=h.id.indexOf(f)&&u.sendChatMessage("/nick "+f,a.roomId)}function j(a){if(0==a.msg.indexOf("/nick ")){var b=u.getUserById(a.from,a.roomId),c=a.msg.slice(6);if(c.length&&(b.name=c,b.id==p)){var d=Autodesk.Viewing.i18n.translate("you");b.name+=" ("+d+")"}u.dispatchEvent({type:"userListChange",data:a,channelId:a.roomId})}}function k(a){r<q.length?(c.logger.info("Connect failed, trying another server..."),n.disconnect(),n=null,r++,u.connect(u.sessionID)):u.dispatchEvent({type:"socketError",data:a})}function l(a){u.dispatchEvent({type:"socketError",data:a})}function m(a){r=0;for(var b in s)u.join(b)}var n,o={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",private:"privateMessage",join_error:"socketError"},p=null,q=Array.isArray(a)?a:[a],r=0,s={},t={},u=this;this.connect=function(a){if(!n)return void 0!==window.WebSocket&&(d||(d="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=a,n=d.connect(q[r]+"?sessionID="+a,{path:b,forceNew:!0}),n.on("connect",m),n.on("message",f),n.on("connect_error",k),n.on("error",l),!0)},this.join=function(a){if(!n||!n.connected)return void(s[a]=1);delete s[a],t[a]={id:a,users:[],userSet:{}},n.emit("join",{roomId:a,name:e()})},this.disconnect=function(){n&&(n.disconnect(),n=null,t={},p=null)},this.sendMessage=function(a,b,c){var d={type:a,from:p,msg:b,roomId:c};n.emit("message",d)},this.sendPrivateMessage=function(a,b){var c={type:"private",target:a,from:p,msg:b};n.emit("message",c)},this.sendChatMessage=function(a,b){var c={type:"txt",from:p,msg:a,roomId:b};n.emit("message",c),f(c)},this.getUserById=function(a,b){for(var c=t[b].users,d=0;d<c.length;d++)if(c[d].id==a)return c[d];return null},this.getLocalId=function(){return p},this.getChannelInfo=function(a){return t[a]},this.isConnected=function(){return n}}var b=Autodesk.Viewing,c=b.Private;c.config={userName:""},c.setUserName=function(a){c.config.userName=a};var d;a.prototype.constructor=a,b.EventDispatcher.prototype.apply(a.prototype);var e={};a.GetInstance=function(a,b){a||(a=c.EnvironmentConfigurations[c.env].LMV.RTC),Array.isArray(a)||(a=[a]);var d=e[a[0]];return d?d:(d=new c.MessageClient(a,b),e[a[0]]=d,d)},Autodesk.Viewing.Private.MessageClient=a}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing,b=a.Private;b.P2PClient=function(c){function d(c){try{l=new RTCPeerConnection(u),l.onicecandidate=function(a){a.candidate?r.sendPrivateMessage(m,{type:"candidate",label:a.candidate.sdpMLineIndex,id:a.candidate.sdpMid,candidate:a.candidate.candidate}):b.logger.log("End of candidates.")},l.ondatachannel=function(a){b.logger.log("Data channel added."),p=a.channel,p.onmessage=i,q.dispatchEvent({type:"dataChannelAdded",data:a.channel})},l.onaddstream=function(a){b.logger.log("Remote stream added."),o=a.stream,q.dispatchEvent({type:"remoteStreamAdded",data:a.stream})},l.onremovestream=function(a){b.logger.log("Remote stream removed. Event: ",a),o=null,q.dispatchEvent({type:"remoteStreamRemoved",data:a.stream})},c&&(p=l.createDataChannel("sendDataChannel",{reliable:!1,ordered:!1}),p.onmessage=i)}catch(c){return b.logger.error("Failed to create PeerConnection, exception: "+c.message,a.errorCodeString(a.ErrorCodes.NETWORK_FAILURE)),void alert("Cannot create RTCPeerConnection object.")}}function f(c){b.logger.error("createOffer() error: ",e,a.errorCodeString(a.ErrorCodes.UNKNOWN_FAILURE))}function g(a){if(l.setLocalDescription(a),r.sendPrivateMessage(m,a),t.length){for(var b=0;b<t.length;b++)l.addIceCandidate(t[b]);t=[]}}function h(a){for(var b=a.split("\n"),c=!1,d=!1,e=!1,f=0;f<b.length;f++)0==b[f].indexOf("a=mid:data")&&(c=!0),0==b[f].indexOf("a=mid:video")&&(e=!0),0==b[f].indexOf("a=mid:audio")&&(d=!0);return c&&!e&&!d}function i(a){var b=JSON.parse(a.data);switch(b.type){case"camera":q.dispatchEvent({type:"cameraChange",data:b});break;case"joystick":q.dispatchEvent({type:"joystick",data:b});break;case"state":q.dispatchEvent({type:"viewerState",data:b})}}function j(a){var c=a.data.msg;if(b.logger.debug("Client received message:"+JSON.stringify(c)),"offer"!=c.type||s)if("answer"===c.type&&s)l.setRemoteDescription(new RTCSessionDescription(c));else if("candidate"===c.type){var d=new RTCIceCandidate({sdpMLineIndex:c.label,candidate:c.candidate});s?l.addIceCandidate(d):t.push(d)}else"bye"===c&&s&&(q.dispatchEvent({type:"remoteHangup",data:null}),b.logger.info("Session terminated."),k());else b.logger.log("Received offer. Accepting."),q.receiveCall(a.data)}function k(){s=!1,l.close(),l=null,n=null,o=null,m=null}var l,m,n,o,p,q=this,r=c,s=!1,t=[],u={iceServers:[{url:"stun:stun.l.google.com:19302"}]},v={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},w={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};r.addEventListener("privateMessage",j),this.hangup=function(){b.logger.log("Hanging up."),s&&(r.sendPrivateMessage(m,"bye"),k())},this.initUserMedia=function(c){function d(a){b.logger.log("Adding local stream."),c&&c(a),q.dispatchEvent({type:"localStreamAdded",data:a})}function e(c){b.logger.error("getUserMedia error: ",c,a.errorCodeString(a.ErrorCodes.NETWORK_SERVER_ERROR))}var f={video:!0,audio:!0};window.getUserMedia(f,d,e),b.logger.log("Getting user media with constraints",f)},this.callUser=function(a,c){if(m)return void b.logger.warn("Already in a call. Ignoring call request.");m=a,b.logger.info("Calling user "+m),c?(d(!0),s=!0,b.logger.log("Sending data channel offer to peer"),l.createOffer(g,f)):this.initUserMedia(function(a){n=a,s||void 0===n||(d(!1),l.addStream(n),s=!0,b.logger.log("Sending audio/video offer to peer"),l.createOffer(g,f))})},this.receiveCall=function(a){(m=a.from)||(m=a.senderId),h(a.msg.sdp)?(d(!0),s=!0,l.setRemoteDescription(new RTCSessionDescription(a.msg)),b.logger.log("Sending data-only answer to peer."),l.createAnswer(g,null,w)):this.initUserMedia(function(c){n=c,s||void 0===n||(d(!1),l.addStream(n),s=!0),l.setRemoteDescription(new RTCSessionDescription(a.msg)),b.logger.log("Sending audio+video answer to peer."),l.createAnswer(g,null,v)})},this.getCurrentCallTarget=function(){return m},this.dataChannel=function(){return p}},b.P2PClient.prototype.constructor=b.P2PClient,Autodesk.Viewing.EventDispatcher.prototype.apply(b.P2PClient.prototype)}(),function(){var a=Autodesk.Viewing.Private;Autodesk.Viewing.Private.LiveReviewClient=function(a){this.viewer=a,this.messageClient=null,this.presenceChannelId=null,this.p2p=null,this.viewtx=null,this.interceptor=null},Autodesk.Viewing.Private.LiveReviewClient.prototype.destroy=function(){this.leaveLiveReviewSession()},Autodesk.Viewing.Private.LiveReviewClient.prototype.joinLiveReviewSession=function(b){this.messageClient||(this.messageClient=a.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=window.location.host),this.messageClient.isConnected()||this.messageClient.connect(b),this.viewtx||(this.viewtx=new a.ViewTransceiver(this.messageClient)),this.viewtx.channelId=b,this.viewtx.attach(this.viewer),this.p2p||(this.p2p=new a.P2PClient(this.messageClient)),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new a.InteractionInterceptor(this.viewtx)),this.viewer.toolController.registerTool(this.interceptor),this.viewer.toolController.activateTool(this.interceptor.getName())},Autodesk.Viewing.Private.LiveReviewClient.prototype.leaveLiveReviewSession=function(){this.p2p&&this.p2p.hangup(),this.viewtx&&this.viewtx.detach(this.viewer),this.messageClient&&this.messageClient.disconnect(),this.interceptor&&this.viewer.toolController.deactivateTool(this.interceptor.getName()),this.p2p=null,this.viewtx=null,this.messageClient=null,this.interceptor=null};var b=Autodesk.Viewing,a=b.Private;a.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(a){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(b){return a.takeControl(),!1},this.handleButtonDown=function(b,c){return a.takeControl(),!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(b){return a.updatePointer(b),!1},this.handleGesture=function(b){return a.takeControl(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},a.ViewTransceiver=function(c){function d(a){p=!0;var b=JSON.parse(a.data.msg);w.restoreState(b),o.impl.invalidate(!0,!1,!0),p=!1}function e(a){return Math.round(1e3*a)/1e3}function f(a){for(var b=0;b<a.length;b++)a[b]=e(a[b])}function g(a){var b=a.data.msg;b[1]===!0||r||(b[0]!=m&&(m=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),q=!1,o.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),o.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function h(a){if(q||r){var b=a.camera,d=[b.position.x,b.position.y,b.position.z,b.target.x,b.target.y,b.target.z,b.up.x,b.up.y,b.up.z];f(d),d.unshift(r),d.unshift(c.getLocalId()),s.sendMessage("camera",d,n.channelId),m!=d[0]&&(m=d[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:m}}))}}function i(a,b,c){a&&!u&&(u=document.createElement("div"),u.classList.add("collabPointer")),a&&!v?(o.container.appendChild(u),v=!0):!a&&v&&(o.container.removeChild(u),v=!1),a&&(u.style.left=b-6+"px",u.style.top=c-6+"px")}function j(a){if(!q&&!r){var b=a.data.msg;t.origin.set(b[1],b[2],b[3]),t.direction.set(b[4],b[5],b[6]);var c=t.at(o.getCamera().near);c.project(o.getCamera()),c=o.impl.viewportToClient(c.x,c.y),i(!0,c.x,c.y)}}function k(a){if(q){var b=o.impl.clientToViewport(a.canvasX,a.canvasY);o.impl.viewportToRay(b,t);var d=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z];f(d),d.unshift(c.getLocalId()),s.sendMessage("pointer",d,n.channelId)}}function l(a){if(!p){var b=w.getState(x);c.sendMessage("state",JSON.stringify(b),n.channelId)}}var m,n=this,o=this.viewer=null,p=!1,q=!1,r=!1,s=this.client=c,t=new THREE.Ray,u=null,v=!1;this.channelId=null;var w,x={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){q=!0,i(!1)},this.updatePointer=function(a){k(a)},this.connectCamera=function(a){r=!a},this.attach=function(c,e){o&&this.detach(),this.viewer=o=c,w=new a.ViewerState(o),s.addEventListener("cameraChange",g),s.addEventListener("pointerMove",j),o.hasEventListener(b.CAMERA_CHANGE_EVENT,h)||o.addEventListener(b.CAMERA_CHANGE_EVENT,h),e||(s.addEventListener("viewerState",d),o.hasEventListener(b.SELECTION_CHANGED_EVENT,l)||(o.addEventListener(b.SELECTION_CHANGED_EVENT,l),o.addEventListener(b.ISOLATE_EVENT,l),o.addEventListener(b.HIDE_EVENT,l),o.addEventListener(b.SHOW_EVENT,l),o.addEventListener(b.EXPLODE_CHANGE_EVENT,l),o.addEventListener(b.LAYER_VISIBILITY_CHANGED_EVENT,l),o.addEventListener(b.CUTPLANES_CHANGE_EVENT,l)))},this.detach=function(){i(!1),s&&(s.removeEventListener("cameraChange",g),s.removeEventListener("viewerState",d)),o&&(o.removeEventListener(b.CAMERA_CHANGE_EVENT,h),o.removeEventListener(b.SELECTION_CHANGED_EVENT,l),o.removeEventListener(b.ISOLATE_EVENT,l),o.removeEventListener(b.HIDE_EVENT,l),o.removeEventListener(b.SHOW_EVENT,l),o.removeEventListener(b.EXPLODE_CHANGE_EVENT,l),o.removeEventListener(b.LAYER_VISIBILITY_CHANGED_EVENT,l),o.removeEventListener(b.CUTPLANES_CHANGE_EVENT,l),this.viewer=o=null,w=null)}},a.ViewTransceiver.prototype.constructor=a.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(a.ViewTransceiver.prototype)}();var avp=Autodesk.Viewing.Private;avp.Autocam=avp.Autocam||function(a,b){function c(b){t=!0,a.target.copy(q.center),a.pivot.copy(q.pivot),a.worldup?a.worldup.copy(q.sceneUpDirection):a.up.copy(q.sceneUpDirection),q.cameraChangedCallback&&q.cameraChangedCallback(b),t=!1}function d(a,b){var c=a.clone();return Math.abs(c.clone().dot(b))<Number.MIN_VALUE?(c.normalize(),c):(c=e(a,b),c.length()<Number.MIN_VALUE&&(c=f(b)),c.normalize(),c)}function e(a,b){b.normalize();var c=a.clone().dot(b),d=b.clone().multiplyScalar(c);return d=a.clone().sub(d)}function f(a){for(var b=new THREE.Vector3(0,0,0),c=[new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,1),new THREE.Vector3(1,0,1),new THREE.Vector3(1,1,0),new THREE.Vector3(1,1,1)],d=0;d<7;d++)if(Math.abs(c[d].dot(a))<Number.MIN_VALUE){b=c[d];break}return b}function g(a,b){var c=new THREE.Vector2(0,0);return c.x=a/window.innerWidth,c.y=b/window.innerHeight,c}function h(b){b.y=Math.abs(b.y-window.innerHeight);var c,d,e=a.position,f=q.center,g=f.clone().sub(e),h=a.up,i=g.clone().cross(h),j=g.clone().length(),k=j*Math.tan(THREE.Math.degToRad(a.leftFov)),l=j*Math.tan(THREE.Math.degToRad(a.rightFov)),m=j*Math.tan(THREE.Math.degToRad(a.topFov)),n=j*Math.tan(THREE.Math.degToRad(a.bottomFov)),o=k+l,p=m+n,r=b.x*o/window.innerWidth,s=r-k,t=b.y*p/window.innerHeight,u=t-n;return h=h.clone().normalize().clone().multiplyScalar(u),i=i.clone().normalize().clone().multiplyScalar(s),q.ortho?(c=e.clone().add(i).clone().add(h),d=g):(c=e,d=g.clone().add(h).clone().add(i)),{rayO:c,rayD:d}}function i(a,b,c){var d,e,f,g;d=e=f=g=0;var h=0,i=null,j=null,k=q.snapOrbitDeadZone,l=q.orbitMultiplier;return"h"==a?(d=q.snapOrbitThresholdH,e=q.snapOrbitAccelerationAX,f=q.snapOrbitAccelerationBX,g=1-q.snapOrbitAccelerationPointX,j=q.lockDeltaX,i=q.lockedX):(d=q.snapOrbitThresholdV,e=q.snapOrbitAccelerationAY,f=q.snapOrbitAccelerationBY,g=1-q.snapOrbitAccelerationPointY,j=q.lockDeltaY,i=q.lockedY),i?(j+=c,j<-k?(h=(j+k)*l*1/f,i=!1):j>k&&(h=(j-k)*l*1/f,i=!1)):(h=Math.abs(b)>d?c*l:Math.abs(b)>g*d?c*b>0?c*l*e:c*l*1/e:c*b>0?c*l*f:c*l*1/f)*b>0&&Math.abs(h)>Math.abs(b)&&(this.lockDeltaX=this.lockDeltaY=0,i=!0,h=b),h}function j(){return q.combined}function k(a,b){var c=!1,d=window.innerWidth,e=a.x%d,f=window.innerHeight,g=a.y%f,h=e>0?e-b.x:d+e-b.x,i=g>0?g-b.y:f+g-b.y;return Math.abs(h)<30&&Math.abs(i)<30&&(c=!0),c}function l(a,b,c){c.x=(a.x-b.x)/window.innerWidth,a.x=b.x+(a.x-b.x)%window.innerWidth,c.y=(a.y-b.y)/window.innerHeight,a.y=b.y+(a.y-b.y)%window.innerHeight}function m(a,b,c){if(!O||!a){if(a){var d=new THREE.Vector2,e=b.x,f=b.y;l(b,c,d),M=window.innerWidth*d.x,N=window.innerHeight*d.y,e<c.x?e-=60:e+=60,f<c.y?f-=60:f+=60}O=a}}function n(a,b,c){
if(0===b)return 0;var d=a,e=q.saveEye.clone().sub(worldUp.clone().multiplyScalar(c+d)),f=q.saveEye.clone().sub(worldUp.clone().multiplyScalar(c)),g=0,h=(q.maxSceneBound-q.minSceneBound)/1e3;q.topLimit&&b>0?(g=q.maxSceneBound-h,q.topLimit=!1):q.bottomLimit&&b<0?(g=q.minSceneBound+h,q.bottomLimit=!1):g=e.dot(worldUp);var i=f.dot(worldUp);return g<q.minSceneBound?i<q.minSceneBound&&(q.bottomLimit=!0,d=0):g>q.maxSceneBound&&i>q.maxSceneBound&&(q.topLimit=!0,d=0),d}function o(a){var b=Math.pow(a,2);a<0&&(b=-b);var c=g(0,b),d=q.maxSceneBound-q.minSceneBound,e=.01*d;c.y*=e;var f=q.userHeightSpeed*c.y;return f=n(f,a,q.m_amount)}function p(a){var b=q.sceneFrontDirection.clone().cross(q.sceneUpDirection),c=Math.abs(Math.abs(a.dot(q.sceneUpDirection))-1),d=Math.abs(Math.abs(a.dot(q.sceneFrontDirection))-1),e=Math.abs(Math.abs(a.dot(b))-1);return c<1e-5||d<1e-5||e<1e-5}var q=this,r=null,s=null,t=!1;this.cube=null,this.camera=a,this.renderer="WEBGL",this.startState={},this.navApi=b,this.orthographicFaces=!1,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null;var u,v=Date.now(),w=!1;this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null},this.showPivot=function(a){this.pivotDisplayCallback&&this.pivotDisplayCallback(a)},this.setWorldUpVector=function(a){t||a&&a.lengthSq()>0&&!a.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(a),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var a=this.sceneUpDirection.clone();return Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):a.z>=0?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x),a.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(a){if(this.navApi.isActionEnabled("gotoview")){var b={position:a.position.clone(),up:a.up.clone(),center:a.center.clone(),pivot:a.pivot.clone(),fov:a.fov,worldUp:a.worldUp.clone(),isOrtho:a.isOrtho};q.elapsedTime=0,this.animateTransition(b)}},this.getCurrentView=function(){return{position:a.position.clone(),up:a.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:a.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:a.isPerspective===!1}},this.setCurrentViewAsHome=function(a){a?(this.navApi.setRequestFitToView(!0),w=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(a){var b=a.pivot?a.pivot:this.center,c=a.target?a.target:this.pivot,d=a.worldup?a.worldup:this.sceneUpDirection;this.homeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),isOrtho:a.isPerspective===!1},this.originalHomeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:a.isPerspective===!1}},this.toPerspective=function(){a.isPerspective||(a.toPerspective(),c(!1))},this.toOrthographic=function(){a.isPerspective&&(a.toOrthographic(),c(!1))},this.setOrthographicFaces=function(a){this.orthographicFaces=a},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(a.position)},this.setCameraUp=function(b){var c=this.dir.clone(),d=c.cross(b).normalize();0===d.lengthSq()&&(c.copy(this.dir),b.z>b.y?c.y+=1e-4:c.z+=1e-4,d=c.cross(b).normalize()),a.up.copy(d).cross(this.dir).normalize()},function a(){requestAnimationFrame(a);var b=Date.now();u=b-v,v=b}(),this.ortho=!1,this.center=a.target?a.target.clone():new THREE.Vector3(0,0,0),this.pivot=a.pivot?a.pivot.clone():this.center.clone(),this.sceneUpDirection=a.worldup?a.worldup.clone():a.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(a.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=a.position.clone(),this.saveUp=a.up.clone();var z,A,B,C;this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(a);var D,E,F=new THREE.Quaternion,G=new THREE.Quaternion,H=new THREE.Quaternion,I=new THREE.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,a.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=THREE.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new THREE.Vector3(-1,0,0),this.alignDirTable[1]=new THREE.Vector3(1,0,0),this.alignDirTable[2]=new THREE.Vector3(0,-1,0),this.alignDirTable[3]=new THREE.Vector3(0,1,0),this.alignDirTable[4]=new THREE.Vector3(0,0,-1),this.alignDirTable[5]=new THREE.Vector3(0,0,1),this.alignDirTable[6]=new THREE.Vector3(-1,-1,0),this.alignDirTable[7]=new THREE.Vector3(-1,1,0),this.alignDirTable[8]=new THREE.Vector3(1,-1,0),this.alignDirTable[9]=new THREE.Vector3(1,1,0),this.alignDirTable[10]=new THREE.Vector3(0,-1,-1),this.alignDirTable[11]=new THREE.Vector3(0,-1,1),this.alignDirTable[12]=new THREE.Vector3(0,1,-1),this.alignDirTable[13]=new THREE.Vector3(0,1,1),this.alignDirTable[14]=new THREE.Vector3(-1,0,-1),this.alignDirTable[15]=new THREE.Vector3(1,0,-1),this.alignDirTable[16]=new THREE.Vector3(-1,0,1),this.alignDirTable[17]=new THREE.Vector3(1,0,1),this.alignDirTable[18]=new THREE.Vector3(-1,-1,-1),this.alignDirTable[19]=new THREE.Vector3(-1,-1,1),this.alignDirTable[20]=new THREE.Vector3(-1,1,-1),this.alignDirTable[21]=new THREE.Vector3(-1,1,1),this.alignDirTable[22]=new THREE.Vector3(1,-1,-1),this.alignDirTable[23]=new THREE.Vector3(1,-1,1),this.alignDirTable[24]=new THREE.Vector3(1,1,-1),this.alignDirTable[25]=new THREE.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var J={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=J;var K,L;this.zoomDelta=new THREE.Vector2;var M,N,O,P=0,Q=new THREE.Vector3,R=new THREE.Vector3;this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new THREE.Vector2(0,0),openBracket:new THREE.Vector2(0,0),openBracketA:new THREE.Vector2(0,0),openBracketB:new THREE.Vector2(0,0),openLocationOrigin:new THREE.Vector2(0,0),locationOffset:new THREE.Vector2(0,0),snapOffset:new THREE.Vector2(0,0),slideOffset:new THREE.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new THREE.Vector2(0,0),this.menuOrigin=new THREE.Vector2(0,0),a.lookAt(this.center),this.setCube=function(a){this.cube=a},this.loadObject=function(a,b,c){loader=new THREE.JSONLoader,loader.load(a,function(a,d){var e=new THREE.MeshPhongMaterial(d);mesh=new THREE.Mesh(a,e),mesh.scale=b,mesh.position.copy(c),mesh.geometry.computeBoundingBox();var f=mesh.geometry.boundingBox.clone();R.set(f.max.x,f.max.y,f.max.z),Q.set(f.min.x,f.min.y,f.min.z),R.multiply(b),Q.multiply(b),scene.add(mesh),objects.push(mesh)})},this.sync=function(b){b.isPerspective!==a.isPerspective&&(b.isPerspective?a.toPerspective():(a.toOrthographic(),b.saveFov&&(a.saveFov=b.saveFov))),a.fov=b.fov,a.position.copy(b.position),b.target&&(this.center.copy(b.target),a.target.copy(b.target)),b.pivot&&(this.pivot.copy(b.pivot),a.pivot.copy(b.pivot)),this.dir.copy(this.center).sub(a.position),this.setCameraUp(b.up);var c=b.worldup?b.worldup:b.up;c.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(c),w&&!this.navApi.getTransitionActive()&&(w=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},THREE.Box2.prototype.setCenter=function(a){var b=new THREE.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);return this.min.copy(a).sub(b),this.max.copy(a).add(b),this},THREE.Box2.prototype.getIcon2DCoords=function(a,b){var c=this.center;b.set((a.x-c.x)/(this.size().x/2),(a.y-c.y)/(this.size().y/2))},THREE.Matrix3.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[3]=k-r,b[6]=l+q,b[1]=k+r,b[4]=1-(j+o),b[7]=n-p,b[2]=l-q,b[5]=n+p,b[8]=1-(j+m),this},THREE.Quaternion.prototype.setFromRotationMatrix3=function(a){var b,c=a.elements,d=c[0],e=c[3],f=c[6],g=c[1],h=c[4],i=c[7],j=c[2],k=c[5],l=c[8],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},THREE.Quaternion.prototype.rotate=function(a){var b=(new THREE.Matrix4).makeRotationFromQuaternion(this),c=b.elements,d=(new THREE.Matrix3).set(c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]);return a.applyMatrix3(d)},THREE.Vector3.prototype.findAngleWith=function(a,b){var c=0,d=this.clone().normalize().clone().dot(a.clone().normalize()),e=this.clone().cross(a).clone().normalize();if(e.clone().length()<Number.MIN_VALUE)c=d>0?0:180;else{b=e.clone().dot(b.clone().normalize())>0?e:-e;var f=(new THREE.Quaternion).setFromAxisAngle(b,90*THREE.Math.degToRad);f=f.clone().rotate(a).clone().normalize().clone().dot(this),c=Math.acos(d)*THREE.Math.radToDeg,Math.abs(c-90)<Number.MIN_VALUE&&(c=90),(c<90&&d*f>0||c>90&&d*f<0||90==c&&f>0)&&(c*=-1)}return c=THREE.Math.degToRad(c)},"contains"in String.prototype||(String.prototype.contains=function(a,b){return-1!==String.prototype.indexOf.call(this,a,b)}),Math.linearClamp=function(a,b,c){return a<=b?0:a>=c?1:(a-b)/(c-b)},Math.easeClamp=function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;var d=(a-b)/(c-b);return.5*(Math.sin((d-.5)*Math.PI)+1)},Math.linearInterp=function(a,b,c){return b*(1-a)+c*a},Math.equalityClamp=function(a,b,c){return a<=b?b:a>=c?c:a},Math.round2=function(a){return Math.round(100*a)/100},Math.round1=function(a){return Math.round(10*a)/10},this.animateTransition=function(b){if(b){var d=!1,e=0;if(this.setCameraOrtho(b.isOrtho),q.elapsedTime>=J.duration)return e=1,q.center.copy(b.center),q.pivot.copy(b.pivot),a.position.copy(b.position),a.up.copy(b.up),a.target.copy(b.center),b.isOrtho||(a.fov=b.fov),a.dirty=!0,d=!b.worldUp.equals(this.sceneUpDirection),d&&this.setWorldUpVector(b.worldUp),this.currentlyAnimating=!1,c(d),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),void this.navApi.setTransitionActive(!1);this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var f=J.destinationPercent;e=Math.easeClamp(q.elapsedTime/J.duration,0,f);var g=1-e;q.elapsedTime+=u/500;var h=q.center.clone().multiplyScalar(g).add(b.center.clone().multiplyScalar(e)),i=a.position.clone().multiplyScalar(g).add(b.position.clone().multiplyScalar(e)),j=a.up.clone().multiplyScalar(g).add(b.up.clone().multiplyScalar(e)),k=a.pivot.clone().multiplyScalar(g).add(b.pivot.clone().multiplyScalar(e)),l=this.sceneUpDirection.clone().multiplyScalar(g).add(b.worldUp.clone().multiplyScalar(e)),m=a.fov*g+b.fov*e;q.center.copy(h),q.pivot.copy(k),a.position.copy(i),a.up.copy(j),a.target.copy(h),b.isOrtho||(a.fov=m),a.dirty=!0,d=l.distanceToSquared(this.sceneUpDirection)>1e-4,d&&this.setWorldUpVector(l),a.lookAt(q.center),c(d),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame(function(){q.animateTransition(b)})}},this.sphericallyInterpolateTransition=function(b){var d,e,f,g=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),q.elapsedTime>=J.duration)g=1,this.currentlyAnimating=!1;else{var h=J.destinationPercent;g=Math.easeClamp(q.elapsedTime/J.duration,0,h),q.elapsedTime+=u/500}if(1===g)e=L.position,d=L.center,f=L.up;else{var i=new THREE.Matrix3,j=F.clone();j.slerp(G,g),i.makeRotationFromQuaternion(j);var k=Math.linearInterp(g,D,E),l=i.elements;d=K.center.clone().multiplyScalar(1-g).add(L.center.clone().multiplyScalar(g)),e=d.clone().sub(new THREE.Vector3(l[0],l[1],l[2]).multiplyScalar(k)),f=new THREE.Vector3(l[3],l[4],l[5])}q.center.copy(d),a.position.copy(e),a.up.copy(f),q.navApi.getUsePivotAlways()||q.pivot.copy(d),a.lookAt(q.center),this.currentlyAnimating===!0?(this.showPivot(!0),requestAnimationFrame(function(){q.sphericallyInterpolateTransition(b)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),b&&b()),c(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var b=Math.round1(a.up.x),c=Math.round1(a.up.y),d=Math.round1(a.up.z),e=this.sceneFrontDirection.clone(),f=this.sceneUpDirection.clone(),g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();e.x=Math.round1(e.x),e.y=Math.round1(e.y),e.z=Math.round1(e.z),f.x=Math.round1(f.x),f.y=Math.round1(f.y),f.z=Math.round1(f.z),g.x=Math.round1(g.x),g.y=Math.round1(g.y),g.z=Math.round1(g.z);var h=g.clone().multiplyScalar(-1),i=f.clone().multiplyScalar(-1),j=e.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case"right":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(j.x==b&&j.y==c&&j.z==d)return"left";if(e.x==b&&e.y==c&&e.z==d)return"right";break;case"left":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(e.x==b&&e.y==c&&e.z==d)return"left";if(j.x==b&&j.y==c&&j.z==d)return"right";break;case"back":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(h.x==b&&h.y==c&&h.z==d)return"right";if(g.x==b&&g.y==c&&g.z==d)return"left";break;case"top":if(j.x==b&&j.y==c&&j.z==d)return"down";if(e.x==b&&e.y==c&&e.z==d)return"up";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case"bottom":if(e.x==b&&e.y==c&&e.z==d)return"down";if(j.x==b&&j.y==c&&j.z==d)return"up";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left"}}},this.setCameraOrtho=function(b){b&&a.isPerspective&&a.toOrthographic(),b||a.isPerspective||a.toPerspective()},this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),c(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front"),this.sceneUpDirection.copy(a.up.clone()),this.sceneFrontDirection.copy(this.getView()).normalize(),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.orthographicFaces&&this.setCameraOrtho(!0),c(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top"),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),this.sceneFrontDirection.copy(a.up),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),c(!0)},this.calculateCubeTransform=function(b){var c=this.sceneUpDirection.clone(),d=this.sceneFrontDirection.clone(),e=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();K=a.clone(),K.center=q.center.clone(),K.pivot=q.pivot.clone(),L=a.clone(),L.center=q.center.clone(),L.pivot=q.pivot.clone();var f=new THREE.Vector3(0,0,0);b.contains("back")&&(f=f.add(d)),b.contains("front")&&(f=f.sub(d)),b.contains("top")&&(f=f.add(c)),b.contains("bottom")&&(f=f.sub(c)),b.contains("right")&&(f=f.add(e)),b.contains("left")&&(f=f.sub(e));var g=c,h=f.clone().normalize();if(1-Math.abs(h.dot(c))<Number.MIN_VALUE)for(var i=this.getView().normalize(),j=[d.clone(),d.clone().negate(),e.clone(),e.clone().negate()],k=h.dot(c)>0?1:-1,l=i.clone().add(a.up.clone().multiplyScalar(k)).normalize(),m=-2,n=0;n<4;n++){var o=l.dot(j[n]);o>m&&(m=o,g=j[n].multiplyScalar(k))}E=D=this.getView().length(),L.position.copy(L.center.clone().add(f.multiplyScalar(E/f.length()))),L.up.copy(g);var p=K.center.clone().sub(K.position).normalize(),r=p.clone().cross(K.up).normalize(),s=r.clone().cross(p).normalize(),t=new THREE.Matrix3;t.set(p.x,s.x,r.x,p.y,s.y,r.y,p.z,s.z,r.z),F.setFromRotationMatrix3(t),p=L.center.clone().sub(L.position).normalize(),r=p.clone().cross(L.up).normalize(),s=r.clone().cross(p).normalize(),t.set(p.x,s.x,r.x,p.y,s.y,r.y,p.z,s.z,r.z),H.setFromAxisAngle(p,0),I.setFromAxisAngle(s,0),G.setFromRotationMatrix3(t),G.multiply(H).multiply(I).normalize()},this.centerShot=function(b){K&&!b||(q.elapsedTime=0,K=L=a.clone(),K.center=q.center);var d=q.pivot.clone(),e=d.clone().sub(K.position),f=K.center.clone().sub(K.position).normalize(),g=K.up.clone(),h=f.clone().cross(g).normalize();g=h.clone().cross(f).normalize();var i=h.clone().multiplyScalar(h.dot(e)),j=g.clone().multiplyScalar(g.dot(e)),k=i.clone().add(j);L.position.copy(K.position.clone().add(k)),L.center=d,L.pivot=d;var l=0;if(q.elapsedTime>=J.duration)l=1;else{var m=J.destinationPercent;l=Math.easeClamp(q.elapsedTime/J.duration,0,m),q.elapsedTime+=u/2e3}var n=a.position.clone().multiplyScalar(1-l).add(L.position.clone().multiplyScalar(l)),o=q.center.clone().multiplyScalar(1-l).add(L.center.clone().multiplyScalar(l)),p=q.pivot.clone().multiplyScalar(1-l).add(L.pivot.clone().multiplyScalar(l));a.position.copy(n),q.center.copy(o),q.pivot.copy(p),a.lookAt(q.center),c(!1),1===l?this.addHistoryElement():requestAnimationFrame(function(){q.centerShot(!1)})},this.levelShot=function(){var b=this.getView(),c=b.length(),d=this.sceneUpDirection.clone(),e=a.up.clone().normalize(),f=b.normalize(),g=f.dot(d);if(1-Math.abs(g)>Number.MIN_VALUE){var h=f.clone().cross(d);f=d.clone().cross(h),f.normalize()}else f=e.clone();f.multiplyScalar(c);var i={center:f.add(a.position),up:d,position:a.position,pivot:q.center.clone().add(f),fov:a.fov,worldUp:d};q.elapsedTime=0,q.animateTransition(i)},this.fitToWindow=function(){var b=this.getView(),c=a.up.clone();b.normalize(),c.normalize(),L=a.clone(),L.center=q.center,c=d(c,b),c.normalize(),L.up.copy(c);var e=b.clone().cross(c);e.normalize();var f=Q.clone(),g=R.clone(),h=[f,g],i=new THREE.Vector3(g.x-f.x,g.y-f.y,g.z-f.z);h[2]=new THREE.Vector3(g.x,f.y,g.z),h[3]=new THREE.Vector3(g.x,f.y,f.z),h[4]=new THREE.Vector3(g.x,g.y,f.z),h[5]=new THREE.Vector3(f.x,g.y,g.z),h[6]=new THREE.Vector3(f.x,g.y,f.z),h[7]=new THREE.Vector3(f.x,f.y,g.z);for(var j=0;j<8;j++){var k=h[j].clone().sub(a.position);h[j].setX(k.clone().dot(e)),h[j].setY(k.clone().dot(c)),h[j].setZ(k.clone().dot(b))}var l,m,n,o,p=THREE.Math.degToRad(a.topFov),r=THREE.Math.degToRad(a.bottomFov),s=THREE.Math.degToRad(a.leftFov),t=THREE.Math.degToRad(a.rightFov);l=s>=0?Number.MAX_VALUE:Number.MIN_VALUE,m=t>=0?Number.MAX_VALUE:Number.MIN_VALUE,n=p>=0?Number.MAX_VALUE:Number.MIN_VALUE,o=r>=0?Number.MAX_VALUE:Number.MIN_VALUE;for(var u=1/Math.tan(t),v=-1/Math.tan(s),w=1/Math.tan(p),x=-1/Math.tan(r),y=0;y<8;y++){var z=h[y].clone(),A=z.z-v*z.x;l=s>=0?Math.min(l,A):Math.max(l,A),A=z.z-u*z.x,m=t>=0?Math.min(m,A):Math.max(m,A),A=z.z-w*z.y,n=p>=0?Math.min(n,A):Math.max(n,A),A=z.z-x*z.y,o=r>=0?Math.min(o,A):Math.max(o,A)}var B=(m-l)/(v-u),C=v*B+l,D=(o-n)/(w-x),E=w*D+n,F=0;if(C<=E){var G=(p-r)/2;if(Math.abs(G)>Number.MIN_VALUE){var H=1/Math.tan(G);D=D-E/H+C/H}F=C}else{var I=(t-s)/2;if(Math.abs(I)>Number.MIN_VALUE){var J=1/Math.tan(I);B=B-C/J+E/J}F=E}var K=new THREE.Vector3(B,D,F),M=e.clone().multiplyScalar(K.x),N=c.clone().multiplyScalar(K.y),O=b.clone().multiplyScalar(K.z);K=M.clone().add(N.clone().add(O)),L.position.add(K);var P=i.clone().sub(L.position).dot(b);L.center=L.position.clone().add(b.multiplyScalar(P)),L.pivot=i.clone();var S={center:L.center,up:L.up,position:L.position,pivot:L.pivot,fov:a.fov,worldUp:q.sceneUpDirection.clone()};q.elapsedTime=0,q.animateTransition(S)},this.updatePivotPosition=function(b){var c,d,e=new THREE.Vector3(b.x/window.innerWidth*2-1,2*-(b.y/window.innerHeight)+1,.5);if(e=e.unproject(a),c=new THREE.Raycaster(a.position,e.sub(a.position).normalize()),d=c.intersectObjects(objects),"zoom"==q.mode)if(void 0!==d[0]){var f=d[0].point;q.pivot.copy(f)}else{var g=h(b);q.pivot.copy(g.rayO.clone().add(g.rayD))}else if(void 0!==d[0]){wheel.cursorImage("pivot");var f=d[0].point;q.isMouseDown||q.pivot.copy(f)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(b,c,d,e,f){var g=new THREE.Vector3(0,1,0),h=a.position.clone().dot(g),i=Math.linearClamp(h,q.minSceneBound,q.maxSceneBound),j=i-.5;s&&(s.find("img#updownImageA").remove(),s.prepend('<img src="'+f+'SWheighthandleA.png" id="updownImageA" style="position:fixed; z-index:9999; top:'+(d-86*j)+"px; left:"+c+'px;"/>'),e||s.prepend('<img src="'+f+'SWheighthandleI.png" id="updownImageI" style="position:fixed; z-index:9998; top:'+(d-86*j)+"px; left:"+c+'px;"/>'))},this.drawDropdownMenu=function(a,b,c,d,e,f,g){var h=0;if(r)f.appendChild(r);else{r=document.createElement("div"),r.className="dropDownMenu",r.style.top="100px",r.style.left="-400px";for(var i=0,j=0,k=0;k<a.length;k++){var l;if(null===a[k])l=document.createElement("li"),l.style.height="1px",i+=1,l.style.backgroundColor="#E0E0E0";else{var m=Autodesk.Viewing.i18n.translate(a[k]);if(j=m.length>j?m.length:j,c[k]){l=document.createElement("div");var n=document.createElement("input"),o=document.createElement("label");n.type="radio",n.className="dropDownMenuCheck",o.innerHTML=m,o.className="dropDownMenuCheckText",l.appendChild(n),l.appendChild(o),l.className="dropDownMenuCheckbox"}else l=document.createElement("li"),l.textContent=m,l.className=b[k]?"dropDownMenuItem":"dropDownMenuItemDisabled";l.id="menuItem"+h,h++,i+=25,l.setAttribute("data-i18n",a[k])}r.appendChild(l)}f.appendChild(r),r.style.minWidth=Math.max(256,7.4*j)+"px";var p=r.getBoundingClientRect().width;this.menuSize.x=p,this.menuSize.y=i}h=0;for(var k=0;k<a.length;k++)if(null!==a[k]){if(c[k]){var q="menuItem"+h,s=document.getElementById(q);s&&(s.children[0].checked=c[k]())}h++}var t=e-15,u=d+1,v=this.canvas.getBoundingClientRect();u+this.menuSize.x>v.right&&(u=d-this.menuSize.x-1),t+this.menuSize.y>v.bottom&&(t=v.bottom-this.menuSize.y),t-=g.y,u-=g.x,r.style.top=t+"px",r.style.left=u+"px",this.menuOrigin.x=u,this.menuOrigin.y=t},this.removeDropdownMenu=function(a){a.removeChild(r)},this.isFaceView=function(){return p(this.center.clone().sub(a.position).normalize())&&p(a.up)},this.startInteraction=function(a,b){this.startCursor=new THREE.Vector2(a,b),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(b,d,e,f){if(this.navApi.isActionEnabled("orbit")&&this.currentlyAnimating!==!0){var h="wheel";if(q.orthographicFaces&&!a.isPerspective&&(a.toPerspective(),f&&f.saveEye.copy(this.camera.position)),f&&(h="cube"),"cube"==h?(this.saveCenter.copy(f.saveCenter),this.saveEye.copy(f.saveEye),this.savePivot.copy(f.savePivot),this.saveUp.copy(f.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(a.position),this.saveUp.copy(a.up),this.useSnap=!1,this.doCustomOrbit=!1),j()&&void 0==A&&(A=this.saveCenter.clone(),z=this.saveEye.clone(),C=this.savePivot.clone(),B=this.saveUp.clone()),this.preserveOrbitUpDirection){var k=g(b.x-d.x,b.y-d.y),l=g(e.x,e.y),m=this.sceneUpDirection.clone(),n=this.sceneFrontDirection.clone(),o=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),p=j()?C:this.savePivot,r=j()?z:this.saveEye,s=j()?A:this.saveCenter,t=j()?B:this.saveUp,u=p.clone().sub(r).normalize(),v=s.clone().sub(r).normalize(),w=v.clone().cross(t),x=r.clone().sub(p).length(),y=r.clone().sub(s).length(),D=u.clone().multiplyScalar(-1),E=v.clone().multiplyScalar(-1),F=w,G=t.clone();if(!this.constrainOrbitHorizontal){m.dot(this.saveUp)<-.009&&(k.x=-k.x,l.x=-l.x);var H=0;H=j()?l.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+i("h",0,-l.x):k.x*this.orbitMultiplier,this.lastSnapRotateX=H;var I=(new THREE.Quaternion).setFromAxisAngle(m,-H);D.applyQuaternion(I),E.applyQuaternion(I),F.applyQuaternion(I),G.applyQuaternion(I)}if(!this.constrainOrbitVertical){var J=n.clone().multiplyScalar(n.dot(F)),K=o.clone().multiplyScalar(o.dot(F)),L=J.clone().add(K);L.clone().normalize();var M=0;if(j())M=l.y*this.orbitMultiplier;else{var N=i("v",0,l.y);M=this.useSnap?this.lastSnapRotateY+N:k.y*this.orbitMultiplier}var O=(new THREE.Quaternion).setFromAxisAngle(L,-M);if(this.navApi.getOrbitPastWorldPoles())D.applyQuaternion(O).normalize(),E.applyQuaternion(O).normalize(),G.applyQuaternion(O).normalize();else{var P=G.clone();P.applyQuaternion(O).normalize();if(m.dot(P)<0){var Q=E.clone();Q.applyQuaternion(O).normalize();var R=Q.angleTo(m);Math.abs(R)>.5*Math.PI&&(R-=R>0?Math.PI:-Math.PI),M-=R,O.setFromAxisAngle(L,-M),D.applyQuaternion(O).normalize(),E.applyQuaternion(O).normalize(),G.applyQuaternion(O).normalize()}else D.applyQuaternion(O).normalize(),E.applyQuaternion(O).normalize(),G.applyQuaternion(O).normalize()}this.lastSnapRotateY=M}var S=D.multiplyScalar(x).add(p);a.position.copy(S),a.up.copy(G),this.center.copy(S),this.center.sub(E.multiplyScalar(y)),j()&&(A.copy(this.center),z.copy(a.position),C.copy(this.pivot),B.copy(a.up))}a.lookAt(this.center),c(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(b){if(this.navApi.isActionEnabled("walk")){var d=g(b.x,b.y),e=this.userLookSpeed,f=this.getView(),h=a.up,i=f.clone().cross(h).normalize(),j=this.sceneUpDirection.clone(),k=d.clone();k.x*=Math.PI,k.y*=Math.PI/a.aspect,k.multiplyScalar(e);var l=(new THREE.Quaternion).setFromAxisAngle(i,-k.y);if(a.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var m=h.clone();if(m.applyQuaternion(l).normalize(),m.dot(j)<0){var n=f.clone();n.applyQuaternion(l);var o=n.angleTo(j);Math.abs(o)>.5*Math.PI&&(o-=o>0?Math.PI:-Math.PI),k.y-=o,l.setFromAxisAngle(i,-k.y)}}f=l.clone().rotate(f),h=l.clone().rotate(h),h.normalize();var p=a.keepSceneUpright?j:h,q=(new THREE.Quaternion).setFromAxisAngle(p,-k.x);f=q.clone().rotate(f),h=q.clone().rotate(h),this.center.copy(f.add(a.position)),a.up.copy(h),a.lookAt(this.center),c(!1)}},this.pan=function(b){if(this.navApi.isActionEnabled("pan")){b=g(b.x,b.y);var d=this.getView(),e=a.up.clone().cross(d),f=d.clone().cross(e);e.normalize(),f.normalize(),d.normalize();var h=this.pivot.clone().sub(a.position),i=d.clone().dot(h),j=i*(Math.tan(THREE.Math.degToRad(a.leftFov))+Math.tan(THREE.Math.degToRad(a.rightFov))),k=i*(Math.tan(THREE.Math.degToRad(a.topFov))+Math.tan(THREE.Math.degToRad(a.bottomFov))),l=b.x*Math.abs(j),m=b.y*Math.abs(k),n=new THREE.Vector3,o=e.clone().multiplyScalar(l),p=f.clone().multiplyScalar(m);n=o.clone().add(p).clone().multiplyScalar(this.userPanSpeed),a.position.add(n),this.center.add(n),a.lookAt(this.center),c(!1)}},this.zoom=function(b){if(this.navApi.isActionEnabled("zoom")){var d=this.userZoomSpeed,e=Number.MAX_VALUE,f=b.x+b.y,g=Math.pow(d,f),h=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(g)),i=h.clone().add(q.D.clone().multiplyScalar(q.D.clone().dot(this.pivot.clone().sub(h).clone())));if(!(g>=e)){if(f>0){Math.pow(d,f-0);if(f<0)return void(P=0);a.position.copy(h),this.center.copy(i);var j=h.clone().sub(this.saveEye).dot(q.D);j>e?(a.position.copy(this.saveEye.sub(q.D).clone().multiplyScalar(e)),P=e>0?-1:0):P=-(j/e)}else a.position.copy(h),this.center.copy(i);a.lookAt(this.center),c(!1)}}},this.walk=function(b,d,e,f,h){if(this.navApi.isActionEnabled("walk")){var i=this.sceneUpDirection.clone(),j=this.sceneFrontDirection.clone(),l=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);k(b,d)?(wheel.cursorImage("SWWalk"),m(!0,b,d),x=d.x,y=d.y):m(!1,b,d),x=b.x,y=b.y;var n=g(x-d.x,y-d.y),o=-n.x,p=-n.y,q=o<0?-1:1,r=p<0?-1:1,s=Math.abs(o),t=Math.abs(p),u=new THREE.Vector2(30,30);u=g(u.x,u.y),s=k(b,d)?0:Math.abs(o)-u.x,t=k(b,d)?0:Math.abs(p)-u.y;s/=.25,t/=.25,s=s<1?Math.easeClamp(s,0,1):Math.pow(s,1),t=t<1?Math.easeClamp(t,0,1):Math.pow(t,1);var v=s>0?s*q:0,w=t>0?t*r:0,z=this.getView(),A=z.length();z.normalize();z.clone().cross(a.up).normalize();var B=l.clone().multiplyScalar(l.clone().dot(z)),C=j.clone().multiplyScalar(j.clone().dot(z)),D=C.clone().add(B);D=D.clone().length()>Number.MIN_VALUE?D.normalize():a.up;var E=w*(1*this.walkMultiplier),F=D,G=Math.cos(.65);1!=G&&(i.clone().dot(a.up)<-Number.MIN_VALUE&&i.clone().dot(z)<-G||i.clone().dot(a.up)>Number.MIN_VALUE&&i.clone().dot(z)>G)&&(F=-F);var H=-v*this.walkMultiplier*.05,I=a.up;(i.clone().dot(a.up)<-Number.MIN_VALUE||Math.abs(i.clone().dot(a.up))<Number.MIN_VALUE&&i.clone().dot(z)>Number.MIN_VALUE)&&(H=-H),I=i;var J=(new THREE.Quaternion).setFromAxisAngle(I,H);J.normalize(),z=J.clone().rotate(z),z.normalize(),a.up.copy(J.clone().rotate(a.up)),a.up.normalize(),a.position.add(F.clone().multiplyScalar(E)),this.center.copy(a.position.clone().add(z.clone().multiplyScalar(A))),F=i,F.normalize(),0===E&&(E=.01),a.lookAt(this.center),c(!1)}},this.updown=function(b){if(!this.navApi.getIsLocked()){var d=b,e=o(d);q.m_amount+=e;var f=new THREE.Vector3(0,1,0),g=q.saveEye.clone().sub(f.clone().multiplyScalar(q.m_amount)),h=g.clone().dot(f);a.position.copy(g),h<q.minSceneBound&&a.position.add(f.clone().multiplyScalar(q.minSceneBound-h)),h>q.maxSceneBound&&a.position.add(f.clone().multiplyScalar(q.maxSceneBound-h)),this.center.copy(a.position.clone().add(q.saveCenter.clone().sub(q.saveEye))),a.lookAt(this.center),c(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(a){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,
this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement();for(var b=0;b<this.rewindParams.history.length;b++){var c=b-this.rewindParams.timelineIndex,d=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[b].thumbnailBounds.setCenter(new THREE.Vector2(a.x+c*d,a.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[b].weight=b==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);var d=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);if(this.rewindParams.open=!0,this.rewindParams.openLocation=a.clone(),this.rewindParams.openLocationOrigin=a.clone(),this.rewindParams.openBracket=a.clone(),this.rewindParams.openBracketA=new THREE.Vector2(d,a.y),this.rewindParams.openBracketB=new THREE.Vector2(window.innerWidth-d,a.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var e=this.rewindParams.openBracketA.x;this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=e}this.rewindParams.locationOffset=new THREE.Vector2(0,0),this.rewindParams.snapOffset=new THREE.Vector2(0,0)},this.slideTimeline=function(a){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var b=a.clone().add(this.rewindParams.locationOffset),c=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),d=c,e=window.innerWidth-c,f=this.rewindParams.history[0].thumbnailBounds.center().x,g=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,h=0;if(b.x<this.rewindParams.openBracketA.x){h=b.x-this.rewindParams.openBracketA.x;var i=f-h;d<i&&(h=Math.min(h+(i-d),0))}if(b.x>this.rewindParams.openBracketB.x){h=b.x-this.rewindParams.openBracketB.x;var j=g-h;e>j&&(h=Math.max(h+(j-e),0))}this.rewindParams.openLocation.x+=h,this.rewindParams.openBracketA.x+=h,this.rewindParams.openBracketB.x+=h,this.rewindParams.openBracket.x=b.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);var k=new THREE.Vector2(-h,0),l=b.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));k.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0;var m=!1;if(this.rewindParams.snappingEnabled)for(var n=0;n<this.rewindParams.history.length;n++){var o=this.rewindParams.history[n].thumbnailBounds.center().add(k);if(Math.abs(o.x-l.x)<4||this.rewindParams.snapped&&Math.abs(o.x-l.x)<16){m=!0,0!==h?(this.rewindParams.snapOffset.x=o.x-l.x,k.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=o.x-l.x,l.x=o.x;break}}this.rewindParams.snapped=m;for(var p=-1,q=0,r=0;r<this.rewindParams.history.length;r++){var s=this.rewindParams.history[r].thumbnailBounds.clone();if(this.rewindParams.history[r].thumbnailBounds.setCenter(this.rewindParams.history[r].thumbnailBounds.center().add(k)),this.rewindParams.history[r].thumbnail){var t=this.rewindParams.history[r].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+r).css("left",t),$("#rewindBorder"+r).css("left",t-4)}var u=new THREE.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));s.setFromCenterAndSize(s.center(),u);var v=new THREE.Vector2(0,0);s.getIcon2DCoords(l,v);var w=1-Math.abs(Math.equalityClamp(v.x,-1,1));this.rewindParams.history[r].weight=w,0===r&&l.x<s.center().x&&(this.rewindParams.history[r].weight=1),r===this.rewindParams.history.length-1&&l.x>s.center().x&&(this.rewindParams.history[r].weight=1),q+=this.rewindParams.history[r].weight,this.rewindParams.history[r].weight>p&&(p=this.rewindParams.history[r].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[r].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[r].thumbnailBounds.center().x-l.x,this.rewindParams.timelineIndexSlide=r)}for(var x=0;x<this.rewindParams.history.length;x++)this.rewindParams.history[x].weight=this.rewindParams.history[x].weight/q;var y=this.rewindParams.history[0].thumbnailBounds.center().x,z=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<y?(this.rewindParams.locationOffset.x+=y-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=y):this.rewindParams.openBracket.x>z&&(this.rewindParams.locationOffset.x+=z-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=z)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,q.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var b=this.rewindParams.timelineIndex,d=0;if(q.elapsedTime>=J.duration)d=1;else{var e=J.destinationPercent;d=Math.easeClamp(q.elapsedTime/J.duration,0,e),q.elapsedTime+=u/500}q.center.copy(q.center.clone().multiplyScalar(1-d).clone().add(this.rewindParams.history[b].camera.center.clone().multiplyScalar(d))),a.position.copy(a.position.clone().multiplyScalar(1-d).clone().add(this.rewindParams.history[b].camera.position.clone().multiplyScalar(d))),a.up.copy(this.rewindParams.history[b].camera.up),q.pivot.copy(q.center),a.lookAt(q.center),c(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==d&&requestAnimationFrame(function(){q.animateToRewindIndex()})},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var b=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4);b.center=new THREE.Vector3(0,0,0),b.pivot=new THREE.Vector3(0,0,0),b.leftFov=0,b.rightFov=0,b.topFov=0,b.bottomFov=0,b.up.set(0,0,0);for(var d=0;d<this.rewindParams.history.length;d++){var e=this.rewindParams.history[d].camera,f=this.rewindParams.history[d].weight;b.center.add(e.center.clone().multiplyScalar(f)),b.position.add(e.position.clone().multiplyScalar(f)),b.up.add(e.up.clone().multiplyScalar(f)),b.rotation.add(e.rotation.clone().multiplyScalar(f)),b.pivot.add(e.pivot.clone().multiplyScalar(f)),b.leftFov+=e.leftFov*f,b.rightFov+=e.rightFov*f,b.topFov+=e.topFov*f,b.bottomFov+=e.bottomFov*f}a.position.copy(b.position),a.up.copy(b.up),a.rotation=b.rotation,a.leftFov=b.leftFov,a.rightFov=b.rightFov,a.topFov=b.topFov,a.bottomFov=b.bottomFov,q.center.copy(b.center),q.pivot.copy(b.pivot),a.lookAt(q.center),a.up.normalize(),c(!1)}};var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private;avp.Autocam.ViewCube=function(a,b,c,d){function e(a,b){var c={};return 0===a.type.indexOf("touch")?a.touches.length>0?(c.clientX=a.touches[0].clientX,c.clientY=a.touches[0].clientY,c.pageX=a.touches[0].pageX,c.pageY=a.touches[0].pageY,c.screenX=a.touches[0].screenX,c.screenY=a.touches[0].screenY,c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY,c.which=g.navApi.getUseLeftHandedInput()?3:1):c=b.prevCoords:(c.clientX=a.clientX,c.clientY=a.clientY,c.pageX=a.pageX,c.pageY=a.pageY,c.screenX=a.screenX,c.screenY=a.screenY,c.which=a.which,S?(c.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,c.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0):(c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY)),b.prevX=c.screenX,b.prevY=c.screenY,b.prevCoords=c,c}var f=this,g=b,h=b.camera;b.setCube(this),f.currentFace="front";var i,j,k,l,m,n,o=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],p=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],q=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],r=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],s=[null,null,function(){return!g.orthographicFaces&&!h.isPerspective},function(){return!g.orthographicFaces&&h.isPerspective},function(){return g.orthographicFaces},null,null,null,null,null,null,null,null];f.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),f.camera.position.copy(h.position),f.center=new THREE.Vector3(0,0,0),f.camera.lookAt(f.center);var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=[],I=[],J=[],K=[],L=[],M=null,N=null,O=null,P=0,Q=0,R=!0,S=!1,T=!1,U=!1,V=navigator.userAgent.search("Chrome")!=-1,W=navigator.platform.search("Win32")!=-1,X=!1,Y=!1,Z=[];this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5;var $=function(a){var b=a.getBoundingClientRect();return{x:b.left,y:b.top,w:b.width,h:b.height}},_=function(a){a.preventDefault(),a.stopPropagation(),T=document.pointerLockElement===c||document.mozPointerLockElement===c||document.webkitPointerLockElement===c},aa=function(){g.navApi.isActionEnabled("orbit")&&(c.style.opacity="1.0",Y=!1),requestAnimationFrame(f.render)},ba=function(a){if(Y||g.viewCubeMenuOpen||!g.navApi.isActionEnabled("orbit"))g.navApi.isActionEnabled("orbit")&&(c.style.opacity=1);else{var b=Math.max(4*Math.abs((a.clientX-G.x)/G.w-.5)-1,0),d=Math.max(4*Math.abs((a.clientY-G.y)/G.h-.5)-1,0),e=Math.max(0,Math.min(Math.sqrt(b*b+d*d),1));c.style.opacity=1-e*(1-f.inactiveOpacity)}},ca=function(){g.viewCubeMenuOpen||(c.style.opacity=f.inactiveOpacity,Y=!0,requestAnimationFrame(f.render))},da=function(a){var b=new Image,c=av.getUseCredentials()&&(a.indexOf("://")===-1||a.indexOf(window.location.host)!==-1);b.crossOrigin=c?"use-credentials":"anonymous";var d=new THREE.Texture(b);return b.onload=function(){d.needsUpdate=!0,++Q>=11&&requestAnimationFrame(f.render)},b.src=a,d},ea=function(){var a,b=[],c=[];b[0]=pa(0,0),b[1]=pa(0,Math.PI/2),b[2]=pa(0,-Math.PI/2),b[3]=pa(0,Math.PI),b[4]=pa(Math.PI/2,0),b[5]=pa(Math.PI/2,Math.PI/2),b[6]=pa(Math.PI/2,-Math.PI/2),b[7]=pa(Math.PI/2,Math.PI),c[0]=oa(0,0,0),c[1]=oa(0,Math.PI/2,0),c[2]=oa(0,-Math.PI/2,0),c[3]=oa(0,Math.PI,0),c[4]=oa(Math.PI/2,0,0),c[5]=oa(Math.PI/2,Math.PI/2,0),c[6]=oa(Math.PI/2,-Math.PI/2,0),c[7]=oa(Math.PI/2,Math.PI,0),c[8]=oa(0,0,Math.PI/2),c[9]=oa(0,0,-Math.PI/2),c[10]=oa(-Math.PI/2,0,-Math.PI/2),c[11]=oa(-Math.PI,0,-Math.PI/2),H.push(na(0,0)),H[0].name="front",J.push(H[0]),L.push(H[0]),k.add(H[0]),H.push(na(0,Math.PI/2)),H[1].name="right",J.push(H[1]),L.push(H[1]),k.add(H[1]),H.push(na(0,Math.PI)),H[2].name="back",J.push(H[2]),L.push(H[2]),k.add(H[2]),H.push(na(0,-Math.PI/2)),H[3].name="left",J.push(H[3]),L.push(H[3]),k.add(H[3]),H.push(na(Math.PI/2,0)),H[4].name="bottom",J.push(H[4]),L.push(H[4]),k.add(H[4]),H.push(na(-Math.PI/2,0)),H[5].name="top",J.push(H[5]),L.push(H[5]),k.add(H[5]),a=H.length;var d;for(d=0;d<b.length;d++)H.push(b[d]),H[a+d].name=p[d],k.add(H[a+d]),J.push(H[a+d]),L.push(H[a+d]);for(a=H.length,d=0;d<c.length;d++)H.push(c[d]),H[a+d].name=o[d],k.add(H[a+d]),J.push(H[a+d]),L.push(H[a+d])},fa=function(a,b,c){var d,e=new THREE.Vector3;return e.copy(a),e=e.unproject(b),d=new THREE.Raycaster(b.position,e.sub(b.position).normalize()),d.intersectObjects(c)},ga=function(a,b){var c=a.clientX-b.x,d=a.clientY-b.y;return c=c/b.w*2-1,d=(b.h-d)/b.h*2-1,new THREE.Vector3(c,d,.5)},ha=function(a){if(a.preventDefault(),a.stopPropagation(),g.navApi.isActionEnabled("orbit")&&!g.currentlyAnimating){var b=e(a,f);G=$(c),c.removeEventListener("mousemove",la,!1),document.addEventListener("mouseup",ka,!1),document.addEventListener("touchend",ka,!1),g.navApi.getUsePivotAlways()||(g.pivot.copy(g.center),g.navApi.setPivotPoint(g.center),g.navApi.setPivotSetFlag(!1)),g.startInteraction(b.pageX,b.pageY);var d,h;0==g.rewindParams.history.length&&g.addHistoryElement(),g.rewindParams.snapped&&g.rewindParams.timelineIndex+1==g.rewindParams.history.length||g.addIntermediateHistoryElement();var i=g.navApi.getUseLeftHandedInput()?1:3;if(b.which!==i){if(f.animSpeed<=0)return void avp.logger.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR));h=ga(b,G),d=fa(h,f.camera,L),d.length>0&&(sa(),f.draggable&&(document.addEventListener("mousemove",ia,!1),document.addEventListener("touchmove",ia,!1),S&&(c.requestPointerLock(),U=V&&W)))}}},ia=function(a){if(a.preventDefault(),a.stopPropagation(),f.animSpeed<=0)return document.removeEventListener("mousemove",ia,!1),document.removeEventListener("touchmove",ia,!1),void avp.logger.error("animSpeed cannot be 0 or less",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR));if(!g.currentlyAnimating){var b=e(a,f);if(S&&U&&(U=!1,b.movementX=b.movementY=0),T&&(b.movementX>300||b.movementY>300)&&(b.movementX=0,b.movementY=0),b.movementX===b.movementY&&0===b.movementX)return void(g.currentlyAnimating=!1);R=!1,X=!0,g.showPivot(!0),g.currentCursor=new THREE.Vector2(b.pageX,b.pageY),g.orbit(g.currentCursor,g.startCursor,new THREE.Vector3(-b.movementX,b.movementY,0),g.startState),f.camera.lookAt(f.center),requestAnimationFrame(f.render)}},ja=function(a){a||(document.removeEventListener("mouseup",ka,!1),document.removeEventListener("touchend",ka,!1)),document.removeEventListener("mousemove",ia,!1),document.removeEventListener("touchmove",ia,!1),c.addEventListener("mousemove",la,!1),T&&document.exitPointerLock()},ka=function(a){a.preventDefault(),a.stopPropagation();var b,d,i;if(g.currentlyAnimating||X)return g.endInteraction(),g.showPivot(!1),X=!1,void ja(!1);var j=e(a,f);if(g.viewCubeMenuOpen){var k=j.clientX-G.x,l=j.clientY-G.y;if(g.menuOrigin.x<=k&&k<=g.menuOrigin.x+g.menuSize.x&&g.menuOrigin.y<=l&&l<=g.menuOrigin.y+g.menuSize.y){var m=Math.floor((l-5-g.menuOrigin.y)/25),o=function(a){avp.logger.track({name:"navigation/"+a,aggregate:"count"})};switch(m){case 0:o("home"),g.goHome();break;case 1:o("setortho"),g.setOrthographicFaces(!1),g.toOrthographic();break;case 2:o("setpersp"),g.setOrthographicFaces(!1),g.toPerspective();break;case 3:g.setOrthographicFaces(!0),R?g.toOrthographic():g.toPerspective();break;case 4:o("sethome"),g.setCurrentViewAsHome(!1);break;case 5:o("focushome"),g.setCurrentViewAsHome(!0);break;case 6:o("resethome"),g.resetHome();break;case 7:o("setfront"),g.setCurrentViewAsFront();break;case 8:o("settop"),g.setCurrentViewAsTop();break;case 9:g.resetOrientation()}}return g.viewCubeMenuOpen=!1,g.removeDropdownMenu(c),(j.clientX<G.x||j.clientX>G.w+G.x||j.clientY<G.y||j.clientY>G.h+G.y)&&ca(),f.mouseMoveSave&&f.processMouseMove(f.mouseMoveSave),g.endInteraction(),void ja(!1)}var p=g.navApi.getUseLeftHandedInput()?1:3;if(j.which===p)return g.viewCubeMenuOpen=!0,g.drawDropdownMenu(q,r,s,j.clientX,j.clientY,c,G),void ja(!0);var t=ga(j,G);if(b=fa(t,f.camera,L),d=fa(t,n,I),i=fa(t,n,K),d.length>0&&R){var u=g.getOrientation();switch(f.currentFace){case"front":switch(u){case"up":d[0].object===I[0]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[1]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[2]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[3]&&(g.calculateCubeTransform("left"),f.currentFace="left");break;case"right":d[0].object===I[0]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[1]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[2]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[3]&&(g.calculateCubeTransform("top"),f.currentFace="top");break;case"down":d[0].object===I[0]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[1]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[2]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[3]&&(g.calculateCubeTransform("right"),f.currentFace="right");break;case"left":d[0].object===I[0]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[1]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[2]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[3]&&(g.calculateCubeTransform("bottom"),f.currentFace="bottom")}break;case"right":switch(u){case"up":d[0].object===I[0]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[1]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[2]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[3]&&(g.calculateCubeTransform("front"),f.currentFace="front");break;case"right":d[0].object===I[0]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[1]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[2]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[3]&&(g.calculateCubeTransform("top"),f.currentFace="top");break;case"down":d[0].object===I[0]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[1]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[2]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[3]&&(g.calculateCubeTransform("back"),f.currentFace="back");break;case"left":d[0].object===I[0]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[1]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[2]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[3]&&(g.calculateCubeTransform("bottom"),f.currentFace="bottom")}break;case"left":switch(u){case"up":d[0].object===I[0]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[1]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[2]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[3]&&(g.calculateCubeTransform("back"),f.currentFace="back");break;case"right":d[0].object===I[0]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[1]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[2]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[3]&&(g.calculateCubeTransform("top"),f.currentFace="top");break;case"down":d[0].object===I[0]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[1]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[2]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[3]&&(g.calculateCubeTransform("front"),f.currentFace="front");break;case"left":d[0].object===I[0]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[1]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[2]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[3]&&(g.calculateCubeTransform("bottom"),f.currentFace="bottom")}break;case"back":switch(u){case"up":d[0].object===I[0]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[1]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[2]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[3]&&(g.calculateCubeTransform("right"),f.currentFace="right");break;case"right":d[0].object===I[0]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[1]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[2]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[3]&&(g.calculateCubeTransform("top"),f.currentFace="top");break;case"down":d[0].object===I[0]?(g.calculateCubeTransform("bottom"),f.currentFace="bottom"):d[0].object===I[1]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[2]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[3]&&(g.calculateCubeTransform("left"),f.currentFace="left");break;case"left":d[0].object===I[0]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[1]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[2]?(g.calculateCubeTransform("top"),f.currentFace="top"):d[0].object===I[3]&&(g.calculateCubeTransform("bottom"),f.currentFace="bottom")}break;case"top":switch(u){case"up":d[0].object===I[0]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[1]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[2]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[3]&&(g.calculateCubeTransform("left"),f.currentFace="left");break;case"right":d[0].object===I[0]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[1]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[2]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[3]&&(g.calculateCubeTransform("back"),f.currentFace="back");break;case"down":d[0].object===I[0]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[1]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[2]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[3]&&(g.calculateCubeTransform("right"),f.currentFace="right");break;case"left":d[0].object===I[0]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[1]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[2]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[3]&&(g.calculateCubeTransform("front"),f.currentFace="front")}break;case"bottom":switch(u){case"up":d[0].object===I[0]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[1]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[2]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[3]&&(g.calculateCubeTransform("left"),f.currentFace="left");break;case"right":d[0].object===I[0]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[1]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[2]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[3]&&(g.calculateCubeTransform("front"),f.currentFace="front");break;case"down":d[0].object===I[0]?(g.calculateCubeTransform("back"),f.currentFace="back"):d[0].object===I[1]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[2]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[3]&&(g.calculateCubeTransform("right"),f.currentFace="right");break;case"left":d[0].object===I[0]?(g.calculateCubeTransform("left"),f.currentFace="left"):d[0].object===I[1]?(g.calculateCubeTransform("right"),f.currentFace="right"):d[0].object===I[2]?(g.calculateCubeTransform("front"),f.currentFace="front"):d[0].object===I[3]&&(g.calculateCubeTransform("back"),f.currentFace="back")}}g.elapsedTime=0,g.sphericallyInterpolateTransition()}if(i.length>0){if(g.elapsedTime=0,f.wantHomeButton&&i[0].object===K[E])return g.goHome(),void ja(!1);if(f.wantContextMenu&&i[0].object===K[F])return g.viewCubeMenuOpen=!0,g.drawDropdownMenu(q,r,s,j.clientX,j.clientY,c,G),void ja(!0);if(f.wantRollArrows&&R&&(i[0].object===K[B]||i[0].object===K[C])){var v=i[0].object===K[C],w={center:g.center.clone(),position:h.position.clone(),pivot:h.pivot.clone(),fov:h.fov,worldUp:g.sceneUpDirection.clone(),isOrtho:h.isPerspective===!1},x=g.center.clone().sub(h.position).normalize();v?w.up=h.up.clone().cross(x):(w.up=h.up.clone().multiplyScalar(-1),w.up.cross(x)),w.up.normalize(),g.elapsedTime=0,g.animateTransition(w)}}if(b.length>0){var y=b[0].object.name;f.mouseMoveSave=a,f.cubeRotateTo(y)}ja(!1)};this.cubeRotateTo=function(a){f.currentFace=a,g.orthographicFaces&&f.currentFace.indexOf(",")!==-1&&g.setCameraOrtho(!1),g.calculateCubeTransform(f.currentFace),g.elapsedTime=0,g.sphericallyInterpolateTransition(function(){f.mouseMoveSave&&f.processMouseMove(f.mouseMoveSave)})},this.processMouseMove=function(a){var b,c,d;if(g.viewCubeMenuOpen||g.currentlyAnimating)return void(f.mouseMoveSave=a);f.mouseMoveSave=null;var h=e(a,f),i=ga(h,G);if(b=fa(i,f.camera,J),c=fa(i,n,I),d=fa(i,n,K),M&&!X&&(M.material.color.setHex(14540253),M=null,requestAnimationFrame(f.render)),c.length>0&&!X){M=c[0].object;for(var j=y.children.length;--j>=0;)if(M===I[j]){M=y.children[j],M.material.color.setHex(45055);break}requestAnimationFrame(f.render)}N&&!X&&(N.material.opacity=0,N=null,requestAnimationFrame(f.render)),b.length>0&&!X&&(N=b[0].object,N.material.opacity=.3,requestAnimationFrame(f.render)),d.length>0&&!X?O!==d[0].object&&(f.wantHomeButton&&d[0].object===K[E]?(O=d[0].object,K[E].material.map=Z[0]):f.wantRollArrows&&d[0].object===K[B]?(O=d[0].object,K[D].material.map=Z[1]):f.wantRollArrows&&d[0].object===K[C]?(O=d[0].object,K[D].material.map=Z[2]):f.wantContextMenu&&d[0].object===K[F]?(O=d[0].object,K[F].material.map=Z[6]):f.wantHomeButton&&O===K[E]?(O=null,K[E].material.map=Z[3]):!f.wantRollArrows||O!==K[B]&&O!==K[C]&&O!==K[D]?f.wantContextMenu&&O===K[F]&&(O=null,K[F].material.map=Z[5]):(O=null,K[D].material.map=Z[4]),requestAnimationFrame(f.render)):null===O||X||(f.wantHomeButton&&O===K[E]?(O=null,K[E].material.map=Z[3]):!f.wantRollArrows||O!==K[B]&&O!==K[C]&&O!==K[D]?f.wantContextMenu&&O===K[F]&&(O=null,K[F].material.map=Z[5]):(O=null,K[D].material.map=Z[4]),requestAnimationFrame(f.render))};var la=function(a){g.navApi.isActionEnabled("orbit")&&f.processMouseMove(a)},ma=function(){G=$(c),f.width=c.offsetWidth,f.height=c.offsetHeight,z=f.width/2,A=f.height/2,f.camera.aspect=f.width/f.height,f.camera.updateProjectionMatrix(),f.camera.topFov=f.camera.bottomFov=f.camera.fov/2,f.camera.leftFov=f.camera.rightFov=f.camera.aspect*f.camera.fov/2,f.renderer.setSize(f.width,f.height),requestAnimationFrame(f.render)},na=function(a,b){var c,d=new THREE.Geometry,e=new THREE.Vector3(0,0,0),f=new THREE.Vector3(60,-60,105),g=new THREE.Vector3(60,60,105),h=new THREE.Vector3(-60,60,105),i=new THREE.Vector3(-60,-60,105);return d.vertices.push(e),d.vertices.push(f),d.vertices.push(g),d.vertices.push(h),d.vertices.push(i),d.faces.push(new THREE.Face3(1,2,3)),d.faces.push(new THREE.Face3(1,3,4)),d.applyMatrix((new THREE.Matrix4).makeRotationX(a)),d.applyMatrix((new THREE.Matrix4).makeRotationY(b)),d.computeFaceNormals(),d.computeVertexNormals(),c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(d,c)},oa=function(a,b,c){var d,e=new THREE.Geometry,f=new THREE.Vector3(60,105,105),g=new THREE.Vector3(-60,105,105),h=new THREE.Vector3(-60,60,105),i=new THREE.Vector3(60,60,105),j=new THREE.Vector3(60,105,60),k=new THREE.Vector3(-60,105,60),l=new THREE.Vector3(-60,105,105),m=new THREE.Vector3(60,105,105);return e.vertices.push(f),e.vertices.push(g),e.vertices.push(h),e.vertices.push(i),e.vertices.push(j),e.vertices.push(k),e.vertices.push(l),e.vertices.push(m),e.faces.push(new THREE.Face3(0,1,2)),e.faces.push(new THREE.Face3(0,2,3)),e.faces.push(new THREE.Face3(4,5,6)),e.faces.push(new THREE.Face3(4,6,7)),e.applyMatrix((new THREE.Matrix4).makeRotationX(a)),e.applyMatrix((new THREE.Matrix4).makeRotationY(b)),e.applyMatrix((new THREE.Matrix4).makeRotationZ(c)),e.computeFaceNormals(),e.computeVertexNormals(),d=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(e,d)},pa=function(a,b){var c,d=new THREE.Geometry,e=new THREE.Vector3(105,105,105),f=new THREE.Vector3(60,105,105),g=new THREE.Vector3(60,60,105),h=new THREE.Vector3(105,60,105),i=new THREE.Vector3(105,105,60),j=new THREE.Vector3(105,105,105),k=new THREE.Vector3(105,60,105),l=new THREE.Vector3(105,60,60),m=new THREE.Vector3(105,105,105),n=new THREE.Vector3(105,105,60),o=new THREE.Vector3(60,105,60),p=new THREE.Vector3(60,105,105);return d.vertices.push(e),d.vertices.push(f),d.vertices.push(g),d.vertices.push(h),d.vertices.push(i),d.vertices.push(j),d.vertices.push(k),d.vertices.push(l),d.vertices.push(m),d.vertices.push(n),d.vertices.push(o),d.vertices.push(p),d.faces.push(new THREE.Face3(0,1,2)),d.faces.push(new THREE.Face3(0,2,3)),d.faces.push(new THREE.Face3(4,5,6)),d.faces.push(new THREE.Face3(4,6,7)),d.faces.push(new THREE.Face3(8,9,10)),d.faces.push(new THREE.Face3(8,10,11)),d.applyMatrix((new THREE.Matrix4).makeRotationX(a)),d.applyMatrix((new THREE.Matrix4).makeRotationY(b)),d.computeFaceNormals(),d.computeVertexNormals(),c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(d,c)},qa=function(a){var b=g.cubeFront.clone(),c=g.sceneUpDirection.clone(),d=b.clone().cross(c);c.copy(d).cross(b),b.normalize(),c.normalize(),d.normalize();var e=new THREE.Vector3(b.x,c.x,d.x).multiplyScalar(a.x);return e.add(new THREE.Vector3(b.y,c.y,d.y).multiplyScalar(a.y)),e.add(new THREE.Vector3(b.z,c.z,d.z).multiplyScalar(a.z)),e};this.render=function(){var a=f.compass?f.viewScaleFactorCompass*f.viewScale:f.viewScale,b=g.center.clone().sub(h.position).normalize(),c=h.up.normalize();b=qa(b),c=qa(c),f.camera.position.copy(b),f.camera.position.multiplyScalar(-a/f.camera.position.length()),f.camera.up=c.normalize(),f.camera.lookAt(f.center),ra();var d=f.renderer;d&&(d.clear(),d.render(i,f.camera),d.render(j,f.camera),d.render(l,f.camera),d.render(k,f.camera),d.render(m,n))};var ra=function(){R=g.isFaceView(),!R||Y||g.currentlyAnimating?sa():ta(),Y?ua():va(),Y?wa():xa()},sa=function(){m.remove(y),K[D].material.opacity=0,K[F].material.opacity=0},ta=function(){m.add(y);var a=f.wantRollArrows?1:0;K[D].material.opacity=a,K[F].material.opacity=a},ua=function(){x.material.opacity=av.isMobileDevice()?1:0},va=function(){x.material.opacity=f.wantContextMenu?1:0},wa=function(){v.material.opacity=0},xa=function(){v.material.opacity=f.wantHomeButton?1:0};this.refreshCube=function(){ma()},this.setSize=function(a,b){if(f.width=a,f.height=b,c.children.length>1)for(var d=1;d<c.children.length;d++)c.children[d].style.bottom=(f.height/5).toString()+"px";ma()},this.useTransparency=function(a){Y=a,a?(c.onmouseover=aa,c.onmousemove=ba,c.onmouseout=ca,ca()):(c.onmouseover=null,c.onmouseout=null,c.onmousemove=null,c.style.opacity="1.0")},this.dtor=function(){this.renderer=null},function(){var a=c.getBoundingClientRect();f.width=a.width,f.height=a.height,G=$(c),z=f.width/2,A=f.height/2,n=new THREE.PerspectiveCamera(70,f.height/f.width,1,1e4),n.position.set(0,0,500),i=new THREE.Scene,j=new THREE.Scene,k=new THREE.Scene,l=new THREE.Scene,m=new THREE.Scene,R=!0,P=200,f.viewScale=3.5*P;var b=THREE.LinearFilter,e=Autodesk.Viewing.Private.getResourceUrl,h="res/textures/",o=d||h,p=(new THREE.DDSLoader).load(e(o+"VCcrossRGBA8small.dds"));p.minFilter=p.maxFilter=b;var q=THREE.ShaderLib.cube,r=Autodesk.Viewing.Shaders.createShaderMaterial(q);r.depthWrite=!1,r.uniforms.tCube.value=p;var s=new THREE.BoxGeometry(P,P,P,4,4,4),H=new THREE.BoxGeometry(P+1,P+1,P+1,4,4,4);t=new THREE.Mesh(s,r),t.position.set(0,0,0),j.add(t);var J=da(e(h+"VCedge1.png"));J.minFilter=J.maxFilter=b,u=new THREE.Mesh(H,new THREE.MeshBasicMaterial({map:J,overdraw:!1,transparent:!0,shading:THREE.SmoothShading})),u.position.set(0,0,0),l.add(u);var L=P,M=new THREE.Geometry,N=new THREE.Vector3(-30,0,0),O=new THREE.Vector3(30,0,0),Q=new THREE.Vector3(0,-30,0);M.vertices.push(N),M.vertices.push(O),M.vertices.push(Q),M.faces.push(new THREE.Face3(1,0,2)),M.computeFaceNormals();var T=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),U=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading
}),V=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),W=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),X=new THREE.PlaneBufferGeometry(.5*P,.3*P,2,2),Y=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),aa=new THREE.Mesh(M,T),ba=new THREE.Mesh(X,Y);aa.position.set(0,L,0),ba.position.set(0,.9*L,.1);var ca=new THREE.Mesh(M,U),fa=new THREE.Mesh(X,Y);ca.position.set(0,-L,0),fa.position.set(0,.9*-L,.1),ca.rotation.z+=Math.PI,fa.rotation.z+=Math.PI;var ga=new THREE.Mesh(M,V),ia=new THREE.Mesh(X,Y);ga.position.set(L,0,0),ia.position.set(.9*L,0,.1),ga.rotation.z-=Math.PI/2,ia.rotation.z-=Math.PI/2;var ja=new THREE.Mesh(M,W),ka=new THREE.Mesh(X,Y);ja.position.set(-L,0,0),ka.position.set(.9*-L,0,.1),ja.rotation.z+=Math.PI/2,ka.rotation.z+=Math.PI/2,y=new THREE.Object3D,y.position.set(0,0,0),y.add(aa),y.add(ca),y.add(ga),y.add(ja),m.add(ba),m.add(fa),m.add(ia),m.add(ka),m.add(y),I.push(ba),I.push(fa),I.push(ia),I.push(ka);var ma=new THREE.PlaneBufferGeometry(P/3,P/3,2,2),na=new THREE.MeshBasicMaterial({map:da(e(h+"VChome.png")),transparent:!0,shading:THREE.FlatShading});v=new THREE.Mesh(ma,na),v.position.set(-P,P,0),E=K.length,m.add(v),K.push(v);var oa=new THREE.PlaneBufferGeometry(1.5*P,1.5*P,2,2),pa=new THREE.MeshBasicMaterial({map:da(e(h+"VCarrows.png")),shading:THREE.FlatShading,transparent:!0}),qa=new THREE.Mesh(oa,pa);qa.position.set(.5*P+20,.5*P+20,0);var ra=new THREE.PlaneBufferGeometry(.6*P,.45*P,2,2),sa=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),ta=new THREE.Mesh(ra,sa);ta.position.set(.5*P+20,P+20,.1);var ua=new THREE.PlaneBufferGeometry(.45*P,.6*P,2,2),va=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),wa=new THREE.Mesh(ua,va);wa.position.set(P+20,.5*P+20,.1),m.add(qa),m.add(ta),m.add(wa),B=K.length,K.push(ta),C=K.length,K.push(wa),D=K.length,K.push(qa);var xa=new THREE.PlaneBufferGeometry(P/2.3,P/2.3,2,2),ya=new THREE.MeshBasicMaterial({map:da(e(h+"VCcontext.png")),transparent:!0,shading:THREE.FlatShading});x=new THREE.Mesh(xa,ya),x.position.set(P,-P,0),F=K.length,m.add(x),K.push(x);var za=new THREE.Geometry;za.vertices.push(new THREE.Vector3(0,0,0)),za.vertices.push(new THREE.Vector3(-P/2,-P/2-20,-P/2)),za.vertices.push(new THREE.Vector3(P/2,-P/2-20,-P/2)),za.vertices.push(new THREE.Vector3(P/2,-P/2-20,P/2)),za.vertices.push(new THREE.Vector3(-P/2,-P/2-20,P/2)),za.faces.push(new THREE.Face3(4,3,2)),za.faces.push(new THREE.Face3(4,2,1));var Aa;Aa=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),w=new THREE.Mesh(za,Aa),i.add(w),ea(),"CANVAS"===g.renderer.toUpperCase()?f.renderer=new THREE.CanvasRenderer:"WEBGL"===g.renderer.toUpperCase()?f.renderer=new avp.FireflyWebGLRenderer({alpha:!0,antialias:!1}):(avp.logger.warn("Incorrect use of Autocam.renderer property"),f.renderer=new THREE.CanvasRenderer),f.useTransparency(!0),f.setSize(f.width,f.height),f.camera.topFov=f.camera.bottomFov=f.camera.fov/2,f.camera.leftFov=f.camera.rightFov=f.camera.aspect*f.camera.fov/2,f.renderer.autoClear=!1,f.renderer.setSize(f.width,f.height),f.renderer.sortObjects=!1,c.appendChild(f.renderer.domElement),c.addEventListener("touchstart",ha,!1),c.addEventListener("mousedown",ha,!1),c.addEventListener("mousemove",la,!1),S=!1,S&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,c.requestPointerLock=c.requestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock,document.addEventListener("pointerlockchange",_,!1),document.addEventListener("mozpointerlockchange",_,!1),document.addEventListener("webkitpointerlockchange",_,!1)),Z.push(da(e(h+"VChomeS.png"))),Z.push(da(e(h+"VCarrowsS0.png"))),Z.push(da(e(h+"VCarrowsS1.png"))),Z.push(da(e(h+"VChome.png"))),Z.push(da(e(h+"VCarrows.png"))),Z.push(da(e(h+"VCcontext.png"))),Z.push(da(e(h+"VCcontextS.png")))}()},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224},Autodesk.Viewing.ToolController=function(a,b,c,d,e){function f(a,c){return b.navigation.getUseLeftHandedInput()&&0===a||j&&1===a||i&&!l&&0===a&&c.ctrlKey}var g=Autodesk.Viewing,h=Autodesk.Viewing.Private;this.domElement=b.canvasWrap,this.selector=a.selector,this.autocam=c,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0;var i=navigator.userAgent.search("Mac OS")!=-1,j=navigator.userAgent.search("Firefox")!=-1,k=navigator.userAgent.search("Chrome")!==-1,l=navigator.userAgent.search("Safari")!==-1&&!k,m={},n=[],o=!1,p=-1,q=-1,r=!1,s=null,t=void 0,u=!1,v={},w=this,x=Autodesk.Viewing.KeyCode;this.__registerToolByName=function(a,b){m[b]=a},this.registerTool=function(a){var b=a.getNames();if(!b||0==b.length)return h.logger.warn("Cannot register tool with no name."),!1;for(var c=!1,e=0;e<b.length;++e)"default"!==b[e]&&(this.__registerToolByName(a,b[e]),c=!0);return a.utilities=d,a.controller=this,a.register&&a.register(),c},this.deregisterTool=function(a){this.deactivateTool(a.getName());var b=a.getNames();if(!b||0==b.length)return!1;for(var c=b.length;--c>=0;)this.__deregisterToolName(b[c]);return a.deregister&&a.deregister(),a.utilities=null,a.controller=null,!0},this.__deregisterToolName=function(a){a in m&&(!function(a){for(var b=n.length;--b>=0;)n[b].activeName===a&&(m[a].deactivate(a),n.splice(b,1))}(a),delete m[a])},this.getTool=function(a){return m[a]},this.getActiveToolName=function(){var a=n.length;return a>0?n[a-1].activeName:"default"},this.getActiveTool=function(){var a=n.length;return a>0?n[a-1]:m.default},this.isToolActivated=function(a){for(var b=0;b<n.length;b++)if(n[b].activeName===a)return!0;return!1},this.setToolActiveName=function(a){var b=m[a];b&&(b.activeName=a)},this.activateTool=function(c){if(o)return!1;var d=m[c];if(d){void 0===d.count&&(d.count=0);var e=null;n.length&&"intercept"===n[n.length-1].activeName&&(e=n.pop());for(var f=0;f<n.length;f++)n[f]===d&&d.count++;return d.activeName=c,0===d.count&&(d.count++,n.push(d)),d.activate(c,b),e&&n.push(e),b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:c,tool:d,active:!0}),a.track({category:"tool_changed",name:c}),!0}return h.logger.warn("activateTool not found: "+c),!1},this.deactivateTool=function(a){if(o)return!1;for(var c=n.length;--c>=0;)if(n[c].activeName===a)return 1===m[a].count&&n.splice(c,1),m[a].count--,m[a].deactivate(a),b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:a,tool:n[c],active:!1}),!0;return h.logger.warn("deactivateTool not found: "+a),!1},this.getToolNames=function(){return Object.keys(m)},this.setDefaultTool=function(a){var b=this.getDefaultTool();return!(!a||a===b)&&(this.__registerToolByName(a,"default"),b&&b.deactivate("default"),a.activate("default"),!0)},this.getDefaultTool=function(){return m.default},this.setDefaultTool(e),this.setIsLocked=function(a){var b=o;return o=!!a,b},this.getIsLocked=function(){return o},this.__checkCursor=function(){for(var a=null,c=n.length;--c>=0;){var d=n[c];if(d.getCursor&&(a=d.getCursor()))break}a||(a="auto"),s!=a&&(b.canvas.style.cursor=a,s=a)},this.update=function(a){this.__checkCursor();var c=!1;d&&d.update()&&(c=!0);for(var e=n.length;--e>=0;){var f=n[e];f.update&&f.update(a)&&(c=!0)}if(b.navigation.getCamera().dirty?(b.navigation.updateCamera(),c=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,c)b.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){var g=this.moveDelay-Date.now();g>0?c=!0:this.moveDelay=0}return c},this.__clientToCanvasCoords=function(b,c,d){var e=a.canvas.getBoundingClientRect(),f=e.width,g=e.height,h=b.clientX-e.left,i=b.clientY-e.top;b.canvasX=h,b.canvasY=i,b.normalizedX=h/f*2-1,b.normalizedY=(g-i)/g*2-1,c&&c.set(h/f,i/g,0),d&&d.set(h,i)},this.__invokeStack=function(a,b,c){for(var d=n.length;--d>=0;){var e=n[d];if(e[a]&&e[a](b,c))return!0}var f=this.getDefaultTool();return!(!f[a]||!f[a](b,c))},this.distributeEvent=function(a,b,c){return this.__invokeStack(a,b,c)},this.handleResize=function(){b.navigation.setScreenViewport(b.container.getBoundingClientRect());for(var a=n.length;--a>=0;){var c=n[a];c.handleResize&&c.handleResize()}},this.handleSingleClick=function(a){var b=this.applyButtonMappings(a);this.lastClickX=a.clientX,this.lastClickY=a.clientY,this.__invokeStack("handleSingleClick",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleDoubleClick=function(a){var b=this.applyButtonMappings(a);this.__invokeStack("handleDoubleClick",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleSingleTap=function(a){this.lastClickX=a.canvasX,this.lastClickY=a.canvasY,this.__invokeStack("handleSingleTap",a)&&(a.preventDefault(),a.stopPropagation())},this.handleDoubleTap=function(a){this.lastClickX=a.canvasX,this.lastClickY=a.canvasY,this.__invokeStack("handleDoubleTap",a)&&(a.preventDefault(),a.stopPropagation())},this.handleWheelInput=function(a,b){this.__invokeStack("handleWheelInput",a)&&(b.preventDefault(),b.stopPropagation())},this.applyButtonMappings=function(a){var c=a.button;return"buttons"in a&&(a.firefoxSpoof?c=0:!r||1&a.buttons?2===c&&1&a.buttons&&(c=0,a.firefoxSpoof=r=!0):(a.firefoxSpoof=!0,r=!1,c=0)),b.navigation.getUseLeftHandedInput()&&(c=0===c?2:2===c?0:c),c},this.applyKeyMappings=function(a,b){switch(a.keyCode){case x.LCOMMAND:case x.RCOMMAND:case x.COMMANDMOZ:return i&&a.metaKey&&a.shiftKey?null:x.CONTROL;case x.SHIFT:return b&&i&&a.metaKey?null:x.SHIFT;case x.EQUALSMOZ:return x.EQUALS;case x.DASHMOZNEW:case x.DASHMOZ:return x.DASH}return a.keyCode},this.handleKeyDown=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyDown",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleKeyUp=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyUp",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleButtonDown=function(a,b){this.__invokeStack("handleButtonDown",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleButtonUp=function(a,b){this.__invokeStack("handleButtonUp",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleMouseMove=function(a){this.__invokeStack("handleMouseMove",a)&&(a.preventDefault(),a.stopPropagation())},this.handleBlur=function(a){this.__invokeStack("handleBlur",a)&&(a.preventDefault(),a.stopPropagation())},this.keydown=function(a){if(!(!w.domElement.contains(t)||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLSelectElement)){if(document.activeElement){var b=document.activeElement.getAttribute("contenteditable");if("true"===b||""===b)return}i&&a.metaKey&&a.keyCode!=x.LCOMMAND&&a.keyCode!=x.RCOMMAND||w.handleKeyDown(a)}},this.keyup=function(a){i&&a.metaKey&&a.keyCode!=x.LCOMMAND&&a.keyCode!=x.RCOMMAND||w.handleKeyUp(a)},this.mousedown=function(a){function b(a){w.applyButtonMappings(a)===c&&(document.removeEventListener("mouseup",b),w.mouseup(a))}g.isIE11&&g.inFullscreen()||document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),w.__clientToCanvasCoords(a);var c=w.applyButtonMappings(a);if(w.handleButtonDown(a,c),p=a.canvasX,q=a.canvasY,f(c,a)){var d=v,e=void 0!==d.time&&a.timeStamp-d.time<500,h=void 0!==d.x&&void 0!==d.y&&Math.abs(d.x-a.canvasX)<=2&&Math.abs(d.y-a.canvasY)<=2;(!e||!h||d.clickCount&&2<=d.clickCount)&&(d.clickCount=0),d.clickCount?1===d.clickCount&&(d.clickCount=2):(d.clickCount=1,d.x=a.canvasX,d.y=a.canvasY,d.time=a.timeStamp)}document.addEventListener("mouseup",b,!1),w.registerWindowMouseMove()},this.mousemove=function(a){w.__clientToCanvasCoords(a);var b=p-a.canvasX,c=q-a.canvasY;(Math.abs(b)>2||Math.abs(c)>2)&&(p=-1,q=-1),w.handleMouseMove(a)},this.mouseup=function(a){w.__clientToCanvasCoords(a);var b=w.applyButtonMappings(a);w.handleButtonUp(a,b);var c=p-a.canvasX,d=q-a.canvasY;if(p=-1,q=-1,Math.abs(c)<=2&&Math.abs(d)<=2&&w.handleSingleClick(a),f(b,a)){var e=v;2===e.clickCount&&(w.handleDoubleClick(a),e.clickCount=0,e.x=void 0,e.y=void 0,e.time=void 0)}w.unregisterWindowMouseMove()},this.doubleclick=function(a){w.__clientToCanvasCoords(a),p=a.canvasX,q=a.canvasY,w.handleDoubleClick(a)},this.mousewheel=function(a){if(w.scrollInputEnabled){var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail),w.handleWheelInput(b,a)}},this.blur=function(a){w.handleBlur(a)},this.mouseover=function(a){t=a.target},this.registerWindowMouseMove=function(){window.addEventListener("mousemove",w.mousemove),window.addEventListener("mouseover",w.mouseover),w.domElement.removeEventListener("mousemove",w.mousemove),w.domElement.removeEventListener("mouseover",w.mouseover)},this.unregisterWindowMouseMove=function(){window.removeEventListener("mousemove",w.mousemove),window.removeEventListener("mouseover",w.mouseover),w.domElement.addEventListener("mousemove",w.mousemove),w.domElement.addEventListener("mouseover",w.mouseover)},this.enableMouseButtons=function(a){a&&!u?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!a&&u&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var b=u;return u=a,b},this.enableMouseButtons(!0),this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),window.addEventListener("blur",this.blur,!1),this.uninitialize=function(){for(u&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",w.mousemove),window.removeEventListener("mouseover",w.mouseover)),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null;n.length>0;)this.deactivateTool(n[n.length-1].activeName);m=null,n=null,w=null,d=null,b=null,a=null,t=null},this.set2DMode=function(a){},this.setAutocam=function(a){},this.syncCamera=function(){},this.recordHomeView=function(){var a=b.navigation.getCamera();c.sync(a),c.setHomeViewFrom(a)},this.setMouseWheelInputEnabled=function(a){this.scrollInputEnabled=a}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ViewingUtilities=function(a,b,c){function d(a){var b=0,c=new THREE.SphereGeometry(1),d=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),e=new THREE.Mesh(c,d),f=a;f.createOverlayScene("pivot"),e.visible=!1,this.shown=function(){return e.visible},this.show=function(a,c,g){e.scale.x=c,e.scale.y=c,e.scale.z=c,e.position.set(a.x,a.y,a.z),d.opacity=.6,e.visible=!0,f.addOverlay("pivot",e),f.invalidate(!1,!1,!0),b=g?Date.now()+500:0},this.hide=function(){e.visible&&(e.visible=!1,f.removeOverlay("pivot",e),f.invalidate(!1,!1,!0),b=0)},this.fade=function(){if(b>0){var a=b-Date.now();if(a<=0)return this.hide(),!0;var c=a/500*.6;return d.opacity=c,!0}return!1},this.fading=function(){return b>0}}function e(a,b,c){var d=b.clone().sub(a);if(0===d.lengthSq())return d.copy(c);var e=d.clone().cross(c);return 0===e.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z-=1e-4,e.crossVectors(d,c)),e.cross(d).normalize()}this.autocam=b,this.viewerImpl=a;var f=c.getCamera(),g={},h={},i=new d(this.viewerImpl);this.transitionView=function(a,d,g,h,i,j,k){i=i||c.getWorldUpVector();var l=j?e(a,d,i):h;l||(l=f.up),k=k||d;var m={position:a,center:d,pivot:k,fov:g,up:l,worldUp:i,isOrtho:f.isPerspective===!1};b.goToView(m)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),b.goHome()},this.getHitPoint=function(a,b){b=1-b,a=2*a-1,b=2*b-1;var c=new THREE.Vector3(a,b,1),d=this.viewerImpl.hitTestViewport(c,!1);return d?d.intersectPoint:null},this.activatePivot=function(a){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var b=f.isPerspective?c.getPivotPlaneDistance():c.getEyeVector().length(),d=c.getVerticalFov(),e=2*b*Math.tan(THREE.Math.degToRad(.5*d)),g=c.getScreenViewport(),h=window.devicePixelRatio||1,j=5*e/(g.height*h);i.show(c.getPivotPoint(),j,a)}},this.pivotActive=function(a,b){if(a=a&&!c.getIs2D(),b=b||!1,!a&&i.shown())return void i.hide();a&&this.activatePivot(b)},this.pivotUpdate=function(){i.shown()&&i.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(a,b,d){c.setPivotPoint(a),b||c.setTarget(a),d&&c.setPivotSetFlag(!0),this.setTemporaryPivot(null),c.getIs2D()||i.shown()&&this.activatePivot(i.fading())},this.savePivot=function(a){a||(a="default"),g[a]=c.getPivotPoint(),h[a]=c.getPivotSetFlag()},this.restorePivot=function(a){if(a||(a="default"),g[a]){var b=h[a];this.setPivotPoint(g[a],!0,b),b||c.setPivotSetFlag(!1),delete g[a],delete h[a]}},this.setTemporaryPivot=function(a){if(a){var b=c.getPivotPoint(),d=c.getPivotSetFlag();this.setPivotPoint(a,!0,d),g.TEMP=b,h.TEMP=d}else delete g.TEMP,delete h.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.getBoundingBox=function(a){return this.viewerImpl.getFitBounds(a)},this.fitToView=function(a){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.api.getSelection()),this.activatePivot(!0)},this.update=function(){c.getRequestFitToView()&&!c.getTransitionActive()&&(c.setRequestFitToView(!1),this.fitToView()),c.getRequestHomeView()&&!c.getTransitionActive()&&(c.setRequestHomeView(!1),this.goHome());var a=c.getRequestTransition();return a&&!c.getTransitionActive()&&(c.setRequestTransition(!1),this.transitionView(a.position,a.coi,a.fov,a.up,a.worldUp,a.reorient,a.pivot)),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.DefaultHandler=function(a,b,c){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(a){this.clickConfig=a},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(a){},this.deactivate=function(a){},this.handleAction=function(b,d){for(var e=0;e<b.length;++e)switch(b[e]){case"selectOnly":a.selector&&d&&a.selector.setSelection([d.dbId],d.model);break;case"deselectAll":a.selector&&a.selector.setSelection([]);break;case"selectToggle":a.selector&&d&&a.selector.toggleSelection(d.dbId,d.model);break;case"isolate":d&&a.isolate(d.dbId);break;case"showAll":a.showAll();break;case"setCOI":d&&d.intersectPoint&&(c.setPivotPoint(d.intersectPoint,!0,!0),c.pivotActive(!0,!0));break;case"hide":d&&a.hide(d.dbId);break;case"show":d&&a.show(d.dbId);break;case"toggleVisibility":d&&a.toggleVisibility(d.dbId);break;case"focus":a.selector&&(d?a.selector.setSelection([d.dbId],d.model):a.selector.setSelection([]),c.fitToView())}},this.handleSingleClick=function(b,d){var e=b.ctrlKey||b.metaKey,f=b.shiftKey,g=b.altKey;if(0===d){var h=new THREE.Vector3(b.normalizedX,b.normalizedY,1),i=a.hitTestViewport(h,!1),j="click";e&&(j+="Ctrl"),f&&(j+="Shift"),g&&(j+="Alt");var k=i?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[j]&&this.clickConfig[j][k])return this.handleAction(this.clickConfig[j][k],i),!0}else if(1===d&&f&&!g&&!e){var h=new THREE.Vector3(b.normalizedX,b.normalizedY,1),i=a.hitTestViewport(h,!1);if(i&&i.intersectPoint)return c.setPivotPoint(i.intersectPoint,!0,!0),c.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(d,e){if(a.selector&&0===e){var f=new THREE.Vector3(d.normalizedX,d.normalizedY,1),g=a.hitTestViewport(f,!1);return g?a.selector.setSelection([g.dbId],g.model):a.selector.clearSelection(),c.fitToView(),!0}return 1===e&&(b.fitBounds(!1,c.getBoundingBox(!0)),b.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(c){if(c.clientX=c.pointers[0].clientX,c.clientY=c.pointers[0].clientY,a.api.triggerSingleTapCallback(c),c.hasOwnProperty("pointers")&&2===c.pointers.length)return b.setRequestHomeView(!0),!0;if(a.selector){var d=new THREE.Vector3(c.normalizedX,c.normalizedY,1),e=a.hitTestViewport(d,!1);return e?(a.selector.setSelection([e.dbId],e.model),a.api.triggerSelectionChanged([e.dbId])):(a.selector.clearSelection(),a.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(b){b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerDoubleTapCallback(b);var d=this.handleSingleTap(b,0);return c.fitToView(),d},this.handlePressHold=function(b){return"press"===b.type&&(b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerContextMenu(b))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.GestureHandler=function(a){var b=Autodesk.Viewing,c=a.navigation,d=["gestures"],e=this,f=!0,g=!0,h=null,i=b.isTouchDevice();c.setIsTouchDevice(i),i&&(h=new Hammer.Manager(a.canvasWrap,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}],[Hammer.Pan,{event:"drag3",pointers:3,threshold:15}],[Hammer.Pan,{event:"pan",pointers:2,threshold:20}],[Hammer.Pinch,{enable:!0,threshold:.05}],[Hammer.Rotate,{enable:!0,threshold:7}]],inputClass:Hammer.TouchInput}),a.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(a){a.preventDefault()},this.getNames=function(){return d},this.getName=function(){return d[0]},this.__clientToCanvasCoords=function(b){var c,d,e=a.impl.canvas.getBoundingClientRect(),f=e.width,g=e.height;b.hasOwnProperty("center")?(c=b.center.x-e.left,d=b.center.y-e.top):(c=b.pointers[0].clientX-e.left,d=b.pointers[0].clientY-e.top),b.canvasX=c,b.canvasY=d,b.normalizedX=c/f*2-1,b.normalizedY=(g-d)/g*2-1},this.distributeGesture=function(a){e.__clientToCanvasCoords(a),e.controller.distributeEvent("handleGesture",a)&&a.preventDefault(),function(a,b){return a.indexOf(b,a.length-b.length)!==-1}(a.type,"end")&&h.stop()},this.onSingleTap=function(a){e.__clientToCanvasCoords(a),e.controller.distributeEvent("handleSingleTap",a)&&a.preventDefault()},this.onDoubleTap=function(a){e.__clientToCanvasCoords(a),e.controller.distributeEvent("handleDoubleTap",a)&&a.preventDefault()},this.onPressHold=function(a){e.__clientToCanvasCoords(a),"press"===a.type?f=e.controller.enableMouseButtons(!1):e.controller.enableMouseButtons(f),e.controller.distributeEvent("handlePressHold",a)&&a.preventDefault()},this.activate=function(a){h&&(h.on("dragstart dragmove dragend",this.distributeGesture),h.on("singletap",this.onSingleTap),h.on("singletap2",this.onSingleTap),h.on("doubletap",this.onDoubleTap),h.on("doubletap2",this.onDoubleTap),h.on("press pressup",this.onPressHold),h.on("drag3start drag3move drag3end",this.distributeGesture),g&&(h.on("panstart panmove panend",this.distributeGesture),h.on("pinchstart pinchmove pinchend",this.distributeGesture),h.on("rotatestart rotatemove rotateend",this.distributeGesture)),h.get("doubletap2").recognizeWith("doubletap"),h.get("singletap2").recognizeWith("singletap"),h.get("singletap").requireFailure("doubletap"))},this.deactivate=function(a){h&&(h.off("dragstart dragmove dragend",this.distributeGesture),h.off("singletap",this.onSingleTap),h.off("singletap2",this.onSingleTap),h.off("doubletap",this.onDoubleTap),h.off("doubletap2",this.onDoubleTap),h.off("press pressup",this.onPressHold),h.off("drag3start drag3move drag3end",this.distributeGesture),g&&(h.off("panstart panmove panend",this.distributeGesture),h.off("pinchstart pinchmove pinchend",this.distributeGesture),h.off("rotatestart rotatemove rotateend",this.distributeGesture)))},this.update=function(){return!1},this.handleBlur=function(a){return!1},this.disableTwoFingerSwipe=function(){g=!1,h&&(h.remove(Hammer.Pan),h.remove(Hammer.Pinch),h.remove(Hammer.Rotate),h.off("panstart panmove panend",this.distributeGesture),h.off("pinchstart pinchmove pinchend",this.distributeGesture),h.off("rotatestart rotatemove rotateend",this.distributeGesture))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.OrbitDollyPanTool=function(a,b){function c(){var a=da;return K===J&&!a.SHIFT&&!(a.ALT^a.CONTROL)||K===J&&a.SHIFT&&a.CONTROL||K===I&&!a.SHIFT&&!a.CONTROL||K===I&&a.ALT||K===I&&a.CONTROL&&!a.ALT||K===H&&a.SHIFT&&!a.CONTROL&&!a.ALT||"pan"===v&&K!==I&&!a.ALT&&!("pinch"===w)||a.SPACE}function d(){var a=da;return K===J&&a.SHIFT&&!a.ALT&&!a.CONTROL||K===J&&a.ALT&&!a.SHIFT&&!a.CONTROL||"dolly"===v&&!a.ALT&&!("pinch"===w)}function e(){var a=da;return!(a.CONTROL||a.ALT||a.SHIFT||K!==J&&K!==I)}function f(){return q.getPivotPoint().sub(q.getPosition()).dot(q.getEyeVector())<=0}function g(a,b){var c={left:0,top:0,width:window.innerWidth,height:window.innerHeight};Y.set((a-.5*c.width-c.left)/(.5*c.width),(.5*c.height+c.top-b)/(.5*c.height),0);var d=Y.length();return _?d<Math.SQRT1_2?Y.z=Math.sqrt(1-d*d):Y.z=.5/d:d>1?Y.normalize():Y.z=Math.sqrt(1-d*d),U.copy(r.position).sub(r.pivot),W.copy(r.up).setLength(Y.y),W.add(X.copy(r.up).cross(U).setLength(Y.x)),W.add(U.setLength(Y.z)),W}function h(){if(q.isActionEnabled("orbit")){U.subVectors(r.position,r.pivot),V.subVectors(r.position,r.target);var a=V.length();V.normalize();var b=Math.acos(S.dot(T)/S.length()/T.length());b&&(b*=o,Z.crossVectors(S,T).normalize(),$.setFromAxisAngle(Z,-b),U.applyQuaternion($),r.up.applyQuaternion($),T.applyQuaternion($),V.applyQuaternion($),aa?S.copy(T):($.setFromAxisAngle(Z,b*(ba-1)),S.applyQuaternion($))),r.position.addVectors(r.pivot,U),r.target.subVectors(r.position,V.multiplyScalar(a)),r.dirty=!0}}function i(a,b){return a.indexOf(b,a.length-b.length)!==-1}function j(a){var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY;return Math.sqrt(b*b+c*c)}var k,l,m,n=(Autodesk.Viewing.Private,this),o=2,p=navigator.userAgent.search("Mac OS")!=-1,q=b.navigation,r=q.getCamera(),s=["orbit","freeorbit","dolly","pan"],t=s[0],u=[t],v=t,w=null,x=1,y=1,z=0,A=0,B=0,C=0,D=!1,E=null,F=!1,G={SHIFT:16,CONTROL:17,ALT:18,SPACE:32,PAGEUP:33,PAGEDOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,ZERO:48,EQUALS:187,DASH:189},H=0,I=1,J=2,K=-5,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Vector2,O=new THREE.Vector2,P=new THREE.Vector2,Q=new THREE.Vector2,R=new THREE.Vector3,S=new THREE.Vector3,T=new THREE.Vector3,U=new THREE.Vector3,V=new THREE.Vector3,W=new THREE.Vector3,X=new THREE.Vector3,Y=new THREE.Vector3,Z=new THREE.Vector3,$=new THREE.Quaternion,_=!1,aa=!0,ba=.2,ca=[!1,!1,!1,!1,!1,!1],da={SHIFT:0,ALT:0,CONTROL:0,SPACE:0},ea=1,fa=5,ga=.025;this.getNames=function(){return s},this.getName=function(){return s[0]},this.activate=function(a){u.push(a),v=a},this.deactivate=function(a){var b=u.length-1;b>0&&u[b]===a&&(u.pop(),v=u[b-1])},this.adjustDollyLookSpeed=function(a){0===a?(ga=.025,fa=5):(ga*=a>0?1.1:.9,fa*=a>0?1.1:.9,ga<1e-6&&(ga=1e-6),fa<1e-6&&(fa=1e-6))},this.getDollySpeed=function(a){var b=q.getEyeVector(),c=q.getPosition(),d=a.clone().sub(c).dot(b.normalize()),e=d*ga;return Math.abs(e)<.01?e<0?-.01:.01:e},this.getLookSpeed=function(){return fa},this.coiIsActive=function(){return q.getPivotSetFlag()&&q.isPointVisible(q.getPivotPoint())},this.adjustSpeed=function(a){this.adjustDollyLookSpeed(a),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return K===I&&da.SHIFT?u[1]:d()||0!==R.z?e()?"pan":"dolly":c()?"pan":"pan"===w||"pinch"===w?"dollypan":v},this.initTracking=function(a,b){var c;if(r.isPerspective){c=.5*(r.near+r.far);var d=this.utilities.getHitPoint(a,b),e=q.getPosition();if(d&&d.sub){var f=d.sub(e),g=q.getEyeVector().normalize();c=Math.abs(g.dot(f))}else{if(q.getPivotSetFlag()&&q.isPointVisible(q.getPivotPoint())){var h=q.getPivotPlaneDistance();h>1e-5&&(c=h)}}}else c=q.getEyeVector().length();ea=c},this.initOrbit=function(){this.utilities.setTemporaryPivot(f()?q.getTarget():null)},this.getActiveMode=function(){return t},this.getCursor=function(){switch(t){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(a,b){var c=q&&q.getReverseZoomDirection()?-1.5:1.5;p&&(c*=-1),ca[0]&&(M.x+=.01,P.x+=20),ca[1]&&(M.x-=.01,P.x-=20),ca[2]&&(M.y+=.01,P.y+=20),ca[3]&&(M.y-=.01,P.y-=20),ca[4]&&(M.z+=c),ca[5]&&(M.z-=c);var d=M.x-L.x,e=M.y-L.y,f=M.z-L.z;Math.abs(d)<.001&&(d=0),Math.abs(e)<.001&&(e=0),Math.abs(f)<.001&&(f=0),a.set(d,e,f),b&&b.set(P.x-O.x,P.y-O.y)},this.stepMotionDelta=function(a,b){b?(L.x+=.6*a.x,L.y+=.6*a.y,L.z+=.6*a.z):L.copy(M),O.copy(P)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(m=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),m},this.update=function(){var a,c=!1,d=!1;this.getMotionDelta(R,Q);var e=R.x,f=R.y,g=R.z;if(D||this.checkInteractionMode(),
D=K>-1,D&&this.controller.setIsLocked(!0),0!==e||0!==f||0!==g){switch(t){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(Q.x=-Q.x,E&&this.utilities.autocam.orbit(P,E,Q.multiplyScalar(o),this.utilities.autocam.startState));break;case"freeorbit":h();break;case"dolly":var i,j,m;g*=.6,K>=H?(f=-f,g=Math.abs(e)>Math.abs(f)?e:f,g*=100,e=0,f=0,j=m=.5):(a=q.getScreenViewport(),k&&l?(j=k/a.width,m=l/a.height):j=m=.5),i=!q.getIs2D()&&q.getZoomTowardsPivot()?this.coiIsActive()?q.getPivotPoint():q.getWorldPoint(.5,.5):q.getWorldPoint(j,m),q.dollyFromPoint(g*this.getDollySpeed(i),i,this.getFitBounds());break;case"pan":q.panRelative(-e,f,ea);break;case"dollypan":0===e&&0===f||q.panRelative(-e,f,ea),a=q.getScreenViewport(),j=k/a.width,m=l/a.height,i=q.getWorldPoint(j,m);var n=q.getPosition(),p=q.getIs2D()?n.sub(i).length():ea,u=z/A-1,v=u*p;q.dollyFromPoint(v,i,this.getFitBounds());var C=new THREE.Vector3,G=new THREE.Quaternion,I=q.getCameraUpVector(),J=C.copy(r.position).sub(r.target).normalize();G.setFromAxisAngle(J,1.2*B),I.applyQuaternion(G),q.getIs2D()||q.setCameraUpVector(I),z=A,y=x,ea=p+v}d=!0}return this.stepMotionDelta(R,"pan"!==t&&"dollypan"!==t),K===-1&&Math.abs(g)<1e-5&&(this.interactionEnd(-1),c=!0,d=!0),(da.SHIFT||da.ALT)&&s.indexOf(b.getActiveNavigationTool())!==-1&&(d=!0),!F&&(c||K>-5)&&(K>-1&&(L.copy(M),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),K=-5,D&&this.controller.setIsLocked(!1),D=!1,E=null,w=null),d?this.utilities.pivotActive(q.getPivotSetFlag(),K<=-1):this.utilities.pivotUpdate(),r.dirty},this.checkInteractionMode=function(){var a=this.getTriggeredMode();a!==t&&("pan"===(t=a)&&K>-1||"dollypan"===t)&&this.initTracking(L.x,L.y)},this.interactionStart=function(a,b){(b||a>K)&&(K=a,F=!0,a>-1&&("pan"===t&&this.initTracking(L.x,L.y),"orbit"===t&&this.initOrbit()),this.utilities.pivotActive(q.getPivotSetFlag(),a===-1),this.utilities.autocam&&(this.utilities.autocam.sync(r),this.utilities.autocam.startInteraction(O.x,O.y),E=O.clone()))},this.interactionCheck=function(){(ca[0]||ca[1]||ca[2]||ca[3]||ca[4]||ca[5]||da.SHIFT||da.CONTROL||da.ALT||da.SPACE)&&this.interactionStart(-4,!0)},this.interactionEnd=function(a){a===K&&(a!==-1&&this.utilities.pivotActive(!1),F=!1)},this.handleWheelInput=function(b){if(this.isDragging)return!1;if(q.getIs2D()){var c=q.getScreenViewport(),d=a.intersectGround(k+c.width,l+c.height);this.utilities.setPivotPoint(d,!0,!0)}return q.getReverseZoomDirection()&&(b*=-1),M.z+=b,0!=b&&this.interactionStart(-1),!0},this.resetKeys=function(){this.autoMove(-1,!1),da.SHIFT=0,da.CONTROL=0,da.ALT=0,da.SPACE=0},this.autoMove=function(a,b){b&&this.isDragging||(a<0?ca[0]=ca[1]=ca[2]=ca[3]=ca[4]=ca[5]=b:ca[a]=b,b||this.interactionEnd(-4),this.interactionCheck())},this.updateModifierState=function(a){da.CONTROL=p&&a.metaKey||a.ctrlKey?1:0,da.SHIFT=a.shiftKey?1:0,da.ALT=a.altKey?1:0},this.handleKeyDown=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case G.EQUALS:this.adjustSpeed(1),c=!0;break;case G.DASH:this.adjustSpeed(-1),c=!0;break;case G.ZERO:this.adjustSpeed(0),c=!0;break;case G.LEFT:this.autoMove(0,!0),c=!0;break;case G.RIGHT:this.autoMove(1,!0),c=!0;break;case G.PAGEUP:this.autoMove(2,!0),c=!0;break;case G.PAGEDOWN:this.autoMove(3,!0),c=!0;break;case G.UP:this.autoMove(4,!0),c=!0;break;case G.DOWN:this.autoMove(5,!0),c=!0;break;default:return!1}return this.isDragging||this.interactionStart(-4),c},this.handleKeyUp=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case G.LEFT:this.autoMove(0,!1),c=!0;break;case G.RIGHT:this.autoMove(1,!1),c=!0;break;case G.PAGEUP:this.autoMove(2,!1),c=!0;break;case G.PAGEDOWN:this.autoMove(3,!1),c=!0;break;case G.UP:this.autoMove(4,!1),c=!0;break;case G.DOWN:this.autoMove(5,!1),c=!0;break;default:return!1}return c&&(this.interactionEnd(-4),F||this.interactionCheck()),c},this.handleDollyPan=function(a){k=a.canvasX,l=a.canvasY;var b=q.getScreenViewport();P.x=N.x+a.deltaX,P.y=N.y+a.deltaY,M.x=P.x/b.width,M.y=P.y/b.height,A=j(a);var c=THREE.Math.degToRad(a.rotation);B=c-C,Math.abs(B)>1&&(B=0),C=c,i(a.type,"start")&&(z=A,y=1,B=0,C=c),x=a.scale},this.handleGesture=function(a){switch(a.type){case"dragstart":return w="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===w&&this.handleMouseMove(a);case"dragend":return"drag"===w&&(this.handleButtonUp(a,0),w=null,!0);case"panstart":return w="pan",this.isDragging=!0,L.x=.5*(a.normalizedX+1),L.y=1-.5*(a.normalizedY+1),N.set(a.canvasX,a.canvasY),O.set(a.canvasX,a.canvasY),this.interactionStart(3),this.handleDollyPan(a),!0;case"panmove":return"pan"===w&&this.handleDollyPan(a);case"panend":return"pan"===w&&(this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(3),!0);case"pinchstart":return this.isDragging=!0,w="pinch",L.x=.5*(a.normalizedX+1),L.y=1-.5*(a.normalizedY+1),N.set(a.canvasX,a.canvasY),O.set(a.canvasX,a.canvasY),this.interactionStart(3),this.handleDollyPan(a),!0;case"pinchmove":return"pinch"===w&&this.handleDollyPan(a);case"pinchend":return"pinch"===w&&(this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(a,b){return this.updateModifierState(a),L.x=.5*(a.normalizedX+1),L.y=1-.5*(a.normalizedY+1),O.set(a.canvasX,a.canvasY),M.copy(L),P.copy(O),S.copy(g(a.canvasX,a.canvasY)),T.copy(S),k=a.canvasX,l=a.canvasY,this.isDragging=!0,this.interactionStart(b),!0},this.handleButtonUp=function(a,b){return this.updateModifierState(a),M.x=.5*(a.normalizedX+1),M.y=1-.5*(a.normalizedY+1),P.set(a.canvasX,a.canvasY),T.copy(g(a.canvasX,a.canvasY)),S.copy(T),k=a.canvasX,l=a.canvasY,this.interactionEnd(b),this.isDragging=!1,!0},this.handleMouseMove=function(b){return this.updateModifierState(b),this.isDragging?(M.x=.5*(b.normalizedX+1),M.y=1-.5*(b.normalizedY+1),P.set(b.canvasX,b.canvasY),T.copy(g(b.canvasX,b.canvasY)),k=b.canvasX,l=b.canvasY,!0):(L.x=.5*(b.normalizedX+1),L.y=1-.5*(b.normalizedY+1),O.set(b.canvasX,b.canvasY),M.x=L.x,M.y=L.y,P.copy(O),k=b.canvasX,l=b.canvasY,a.rolloverObject(k,l),!1)},this.handleBlur=function(a){this.resetKeys(),this.interactionEnd(K)},b.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,function(a){n.handleBlur(a)})},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.HotGestureTool=function(a){var b=(navigator.userAgent.search("Mac OS"),a.navigation),c=(b.getCamera(),["hottouch"]),d={SHIFT:0,ALT:0,CONTROL:0},e=null,f=null,g=!1,h=!1,i=null,j={SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LCOMMAND:91,RCOMMAND:93,COMMANDMOZ:224};this.getNames=function(){return c},this.getName=function(){return c[0]},this.activate=function(a){},this.deactivate=function(a){},this.__checkStart=function(){i&&(this.controller.distributeEvent("handleGesture",i),i=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var b=a.getActiveNavigationTool(),c=g===!1&&h===!0,d=g===!0&&h===!1;if(c||d){var i=c?"worldup":"fov";if(b===i)return!1;if(b===e)return a.setActiveNavigationTool(i),e=i,this.__checkStart(),!1;f=b,a.setActiveNavigationTool(i),e=i,this.__checkStart()}else e&&(a.setActiveNavigationTool(f),e=null,f=null);return!1},this.resetKeys=function(){d.SHIFT=0,d.CONTROL=0,d.ALT=0},this.updateModifierState=function(a){d.CONTROL=a.ctrlKey?1:0,d.SHIFT=a.shiftKey?1:0,d.ALT=a.altKey?1:0},this.handleGesture=function(b){if(b===i)return!1;switch(b.type){case"drag3start":a.navigation.isActionEnabled("fov")&&(i=b,g=!0);break;case"drag3move":break;case"drag3end":g=!1;break;case"rotatestart":a.navigation.isActionEnabled("roll")&&(i=b,h=!0);break;case"rotatemove":break;case"rotateend":h=!1}return!1},this.handleKeyDown=function(a,b){switch(this.updateModifierState(a),b){case j.SHIFT:d.SHIFT=1;break;case j.CONTROL:d.CONTROL=1;break;case j.ALT:d.ALT=1}return!1},this.handleKeyUp=function(a,b){switch(this.updateModifierState(a),b){case j.SHIFT:d.SHIFT=0;break;case j.CONTROL:d.CONTROL=0;break;case j.ALT:d.ALT=0}return!1},this.handleButtonDown=function(a,b){return this.updateModifierState(a),!1},this.handleButtonUp=function(a,b){return this.updateModifierState(a),!1},this.handleMouseMove=function(a){return this.updateModifierState(a),!1},this.handleBlur=function(a){return this.resetKeys(),!1}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.HotkeyManager=function(){function a(){return p}function b(){return p[0]}function c(a,b){return a-b}function d(a,b,d){if(k.some(function(b){return b.id===a}))return!1;for(var e=0;e<b.length;e++)k.push({id:a,keys:b[e].keycodes.sort(c).join(),onPress:b[e].onPress,onRelease:b[e].onRelease,options:d||{}});return!0}function e(a){for(var b=!1,c=k.length-1;c>=0;c--)k[c].id===a&&(k.splice(c,1),b=!0);return b}function f(){var a,b,c=l.join();for(b=0;b<n.length;)a=n[b],a.keys===c?n.splice(b,1):b++;for(b=0;b<m.length;)a=m[b],a.keys!==c?m.splice(b,1):b++}function g(a,b){if(l.indexOf(b)===-1){for(var c=l.join(),d=l.slice(0),e=0;e<l.length&&l[e]<b;)e++;l.splice(e,0,b);var g=l.join(),h=l.slice(0);f();var i,j=[],o=[];for(e=k.length-1;e>=0;e--)i=k[e],i.keys===c&&i.onRelease?j.unshift(i):i.keys===g&&i.onPress&&o.unshift(i);for(e=j.length-1;e>=0&&(i=j[e],!i.onRelease(d));e--)i.options.tryUntilSuccess&&n.unshift(i);for(e=o.length-1;e>=0&&(i=o[e],!i.onPress(h));e--)i.options.tryUntilSuccess&&m.unshift(i)}}function h(a,b){var c=l.join(),d=l.slice(0),e=l.indexOf(b);e>-1&&l.splice(e,1);var g=l.join(),h=l.slice(0);f();var i,j=[],o=[];for(e=k.length-1;e>=0;e--)i=k[e],i.keys===c&&i.onRelease?j.unshift(i):i.keys===g&&i.onPress&&o.unshift(i);for(e=j.length-1;e>=0&&(i=j[e],!i.onRelease(d));e--)i.options.tryUntilSuccess&&n.unshift(i);for(e=o.length-1;e>=0&&(i=o[e],!i.onPress(h));e--)i.options.tryUntilSuccess&&m.unshift(i)}function i(){var a,b;for(b=0;b<n.length;)a=n[b],a.onRelease(a.keys.split())===!0?n.splice(b,1):b++;for(b=0;b<m.length;)a=m[b],a.onPress(a.keys.split())===!0?m.splice(b,1):b++;return!1}function j(){for(var a=l.length-1;a>=0;a--)h(null,l[a])}var k=[],l=[],m=[],n=[],o=Autodesk.Viewing.KeyCode,p=["hotkeys"];return{pushHotkeys:d,popHotkeys:e,handleKeyDown:g,handleKeyUp:h,handleBlur:j,getName:b,getNames:a,activate:function(){},deactivate:function(){},update:i,KEYCODES:o}},Autodesk.Viewing.theHotkeyManager=new Autodesk.Viewing.HotkeyManager,AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.FovTool=function(a){function b(a){return a<0&&a>-3?-3:a>0&&a<3?3:a}var c=a.navigation,d=c.getCamera(),e=["fov"],f=!1,g=0,h=null,i=null,j=!1,k=0,l=-5,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=null;this.getNames=function(){return e},this.getName=function(){return e[0]},this.activate=function(a){k=0},this.deactivate=function(a){l=-5},this.getCursor=function(){return 0!==k&&l===-5?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(a){var b=n.x-m.x,c=n.y-m.y,d=n.z-m.z;Math.abs(b)<.001&&(b=0),Math.abs(c)<.001&&(c=0),Math.abs(d)<.001&&(d=0),a.set(b,c,d)},this.stepMotionDelta=function(a,b){b?(m.x+=.6*a.x,m.y+=.6*a.y,m.z+=.6*a.z):m.copy(n)},this.getAccumulatedWheelDelta=function(){var a=Date.now(),c=0;return i&&a-i>100?(c=b(g),g=0,h=null,i=null,j=!1):h&&a-h>100&&(j?Math.abs(g)>=3&&(c=g,g=0):(c=b(g),j=!0,g=0)),c},this.update=function(){var a=!1,b=l>-5;if(l>-5){this.controller.setIsLocked(!0),this.getMotionDelta(o);var e=o.x,g=o.y,h=o.z;if(0!==e||0!==g||0!==h)if(b=!0,l>=0)g=-g,0!==(h=Math.abs(e)>Math.abs(g)?e:g)&&(h*=-1,c.setVerticalFov(c.getVerticalFov()*(1+h),!0));else{var i=this.getAccumulatedWheelDelta()/3;0!==i&&c.setFocalLength(c.getFocalLength()+i,!0)}this.stepMotionDelta(o,!0),l===-1&&Math.abs(h)<1e-5&&(this.interactionEnd(-1),a=!0)}return b?this.utilities.pivotActive(c.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!f&&(a||l>-5)&&(l>-1&&m.copy(n),l=-5,this.controller.setIsLocked(!1)),d.dirty},this.interactionStart=function(a,b){(b||a>l)&&(l=a,f=!0),c.toPerspective()},this.interactionEnd=function(a){a===l&&(a!==-1&&this.utilities.pivotActive(!1),f=!1)},this.handleWheelInput=function(a){if(l>-1)return!1;c.getReverseZoomDirection()&&(a*=-1),n.z+=a,g+=a;var b=Date.now();return h||(h=b),i=b,0!=a&&this.interactionStart(-1),!0},this.handleGesture=function(a){switch(a.type){case"dragstart":return this.handleButtonDown(a,0);case"dragmove":return this.handleMouseMove(a);case"dragend":return this.handleButtonUp(a,0);case"drag3start":return p="drag",this.handleButtonDown(a,0);case"drag3move":return"drag"===p&&this.handleMouseMove(a);case"drag3end":return"drag"===p&&this.handleButtonUp(a,0),p=null,!1}return!1},this.handleButtonDown=function(a,b){return k+=1<<b,2!==b&&(m.x=.5*(a.normalizedX+1),m.y=1-.5*(a.normalizedY+1),n.copy(m),this.interactionStart(b),!0)},this.handleButtonUp=function(a,b){return k-=1<<b,2!==b&&(n.x=.5*(a.normalizedX+1),n.y=1-.5*(a.normalizedY+1),this.interactionEnd(b),!0)},this.handleMouseMove=function(a){return n.x=.5*(a.normalizedX+1),n.y=1-.5*(a.normalizedY+1),l>-1},this.handleBlur=function(a){return this.interactionEnd(l),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.WorldUpTool=function(a,b){function c(a,b){function c(a,b){var c=Math.abs(a-b);return c>l?c:Math.min(l-c,c)}function d(a,b){var c=p(a);return c.distanceToSquared(b)<m||(B.set(-b.x,-b.y,-b.z),c.distanceToSquared(B)<m)}function h(a,b){for(var e=W+X+2*Math.PI/180,f=0;f<6;++f)if(Q[f]!==Z)for(var g=f+1;g<6;++g)if(Q[g]!==Z){var h=c(Q[f],Q[g]);if(h<e){if(a[f]<a[g]&&!d(f,b)||d(g,b)){Q[f]=Z;break}Q[g]=Z}}}function i(a){return a>l?a:a<=0?a+Math.PI:a-Math.PI}function j(a,b,c){var d=a.clone().normalize(),e=new Array(3),f=new Array(6);e[0]=k(1,0,0,d),e[1]=k(0,1,0,d),e[2]=k(0,0,1,d);var g,j=b.clone().cross(d).normalize();for(g=0;g<3;++g){var l=e[g];f[g]=l.length(),f[g]<$?Q[g]=Z:(l.multiplyScalar(1/f[g]),Q[g]=Math.atan2(j.dot(l),b.dot(l)))}for(Q[3]=i(Q[0]),Q[4]=i(Q[1]),Q[5]=i(Q[2]),f[3]=f[0],f[4]=f[1],f[5]=f[2],h(f,c),g=0;g<6;++g)if(Q[g]!==Z){var m=B.set(0,0,1);C.setFromAxisAngle(m,Q[g]);var n=B.set(0,.54,0);n.applyQuaternion(C),O[g].position.copy(n),O[g].visible=!0}else O[g].visible=!1}function n(){M=new THREE.Object3D;var a=new THREE.RingGeometry(.5-.01*F,.5,60),b=new THREE.Mesh(a,z);I=b;var c=.007*F,d=new THREE.BoxGeometry(.93,c,c),e=new THREE.BoxGeometry(c,.93,c),f=new THREE.BoxGeometry(c,c,.93);J=new THREE.Mesh(d,z),K=new THREE.Mesh(e,z),L=new THREE.Mesh(f,z),M.add(J),M.add(K),M.add(L),N=new THREE.Mesh(new THREE.CircleGeometry(.005),z),M.add(N),O=new Array(6),P=new Array(6);for(var g=0;g<6;++g){var h=.005*F,i=.0025*F;O[g]=new THREE.Mesh(new THREE.CircleGeometry(h,16),z),P[g]=new THREE.Mesh(new THREE.CircleGeometry(i,16),z),P[g].visible=!1,O[g].add(P[g]),b.add(O[g])}return M.add(b),M}function o(a,b,c,d,e){return M||(M=n()),g.orient(I,b,D.position,d),j(c,e,d),M.scale.x=a,M.scale.y=a,M.scale.z=a,M.position.copy(b),M}function p(a){if(A.set(0,0,0),a>=0){var b=a>=3?-1:1;a%=3,0===a&&(A.x=b),1===a&&(A.y=b),2===a&&(A.z=b)}return T&&A.multiplyScalar(-1),A}function q(a,b){for(var d=c(Q[0],a),e=0,f=1;f<6;++f){var g=c(Q[f],a);g<d&&(d=g,e=f)}return R=d,d<b?e:-1}function r(a){g.setWorldUpVector(a,!0)}function s(a){if(0!==a){var b=30*Math.PI/180,c=B.copy(D.position).sub(H).normalize();C.setFromAxisAngle(c,a);var d=g.getWorldUpVector(),e=Math.abs(c.angleTo(d));(e<b||Math.PI-e<b)&&d.copy(g.getCameraUpVector()),d.applyQuaternion(C),r(d)}}function t(){if(!U){var a=q(S,W);if(a>=0)return R=0,U=!0,S=Q[a],p(a)}return!1}function u(){if(U){if(q(S,X)<0)return U=!1,!0;R=0}return!1}function v(a,b,c,d){if(a<b)return p(c).distanceToSquared(d)<m;return!1}function w(a,b){a.dot(b)<0&&(b=b.clone().multiplyScalar(-1)),g.orient(N,H,D.position,b),N.position.copy(b.multiplyScalar(.495));for(var d=!1,e=U?X:W,f=0;f<6;++f){var h=c(Q[f],S),i=v(h,e,f,a);i&&(d=!0);var j=i?4:3*(1-3*h/Math.PI);j<1&&(j=1),j*=F,P[f].visible=i;var k=O[f];k.scale.x=j,k.scale.y=j,k.scale.z=j}return J.visible=d,K.visible=d,L.visible=d,d}function x(a){S+=a,S>Math.PI?S-=l:S<=-Math.PI&&(S=l+S);var b=t();if(b)V=S,r(b);else if(u()){var c=S-V;s(c),V=0}else{if(U)return!1;s(a)}return!0}var y=2*Math.tan(THREE.Math.degToRad(15)),z=new THREE.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),A=new THREE.Vector3,B=new THREE.Vector3,C=new THREE.Quaternion,D=new THREE.PerspectiveCamera(30,b.aspect,b.near,b.far),E=b,F=1,G=1,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=new Array(6),R=0,S=0,T=!1,U=!0,V=0,W=5*Math.PI/180,X=7*Math.PI/180,Y=1,Z=1e3,$=.1;a.createOverlayScene("roll",null,null,D),this.updateRollCamera=function(a,b){D.position.copy(E.position),D.quaternion.copy(E.quaternion),D.up.copy(E.up),D.aspect=E.aspect,a&&b&&(D.near=b-a,D.far=b+a),D.updateProjectionMatrix()},this.isSnapped=function(){return U},this.resize=function(){var a=Y*y,b=a*E.aspect,c=(E.aspect<1?b:a)*G;M.scale.x=c,M.scale.y=c,M.scale.z=c},this.start=function(b,c){this.updateHUD(b,c),a.addOverlay("roll",M)},this.updateHUD=function(a,b){H=a,b<e?b=e:b>f&&(b=f),G=b,F=f/b;var c=A.copy(a).sub(E.position);Y=c.length();var d=Y*y,h=d*E.aspect,i=(E.aspect<1?h:d)*b;this.updateRollCamera(i,Y);var j=g.getWorldUpVector(),k=g.getCameraUpVector();o(i,a,c,j,k),S=0,V=0,T=j.dot(k)<0,U=w(j,k)},this.handleRoll=function(a,b,c){if(this.updateRollCamera(),w(g.getWorldUpVector(),g.getCameraUpVector()),0!==a||0!==b){var d=c.x-a-.5,e=c.y-b-.5,f=c.x-.5,h=c.y-.5;return x(Math.atan2(h,f)-Math.atan2(e,d))}return!1},this.handleRollTouch=function(a){this.updateRollCamera(),w(g.getWorldUpVector(),g.getCameraUpVector());var b=a-S;return Math.abs(b)>.001&&x(b)},this.end=function(){a.removeOverlay("roll",M)}}function d(a){var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY,d=Math.sqrt(b*b+c*c),e=g.getScreenViewport();return d/Math.min(e.width,e.height)}var e=.35,f=.8,g=b.navigation,h=g.getCamera(),i=["worldup"],j=this,k=function(){var a=new THREE.Vector3;return function(b,c,d,e){var f=new THREE.Vector3(b,c,d),g=e.dot(f);return a.copy(e),a.multiplyScalar(g),f.sub(a)}}(),l=2*Math.PI,m=1e-5,n=!1,o=!1,p=!1,q=new c(a,h),r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector3,u=null,v=0,w={x:.5,y:.5},x=1;this.getNames=function(){return i},this.getName=function(){return i[0]},this.activate=function(a){b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),p=!1},this.deactivate=function(a){q.end(),b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),u=null,n=!1,p=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(a){var b=s.x-r.x,c=s.y-r.y,d=s.z-r.z;Math.abs(b)<.001&&(b=0),Math.abs(c)<.001&&(c=0),Math.abs(d)<.001&&(d=0),a.set(b,c,d)},this.stepMotionDelta=function(){r.copy(s)},this.update=function(){if(!p){var a=g.getEyeVector(),b=.5*(h.near+h.far);a.normalize().multiplyScalar(b);var c=a.add(h.position);this.utilities.savePivot(),this.utilities.setPivotPoint(c,!0,!0),this.utilities.pivotActive(!0);q.start(c,.65),p=!0}var d=o;this.getMotionDelta(t);var e=t.x,f=t.y,i=t.z;return(o||"roll"===u||n&&(0!==e||0!==f||0!==i))&&(o="roll"===u?q.handleRollTouch(v):q.handleRoll(e,f,s)),this.stepMotionDelta(),h.dirty&&(d=!0),d},this.handleResize=function(){q.resize(),o=!0},this.handleGesture=function(a){switch(a.type){case"dragstart":return u="drag",this.handleButtonDown(a,0);case"dragmove":return this.handleMouseMove(a);case"dragend":return u=null,this.handleButtonUp(a,0);case"rotatestart":return b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),u="roll",v=THREE.Math.degToRad(a.rotation),w={x:.5*(a.normalizedX+1),y:1-.5*(a.normalizedY+1)},x=d(a),!0;case"rotatemove":return v=THREE.Math.degToRad(a.rotation),"roll"===u;case"rotateend":return b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),v=THREE.Math.degToRad(a.rotation),u=null,!1}return!1},this.handleWheelInput=function(a){return!0},this.handleCameraChange=function(){var a=g.getEyeVector(),b=.5*(h.near+h.far);a.normalize().multiplyScalar(b);var c=a.add(h.position);q.updateHUD(c,.65)},this.handleButtonDown=function(a,c){return r.x=.5*(a.normalizedX+1),r.y=1-.5*(a.normalizedY+1),s.copy(r),n=!0,u=null,this.controller.setIsLocked(!0),b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,j.handleCameraChange),!0},this.handleButtonUp=function(a,c){return s.x=.5*(a.normalizedX+1),s.y=1-.5*(a.normalizedY+1),n=!1,o=!0,this.controller.setIsLocked(!1),b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,j.handleCameraChange),!0},this.handleMouseMove=function(a){return s.x=.5*(a.normalizedX+1),s.y=1-.5*(a.normalizedY+1),!0},this.handleBlur=function(a){return n=!1,u=null,!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ToolInterface=function(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.register=function(){},this.deregister=function(){},this.activate=function(a,b){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},function(){"use strict";function a(a,b){function e(){return b.getData().instanceTree}function f(c){var d=e();if(m[c]>0)0==--m[c]&&a.highlightObjectNode(b,c,!1);else if(m[c]<0)throw"Selection State machine broken. Negatively selected object!";d&&d.enumNodeChildren(c,function(a){f(a)},!1)}function g(c,d){var f=e();m[c]?m[c]++:(a.highlightObjectNode(b,c,!0,d),m[c]=1),f&&f.enumNodeChildren(c,function(a){g(a,!0)},!1)}function h(a){if(void 0!==a&&l.selectedObjectIds[a])return!0}function i(a){var b=e();if(!b||(a=b.findNodeForSelection(a,l.selectionMode),b.isNodeSelectable(a))){h(a)||(l.selectedObjectIds[a]=a,l.selectionCount++,g(a))}}function j(a){h(a)&&(f(a),l.selectedObjectIds[a]=0,l.selectionCount--)}function k(a){if(l.selectionCount!==a.length)return!1;for(var b=0;b<a.length;b++)if(!h(a[b]))return!1;return!0}var l=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=c.SelectionMode.LEAF_OBJECT;var m={};this.getInstanceTree=e,this.getSelectionLength=function(){return l.selectionCount},this.getSelection=function(){var a=[],b=l.selectedObjectIds;for(var c in b)if(b[c]){var d=parseInt(c);a.push(d)}return a},this.clearSelection=function(a){if(this.selectionCount>0){var b=l.selectedObjectIds;for(var c in b){var d=parseInt(c);void 0!==d&&f(d)}l.selectedObjectIds={},l.selectionCount=0}},this.deselectInvisible=function(){var c=!1,d=l.selectedObjectIds,f=(e(),a.visibilityManager);for(var g in d){var h=parseInt(g);h&&!f.isNodeVisible(b,h)&&(j(h),c=!0)}return c},this.toggleSelection=function(a){if(!a)return void d.logger.error("Attempting to select node 0.",c.errorCodeString(c.ErrorCodes.VIEWER_INTERNAL_ERROR));h(a)?j(a):i(a)},this.setSelectionMode=function(a){this.clearSelection(!0),this.selectionMode=a},this.setSelection=function(a){if(!k(a)&&(this.clearSelection(!0),null!=a&&0!==a.length))for(var b=0;b<a.length;b++)i(a[b])},this.getSelectionBounds=function(){var a=new THREE.Box3,c=new THREE.Box3,d=e(),f=b.getFragmentList(),g=l.selectedObjectIds;for(var h in g){var i=parseInt(h);d.enumNodeFragments(i,function(b){f.getWorldBounds(b,c),a.union(c)},!0)}return a},this.getSelectionVisibility=function(){var a=!1,c=!1,d=l.selectedObjectIds;for(var f in d){var g=parseInt(f);if(g){var h=e();if(h&&h.isNodeHidden(g)?c=!0:a=!0,a&&c)break}}return{hasVisible:a,hasHidden:c,model:b}},this.dtor=function(){this.selectedObjectIds=null}}function b(b){function e(){h.length>1&&d.logger.warn("This selection call does not yet support multiple models.")}function f(){for(var a=[],d=0;d<h.length;d++){var e=[],f=[],g=h[d].selector.selectedObjectIds,i=h[d].selector.getInstanceTree();for(var j in g)if(g[j]){var k=parseInt(j);k&&(e.push(k),i&&i.enumNodeFragments(k,function(a){f.push(a)},!1))}e.length&&a.push({fragIdsArray:f,dbIdArray:e,nodeArray:e,model:h[d]})}var l;1===h.length&&(l={type:c.SELECTION_CHANGED_EVENT,fragIdsArray:a[0]?a[0].fragIdsArray:[],dbIdArray:a[0]?a[0].dbIdArray:[],nodeArray:a[0]?a[0].dbIdArray:[],model:h[0]},b.api.fireEvent(l)),l={type:c.AGGREGATE_SELECTION_CHANGED_EVENT,selections:a},b.api.fireEvent(l)}function g(){for(var a=!1,b=0;b<h.length;b++)a=h[b].selector.deselectInvisible()||a;a&&f()}var h=[];this.addModel=function(c){h.indexOf(c)==-1&&(c.selector=new a(b,c),h.push(c))},this.removeModel=function(a){var b=h.indexOf(a);a.selector.getSelection();a.selector.clearSelection(),a.selector=null,h.splice(b,1)},this.getSelectionLength=function(){for(var a=0,b=0;b<h.length;b++)a+=h[b].selector.getSelectionLength();return a},this.getSelection=function(){return e(),h.length>1&&d.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),h[0].selector.getSelection()},this.getAggregateSelection=function(){for(var a=[],b=0;b<h.length;b++){var c=h[b].selector.getSelection();c&&c.length&&a.push({model:h[b],selection:c})}return a},this.clearSelection=function(a){for(var b=0;b<h.length;b++)h[b].selector.clearSelection(a);a||f()},this.toggleSelection=function(a,b){b||(e(),b=h[0]),b.selector.toggleSelection(a),f()},this.setSelectionMode=function(a){for(var b=0;b<h.length;b++)h[b].selector.setSelectionMode(a)},this.setSelection=function(a,b){if(a&&0!==a.length){if(b)for(var c=0;c<h.length;c++)h[c]!==b&&h[c].selector.clearSelection();else e(),b=h[0];b.selector.setSelection(a)}else this.clearSelection();f()},this.getSelectionBounds=function(){if(1==h.length)return h[0].selector.getSelectionBounds();for(var a=new THREE.Box3,b=0;b<h.length;b++){var c=h[b].selector.getSelectionBounds();a.union(c)}return a},this.getSelectionVisibility=function(){for(var a={hasVisible:!1,hasHidden:!1,details:[]},b=0;b<h.length;b++){var c=h[b].selector.getSelectionVisibility();a.hasVisible=a.hasVisible||c.hasVisible,a.hasHidden=a.hasHidden||c.hasHidden,a.details.push(c)}return a},this.dtor=function(){for(var a=0;a<h.length;a++)h[a].selector.dtor()},b.api.addEventListener(c.ISOLATE_EVENT,function(a){g()}),b.api.addEventListener(c.HIDE_EVENT,function(a){g()})}var c=Autodesk.Viewing,d=c.Private;d.Selector=a,d.MultiModelSelector=b}(),function(){"use strict";function a(a){this.viewer=a,this.models=[]}var b=Autodesk.Viewing,c=b.Private,d=function(a,b){this.viewerImpl=a,this.model=b,this.isolatedNodes=[],this.hiddenNodes=[]};d.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},d.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},d.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},d.prototype.setAllVisibility=function(a){var b=this.model?this.model.getRootId():null;b&&this.setVisibilityOnNode(b,a),this.model.getData().is2d&&this.model.setAllVisibility(a)},d.prototype.isNodeVisible=function(a){var b=this.getInstanceTree();return b?!b.isNodeHidden(a):this.hiddenNodes.indexOf(a)==-1&&(0==this.isolatedNodes.length||this.isolatedNodes.indexOf(a)!=-1)},d.prototype.isolate=function(a){var b=this.getInstanceTree(),c=b?b.getRootId():null,d="number"==typeof a&&a===c||"object"==typeof a&&a.dbId===c;a&&!d?this.isolateMultiple(Array.isArray(a)?a:[a]):this.isolateNone()},d.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0);var a={type:b.ISOLATE_EVENT,nodeIdArray:[],model:this.model};this.viewerImpl.api.fireEvent(a)},d.prototype.isolateMultiple=function(a){if(a&&0!=a.length){this.setAllVisibility(!1),this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.isolatedNodes=a.slice(0),this.hiddenNodes=[];for(var c=0;c<a.length;c++)this.setVisibilityOnNode(a[c],!0);var d={type:b.ISOLATE_EVENT,nodeIdArray:a,model:this.model};this.viewerImpl.api.fireEvent(d)}else this.isolateNone();this.viewerImpl.invalidate(!0)},d.prototype.hide=function(a){var c;if(Array.isArray(a)){for(var d=0;d<a.length;++d)this.setVisibilityOnNode(a[d],!1);a.length>0&&(c={type:b.HIDE_EVENT,nodeIdArray:a,model:this.model})}else this.setVisibilityOnNode(a,!1),c={type:b.HIDE_EVENT,nodeIdArray:[a],model:this.model};c&&this.viewerImpl.api.fireEvent(c)},d.prototype.show=function(a){var c;if(Array.isArray(a)){for(var d=0;d<a.length;++d)this.setVisibilityOnNode(a[d],!0);a.length>0&&(c={type:b.SHOW_EVENT,nodeIdArray:a,model:this.model})}else this.setVisibilityOnNode(a,!0),
c={type:b.SHOW_EVENT,nodeIdArray:[a],model:this.model};c&&this.viewerImpl.api.fireEvent(c)},d.prototype.toggleVisibility=function(a){var c=this.getInstanceTree().isNodeHidden(a);this.setVisibilityOnNode(a,c);var d={type:c?b.SHOW_EVENT:b.HIDE_EVENT,nodeIdArray:[a],model:this.model};this.viewerImpl.api.fireEvent(d)},d.prototype.setVisibilityOnNode=function(a,b){var c=this.viewerImpl,d=this.model,e=this.getInstanceTree(),f=!b,g=d.getData().is2d;this.viewerImpl.matman();e?e.enumNodeChildren(a,function(a){e.setNodeHidden(a,f),g?d.getFragmentList().setObject2DGhosted(a,!b):e.enumNodeFragments(a,function(a){d.setVisibility(a,b)},!1)},!0):g?d.getFragmentList().setObject2DGhosted(a,!b):d.setVisibility(a,b),c.sceneUpdated(!0),this.updateNodeVisibilityTracking(a,b)},d.prototype.updateNodeVisibilityTracking=function(a,b){var c=b;if(this.isolatedNodes.length>0){var d=this.isolatedNodes.indexOf(a);c&&d===-1?this.isolatedNodes.push(a):c||d===-1||this.isolatedNodes.splice(d,1)}else{var e=this.hiddenNodes.indexOf(a);c||e!==-1?c&&e!==-1&&this.hiddenNodes.splice(e,1):this.hiddenNodes.push(a)}var f=this.getInstanceTree();f&&f.root&&f.root.dbId===a&&(b?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[a]))},d.prototype.setNodeOff=function(a,b){var c=this.viewerImpl,d=this.model,e=this.getInstanceTree(),f=d.getData().is2d;e?e.enumNodeChildren(a,function(a){e.setNodeOff(a,b),f?d.getFragmentList().setObject2DVisible(a,!b):e.enumNodeFragments(a,function(a){d.getFragmentList().setFragOff(a,b)},!1)},!0):f?d.getFragmentList().setObject2DVisible(a,!b):d.getFragmentList().setFragOff(a,b),c.sceneUpdated(!0)},b.Private.VisibilityManager=d,a.prototype.addModel=function(a){this.models.indexOf(a)==-1&&(a.visibilityManager=new d(this.viewer,a),this.models.push(a))},a.prototype.removeModel=function(a){var b=this.models.indexOf(a);a.visibilityManager.isolateNone(),a.visibilityManager=null,this.models.splice(b,1)},a.prototype.warn=function(){this.models.length>1&&c.logger.warn("This selection call does not yet support multiple models.")},a.prototype.getIsolatedNodes=function(a){return a||(this.warn(),a=this.models[0]),a.visibilityManager.getIsolatedNodes()},a.prototype.getHiddenNodes=function(a){return a||(this.warn(),a=this.models[0]),a.visibilityManager.getHiddenNodes()},a.prototype.isNodeVisible=function(a,b){return a||(this.warn(),a=this.models[0]),a.visibilityManager.isNodeVisible(b)},a.prototype.isolate=function(a,b){(b?[b]:this.models).forEach(function(b){b.visibilityManager.isolate(a)})},a.prototype.hide=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.hide(a)},a.prototype.show=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.show(a)},a.prototype.toggleVisibility=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.toggleVisibility(a)},a.prototype.setVisibilityOnNode=function(a,b,c){c||(this.warn(),c=this.models[0]),c.visibilityManager.setVisibilityOnNode(a,b)},a.prototype.setNodeOff=function(a,b,c){c||(this.warn(),c=this.models[0]),c.visibilityManager.setNodeOff(a,b)},b.Private.MultiModelVisibilityManager=a}();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,LMV_WORKER_URL=avp.LMV_WORKER_URL||"src/workers/MainWorker-web.js",ENABLE_INLINE_WORKER=avp.ENABLE_INLINE_WORKER||!1;!function(){"use strict";var a=null,b=!1,c=[];avp.clearWorkerDataURL=function(){a=null},avp.initWorkerScript=function(d,e){if(ENABLE_INLINE_WORKER&&!a){if(c.push({successCB:d}),b)return;var f=new XMLHttpRequest,g=LMV_WORKER_URL,h=avp.getResourceUrl(LMV_WORKER_URL);h&&(g=h),f.open("GET",g,!0),f.withCredentials=!1,f.onload=function(){b=!1;var d;window.URL=window.URL||window.webkitURL;try{d=new Blob([f.responseText],{type:"application/javascript"})}catch(a){d=new BlobBuilder,d.append(f.responseText),d=d.getBlob()}a=URL.createObjectURL(d);var e=c.concat();c=[];for(var g=0;g<e.length;++g)e[g].successCB&&e[g].successCB()},b=!0,f.send();var i={};return i.cancel=function(){var a=-1;return!!c.some(function(b,c){return b.successCB==d&&(a=c,!0)})&&(c.splice(a,1),!0)},i}return d&&d(),null},avp.createWorker=function(){var b;return b=ENABLE_INLINE_WORKER?new Worker(a):new Worker(avp.getResourceUrl(LMV_WORKER_URL)),b.doOperation=b.postMessage,b},avp.createWorkerWithIntercept=function(){function a(a){if(!c)return null;for(var b=0;b<c.length;++b)if(c[b].arg===a){var d=c[b].callback;return c.splice(b,1),0===c.length&&(c=null),d}return null}var b=avp.createWorker();b.checkEvent=function(a){return!(!a.data||!a.data.assetRequest)&&(avp.assets&&avp.assets.push(a.data.assetRequest),!0)};var c=[];return b.addEventListenerWithIntercept=function(a){var d=function(c){b.checkEvent(c)||a(c)};return c||(c=[]),c.push({arg:a,callback:d}),b.addEventListener("message",d,!1),d},b.removeEventListenerWithIntercept=function(c){var d=a(c);d&&b.removeEventListener("message",d,!1)},b.clearAllEventListenerWithIntercept=function(){if(c)for(var a=c.concat(),d=0;d<a.length;++d)b.removeEventListenerWithIntercept(a[d].arg)},b}}(),function(){"use strict";function a(a){var b=a.data;if(b&&b.debug)return void f.logger.debug(b.message);if(b.cbId){var c=i[b.cbId];b&&b.error?c[1]&&c[1](b.error):c[0]&&c[0](b.result),delete i[b.cbId]}}function b(a,b){var c=h++;return i[c]=[a,b],c}function c(){d&&d.doOperation({operation:g,clearCaches:!0})}var d,e=Autodesk.Viewing,f=e.Private,g="UNLOAD_PROPERTYDB",h=1,i={},j=function(a,b,c){if(this.eventTarget=c||new e.EventDispatcher,this.model=b,this.svf=b&&b.getData(),this.svf&&this.svf.propertydb&&this.svf.propertydb.avs.length){this.dbPath=f.pathToURL(this.svf.basePath),this.dbFiles=this.svf.propertydb,this.sharedDbPath=!1;for(var d in this.dbFiles)this.dbFiles[d][0]=this.dbFiles[d][0]&&this.dbFiles[d][0].replace(/\\/g,"/");if(a){var g=this.dbPath+this.svf.propertydb.avs[0];if(g=f.ViewingService.simplifyPath(g),(g=g.slice(0,g.lastIndexOf("/")+1))===a){var h={},i=this.dbPath.split("/");for(var d in this.dbFiles){var j=this.dbFiles[d][0];j=f.ViewingService.simplifyPath(this.dbPath+j),h[d]=[j];for(var k=j.split("/"),l=0;k[l]===i[l];)l++;i.length=l}this.sharedDbPath=!0,this.dbFiles=h,this.dbPath=i.join("/")+"/",this.dbPath.length>a.length&&(this.dbPath=a);for(var d in this.dbFiles){var j=this.dbFiles[d][0];this.dbFiles[d][0]=j.slice(this.dbPath.length)}}}}else this.sharedDbPath=!0,this.dbPath=a,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]},f.logger.log("Using shared db path "+a);var m=e.getUseCredentials()&&!e.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"";this.queryParam=m,this.svf&&this.svf.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.svf.acmSessionId)};j.prototype.dtor=function(){this.asyncPropertyOperation({operation:g},function(){},function(){})},j.prototype.processLoadResult=function(a){var b=this;if(a.instanceTreeStorage){var c=new f.InstanceTreeAccess(a.instanceTreeStorage,a.rootId,a.instanceBoxes);b.instanceTree=new f.InstanceTree(c,a.objectCount,a.maxTreeDepth),b.svf&&(b.svf.instanceTree=b.instanceTree)}else a.instanceTree?(f.logger.warn("glTF instance tree not supported"),b.hasObjectProperties=a.objectCount):a.objectCount&&(b.hasObjectProperties=a.objectCount,b.svf&&(b.svf.hasObjectProperties=a.objectCount));b.eventTarget.fireEvent({type:e.OBJECT_TREE_CREATED_EVENT,svf:b.svf,model:b.model,target:b})},j.prototype.processLoadError=function(a){var b=this;b.propertyDbError=a,b.eventTarget.fireEvent({type:e.OBJECT_TREE_UNAVAILABLE_EVENT,svf:b.svf,model:b.model,target:b})},j.prototype.load=function(){var c=this;if(this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)return void setTimeout(function(){c.processLoadResult(c.svf)},0);d||(d=f.createWorkerWithIntercept(),d.addEventListenerWithIntercept(a)),this.propWorker=d;var e=function(a){c.processLoadResult(a)},g=function(a){c.processLoadError(a)},h=b(e,g),i={operation:"LOAD_PROPERTYDB",dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:this.svf&&this.svf.fragments.boxes,cbId:h,queryParams:this.queryParam};d.doOperation(f.initLoadContext(i))},j.prototype.asyncPropertyOperation=function(a,c,f){var g=this;if(a.dbPath=this.dbPath,g.instanceTree||g.hasObjectProperties)a.cbId=b(c,f),d.doOperation(a);else if(g.propertyDbError)f&&f(g.propertyDbError);else{var h=function(b){g.eventTarget.removeEventListener(e.OBJECT_TREE_CREATED_EVENT,h),g.eventTarget.removeEventListener(e.OBJECT_TREE_UNAVAILABLE_EVENT,h),g.instanceTree||g.hasObjectProperties||g.propertyDbError?g.asyncPropertyOperation(a,c,f):f&&f({code:e.UNKNOWN_FAILURE,msg:"Failed to load properties"})};g.eventTarget.addEventListener(e.OBJECT_TREE_CREATED_EVENT,h),g.eventTarget.addEventListener(e.OBJECT_TREE_UNAVAILABLE_EVENT,h)}},j.prototype.getProperties=function(a,b,c){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbId:a},b,c)},j.prototype.getBulkProperties=function(a,b,c,d,e){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbIds:a,propFilter:b,ignoreHidden:e},c,d)},j.prototype.searchProperties=function(a,b,c,d,e){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:a,attributeNames:b,completeInfo:e},c,d)},j.prototype.getExternalIdMapping=function(a,b){this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING"},a,b)},j.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},j.prototype.getObjectTree=function(a,b){var c=this;if(c.instanceTree)a(c.instanceTree);else if(c.propertyDbError||"hasObjectProperties"in c)b&&b(c.propertyDbError);else{var d=function(){c.eventTarget.removeEventListener(e.OBJECT_TREE_CREATED_EVENT,d),c.eventTarget.removeEventListener(e.OBJECT_TREE_UNAVAILABLE_EVENT,d),c.getObjectTree(a,b)};c.eventTarget.addEventListener(e.OBJECT_TREE_CREATED_EVENT,d),c.eventTarget.addEventListener(e.OBJECT_TREE_UNAVAILABLE_EVENT,d)}},f.PropDbLoader=j,f.clearPropertyWorkerCache=c}(),function(){"use strict";var a=Autodesk.Viewing,b=a.Private,c=a.isNodeJS?10:a.isMobileDevice()?2:6,d=function(a){this.options={pageOutPercentage:b.PAGEOUT_PERCENTAGE,maxQueuedGeomPFForLoading:WGS.MAX_QUEUED_GEOM_PF_FOR_LOADING,pixelCullingEnable:WGS.pixelCullingEnable,pixelCullingThreshold:WGS.PIXEL_CULLING_THRESHOLD,onDemandLoading:b.onDemandLoading,pageOutGeometryEnabled:b.pageOutGeometryEnabled,minPackFiles:WGS.MIN_PACK_FILES,maxPackFiles:WGS.MAX_PACK_FILES,forceOnDemandLoading:WGS.forceOnDemandLoading},function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}(this.options,a),this.reachLimit=!1,this.geomidsmap={},this.geomTravCount=[],this.loadedPacks={},this.loadedPackslength=0,this.loadingPacks=[],this.queuedPacks=[],this.totalPackFiles=this.options.totalPackFiles,this.loadPackFileImpl=this.options.loadPackFileImpl,this.cancelLoadPackImpl=this.options.cancelLoadPackImpl;var c=!1;this.onDemandLoadingEnabled=function(){return!(!this.options.onDemandLoading||!this.loadPackFileImpl)&&(!!this.options.forceOnDemandLoading||this.totalPackFiles>this.options.maxPackFiles)},this.pageOutGeometryEnabled=function(){return this.options.pageOutGeometryEnabled&&this.onDemandLoadingEnabled()},this.pixelCullingEnable=function(){return this.options.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.pixelCullingThreshold},this.loadPackFile=function(a){return!(!this.onDemandLoadingEnabled()||this.reachLimit)&&(this.loadPackFileImpl(a),!0)},this.unloadPackFile=function(a,b){if(!this.onDemandLoadingEnabled())return!1;if(!this.loadedPacks[a]||!b)return!1;return b.geoms.forEach(function(c){c&&c.packId==a&&b.removeGeometry(c.svfid)}),delete this.loadedPacks[a],this.loadedPackslength--,!0},this.onPackFileLoaded=function(a){if(a){var c=a.packId;if(!this.loadedPacks[c]){var d=a.meshes.length;this.loadedPacks[c]={count:d,travsed:0,culled:0},this.loadedPackslength++}var e=this.loadingPacks.indexOf(c);e!=-1&&this.loadingPacks.splice(e,1),this.loadedPackslength>this.options.maxPackFiles&&b.logger.warn("More pack files being loaded than the max count: "+this.loadedPackslength)}},this.onPackFileLoading=function(a){this.loadingPacks.push(a)},this.onProcessReceivedMesh=function(a,b){var c=a.svfid;this.onDemandLoadingEnabled()&&b>1&&null==this.geomidsmap[c]&&(this.geomidsmap[c]=this.geomTravCount.length,this.geomTravCount.push(0))},this.loadedPackFileCount=function(){return this.loadedPackslength},this.preparedPackFilesCount=function(){return this.queuedPacks.length+this.loadingPacks.length+this.loadedPackFileCount()},this.reset=function(){var a=this.loadedPacks;for(var b in a)a[b].travsed=0,a[b].culled=0;this.cancelLoadPackImpl&&this.loadingPacks.length>0&&this.loadedPackslength>=this.options.maxPackFiles&&this.cancelLoadPackImpl(),this.loadingPacks.length=0,this.queuedPacks.length=0},this.geomPacksMissingLastFrame=function(){return this.queuedPacks},this.addGeomPackMissingLastFrame=function(a){if(this.pageOutGeometryEnabled()){if(this.preparedPackFilesCount()>=this.options.maxPackFiles)return this.reachLimit=!0,!1;if(this.queuedPacks.length>=this.options.maxQueuedGeomPFForLoading)return!1}return this.queuedPacks.indexOf(a)==-1&&this.queuedPacks.push(a),!0},this.needResumeNextFrame=function(){return c},this.pageOut=function(a,d,e){c=!1;var f=WGS.PAGEOUT_SUCCESS;if(!a)return f;var g=this.loadedPackFileCount();if(g&&(this.reachLimit||g>this.options.maxPackFiles)){var h=this.loadedPacks,i=Object.keys(h);i.sort(function(a,b){var c=.7*h[a].culled+.3*h[a].travsed;return.7*h[b].culled+.3*h[b].travsed-c});var j=this.options.maxPackFiles,g=Math.ceil(this.options.pageOutPercentage*j),k=0;return i.every(function(a){return h[a].culled+h[a].travsed>0&&(this.unloadPackFile(a,e),k++),k<g}.bind(this)),d&&0==k&&(this.unloadPackFile(i[0],e),k++,b.logger.log("A force page out occur.")),0==k?(f=WGS.PAGEOUT_FAIL,this.reachLimit=!0):(this.reachLimit=!1,c=!0),b.logger.log("[On Demand Loading] Unload pack files count: "+k),window&&window.gc&&window.gc(),f}return c=c||this.queuedPacks.length>0,f},this.onGeomTraversed=function(a){var b=a.packId,c=a.svfid;if(b>=this.options.minPackFiles){var d=!0,e=this.geomidsmap[c];null!=e&&(this.geomTravCount[e]++,d=a.instanceCount==this.geomTravCount[e]),d&&this.loadedPacks[b].travsed++}},this.onGeomCulled=function(a){if(a){var b=a.packId,c=a.svfid;if(b>=this.options.minPackFiles){var d=this.geomidsmap[c];null!=d?(this.geomTravCount[d]++,a.instanceCount==this.geomTravCount[d]&&this.loadedPacks[b].culled++):this.loadedPacks[b].culled++}}}},e=function(c){this.viewer3DImpl=c,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadedPacks=[],this.tmpMatrix=new THREE.Matrix4,this.tmpBox=new THREE.Box3,this.logger=b.logger,this.loadTime=0,this.domainParam=a.getUseCredentials()&&!a.isNodeJS?"domain="+encodeURIComponent(window.location.origin):""};e.prototype.dtor=function(){if(this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,b.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null,b.logger.debug("SVF loader dtor: on svf worker.")),this.pack_workers){for(var a=0;a<this.pack_workers.length;a++)this.pack_workers[a].clearAllEventListenerWithIntercept(),this.pack_workers[a].terminate();this.pack_workers=null,b.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.logger=null,this.domainParam=null,this.tmpMatrix=null,this.tmpBox=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadedPacks=[],this.loadTime=0,this.pagingProxy=null},e.prototype.isValid=function(){return null!=this.viewer3DImpl},b.pathToURL=function(a){if(a.indexOf("://")!==-1||0===a.indexOf("urn:"))return a;if("undefined"==typeof window)return a;var b=window.location.pathname,c=b.lastIndexOf("/");return b=b.substr(0,c+1),window.location.protocol+"//"+window.location.host+b+a},e.prototype.loadFile=function(a,c,d,e,f){if(!this.viewer3DImpl)return b.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return b.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var g=a.indexOf("urn:");if(g!=-1){a=decodeURIComponent(a);var h=a.substr(g,a.substr(g).indexOf("/"));b.logger.log("Extracted URN: "+h);var i=h.lastIndexOf(":");this.svfUrn=h.substr(i+1)}else this.svfUrn=a;this.sharedDbPath=c.sharedPropertyDbPath,this.currentLoadPath=a;var j=this.currentLoadPath.lastIndexOf("/");j!=-1&&(this.basePath=this.currentLoadPath.substr(0,j+1)),this.acmSessionId=c.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=c;var k=this;return this.initWorkerScriptToken=b.initWorkerScript(function(){k.loadSvfCB(a,c,d,e,f)}),!0},e.prototype.interceptManifest=void 0,e.prototype.loadSvfCB=function(d,e,f,g,h){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var i=!0,j=this,k={url:b.pathToURL(d),basePath:this.currentLoadPath,objectIds:e.ids,globalOffset:e.globalOffset,placementTransform:e.placementTransform,applyRefPoint:e.applyRefPoint,queryParams:this.queryParam,bvhOptions:e.bvhOptions||{isWeakDevice:a.isMobileDevice()},applyScaling:e.applyScaling,loadInstanceTree:e.loadInstanceTree};b.memoryOptimizedSvfLoading&&(k.perfOpt={memoryOptimizedSvfLoading:b.memoryOptimizedSvfLoading,forceMemoryOptimizedMode:b.forceMemoryOptimizedModeOnSvfLoading}),e.useConsolidation&&!e.bvhOptions&&(k.bvhOptions.frags_per_leaf_node=256,k.bvhOptions.max_polys_per_node=5e4);var l=this.svfWorker=b.createWorkerWithIntercept(),m=function(d){var e=function(){l.clearAllEventListenerWithIntercept(),l.terminate(),j.svfWorker=null,l=null};if(i&&h&&(i=!1,h()),d.data&&d.data.manifest)j.interceptManifest(d.data.manifest),k.operation="LOAD_SVF_CONTD",k.manifest=d.data.manifest,l.doOperation(k);else if(d.data&&d.data.svf){var m=j.svf=d.data.svf;j.failedToLoadSomeGeometryPacks&&(g&&g(j.failedToLoadSomeGeometryPacks.code,j.failedToLoadSomeGeometryPacks.msg),j.failedToLoadSomeGeometryPacks=null),j.onModelRootLoadDone(m),f&&f(j.model),j.viewer3DImpl.api.fireEvent({type:a.MODEL_ROOT_LOADED_EVENT,svf:m,model:j.model}),j.svf.loadDone=!1;var n=!1;if(j.svf.metadata&&j.svf.metadata.gltf&&(n=!0),!n){var o=m.geompacks.length;if(0==o)j.onGeomLoadDone();else if(j.model.getFragmentList().onDemandLoadingEnabled())b.logger.debug("[On Demand Loading]: Enabled."),j.loadedPacksCount=0;else if(o)for(var p=Math.min(o,c),q=0;q<p;q++){var r=m.geompacks[j.next_pack++];r.loading=!0,a.isNodeJS?j.loadGeometryPack(r.id,r.uri):function(a){setTimeout(function(){j.loadGeometryPack(a.id,a.uri)},200*q)}(r)}}1==d.data.progress&&(j.loading=!1,e()),m.fragments.polygonCounts||(m.fragments.polygonCounts=new Int32Array(m.fragments.length)),d.data.bvh&&(j.svf.bvh=d.data.bvh,j.model.setBVH(new b.NodeArray(j.svf.bvh.nodes,j.svf.bvh.useLeanNodes),j.svf.bvh.primitives,j.options.bvhOptions),j.viewer3DImpl.invalidate(!1,!0))}else d.data&&d.data.bvh?(j.svf.bvh||(j.svf.bvh=d.data.bvh,j.model.setBVH(new b.NodeArray(j.svf.bvh.nodes,j.svf.bvh.useLeanNodes),j.svf.bvh.primitives,j.options.bvhOptions),j.viewer3DImpl.invalidate(!1,!0)),j.loading=!1,e()):d.data&&d.data.mesh?(j.processReceivedMesh(d.data),1===d.data.progress&&(j.onGeomLoadDone(),j.loading=!1,e())):d.data&&d.data.progress?1==d.data.progress&&(j.loading=!1,e()):d.data&&d.data.error?(j.loading=!1,e(),g&&g(d.data.error.code,d.data.error.msg,d.data.error.args.httpStatus,d.data.error.args.httpStatusText)):d.data&&d.data.debug?b.logger.debug(d.data.message):(b.logger.error("SVF download failed.",a.errorCodeString(a.ErrorCodes.NETWORK_FAILURE)),j.loading=!1,e())};return l.addEventListenerWithIntercept(m),k.operation="LOAD_SVF",k.interceptManifest=!!this.interceptManifest,l.doOperation(b.initLoadContext(k)),!0},e.prototype.cancelGeometryPackLoading=function(){if(this.pack_workers&&this.isValid()){for(var a=0;a<this.pack_workers.length;a++)this.svf&&(this.svf.geompacks[this.pack_workers[a].packId].loading=!1),this.pack_workers[a].queued=0,this.pack_workers[a].clearAllEventListenerWithIntercept(),this.pack_workers[a].terminate();this.pack_workers=null}},e.prototype.loadGeometryPackOnDemand=function(d){if(this.svf&&this.isValid()){var e=this.svf.geompacks[d];if(!e.loading){this.t0||(this.t0=(new Date).getTime());var f,g=this.pagingProxy,h=this,i=function(c){if(c.data&&c.data.meshes){g.onPackFileLoaded(c.data);for(var d=c.data.meshes,e={packId:c.data.packId,meshIndex:0,mesh:null},f=0;f<d.length;f++){var i=d[f];i&&(e.meshIndex=f,e.mesh=i,h.processReceivedMesh(e))}if(c.data.progress>=1){h.pack_workers[c.data.workerId].queued-=1,h.svf.geompacks[c.data.packId].loading=!1;for(var j=!0,k=0;k<h.pack_workers.length;k++)if(0!=h.pack_workers[k].queued){j=!1;break}h.loadedPacks.indexOf(c.data.packId)==-1&&h.loadedPacks.push(c.data.packId),j&&0==h.model.geomPacksMissingLastFrame().length?h.onDemandGeomLoadDone():h.viewer3DImpl.invalidate(!1,!0)}}else if(c.data&&c.data.progress){h.pack_workers[c.data.workerId].queued-=1,h.loadedPacksCount++;var l,m=null,n=h.model.geomPacksMissingLastFrame();for(f=0;f<n.length&&(l=n[f],m=h.svf.geompacks[l],m.loading);++f);m&&!m.loading&&(n.splice(f,1),h.loadGeometryPackOnDemand(l)),h.viewer3DImpl.signalProgress(100*h.loadedPacks.length/h.svf.geompacks.length,a.ProgressState.LOADING)}else c.data&&c.data.debug?b.logger.debug(c.data.message):c.data&&c.data.error?h.failedToLoadSomeGeometryPacks={code:c.data.error.code,msg:c.data.error.msg}:(h.pack_workers[c.data.workerId].queued-=2,h.svf.geompacks[c.data.packId].loading=!1)};if(!this.pack_workers){this.pack_workers=[];var j=g.options.maxPackFiles<c?g.options.maxPackFiles:c;for(f=0;f<j;f++){var k=b.createWorkerWithIntercept();k.addEventListenerWithIntercept(i),k.queued=0,this.pack_workers.push(k)}}var l=0,m=this.pack_workers[0].queued;for(f=1;f<this.pack_workers.length;f++)this.pack_workers[f].queued<m&&(l=f,m=this.pack_workers[f].queued);if(m>1||g.preparedPackFilesCount()>=g.options.maxPackFiles)return void(this.model.addGeomPackMissingLastFrame(d)||this.viewer3DImpl.invalidate(!1,!0));var n,o,p=e.uri;n=this.pack_workers[l],n.queued+=2,n.packId=d,o=l,g.onPackFileLoading(d),e.loading=!0,h.svf.partPacksLoadDone=!1,b.logger.debug("[On Demand Loading] Loading Geometry Pack file: "+d);var q=b.pathToURL(this.svf.basePath+p),r={operation:"LOAD_GEOMETRY",url:q,packId:parseInt(d),workerId:o,packNormals:this.options.packNormals,skipAssetCallback:!0,queryParams:this.queryParam};n.doOperation(b.initLoadContext(r))}}},e.prototype.loadGeometryPack=function(d,e){var f,g,h,i,j=this;if(this.svf&&this.isValid()){var k=function(c){if(c.data&&c.data.meshes){for(var d=c.data.meshes,e={packId:c.data.packId,meshIndex:0,mesh:null},f=0;f<d.length;f++){var g=d[f];g&&(e.meshIndex=f,e.mesh=g,j.processReceivedMesh(e))}if(c.data.progress>=1){j.pack_workers[c.data.workerId].queued-=1,j.loadedPacksCount++,j.viewer3DImpl.signalProgress(100*j.loadedPacksCount/j.svf.geompacks.length,a.ProgressState.LOADING);var h=!0;for(i=0;i<j.pack_workers.length;i++)if(0!=j.pack_workers[i].queued){h=!1;break}if(h){for(i=0;i<j.pack_workers.length;i++)j.pack_workers[i].clearAllEventListenerWithIntercept(),j.pack_workers[i].terminate();j.pack_workers=null}j.loadedPacksCount+j.failedToLoadPacksCount==j.svf.geompacks.length&&j.onGeomLoadDone()}}else if(c.data&&c.data.progress){if(j.pack_workers[c.data.workerId].queued-=1,j.next_pack<j.svf.geompacks.length){var k=null,l=j.model.geomPacksMissingLastFrame();for(f=0;f<l.length&&(!(k=j.svf.geompacks[l[f]])||k.loading);++f);if(!k||k.loading)for(;j.next_pack<j.svf.geompacks.length&&(k=j.svf.geompacks[j.next_pack++],k.loading););k&&!k.loading?(k.loading=!0,j.loadGeometryPack(k.id,k.uri)):(j.viewer3DImpl.modelQueue().enforceBvh=!1,j.svf.fragments.packIds=null)}}else c.data&&c.data.debug?b.logger.debug(c.data.message):c.data&&c.data.error?(++j.failedToLoadPacksCount,j.failedToLoadSomeGeometryPacks={code:c.data.error.code,msg:c.data.error.msg}):j.pack_workers[c.data.workerId].queued-=2},l=this.pack_workers;if(l||(l=this.pack_workers=[]),l.length<c){for(var m=!0,h=0;h<l.length;h++)if(0===l.queued){m=!1;break}if(m){var n=b.createWorkerWithIntercept();n.addEventListenerWithIntercept(k),n.queued=0,l.push(n)}}var o=0,p=l[0].queued;for(h=1;h<l.length;h++)l[h].queued<p&&(o=h,p=l[h].queued);f=l[o],f.queued+=2,g=o;var q=b.pathToURL(this.svf.basePath+e),r={operation:"LOAD_GEOMETRY",url:q,packId:parseInt(d),workerId:g,packNormals:this.options.packNormals,queryParams:this.queryParam};f.doOperation(b.initLoadContext(r))}},e.prototype.checkCull=function(a,b,c){var d=this.tmpBox;if(a.getWorldBounds(b,d),!c.intersectsBox(d))return!0;var e=c.projectedArea(d);return(e*=c.areaConv)<c.areaCullThreshold},e.prototype.processReceivedMesh=function(a){var c=a.packId+":"+a.meshIndex,d=this.svf,e=d.fragments,f=this.model,g=e.mesh2frag[c];if(void 0===g)return void b.logger.warn("Mesh "+c+" was not referenced by any fragments.");Array.isArray(g)||(g=[g]),b.BufferGeometryUtils.meshToGeometry(a),a.geometry.packId=a.packId;var h=g.length,i=f.getFragmentList().getGeometryId(g[0]);f.getGeometryList().addGeometry(a.geometry,h,i);this.pagingProxy.onProcessReceivedMesh(a.geometry,h);for(var j=a.geometry.attributes.index.array||a.geometry.ib,k=j.length/3,l=0;l<g.length;l++){var m=0|g[l];f.getFragmentList().getOriginalWorldMatrix(m,this.tmpMatrix);var n=e.materials[m].toString();e.polygonCounts&&(e.polygonCounts[m]=k);var o=this.viewer3DImpl.setupMesh(this.model,a.geometry,n,this.tmpMatrix);f.activateFragment(m,o,!!d.placementTransform)}this.model.getFragmentList().onDemandLoadingEnabled()||(e.mesh2frag[c]=null),e.numLoaded+=g.length,f.getGeometryList().geomPolyCount>d.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),d.numRepaints++,d.nextRepaintPolys+=1e4*Math.pow(1.5,d.numRepaints),this.viewer3DImpl.invalidate(!1,!0))},e.prototype.onModelRootLoadDone=function(c){this.viewer3DImpl._removeLoadingFile(this),c.geomMemory=0,c.fragments.numLoaded=0,c.gpuNumMeshes=0,c.gpuMeshMemory=0,c.nextRepaintPolys=0,c.numRepaints=0,c.urn=this.svfUrn,c.acmSessionId=this.acmSessionId,c.basePath=this.basePath,c.loadOptions=this.options;var e=Date.now();this.loadTime+=e-this.t0,b.logger.log("SVF load: "+(e-this.t0));var f=this.model=new a.Model(c);f.loader=this;var g=this.viewer3DImpl.api.config?this.viewer3DImpl.api.config.memPerfOpts||{}:{};this.viewer3DImpl.modelQueue().getModels().length>0&&(g.pageOutGeometryEnabled=!1),g.totalPackFiles=c.geompacks.length,g.loadPackFileImpl=this.loadGeometryPackOnDemand.bind(this),g.cancelLoadPackImpl=this.cancelGeometryPackLoading.bind(this),this.pagingProxy=new d(g),f.initialize(this.pagingProxy),!(this.model.getFragmentList().onDemandLoadingEnabled()&&a.isMobileDevice())&&!this.options.skipPropertyDb&&this.loadPropertyDb();var h=this.convertMaterials(f);if(this.t0=e,c.bbox=(new THREE.Box3).copy(c.bbox),c.modelBox&&(c.modelBox=(new THREE.Box3).copy(c.modelBox)),c.refPointTransform&&(c.refPointTransform=new LmvMatrix4(!0).copy(c.refPointTransform)),c.placementTransform&&(c.placementTransform=new LmvMatrix4(!0).copy(c.placementTransform)),c.cameras)for(var i=0;i<c.cameras.length;i++){var j=c.cameras[i];j.position=(new THREE.Vector3).copy(j.position),j.target=(new THREE.Vector3).copy(j.target),j.up=(new THREE.Vector3).copy(j.up)}c.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&this.viewer3DImpl.matman().loadTextures(this.model),b.logger.log("scene bounds: "+JSON.stringify(c.bbox));var k={category:"metadata_load_stats",urn:c.urn,has_topology:!!c.topology,has_animations:!!c.animations,cameras:c.cameras?c.cameras.length:0,lights:c.lights?c.lights.length:0,materials:h,is_mobile:a.isMobileDevice()};c.topologyTooBig&&(k.has_topology=!0,k.topologyTooBig=!0),b.logger.track(k),this.viewer3DImpl.signalProgress(5,a.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},e.prototype.convertMaterials=function(a){var c=this.viewer3DImpl.matman(),d=a.getData(),e=0;if(!d.materials)return e;if(d.gltfMaterials){var f=d.materials.materials;for(var g in f){var h=f[g],i=b.MaterialConverter.convertMaterialGltf(h,d),j=c._getMaterialHash(a,g);c.addMaterial(j,i,!1),e++}return e}var k=d.materials.materials,l=d.proteinMaterials?d.proteinMaterials.materials:null;for(var g in k){var m=!1;l&&(m=b.MaterialConverter.isPrismMaterial(l[g]));var n=m?l[g]:k[g],o=n.userassets,p=n.materials,q=p[o[0]];n.transparent=q.transparent,c.convertOneMaterial(a,n,g,m),e++}return c.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0),e},e.prototype.makeBVH=function(c){var d=performance.now(),e=c.materials?c.materials.materials:null;c.bvh=new b.BVHBuilder(c.fragments,e),c.bvh.build(this.options.bvhOptions||{isWeakDevice:a.isMobileDevice()});var f=performance.now();b.logger.log("BVH build time: "+(f-d))},e.prototype.onDemandGeomLoadDone=function(){!this.svf.proteinMaterials||!PROTEIN_ROOT||PRISM_ROOT;var a=Date.now(),c="[On Demand Loading] On demand requested geometries load time: "+(a-this.t0);b.logger.log(c);var d={category:"on_demand_geom_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:a-this.t0,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),load_pack_count:this.loadedPacksCount,urn:this.svfUrn};b.logger.track(d,!0),this.t0=null,this.loadedPacksCount=0,this.svf.partPacksLoadDone=!0,this.viewer3DImpl.onDemandLoadComplete(this.model)},e.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||this.viewer3DImpl.matman().loadTextures(this.model),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var c=Date.now(),d="Fragments load time: "+(c-this.t0);this.loadTime+=c-this.t0;var e=this.firstPixelTimestamp-this.t0;if(d+=" (first pixel time: "+e+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions)),b.logger.log(d),this.options.useConsolidation){var f=this.viewer3DImpl.glrenderer();this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,f)}var g={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};e>0&&(g.first_pixel_time=e),b.logger.track(g,!0),b.assets&&a.isBrowser&&window.webkit&&(!function(b){var c={command:"assets",data:b};a.isBrowser&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage(c)}(b.assets),b.assets=null),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},e.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new b.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},b.SvfLoader=e,b.SvfPagingProxy=d,a.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],b.SvfLoader)}(),function(){"use strict";function a(a){this.viewer3DImpl=a,this.loading=!1,this.tmpMatrix=new THREE.Matrix4,this.logger=c.logger,this.loadTime=0,this.domainParam=b.getUseCredentials()&&!b.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"",this.useInstancing=this.viewer3DImpl.use2dInstancing}var b=Autodesk.Viewing,c=b.Private,d="PARSE_F2D_FRAME",e=1,f=2,g=4,h=8,i=function(a,b){function i(a){for(;++a<l.length&&(l[a]&(g|h))!=g;);return a}function j(a){var b=0;if(k.model){var c=k.model.getGeometryList();c&&(b=c.numGeomsInMemory)}for(var g=i(p);b+o<a.max2DPersistentBufferCount;){var j=-1,m=null;if(n.length>0&&(t||g>l.length))m=n.shift(),
j=m.lmv_buffer_id;else{if(!(g<l.length))break;j=g,p=g,g=i(g),t=!0}k.parsingWorker.doOperation({operation:d,bufferId:j,rendered:!!(l[j]&e),promised:!!(l[j]&f),conditional:!!(l[j]&h)}),l[j]&h||(o+=1,l[j]|=h)}}var k=a;this.options={max2DPersistentBufferCount:c.MAX_2D_PERSISTENT_BUFFER_COUNT,pageOutCount2D:c.PAGE_OUT_COUNT_2D,pageOutGoal2D:c.PAGE_OUT_GOAL_2D,instancingFactor:1,pixelCullingEnable:WGS.pixelCullingEnable,pixelCullingThreshold:WGS.PIXEL_CULLING_THRESHOLD,onDemandLoading:c.onDemandLoading,pageOutGeometryEnabled:c.pageOutGeometryEnabled,forceOnDemandLoading:WGS.forceOnDemandLoading},function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}(this.options,b),this.options.max2DPersistentBufferCount*=this.options.instancingFactor,this.options.pageOutCount2D*=this.options.instancingFactor,this.options.pageOutGoal2D*=this.options.instancingFactor,this.options.pageOutGeometryEnabled=this.options.onDemandLoading,this.options.fragsPersistentCount=0,this.options.fragsPersistentMaxCount=this.options.max2DPersistentBufferCount,this.options.geomCountLimit=0|this.options.pageOutCount2D;var l=[],m={},n=[],o=0,p=-1,q=-1,r=-1,s=0,t=!0,u=0,v=!1,w=[];this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.onDemandLoading},this.pixelCullingEnable=function(){return this.options.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.pixelCullingThreshold},this.loadPackFile=function(a){return!!this.onDemandLoadingEnabled()&&(!(a<0||v&&a>=u)&&(a>r&&(r=a),l[a]&e||(a<=p&&this.reset(),l[a]|=g|e),j(this.options),!0))},this.promisePackFile=function(a){if(!this.onDemandLoadingEnabled())return Promise.reject({reason:"Not supported"});if(a<0||a>=u)return Promise.reject({reason:"Buffer id out of bounds"});var b=m[a];if(b)return j(this.options),b;var c,d;return b=new Promise(function(a,b){c=a,d=b}),b.lmv_resolve=c,b.lmv_reject=d,b.lmv_buffer_id=a,n.push(b),m[a]=b,l[a]|=g|f,j(this.options),b},this.cancelPromisedPackFile=function(a){if(!a||!a.hasOwnProperty("lmv_buffer_id")||m[a.lmv_buffer_id]!=a)return!1;var b=n.indexOf(a);b>=0&&n.splice(b,1);var c=l[a.lmv_buffer_id];return c&h&&(k.parsingWorker.doOperation({operation:d,cancelPromise:a.lmv_buffer_id}),c&e||(o-=1)),c&e?c&=~f:c=0,l[a.lmv_buffer_id]=c,delete m[a.lmv_buffer_id],a.lmv_reject&&a.lmv_reject({canceled:!0}),j(this.options),!0},this.reset=function(){k.parsingWorker.doOperation({operation:d,cancel:!0}),o=0;for(var a=0;a<l.length;++a)l[a]&f?(l[a]&=~e,l[a]&h&&++o):l[a]=0;p=-1,q=-1,w.length=0,r=u-1,++s},this.addGeomPackMissingLastFrame=function(a){return!0},this.needResumeNextFrame=function(){return!1},this.pageOut=function(a,b,c){var d=c.numGeomsInMemory;if(d>this.options.geomCountLimit){var e=0,f=0|d-this.options.pageOutGoal2D;if(w.splice(0,f).forEach(function(a){c.removeGeometry(a)>0&&--f}),f>0)for(e=c.geoms.length;--e>=0&&!(e<=this.options.fragsPersistentCount)&&!((e<=q||e>p)&&c.removeGeometry(e)>0&&--f<=0););if(d=c.numGeomsInMemory-this.options.geomCountLimit,b&&d>0)for(e=p;e>=0&&!(e<=this.options.fragsPersistentCount)&&!(c.removeGeometry(e)>0&&--d<=0);--e);window&&window.gc&&window.gc()}if(a&&!v){var g=this.options.fragsPersistentMaxCount-c.numGeomsInMemory;if(g>0)for(var h=p;--g>=0;)this.loadPackFile(++h)}return WGS.PAGEOUT_SUCCESS},this.onGeomTraversed=function(a){q=a.svfid-1},this.onGeomCulled=function(a){this.onDemandLoadingEnabled()&&a&&w.push(a.svfid-1)},this.onMeshReceived=function(a,b){if(!this.onDemandLoadingEnabled())return!0;var c=m[b];if(c){c.lmv_resolve&&c.lmv_resolve(),delete m[b];var d=n.indexOf(c);d>=0&&n.splice(d,1)}return!!(l[b]&h&&(0==s||l[b]&f))&&(b>=u&&(u=b+1),l[b]&e&&k.viewer3DImpl.invalidate(!1,!0),l[b]=0,--o,!0)},this.onFinalFrame=function(){this.onDemandLoadingEnabled()&&(v=!0,l.splice(u,l.length).forEach(function(a){a&h&&--o}))},this.cancelAcknowledged=function(){--s}};a.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,c.logger.debug("F2D loader dtor: on init worker script.")),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,c.logger.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,c.logger.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.domainParam=null,this.loadTime=0,this.svf=null,this.options=null,this.pagingProxy=null},a.prototype.isValid=function(){return null!=this.viewer3DImpl},a.prototype.loadFile=function(a,b,d,e,f){if(!this.viewer3DImpl)return c.logger.log("F2D loader was already destructed. So no longer usable."),!1;if(this.loading)return c.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var g=a.indexOf("urn:");if(g!=-1){a=decodeURIComponent(a);var h=a.substr(g,a.substr(g).indexOf("/"));c.logger.log("Extracted URN: "+h);var i=h.lastIndexOf(":");this.svfUrn=h.substr(i+1)}else this.svfUrn=a;this.sharedDbPath=b.sharedPropertyDbPath,this.currentLoadPath=a,this.acmSessionId=b.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=b,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0;var j=this,k=this.memPerfOpts=this.viewer3DImpl.api.config?this.viewer3DImpl.api.config.memPerfOpts||{}:{};return(!k.hasOwnProperty("max2DPersistentBufferCount")||k.max2DPersistentBufferCount<=0)&&(k.max2DPersistentBufferCount=c.MAX_2D_PERSISTENT_BUFFER_COUNT),k.instancingFactor=this.useInstancing?4:1,k.hasOwnProperty("forceOnDemandLoading")||(k.forceOnDemandLoading=WGS.forceOnDemandLoading),k.hasOwnProperty("onDemandLoading")||(k.onDemandLoading=c.onDemandLoading),k.hasOwnProperty("pageOutGeometryEnabled")||(k.pageOutGeometryEnabled=c.pageOutGeometryEnabled),k.hasOwnProperty("pixelCullingEnable")||(k.pixelCullingEnable=WGS.pixelCullingEnable),this.initWorkerScriptToken=c.initWorkerScript(function(){j.loadFydoCB(a,b,d,e,f)}),!0},a.prototype.loadFydoCB=function(a,e,f,g,h){this.t0=Date.now();var i=c.pathToURL(a);this.streamingWorker=c.createWorker(),this.parsingWorker=c.createWorker();var j=this,k=!0,l=function(){j.memPerfOpts.onDemandLoading||(j.parsingWorker.terminate(),j.parsingWorker=null)},m=function(a){if(j.isValid()){var f=function(a,b){if(a){var c=a.geom_metrics,d=3*(c.arcs+c.circ_arcs);d+=c.circles,d+=c.pline_points-(c.plines||0),d+=c.rasters,d+=c.ptri_indices/3*3,d*=4,d+=c.ptri_points;d/=b?16383:32767;var e=j.memPerfOpts;e.onDemandLoading&&!e.forceOnDemandLoading&&d<e.max2DPersistentBufferCount*e.instancingFactor&&(e.onDemandLoading=!1,e.pageOutGeometryEnabled=!1)}return j.memPerfOpts.onDemandLoading};if(k&&h&&(k=!1,h()),a.data&&"F2DBLOB"==a.data.type){f(a.data.metadata,b.isMobileDevice());var l={operation:"PARSE_F2D",data:a.data.buffer,metadata:a.data.metadata,manifest:a.data.manifest,basePath:a.data.basePath,f2dLoadOptions:{modelSpace:e.modelSpace,bgColor:e.bgColor,isMobile:b.isMobileDevice(),useInstancing:j.useInstancing,onDemandLoading:j.memPerfOpts.onDemandLoading},url:i};j.parsingWorker.doOperation(l,[l.data]),j.streamingWorker.terminate(),j.streamingWorker=null}else if(a.data&&"F2DSTREAM"==a.data.type){f(a.data.metadata,b.isMobileDevice());var l={operation:d,data:a.data.frames,url:i,f2dLoadOptions:{modelSpace:e.modelSpace,bgColor:e.bgColor,isMobile:b.isMobileDevice(),useInstancing:j.useInstancing,onDemandLoading:j.memPerfOpts.onDemandLoading}};a.data.metadata&&(l.metadata=a.data.metadata,l.manifest=a.data.manifest),a.data.finalFrame&&(l.finalFrame=!0),a.data.finalFrame&&(j.streamingWorker.terminate(),j.streamingWorker=null),a.data.progress&&j.viewer3DImpl.signalProgress(100*a.data.progress,b.ProgressState.LOADING),j.parsingWorker.doOperation(l,l.data?[l.data]:void 0)}else a.data&&"F2DAssetURL"==a.data.type?c.assets=c.assets.concat(a.data.urls):a.data&&a.data.assetRequest?c.assets.push(a.data.assetRequest):a.data&&a.data.progress||(a.data&&a.data.debug?c.logger.debug(a.data.message):a.data&&a.data.error?(j.loading=!1,j.streamingWorker.terminate(),j.streamingWorker=null,g&&g.call(this,a.data.error.code,a.data.error.msg,a.data.error.args.httpStatus,a.data.error.args.httpStatusText)):(c.logger.error("F2D download failed.",b.errorCodeString(b.ErrorCodes.NETWORK_FAILURE)),j.loading=!1,j.streamingWorker.terminate(),j.streamingWorker=null))}},n=function(a){if(j.isValid())if(k&&h&&(k=!1,h()),a.data&&a.data.f2d){var d=j.svf=a.data.f2d;l(),c.logger.info("Num polylines: "+d.numPolylines),c.logger.info("Line segments: "+d.numLineSegs),c.logger.info("Circular arcs: "+d.numCircles),c.logger.info("Ellipitcal arcs:"+d.numEllipses),c.logger.info("Plain triangles:"+d.numTriangles),c.logger.info("Total # of op codes generated by fydo.parse: "+d.opCount),j.onModelRootLoadDone(j.svf),f&&f(j.model),j.viewer3DImpl.api.fireEvent({type:b.MODEL_ROOT_LOADED_EVENT,svf:j.svf,model:j.model});for(var e=0;e<d.meshes.length;e++)j.processReceivedMesh2D(d.meshes[e],e);d.meshes=null,j.onGeomLoadDone(),j.loading=!1}else if(a.data&&a.data.f2dframe){var i=0;if(a.data.meshes){var m=a.data.bbox;j.svf.bbox=new THREE.Box3(m.min,m.max),i=a.data.baseIndex}else j.svf=a.data.f2dframe,i=a.data.baseIndex;var d=j.svf;if(d.fragments&&d.fragments.initialized||(j.onModelRootLoadDone(d),f&&f(j.model),j.viewer3DImpl.api.fireEvent({type:b.MODEL_ROOT_LOADED_EVENT,svf:d,model:j.model})),a.data.meshes&&a.data.meshes.length)for(var e=0;e<a.data.meshes.length;e++)j.processReceivedMesh2D(a.data.meshes[e],i+e);if(a.data.finalFrame){var n=a.data.cumulativeProps;for(var o in n)d[o]=n[o];l(),j.onGeomLoadDone(),j.loading=!1,j.pagingProxy&&j.pagingProxy.onFinalFrame()}}else a.data&&a.data.progress||(a.data&&a.data.debug?c.logger.debug(a.data.message):a.data&&a.data.canceled&&j.pagingProxy?j.pagingProxy.cancelAcknowledged():a.data&&a.data.error?(j.loading=!1,l(),c.logger.error("Error while parsing F2d: "+JSON.stringify(a.data.error.args),b.errorCodeString(b.ErrorCodes.BAD_DATA)),g&&g.call(this,a.data.error.code,a.data.error.msg,a.data.error.args.httpStatus,a.data.error.args.httpStatusText)):(c.logger.error("F2D download failed.",b.errorCodeString(b.ErrorCodes.NETWORK_FAILURE)),j.loading=!1,l()))};this.streamingWorker.addEventListener("message",m,!1),this.parsingWorker.addEventListener("message",n,!1);var o={operation:"STREAM_F2D",url:i,objectIds:e.ids,queryParams:this.queryParam};return this.streamingWorker.doOperation(c.initLoadContext(o)),!0},a.prototype.processReceivedMesh=function(a){var b=a.packId+":"+a.meshIndex,d=this.svf,e=d.fragments,f=e.mesh2frag[b];if(void 0===f)return void c.logger.warn("Mesh "+b+" was not referenced by any fragments.");Array.isArray(f)||(f=[f]),c.BufferGeometryUtils.meshToGeometry(a);for(var g=f.length,h=this.model,i=(h.getGeometryList().addGeometry(a.geometry,g,a.meshIndex+1),a.geometry.attributes.index.array||a.geometry.ib),j=i.length/3,k=0;k<f.length;k++){var l=0|f[k];h.getFragmentList().getOriginalWorldMatrix(l,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var m=e.materials[l].toString();e.polygonCounts&&(e.polygonCounts[l]=j);var n=this.viewer3DImpl.setupMesh(this.model,a.geometry,m,this.tmpMatrix);h.activateFragment(l,n)}e.mesh2frag[b]=null,e.numLoaded+=f.length;e.numLoaded},a.prototype.processReceivedMesh2D=function(a,b){if(!this.pagingProxy||this.pagingProxy.onMeshReceived(a,b)){var c={mesh:a,is2d:!0,packId:"0",meshIndex:b},d="0:"+b,e=this.svf.fragments;if(!e.fragId2dbId[b]){var f=Object.keys(c.mesh.dbIds).map(function(a){return parseInt(a)});e.fragId2dbId[b]=f;for(var g=0;g<f.length;g++){var h=f[g],i=e.dbId2fragId[h];Array.isArray(i)?i.push(b):e.dbId2fragId[h]=void 0!==i?[i,b]:b}a.material.modelScale=this.modelScale;var j=this.viewer3DImpl;e.materials[b]=this.viewer3DImpl.matman().create2DMaterial(this.model,a.material,!1,!1,function(){j.invalidate(!1,!0,!1)}),e.length++}e.mesh2frag[d]=b,this.processReceivedMesh(c)}},a.prototype.onModelRootLoadDone=function(a){this.viewer3DImpl._removeLoadingFile(this),a.fragments={},a.fragments.mesh2frag={},a.fragments.materials=[],a.fragments.fragId2dbId=[],a.fragments.dbId2fragId=[],a.fragments.length=0,a.fragments.initialized=!0,a.geomMemory=0,a.fragments.numLoaded=0,a.gpuNumMeshes=0,a.gpuMeshMemory=0,a.nextRepaintPolys=1e4,a.numRepaints=0,a.urn=this.svfUrn,a.acmSessionId=this.acmSessionId,a.basePath="";var d=this.currentLoadPath.lastIndexOf("/");d!=-1&&(a.basePath=this.currentLoadPath.substr(0,d+1)),a.loadOptions=this.options;var e=Date.now();this.loadTime+=e-this.t0,c.logger.log("SVF load: "+(e-this.t0)),this.t0=e,a.bbox=(new THREE.Box3).copy(a.bbox);var f=this.model=new b.Model(a);f.loader=this;var g=this.memPerfOpts;this.viewer3DImpl.modelQueue().getModels().length>0&&(g.pageOutGeometryEnabled=!1),g.pageOutPercentage=g.pageOutPercentage>0&&g.pageOutPercentage<1?g.pageOutPercentage:c.PAGEOUT_PERCENTAGE,(g.onDemandLoading||g.pixelCullingEnable)&&(this.pagingProxy=new i(this,g)),f.initialize(this.pagingProxy),!(this.model.getFragmentList().onDemandLoadingEnabled()&&b.isMobileDevice())&&!this.options.skipPropertyDb&&(this.svf.propDbLoader=new c.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)),c.logger.log("scene bounds: "+JSON.stringify(a.bbox));var h={category:"metadata_load_stats",urn:a.urn,layers:a.layerCount};c.logger.track(h),this.viewer3DImpl.signalProgress(5,b.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},a.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.memPerfOpts.onDemandLoading||(this.svf.fragments.mesh2frag=null);var a=Date.now(),d="Fragments load time: "+(a-this.t0);this.loadTime+=a-this.t0,this.options.skipPropertyDb||this.loadPropertyDb(),c.logger.log(d);var e={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};c.logger.track(e,!0),c.assets&&b.isBrowser&&window.webkit&&(!function(a){if(b.isBrowser){var c=window.webkit.messageHandlers.callbackHandler;c.doOperation?c.doOperation({command:"assets",data:a}):c.postMessage&&c.postMessage({command:"assets",data:a})}}(c.assets),c.assets=null),this.currentLoadPath=null,this.isf2d=void 0,this.memPerfOpts.onDemandLoading?this.viewer3DImpl.onDemandLoadComplete(this.model):this.viewer3DImpl.onLoadComplete(this.model)},a.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},c.F2DLoader=a,c.F2DPagingProxy=i,b.FileLoaderManager.registerFileLoader("f2d",["f2d"],c.F2DLoader)}(),function(){"use strict";function a(a){var d=a;this.loadFile=function(a,e,f,g,h){function i(){function g(c){this.bbox=new THREE.Box3,this.basePath=a,this.is2d=!0;var e=c&&c.paperWidth>=0?c.paperWidth:k.texWidth,f=c&&c.paperHeight>=0?c.paperHeight:k.texHeight;this.pageToModelTransform=k.getPageToModelTransform(e,f),this.metadata=new Object,this.metadata.page_dimensions=new Object;var g=this.metadata.page_dimensions;g.page_width=e,g.page_height=f,g.page_units=c.paperUnits,this.loadDone=!0,this.isLeaflet=!0,d.signalProgress(100,b.ProgressState.LOADING),k.texWidth>0&&(this.maxPixelPerUnit=k.texWidth/k.getQuadWidth())}var h=new g(e.loadOptions);h.loadOptions=e,l.getVisibleBounds(h.bbox);var i=new b.Model(h);i.initFromCustomIterator(l),l.callWhenRefined(function(){var a=Date.now();h.loadTime=a-j,c.logger.log("SVF load: "+h.loadTime)}.bind(this)),f(i)}var j=Date.now(),k=new c.TexQuadConfig;k.initFromLoadOptions(a,e.loadOptions,function(a,b,d){c.loadTextureWithSecurity(a,THREE.UVMapping,b,e.acmSessionId)});var l=null;h&&h();var m=!k.valid();m&&k.initForSimpleImage(a,i),k.pixelRatio=d.glrenderer().getPixelRatio(),l=new c.ModelIteratorTexQuad(k,d.getMaterials()),m||i()}}var b=Autodesk.Viewing,c=Autodesk.Viewing.Private;a.computeLevelOffset=function(a){for(var b=1,d=0,e=0;e<20;e++){if((b*=2)>a)return d;d++}return c.logger.log("unexpected leaflet tileSize"),0},Autodesk.Viewing.Private.LeafletLoader=a,Autodesk.Viewing.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],c.LeafletLoader)}(),function(){"use strict";function a(a,b,c){var d=b||65536;this.FULL_COUNT=0|(c||32767),this.useInstancing=a,this.stride=12,this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?d/4:d)),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(d),this.reset(0)}var b=Autodesk.Viewing,c=b.Private,d=2*Math.PI,e=[0,1,3,0,3,2];a.prototype.reset=function(a){this.vcount=a,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-(1/0),this.dbIds={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0},a.prototype.expandStride=function(){},a.prototype.addToBounds=function(a,b){a<this.minx&&(this.minx=a),a>this.maxx&&(this.maxx=a),b<this.miny&&(this.miny=b),b>this.maxy&&(this.maxy=b)},a.prototype.setCommonVertexAttribs=function(a,b,c,d,e,f,g,h){b&=255,c&=255,h&=255,f&=65535,g&=65535,this.vbi[a+8]=b|c<<8|h<<16,this.vbi[a+6]=d,this.vbi[a+7]=e,this.vbi[a+9]=f|g<<16,this.dbIds[e]=1},a.prototype.addVertexTriangleGeom=function(a,b,c,d,e,f,g,h,i,j){for(var k=this.vcount,l=this.vbf,m=this.useInstancing?1:4,n=0;n<m;n++){var o=(k+n)*this.stride;l[o]=a,l[o+1]=b,l[o+2]=c,l[o+3]=d,l[o+4]=e,l[o+5]=f,this.setCommonVertexAttribs(o,0+n,5,g,h,i,j,0),this.vcount++}return k},a.prototype.addVertexLine=function(a,b,c,d,e,f,g,h,i,j,k){for(var l=this.vcount,m=this.vbf,n=this.useInstancing?1:4,o=0;o<n;o++){var p=(l+o)*this.stride;m[p]=a,m[p+1]=b,m[p+2]=c,m[p+3]=d,m[p+4]=.5*f,m[p+5]=e,this.setCommonVertexAttribs(p,0+o,1,g,h,i,j,k),this.vcount++}return l},a.prototype.addVertexTexQuad=function(a,b,c,d,e,f,g,h,i){for(var j=this.vcount,k=this.vbf,l=this.useInstancing?1:4,m=0;m<l;m++){var n=(j+m)*this.stride;k[n]=a,k[n+1]=b,k[n+2]=e,k[n+3]=c,k[n+4]=d,this.setCommonVertexAttribs(n,0+m,4,f,g,h,i,0),this.vcount++}return j},a.prototype.addVertexArc=function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m=this.vcount,n=this.vbf,o=e==f?2:3,p=this.useInstancing?1:4,q=0;q<p;q++){var r=(m+q)*this.stride;n[r]=a,n[r+1]=b,n[r+2]=c,n[r+3]=d,n[r+4]=.5*h,n[r+5]=e,3===o&&(n[r+10]=f,n[r+11]=g),this.setCommonVertexAttribs(r,0+q,o,i,j,k,l,0),this.vcount++}return m},a.prototype.addVertex=function(a,b,c,d,e,f){if(!this.useInstancing){var g=this.vcount,h=this.stride*g,i=this.vbf;return i[h]=a,i[h+1]=b,this.setCommonVertexAttribs(h,0,0,c,d,e,f,0),this.vcount++,g}},a.prototype.addVertexPolytriangle=function(a,b,c,d,e,f){this.useInstancing||(this.addVertex(a,b,c,d,e,f),this.addToBounds(a,b))},a.prototype.addIndices=function(a,b){if(!this.useInstancing){var c=this.ib,d=this.icount;if(d+a.length>=c.length){for(var e=new Uint16Array(2*Math.max(a.length,c.length)),f=0;f<d;++f)e[f]=c[f];this.ib=c=e}for(var f=0;f<a.length;++f)c[d+f]=b+a[f];this.icount+=a.length}},a.prototype.finalizeQuad=function(a){this.useInstancing||this.addIndices(e,a)},a.prototype.addSegment=function(a,b,c,d,e,f,g,h,i,j,k){var l=c-a,m=d-b,n=l||m?Math.atan2(m,l):0,o=l||m?Math.sqrt(l*l+m*m):0,p=this.addVertexLine(a,b,n,o,e,f,g,h,i,j,k);this.finalizeQuad(p),this.addToBounds(a,b),this.addToBounds(c,d)},a.prototype.addTriangleGeom=function(a,b,c,d,e,f,g,h,i,j){this.numTriangleGeoms++;var k=this.addVertexTriangleGeom(a,b,c,d,e,f,g,h,i,j);this.finalizeQuad(k),this.addToBounds(a,b),this.addToBounds(c,d),this.addToBounds(e,f)},a.prototype.addArc=function(a,b,c,e,g,h,i,j,k,l,m,n){g==h?this.numCirculars++:this.numEllipticals++;var o=f(c,e);c=o.start,e=o.end,0==c&&0==e&&(e=d);var p=Math.abs(c-e);if(p>1e-4&&Math.abs(p-d)>1e-4){var q=a+g*Math.cos(c),r=b+h*Math.sin(c);this.addSegment(q,r,q,r,0,j,k,l,m,n);var s=a+g*Math.cos(e),t=b+h*Math.sin(e);this.addSegment(s,t,s,t,0,j,k,l,m,n)}else this.addToBounds(a-g,b-h),this.addToBounds(a+g,b+h);var u=this.addVertexArc(a,b,c,e,g,h,i,j,k,l,m,n);this.finalizeQuad(u);var p,q,r,s,t},a.prototype.addTexturedQuad=function(a,b,c,d,e,f,g,h,i){var j=this.addVertexTexQuad(a,b,c,d,e,f,g,h,i);this.finalizeQuad(j);var k=.5*Math.cos(e),l=.5*Math.sin(e),m=Math.abs(c*k)+Math.abs(d*l),n=Math.abs(c*l)+Math.abs(d*k);this.addToBounds(a-m,b-n),this.addToBounds(a+m,b+n)},a.prototype.isFull=function(a){a=a||3;var b=this.useInstancing?4:1;return this.vcount*b+a>this.FULL_COUNT},a.prototype.toMesh=function(){var a={};a.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),a.vbstride=this.stride;var b=this.useInstancing?1:0;if(a.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1}},this.stride>10&&(a.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:b,normalize:!1}),this.useInstancing){a.numInstances=this.vcount;var c=new Int32Array([0,1,2,3]);a.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},a.vblayout.instFlags4b.array=c.buffer;a.indices=new Uint16Array(e)}else a.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));a.dbIds=this.dbIds;var d=this.maxx-this.minx,f=this.maxy-this.miny,g=Math.max(d,f);a.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-g},max:{x:this.maxx,y:this.maxy,z:.001*g}};a.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(d*d+f*f)};return a};var f=function(a,b){function c(){function c(a,b){return Math.abs(a-b)<.001}c(a,0)&&(a=0),c(b,0)&&(b=0),c(a,d)&&(a=d),c(b,d)&&(b=d)}if(c(),a>b)for(;a>d;)a-=d,b-=d;else for(;b>d;)a-=d,b-=d;return c(),a<0&&b>0&&(a+=d),{start:a,end:b}};c.VertexBufferBuilder=a}(),function(){"use strict";var a=(Autodesk.Viewing,Autodesk.Viewing.Private);Math.PI;a.VertexBufferReader=function(a,b){this.vb=a.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.stride=a.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!!b},a.VertexBufferReader.prototype.getDbIdAt=function(a){return this.vbi[a*this.stride+7]},a.VertexBufferReader.prototype.getVertexFlagsAt=function(a){return this.vbi[a*this.stride+8]},a.VertexBufferReader.prototype.getLayerIndexAt=function(a){return 65535&this.vbi[a*this.stride+9]},a.VertexBufferReader.prototype.getViewportIndexAt=function(a){return this.vbi[a*this.stride+9]>>16&65535},a.VertexBufferReader.prototype.decodeLineAt=function(a,b,c,d){if(d.onLineSegment){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=f+i*Math.cos(h),k=g+i*Math.sin(h);d.onLineSegment(f,g,j,k,c)}},a.VertexBufferReader.prototype.decodeCircularArcAt=function(a,b,c,d){if(d.onCircularArc){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+5];d.onCircularArc(f,g,h,i,j,c)}},a.VertexBufferReader.prototype.decodeEllipticalArcAt=function(a,b,c,d){if(d.onEllipticalArc){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+5],k=this.vbf[e+10],l=this.vbf[e+11];d.onEllipticalArc(f,g,h,i,j,k,l,c)}},a.VertexBufferReader.prototype.decodeTexQuadAt=function(a,b,c,d){if(d.onTexQuad){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+4];d.onTexQuad(f,g,i,j,h,c)}},a.VertexBufferReader.prototype.decodeOneTriangleAt=function(a,b,c,d){if(d.onOneTriangle){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+4],k=this.vbf[e+5];d.onOneTriangle(f,g,h,i,j,k,c)}},a.VertexBufferReader.prototype.decodeTriangleVertex=function(a,b,c,d){if(d.onTriangleVertex){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1];d.onTriangleVertex(f,g,c)}},a.VertexBufferReader.prototype.enumGeomsForObject=function(a,b){for(var c=0;c<this.vcount;){var d=this.getVertexFlagsAt(c),e=d>>8&255,f=this.getLayerIndexAt(c),g=this.getViewportIndexAt(c);if(this.getDbIdAt(c)===a)switch(e){case 0:this.decodeTriangleVertex(c,f,g,b);break;case 1:this.decodeLineAt(c,f,g,b);break;case 2:this.decodeCircularArcAt(c,f,g,b);break;case 3:this.decodeEllipticalArcAt(c,f,g,b);break;case 4:this.decodeTexQuadAt(c,f,g,b);break;case 5:this.decodeOneTriangleAt(c,f,g,b)}c+=this.useInstancing||0==e?1:4}},a.VertexBufferReader.prototype.enumGeomsForVisibleLayer=function(a,b){for(var c=0;c<this.vcount;){var d=this.getVertexFlagsAt(c),e=d>>8&255,f=this.getLayerIndexAt(c),g=this.getViewportIndexAt(c),h=a.indexOf(f)!==-1;if(0!==f&&h)switch(e){case 0:this.decodeTriangleVertex(c,f,g,b);break;case 1:this.decodeLineAt(c,f,g,b);break;case 2:this.decodeCircularArcAt(c,f,g,b);break;case 3:this.decodeEllipticalArcAt(c,f,g,b);break;case 4:this.decodeTexQuadAt(c,f,g,b);break;case 5:this.decodeOneTriangleAt(c,f,g,b)}c+=this.useInstancing||0==e?1:4}}}(),function(){"use strict";function a(){function a(){var a=ba.NormalsShader;h=ba.createShaderMaterial(a),h.blending=THREE.NoBlending,h.packedNormals=!0;var b={NoCutPlanes:1,Instancing:2,Count:4},c=[];c[0]=null;for(var d=1;d<b.Count;d++){var e=h.clone();d&b.NoCutPlanes&&(e.cutPlanes=null,e.blending=THREE.NoBlending,e.packedNormals=!0,e.doNotCut=!0),d&b.Instancing&&(e.useInstancing=!0),c[d]=e}h.variants=c,h.getCustomOverrideMaterial=function(a){var c=!a.cutplanes||0==a.cutplanes.length,d=a.useInstancing,e=(c?b.NoCutPlanes:0)|(d?b.Instancing:0);return this.variants[e]}}function d(a){a(h);for(var b=1;b<h.variants.length;b++)a(h.variants[b])}function e(){function b(a){a.material.blending=THREE.NoBlending,a.material.depthWrite=!1,a.material.depthTest=!1}a(),o=new ba.LmvShaderPass(ba.SAOShader),b(o),n=new ba.LmvShaderPass(ba.SAOBlurShader),b(n),q=new ba.LmvShaderPass(ba.SAOMinifyFirstShader),b(q),p=new ba.LmvShaderPass(ba.SAOMinifyShader),b(p),r=new ba.LmvShaderPass(ba.FXAAShader),b(r),s=new ba.LmvShaderPass(ba.CelShader),b(s),t=new ba.LmvShaderPass(ba.BlendShader),b(t),m=new ba.LmvShaderPass(ba.BackgroundShader),b(m),u=new ba.LmvShaderPass(ba.CopyShader),b(u)}function f(a,b){var c=3*a[1],d=3*(a[3]-a[1])-c;return(((1-c-d)*b+d)*b+c)*b}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=!1,E=!1,F=null,G=null,H=null,I=null,J=null,K=[],L=0,M=0,N=0,O=1,P=!1,Q=new Uint8Array(4),R=(new THREE.Color).setRGB(1,1,1),S=(new THREE.Color).setRGB(0,0,0),T=null,U=!1,V=!1,W=!1,X=0,Y=0,Z=0,$=[.42,0,1,1],_={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,toonShaded:!1,envMapBg:!1,swapBlackAndWhite:!1,numIdTargets:1},aa={},ba=Autodesk.Viewing.Shaders;this.settings=_,this.init=function(a,d,f){if(e(),!a)return void c.logger.error("You need a gl context to make a renderer. Things will go downhill from here.",b.errorCodeString(b.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED));C=window.navigator.userAgent.indexOf("Firefox")!=-1?THREE.RGBAFormat:THREE.RGBFormat,U=b.isMobileDevice(),_.idbuffer=!U,A=d,B=f,g=a},this.overlayUpdate=function(a){if(0===Y||Y===-1)return!1;var b=t.uniforms.highlightIntensity.value,c=.004*(performance.now()-X);c=Math.min(c,1);var d=f($,c);return b!=d&&(t.uniforms.highlightIntensity.value=d,!0)},this.beginScene=function(a,d,e,f){if(j=d,l=a.fog,k=e,D=!1,E=!1,!G&&A)this.initPostPipeline(_.sao,_.antialias);else if(!G&&!A)return void(P||(c.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",b.errorCodeString(b.ErrorCodes.VIEWER_INTERNAL_ERROR)),P=!0));if(f){if(T&&!_.envMapBg){if(_.swapBlackAndWhite){var h=new THREE.Color(1,1,1),i=new THREE.Color(0,0,0);T.equals(h)?g.setClearColor(i,1):T.equals(i)?g.setClearColor(h,1):g.setClearColor(T,1)}else g.setClearColor(T,1);g.clearTarget(G,!0,!0,!1)}else m.uniforms.uCamDir.value=j.worldUpTransform?j.getWorldDirection().clone().applyMatrix4(j.worldUpTransform):j.getWorldDirection(),m.uniforms.uCamUp.value=j.worldUpTransform?j.up.clone().applyMatrix4(j.worldUpTransform):j.up,m.uniforms.uResolution.value.set(A,B),m.uniforms.uHalfFovTan.value=Math.tan(THREE.Math.degToRad(.5*j.fov)),g.clearTarget(G,!1,!0,!1),m.render(g,G,null);for(var n=0;n<K.length;n++)g.setClearColor(R,1),g.clearTarget(K[n],!0,!1,!1)}if(_.sao||_.toonShaded){f&&(g.setClearColor(S,0),g.clearTarget(z,!0,!1,!1));var p=d.near,r=d.far;o.uniforms.cameraNear.value=p,o.uniforms.cameraFar.value=r,s.uniforms.cameraNear.value=p,s.uniforms.cameraFar.value=r,q.uniforms.cameraNear.value=p,q.uniforms.cameraInvNearFar.value=1/(p-r);var u=d.projectionMatrix.elements;d.isPerspective?(o.uniforms.projInfo.value.set(-2/(G.width*u[0]),-2/(G.height*u[5]),(1-u[8])/u[0],(1+u[9])/u[5]),s.uniforms.projInfo.value.copy(o.uniforms.projInfo.value),o.uniforms.isOrtho.value=0,s.uniforms.isOrtho.value=0):(o.uniforms.projInfo.value.set(-2/(G.width*u[0]),-2/(G.height*u[5]),(1-u[12])/u[0],(1-u[13])/u[5]),s.uniforms.projInfo.value.copy(o.uniforms.projInfo.value),o.uniforms.isOrtho.value=1,s.uniforms.isOrtho.value=1);o.uniforms.projScale.value=G.height*u[5]*.125}_.sao||(t.uniforms.useAO.value=0),this.renderScenePart(a,!0,!0,!1,!0)},this.renderScenePart=function(a,b,c,d,e){D=!1,E=!1;var f=e?k:void 0;a.fog=l;var m;V&&W?_.idbuffer&&d&&(_.sao||_.toonShaded)?g.render(a,j,[G,z].concat(K),!1,f):_.sao||_.toonShaded?g.render(a,j,[G,z],!1,f):_.idbuffer&&d?g.render(a,j,[G].concat(K)):g.render(a,j,G,!1,f):W?(_.idbuffer&&d?g.render(a,j,[G].concat(K),!1,f):g.render(a,j,G,!1,f),(_.sao||_.toonShaded)&&c&&(m=a.overrideMaterial,a.overrideMaterial=h,g.render(a,j,z,!1,void 0),a.overrideMaterial=m)):(b&&g.render(a,j,G,!1,f),_.idbuffer&&d&&i&&(m=a.overrideMaterial,a.overrideMaterial=i,g.render(a,j,K[0],!1,void 0),a.overrideMaterial=m),(_.sao||_.toonShaded)&&c&&(m=a.overrideMaterial,a.overrideMaterial=h,g.render(a,j,z,!1,void 0),a.overrideMaterial=m))},this.clearAllOverlays=function(){g.clearTarget(H,!0,!1,!1)},this.renderOverlays=function(a,b){var c=0;for(var d in a){var e=a[d],f=e.scene,h=e.camera?e.camera:j;f.children.length&&(c||(c=1,g.setClearColor(S,0),g.clearTarget(H,!0,!1,!1)),e.materialPre&&(f.overrideMaterial=e.materialPre),g.render(f,h,H,!1,b),e.materialPost&&(f.overrideMaterial=e.materialPost,g.context.depthFunc(g.context.GREATER),g.render(f,h,H,!1,b),g.context.depthFunc(g.context.LEQUAL)),f.overrideMaterial=null)}t.uniforms.useOverlay.value=c},this.computeSSAO=function(a){if(a||!_.sao||_.toonShaded)t.uniforms.useAO.value=0;else{if(!D){if(F&&F.length){var b=F[0];q.uniforms.resolution.value.set(1/b.width,1/b.height),q.render(g,b,z);for(var c=1;c<F.length;c++){var d=F[c];p.uniforms.resolution.value.set(1/d.width,1/d.height),p.render(g,d,b),b=d}}o.render(g,J,G),n.uniforms.axis.value.set(1,0),n.render(g,I,J),n.uniforms.axis.value.set(0,1),n.render(g,J,I),D=!0}t.uniforms.useAO.value=1}},this.presentBuffer=function(a){if(g){!(_.sao||t.uniforms.useOverlay.value||0!==Y&&Y!==-1||0!==Z&&Z!==-1)?_.antialias?a?(r.render(g,I,G),a.render(g,null,I)):_.toonShaded?(s.render(g,I,G),r.render(g,null,I)):r.render(g,null,G):a?a.render(g,null,G):_.toonShaded?(s.render(g,I,G),u.render(g,null,I)):u.render(g,null,G):_.antialias?(t.render(g,I,G),a?(r.render(g,J,I),a.render(g,null,J)):_.toonShaded?(s.render(g,J,I),r.render(g,null,J)):r.render(g,null,I)):a?(t.render(g,I,G),a.render(g,null,I)):_.toonShaded?(t.render(g,I,G),s.render(g,J,I),u.render(g,null,J)):t.render(g,null,G)}},this.composeFinalFrame=function(a,b){_.sao&&!_.toonShaded&&this.computeSSAO(a),b||this.presentBuffer()},this.cleanup=function(){if(G&&(G.dispose(),G=null),z&&(z.dispose(),z=null),H&&(H.dispose(),H=null),I&&(I.dispose(),I=null),J&&(J.dispose(),J=null),F){
for(var a=0;a<F.length;a++)F[a].dispose();F=[]}},this.setSize=function(a,d,e){if(A=a,B=d,_.logicalWidth=a,_.logicalHeight=d,0===a&&0===d||!g)return void this.cleanup();var f=0|a*g.getPixelRatio(),h=0|d*g.getPixelRatio();_.deviceWidth=f,_.deviceHeight=h,g.setSize(a,d),c.logger.log("width: "+f+" height: "+h);var i=1/f,j=1/h;if((_.useSSAA||_.toonShaded&&g.getPixelRatio()<=1)&&(f*=2,h*=2,e=!0),!e&&G&&G.width==f&&G.height==h||(c.logger.log("Reallocating render targets."),this.cleanup(),G=new THREE.WebGLRenderTarget(f,h,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:_.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1}),G.generateMipmaps=!1,H=new THREE.WebGLRenderTarget(f,h,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),H.generateMipmaps=!1,H.shareDepthFrom=G,z=null,I=null,J=null,F=[]),(_.antialias||_.sao||_.customPresentPass||_.toonShaded)&&(!e&&I&&I.width==f&&I.height==h||(I=new THREE.WebGLRenderTarget(f,h,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),I.generateMipmaps=!1)),_.sao||_.toonShaded){if(e||!z||z.width!=f||z.height!=h){var k=THREE.FloatType;b.isMobileDevice()&&(k=THREE.HalfFloatType),z=new THREE.WebGLRenderTarget(f,h,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:C,type:k,stencilBuffer:!1}),z.shareDepthFrom=G,F=[];for(var l=0;l<5;l++){var m=new THREE.WebGLRenderTarget(0|f/(2<<l),0|h/(2<<l),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});m.generateMipmaps=!1,F.push(m),o.uniforms["tDepth_mip"+(l+1)].value=m}V=g.verifyMRTWorks([G,z]),J=I.clone()}!J&&_.antialias&&_.customPresentPass&&(J=I.clone()),o.uniforms.size.value.set(f,h),o.uniforms.resolution.value.set(i,j),o.uniforms.tDepth.value=z,n.uniforms.size.value.set(f,h),n.uniforms.resolution.value.set(i,j),s.uniforms.tDepth.value=z}if(_.idbuffer){if(e||!K[0]||K[0].width!=f||K[0].height!=h){K=[];for(var p=0;p<_.numIdTargets;p++)K[p]=new THREE.WebGLRenderTarget(f,h,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1}),K[p].generateMipmaps=!1,K[p].shareDepthFrom=G,K[p].canReadPixels=!0;W=g.verifyMRTWorks([G].concat(K)),W||c.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work.")}s.uniforms.tID.value=K[0]}else if(K[0])for(var p=0;p<K.length;p++)K[p].dispose(),K[p]=null;r.uniforms.uResolution.value.set(i,j),s.uniforms.resolution.value.set(i,j),t.uniforms.tOverlay.value=H,t.uniforms.tAO.value=J,t.uniforms.useAO.value=_.sao?1:0,t.uniforms.resolution.value.set(i,j),t.uniforms.tID.value=K[0]},this.getMaxAnisotropy=function(){return g.getMaxAnisotropy()},this.mrtFlags=function(){return{mrtNormals:V&&(_.sao||_.toonShaded),mrtIdBuffer:W&&_.idbuffer?_.numIdTargets:void 0}},this.getAntialiasing=function(){return _.antialias},this.initPostPipeline=function(a,c){_.sao=a&&!b.isIE11,_.antialias=c&&!b.isIE11,_.sao&&(_.toonShaded=!1),_.haveTwoSided&&d(function(a){a.side=THREE.DoubleSide}),d(function(a){a.needsUpdate=!0}),o.material.needsUpdate=!0,n.material.needsUpdate=!0,q.material.needsUpdate=!0,p.material.needsUpdate=!0,r.material.needsUpdate=!0,s.material.needsUpdate=!0,t.material.needsUpdate=!0,m.material.needsUpdate=!0,u.material.needsUpdate=!0,this.setSize(A,B)},this.setClearColors=function(a,b){(T=b?a.equals(b)||U?new THREE.Color(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)):void 0:a.clone())||(m.uniforms.color1.value.copy(a),m.uniforms.color2.value.copy(b))},this.setAOEnabled=function(a){_.sao=a,this.setSize(A,B)},this.setAOOptions=function(a,c){void 0!==a&&(o.uniforms.radius.value=a,o.uniforms.bias.value=a*b.isMobileDevice()?.1:.01,n.uniforms.radius.value=a),void 0!==c&&(o.uniforms.intensity.value=c),D=!1},this.getAOEnabled=function(){return _.sao},this.getAORadius=function(){return o.uniforms.radius.value},this.getAOIntensity=function(){return o.uniforms.intensity.value},this.setCubeMap=function(a){m.material.envMap=a},this.setEnvRotation=function(a){M=a,m.material.envRotationSin=Math.sin(a),m.material.envRotationCos=Math.cos(a)},this.getEnvRotation=function(){return M},this.setEnvExposure=function(a){m.uniforms.envMapExposure.value=Math.pow(2,a),m.material.envMapExposure=Math.pow(2,a),m.material.needsUpdate=!0},this.setTonemapExposureBias=function(a){L=a,m.uniforms.exposureBias.value=Math.pow(2,a)},this.getExposureBias=function(){return L},this.setCamera=function(a){j=a},this.setTonemapMethod=function(a){N=a,g.gammaInput=0!==a,m.material.tonemapOutput=N,m.material.needsUpdate=!0},this.getToneMapMethod=function(){return N},this.toggleTwoSided=function(a){_.haveTwoSided!=a&&h&&d(function(b){b.side=a?THREE.DoubleSide:THREE.FrontSide,b.needsUpdate=!0}),_.haveTwoSided=a},this.toggleCelShading=function(a){_.sao=!a,_.toonShaded=a,_.idbuffer=a,this.initPostPipeline(_.sao,_.antialias)},this.toggleEnvMapBackground=function(a){_.envMapBg=a,m.uniforms.envMapBackground.value=a},this.toggleSwapBlackAndWhite=function(a){_.swapBlackAndWhite=a},this.enter2DMode=function(a){i=a,aa.sao=_.sao,aa.toonShaded=_.toonShaded,aa.antialias=_.antialias,aa.idbuffer=_.idbuffer,_.idbuffer=!0,_.toonShaded=!1,t.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){i=null,_.idbuffer=aa.idbuffer,_.toonShaded=aa.toonShaded,delete t.material.defines.IS_2D,this.initPostPipeline(aa.sao,aa.antialias)},this.idAtPixel=function(a,b,c){if(!K[0])return 0;var d=0|.5*(a+1)*K[0].width,e=0|.5*(b+1)*K[0].height;if(E&&d===v&&e===w)return c&&(c[0]=x,c[1]=y),x;g.readRenderTargetPixels(K[0],d,e,1,1,Q);var f=Q[2]<<16|Q[1]<<8|Q[0],h=0;return K[1]?(g.readRenderTargetPixels(K[1],d,e,1,1,Q),h=Q[1]<<8|Q[0],h=h<<16>>16,f=f<<8>>8):f=f<<8>>8,v=d,w=e,x=f,y=h,E=!0,c&&(c[0]=f,c[1]=h),f},this.idAtPixels=function(a,b,c,d){if(!K[0])return 0;var e=.5*(a+1)*K[0].width-.5*(c-1),f=.5*(b+1)*K[0].height-.5*(c-1),h=new Uint8Array(4*c*c);g.readRenderTargetPixels(K[0],e,f,c,c,h);var i=void 0;return d&&K[1]&&(i=new Uint8Array(4*c*c),g.readRenderTargetPixels(K[1],e,f,c,c,i)),function(){for(var a,b=0,e=0,f=0,g=-1,j=0;j<c*c;j++){var k=b+(c-1)/2,l=e+(c-1)/2;if(k>=0&&k<=c&&l>=0&&l<=c){var m=k+l*c;if(a=h[4*m+2]<<16|h[4*m+1]<<8|h[4*m],(a=a<<8>>8)>=0){if(i){var n=i[4*m+1]<<8|i[4*m];n=n<<16>>16,d[0]=a,d[1]=n}break}}if(b==e||b<0&&b==-e||b>0&&b==1-e){var o=f;f=-g,g=o}b+=f,e+=g}return a}()},this.readbackTargetId=function(){if(!K[0])return null;var a=new Uint8Array(4*K[0].width*K[0].height);return g.readRenderTargetPixels(K[0],0,0,K[0].width,K[0].height,a),{buffer:a,width:K[0].width,height:K[0].height}},this.rolloverObjectViewport=function(a,b,c){var d=c?c[0]:this.idAtPixel(a,b);return this.rolloverObjectId(d,c)},this.rolloverObjectId=function(a,b,c){return c=c||0,(a!==Y||c!==Z)&&(t.uniforms.highlightIntensity.value=0,t.uniforms.objID.value=a,X=performance.now(),Y=a,Z=c,b?(b.length>1&&b.shift(),t.uniforms.highlightRange.value=1,t.uniforms.objIDStart.value=b[0],t.uniforms.objIDEnd.value=b[b.length-1]):(t.uniforms.highlightRange.value=0,a<=0&&(a=0),t.uniforms.objIDv3.value.set((255&a)/255,(a>>8&255)/255,(a>>16&255)/255)),!0)},this.setUnitScale=function(a){O=a},this.getUnitScale=function(){return O},this.getBlendPass=function(){return t},this.getClearPass=function(){return m},this.getColorTarget=function(){return G},this.getDepthMaterial=function(){return h}}var b=Autodesk.Viewing,c=b.Private;c.RenderContext=a}(),function(){"use strict";function a(a,b){var c=255*b[2]+b[3],d=Math.pow(2,(c-127)/2),e=d/b[1],f=b[0]*e,g=h[0]*f+h[3]*d+h[6]*e,i=h[1]*f+h[4]*d+h[7]*e,j=h[2]*f+h[5]*d+h[8]*e;g<0&&(g=0),i<0&&(i=0),j<0&&(j=0),a[0]=g,a[1]=i,a[2]=j}function b(a,b,c){var d=.0625*Math.sqrt(b[0]*c),e=.0625*Math.sqrt(b[1]*c),f=.0625*Math.sqrt(b[2]*c),g=Math.max(Math.max(d,e),Math.max(f,1e-6));g>1&&(g=1);var h=Math.ceil(255*g)/255;d>1&&(d=1),e>1&&(e=1),f>1&&(f=1),a[3]=h;var i=1/h;a[0]=d*i,a[1]=e*i,a[2]=f*i}function c(a,b,c){var d=Math.sqrt(b[0]*c),e=Math.sqrt(b[1]*c),f=Math.sqrt(b[2]*c);d>65504&&(d=65504),e>65504&&(e=65504),f>65504&&(f=65504),a[0]=d,a[1]=e,a[2]=f}function d(a){for(var b=[],c=Array.isArray(a.image)?a.image:[a.image],d=0;d<c.length;d++)for(var e=c[d],f=0;f<e.mipmaps.length;f++){var g=e.mipmaps[f];b.push(g.data.buffer)}return b}var e=(Autodesk.Viewing,Autodesk.Viewing.Private),f=Autodesk.LMVTK;e.DefaultLightPreset=1,e.DefaultLightPreset2d=0,e.ModelSettingsEnvironment=null,e.BackgroundPresets={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Custom:[230,230,230,150,150,150]};var g=e.BackgroundPresets;e.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:g["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:g["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:g["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:g.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:g["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:g.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:g.Snow,darkerFade:!1,rotation:0}],e.DebugEnvironments=[{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],darkerFade:!1,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g.Midnight,darkerFade:!1,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["RaaS SBS"],darkerFade:!1,rotation:0}],e.ENABLE_DEBUG&&(e.LightPresets=e.LightPresets.concat(e.DebugEnvironments)),e.copyLightPreset=function(a,b){b.name=a.name+" (copy)",b.path=a.path,b.type=a.type,b.tonemap=a.tonemap,b.E_bias=a.E_bias,b.directLightColor=a.directLightColor,b.ambientColor=a.ambientColor,b.lightMultiplier=a.lightMultiplier,b.bgColorGradient=a.bgColorGradient,b.darkerFade=a.darkerFade,b.rotation=a.rotation},e.CreateCubeMapFromColors=function(a,b){for(var c=255*a.x,d=255*a.y,e=255*a.z,f=255*b.x,g=255*b.y,h=255*b.z,i=new Uint8Array(16),j=new Uint8Array(16),k=new Uint8Array(16),l=0;l<4;l++)i[4*l]=c,i[4*l+1]=d,i[4*l+2]=e,i[4*l+3]=255,j[4*l]=f,j[4*l+1]=g,j[4*l+2]=h,j[4*l+3]=255,l>1?(k[4*l]=c,k[4*l+1]=d,k[4*l+2]=e,k[4*l+3]=255):(k[4*l]=f,k[4*l+1]=g,k[4*l+2]=h,k[4*l+3]=255);var m=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),n=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),o=new THREE.DataTexture(j,2,2,THREE.RGBAFormat),p=new THREE.DataTexture(i,2,2,THREE.RGBAFormat),q=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),r=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),s=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat);return s.image=[n,m,p,o,r,q],s.needsUpdate=!0,s};var h=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],i=new Float32Array(4),j=new Float32Array(4);e.DecodeEnvMap=function(d,f,g,h){if(!d.LogLuv)return void e.logger.warn("Environment map expected to be in LogLuv format.");for(var k=Math.pow(2,f),l=Array.isArray(d.image)?d.image:[d.image],m=0;m<l.length;m++)for(var n=l[m],o=0;o<n.mipmaps.length;o++){var p,q=n.mipmaps[o],r=q.data;g?(p=new Uint16Array(r.length/4*3),q.data=p):p=r.buffer;for(var s=0,t=0;t<r.length;t+=4)i[0]=r[t]/255,i[1]=r[t+1]/255,i[2]=r[t+2]/255,i[3]=r[t+3]/255,a(j,i),g?(c(i,j,k),p[s++]=e.FloatToHalf(i[0]),p[s++]=e.FloatToHalf(i[1]),p[s++]=e.FloatToHalf(i[2])):(b(i,j,k),r[t]=Math.round(255*i[0]),r[t+1]=Math.round(255*i[1]),r[t+2]=Math.round(255*i[2]),r[t+3]=Math.round(255*i[3]))}d.LogLuv=!1,g?(d.type=THREE.HalfFloatType,d.format=THREE.RGBFormat,d.RGBM=!1,d.GammaEncoded=!0):d.RGBM=!0,h&&h(d)},e.imageWorker=null;var k=1;e.DecodeEnvMapAsync=function(a,b,c,f){if(!a.LogLuv)return void e.logger.warn("Environment map expected to be in LogLuv format.");e.imageWorker||(e.imageWorker=e.createWorker());var g=k++,h=function(b){if(b.data.id===g){e.imageWorker.removeEventListener("message",h);var d=b.data.map;a.image=d.image,a.LogLuv=!1,c?(a.type=THREE.HalfFloatType,a.format=THREE.RGBFormat,a.RGBM=!1,a.GammaEncoded=!0):a.RGBM=!0,f(a)}};e.imageWorker.addEventListener("message",h),e.imageWorker.postMessage({operation:"DECODE_ENVMAP",map:a,exposure:b,useHalfFloat:c,id:g},d(a))},f.doDecodeEnvmap=function(a){e.DecodeEnvMap(a.map,a.exposure,a.useHalfFloat),self.postMessage({map:a.map,id:a.id},d(a.map))}}(),function(){"use strict";function a(a,c,d,e){if(h.getUseCredentials()){var f=a.indexOf("://")===-1||a.indexOf(window.location.host)!==-1||i.urlIsApiViewingOrDev(a);THREE.ImageUtils.crossOrigin=f?"use-credentials":"anonymous"}if(a.indexOf("urn:")!==-1){var g=h.getUseCredentials()&&!h.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"",j=g;e&&(j&&(j+="&"),j+="acmsession="+e),j&&(a+="?"+j)}if(".dds"===a.slice(a.length-4).toLocaleLowerCase()){if(h.isIOSDevice()){var k=a.slice(0,a.length-4)+".pvr";return(new THREE.PVRLoader).load(k,d)}return(new THREE.DDSLoader).load(a,d)}return!LMV_THIRD_PARTY_COOKIE&&f?b(a,c,d):THREE.ImageUtils.loadTexture(a,c,d)}function b(a,b,d){function e(a){return c(a,g,d)}function f(a,b,c){var d="Error: "+a+" ("+b+")";i.logger.error(d,h.errorCodeString(h.ErrorCodes.NETWORK_SERVER_ERROR))}var g=new THREE.Texture(void 0,b);return i.ViewingService.getItem(i.initLoadContext(),a,e,f),g}function c(a,b,c){var d=new Image;b.image=d,d.onload=function(){b.needsUpdate=!0,c&&c(b)},d.onerror=function(a){i.logger.error(a,h.errorCodeString(h.ErrorCodes.UNKNOWN_FAILURE))},d.src=function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return"data:image/jpeg;base64,"+window.btoa(b)}(a)}function d(a){var b=a.width,c=a.height;if(0==(b&b-1)&&0==(c&c-1))return a;for(var d=1;2*d<b;)d*=2;for(var e=1;2*e<c;)e*=2;var f=document.createElement("canvas"),g=f.getContext("2d");return f.width=d,f.height=e,g.drawImage(a,0,0,d,e),f}function e(b){function c(a){return.299*a.r+.587*a.g+.114*a.b}WGS.MaterialManager.call(this,b);var e=this,f=WGS.MaterialManager.prototype;this.hasPrism=!1;var g=!1;this.defaultMaterial=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading,reflectivity:0}),this.dtor=function(){this.cleanup(),THREE.Cache.clear(),e=null},this.hasTwoSidedMaterials=function(){return g},this.findMaterial=function(a,b){var c=f.findMaterial.call(this,this._getMaterialHash(a,b));return c||(i.logger.warn("Unknown material "+b+". Using default."),c=this.defaultMaterial),c},this.convertOneMaterial=function(a,b,c,d){var e=a.getData(),f=i.MaterialConverter.convertMaterial(b,d);e.doubleSided&&(f.side=THREE.DoubleSide);var g=this._getMaterialHash(a,c);if(this.addMaterial(g,f,d),b.decals){f.decals=[];for(var h=0,j=b.decals.length;h<j;h++){var k=b.decals[h];d=i.MaterialConverter.isPrismMaterial(k.material);var l=i.MaterialConverter.convertMaterial(k.material,d);f.decals.push({uv:k.uv||0,material:l}),this.addMaterial(g+"|decal|"+h,l,d)}}},this.loadTexture=function(b,c){var g=c.getData(),h=function(b,f,h){var j=(e._getTextureHash(c,f.uri,f.mapName),null),k=b.proteinType&&b.proteinType.length,l=k&&0===b.proteinType.indexOf("Prism");if(!(l&&PRISM_ROOT||k&&PROTEIN_ROOT)||0!==f.uri.indexOf("1/Mats")&&0!==f.uri.indexOf("2/Mats")&&0!==f.uri.indexOf("3/Mats")){for(var m=0;m<g.manifest.assets.length;++m){var n=g.manifest.assets[m];if(n.id.toLowerCase()==f.uri.toLowerCase()){j=i.pathToURL(g.basePath+n.URI);break}}j||(j=i.pathToURL(g.basePath+f.uri))}else j=l?PRISM_ROOT+f.uri:PROTEIN_ROOT+f.uri;return a(j,THREE.UVMapping,function(a){e&&(a.image=d(a.image),h(f,a))},g.acmSessionId)};f.loadMaterialTextures.call(this,c,b,g.materials.scene.SceneUnit,h)},this.loadTextures=function(a){var b=this._getModelHash(a);for(var c in this._materials)if(c.indexOf(b)!=-1){var d=this._materials[c];this.loadTexture(d,a)}},this.texturesLoaded=function(){return 0===this._texturesToUpdate.length},this.create2DMaterial=function(c,e,g,i,j){var k=c?c.getData():null,l="__lineMaterial__";e.image&&(l+="|image:"+e.image.name),e.clip&&(l+="|clip:"+JSON.stringify(e.clip)),g&&(l+="|id"),i&&(l+="|selection"),e.skipEllipticals&&(l+="|skipEllipticals"),e.skipCircles&&(l+="|skipCircles"),e.skipTriangleGeoms&&(l+="|skipTriangleGeoms"),e.useInstancing&&(l+="|useInstancing");var m=this._getMaterialHash(c,l);if(!this._materials.hasOwnProperty(m)){var n=h.Shaders,o=n.createShaderMaterial(n.LineShader);if(o.is2d=!0,o.transparent=!0,o.depthWrite=!1,o.depthTest=!1,o.side=THREE.DoubleSide,o.blending=THREE.NormalBlending,g?(o.defines.ID_COLOR=1,o.blending=THREE.NoBlending):i?(this.setSelectionTexture(o),o.defines.SELECTION_RENDERER=1,o.uniforms.selectionColor.value=new THREE.Vector4(0,0,1,1)):b&&b.supportsMRT()&&(o.mrtIdBuffer=this._mrtIdBuffer),e.skipEllipticals||(o.defines.HAS_ELLIPTICALS=1),e.skipCircles||(o.defines.HAS_CIRCLES=1),e.skipTriangleGeoms||(o.defines.HAS_TRIANGLE_GEOMS=1),e.useInstancing&&(o.defines.USE_INSTANCING=1),e.image&&!h.isNodeJS){var p=function(a){a.image=d(a.image),a.wrapS=THREE.ClampToEdgeWrapping,a.wrapT=THREE.ClampToEdgeWrapping,a.minFilter=THREE.LinearMipMapLinearFilter,a.magFilter=THREE.LinearFilter,a.anisotropy=1,a.flipY=!0,a.generateMipmaps=!0,a.needsUpdate=!0,o.defines.HAS_RASTER_QUADS=1,o.uniforms.tRaster.value=a,e.image.dataURI.indexOf("png")!=-1&&(o.transparent=!0),o.needsUpdate=!0,j&&j(a)};a(e.image.dataURI,THREE.UVMapping,p,k.acmSessionId)}o.modelScale=e.modelScale||1,f.addLineMaterial.call(this,m,o)}return l},this.addMaterial=function(a,b,d){var e=b.proteinMat?b.proteinMat:null,h=b.prismType&&b.prismType.indexOf("Prism")!=-1;if(h&&b.transparent&&(b.side===THREE.FrontSide&&(b.side=THREE.DoubleSide),b.side===THREE.DoubleSide&&b.depthTest&&(b.twoPassTransparency=!0)),this.hasPrism=h||this.hasPrism,!d){var i=b.proteinType&&b.proteinType.indexOf("Prism")!=-1;if(b.metal)b.reflectivity||(b.reflectivity=c(b.specular)),e&&(1===b.reflectivity&&(b.reflectivity=c(b.specular)),0===b.color.r&&0===b.color.g&&0===b.color.b||(b.color.r*=.1,b.color.g*=.1,b.color.b*=.1));else if(i){var j=!1;if("PrismLayered"==b.proteinType&&(b.clearcoat=!0,b.reflectivity=.06,e)){var k=e.materials[e.userassets[0]],l=k.categories;l&&l.length&&l[0].indexOf("Metal")!=-1&&(j=!0)}b.reflectivity=Math.sqrt(b.reflectivity),j?b.specular.copy(b.color):(b.specular.r=b.reflectivity,b.specular.g=b.reflectivity,b.specular.b=b.reflectivity)}else b.reflectivity?b.reflectivity>.3?(b.metal=!0,b.specular.r=b.color.r,b.specular.g=b.color.g,b.specular.b=b.color.b,b.color.r*=.1,b.color.g*=.1,b.color.b*=.1):(b.specular.r*=b.reflectivity,b.specular.g*=b.reflectivity,b.specular.b*=b.reflectivity):1!==b.color.r||1!==b.color.g||1!==b.color.b||1!==b.specular.r||1!==b.specular.g||1!==b.specular.b||b.textureMaps&&(b.textureMaps.map||b.textureMaps.specularMap)?(b.reflectivity=.01+.06*c(b.specular),b.specular.r*=b.reflectivity,b.specular.g*=b.reflectivity,b.specular.b*=b.reflectivity):(b.metal=!0,b.reflectivity=.7,b.color.r*=.1,b.color.g*=.1,b.color.b*=.1),b.opacity<1&&(b.reflectivity=1);(b.transparent||b.textureMaps&&(b.textureMaps.map&&b.textureMaps.map.uri.toLowerCase().indexOf(".png")!=-1||b.textureMaps.opacityMap))&&(b.alphaTest=.01)}if(b.textureMaps&&b.textureMaps.normalMap){var m=b.bumpScale;(void 0===m||m>=1)&&(m=1),b.normalScale=new THREE.Vector2(m,m)}else void 0===b.bumpScale&&b.textureMaps&&(b.textureMaps.map||b.textureMaps.bumpMap)?b.bumpScale=.03:b.bumpScale>=1&&(b.bumpScale=.03);void 0!==b.shininess&&(b.shininess*=.25),b.side==THREE.DoubleSide&&(g=!0),f.addHDRMaterial.call(this,a,b)},this.addMaterialNonHDR=function(a,b){f.addNonHDRMaterial.call(this,a,b)},this.togglePolygonOffset=function(a){this.forEach(function(b){b instanceof THREE.MeshPhongMaterial&&(b.polygonOffset=!0,b.polygonOffsetFactor=a?1:0,b.polygonOffsetUnits=a?.1:0,b.extraDepthOffset&&(b.polygonOffsetFactor+=b.extraDepthOffset),b.needsUpdate=!0)})},this.applyGeometryFlagsToMaterial=function(a,b){b.attributes.color&&(a.vertexColors=THREE.VertexColors,a.needsUpdate=!0),!a.proteinType&&b.attributes.uv&&b.attributes.uv.isPattern&&(a.map&&!a.bumpMap&&(a.bumpMap=a.map,a.needsUpdate=!0),a.textureMaps&&a.textureMaps.map&&!a.textureMaps.bumpMap&&(a.textureMaps.bumpMap=a.textureMaps.map,a.needsUpdate=!0))},this.setCubeMapFromColors=function(a,b){var c=i.CreateCubeMapFromColors(a,b);return c.isBgColor=!0,f.setReflectionMap.call(e,c),e._reflectionMap},this.setCubeMap=function(a,b,c){var d=this,e=function(a){f.setReflectionMap.call(d,a),c&&c(a)},g=function(c){c?(c.mapping=THREE.CubeReflectionMapping,c.LogLuv=a.indexOf("logluv")!=-1,c.RGBM=a.indexOf("rgbm")!=-1,i.DecodeEnvMap(c,b,!1,e)):e(c)};return Array.isArray(a)?(this._reflectionMap=THREE.ImageUtils.loadTextureCube(a,THREE.CubeReflectionMapping,g),this._reflectionMap.format=THREE.RGBFormat):"string"==typeof a?a.toLowerCase().indexOf(".dds")!=-1?this._reflectionMap=(new THREE.DDSLoader).load(a,g):(this._reflectionMap=THREE.ImageUtils.loadTexture(a,THREE.SphericalReflectionMapping,e),this._reflectionMap.format=THREE.RGBFormat):e(a?a:null),d._reflectionMap},this.setIrradianceMap=function(a,b,c){var d=this,g=function(a){f.setIrradianceMap.call(d,a),c&&c(a)},h=function(c){c?(c.mapping=THREE.CubeReflectionMapping,c.LogLuv=a.indexOf("logluv")!=-1,c.RGBM=a.indexOf("rgbm")!=-1,i.DecodeEnvMap(c,b,!1,g)):d._irradianceMap&&g(null)};return THREE.ImageUtils.crossOrigin="",Array.isArray(a)?(e._irradianceMap=THREE.ImageUtils.loadTextureCube(a,THREE.CubeReflectionMapping,g),e._irradianceMap.format=THREE.RGBFormat):"string"==typeof a?a.toLowerCase().indexOf(".dds")!=-1&&(this._irradianceMap=(new THREE.DDSLoader).load(a,h)):g(a?a:null),d._irradianceMap},this.init2DSelectionMaterial=function(a,b,c){this._selectionTex||this.initSelectionTexture(a.myData.maxObjectNumber);var d=this.create2DMaterial(a,{useInstancing:b},!1,!0,c);return this._materials[this._getMaterialHash(a,d)]},this.highlightObject2D=function(a,b){this._selectionTex.image.data[a]=b?255:0,this._selectionTex.needsUpdate=!0},this.getCutPlanes=function(){return this._cutplanes.slice()},this.getCutPlanesRaw=function(){return this._cutplanes},this.addSimpleMaterial=function(a,b,c){var d=i.MaterialConverter.convertMaterial(b),e=this._getMaterialHash(c,a);this.addMaterial(e,d),this.loadTexture(d,c)},this.addMaterial("__defaultMaterial__",this.defaultMaterial),this.setShadowParams=function(a){this.forEach(function(b){a.apply(b)})}}function f(a){return i.hasOwnProperty("MaterialManager")||(e.prototype=new WGS.MaterialManager(a),e.prototype.constructor=e,i.MaterialManager=e),new i.MaterialManager(a)}function g(a){var b=a.clone();b.useInstancing=!0;var c=a.clone();c.wideLines=!0,a.variants=[b,c],a.getCustomOverrideMaterial=function(a){return a.useInstancing?this.variants[0]:a.wideLines?this.variants[1]:null}}var h=Autodesk.Viewing,i=h.Private;Autodesk.Viewing.Private.createMaterialManager=f,Autodesk.Viewing.Private.loadTextureWithSecurity=a,Autodesk.Viewing.Private.addInstancingSupport=g}(),function(){"use strict";function a(a,b){function c(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}var d,e,f,g,h,i,j,k,l,m=[],n=[];return d=(a.length-1)*b,e=Math.floor(d),f=d-e,m[0]=0===e?e:e-1,m[1]=e,m[2]=e>a.length-2?e:e+1,m[3]=e>a.length-3?e:e+2,i=a[m[0]],j=a[m[1]],k=a[m[2]],l=a[m[3]],g=f*f,h=f*g,n[0]=c(i[0],j[0],k[0],l[0],f,g,h),n[1]=c(i[1],j[1],k[1],l[1],f,g,h),n[2]=c(i[2],j[2],k[2],l[2],f,g,h),n}var b=Autodesk.Viewing.Private,c={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2},d=function(){this.animations=[]};d.prototype.init=function(a){if(a.initialized===!0)return a;for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++)if(a.hierarchy[b].keys[c].time<0&&(a.hierarchy[b].keys[c].time=0),void 0!==a.hierarchy[b].keys[c].rot&&!(a.hierarchy[b].keys[c].rot instanceof THREE.Quaternion)){var d=a.hierarchy[b].keys[c].rot;Array.isArray(d)||(d=[d._x,d._y,d._z,d._w]),a.hierarchy[b].keys[c].rot=(new THREE.Quaternion).fromArray(d)}for(var c=1;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time&&(a.hierarchy[b].keys.splice(c,1),c--);for(var c=0;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].index=c}return a.initialized=!0,a},d.prototype.parse=function(a){function b(a,c){if(c.push(a),a.children&&!(a instanceof THREE.Camera))for(var d=0;d<a.children.length;d++)b(a.children[d],c)}var c=[];return b(a,c),c},d.prototype.play=function(a){this.animations.indexOf(a)===-1&&this.animations.push(a)},d.prototype.stop=function(a){var b=this.animations.indexOf(a);b!==-1&&this.animations.splice(b,1)},d.prototype.update=function(a){for(var b=0;b<this.animations.length;b++)this.animations[b].update(a)};var e=function(a,b,d){this.root=a,this.handler=d.animationHandler,this.data=this.handler.init(b),this.hierarchy=this.handler.parse(a),this.viewer=d.viewer,this.animator=d,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=c.LINEAR,this.setStartAndEndKeyTime()};e.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var a=this.data.hierarchy[0].keys;this.startKeyTime=a[0].time,this.endKeyTime=a[a.length-1].time}else this.startKeyTime=this.endKeyTime=0},e.prototype.keyTypes=[],e.prototype.defaultKey={},e.prototype.play=function(a){this.currentTime=void 0!==a?a:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},e.prototype.pause=function(){this.isPaused===!0?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},e.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},e.prototype.goto=function(a){this.isPlaying||this.play(),this.isPaused||this.pause();var b=a-this.currentTime;this.update(b)},e.prototype.reset=function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];void 0===c.animationCache&&(c.animationCache={}),void 0===c.animationCache[this.data.name]&&(c.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:c.matrix});for(var d=c.animationCache[this.data.name],e=0;e<this.keyTypes.length;e++){for(var f=this.keyTypes[e],g=this.data.hierarchy[a].keys[0],h=this.getNextKeyWith(f,a,1);h.time<this.currentTime&&h.index>g.index;)g=h,h=this.getNextKeyWith(f,a,h.index+1);d.prevKey[f]=g,d.nextKey[f]=h}}this.setStartAndEndKeyTime()},e.prototype.getNextKeyWith=function(a,b,d){var e=this.data.hierarchy[b].keys;for(this.interpolationType===c.CATMULLROM||this.interpolationType===c.CATMULLROM_FORWARD?d=d<e.length-1?d:e.length-1:d%=e.length;d<e.length;d++)if(void 0!==e[d][a])return e[d];return this.data.hierarchy[b].keys[0]},e.prototype.getPrevKeyWith=function(a,b,d){var e=this.data.hierarchy[b].keys;for(d=this.interpolationType===c.CATMULLROM||this.interpolationType===c.CATMULLROM_FORWARD?d>0?d:0:d>=0?d:d+e.length;d>=0;d--)if(void 0!==e[d][a])return e[d];return this.data.hierarchy[b].keys[e.length-1]},e.prototype.isPlayingOutOfRange=function(){return this.isPaused===!1&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},e.prototype.resetIfLooped=function(){this.loop===!0&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())};var f=function(a,b,c){e.call(this,a,b,c),this.localMatrix=new THREE.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!b.custom||!b.custom.transform||"abs"!==b.custom.transform};f.prototype=Object.create(e.prototype),f.prototype.constructor=f,f.prototype.keyTypes=["pos","rot","scl"],f.prototype.defaultKey={pos:0,rot:0,scl:0},f.prototype.update=function(){function b(){d||(d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Quaternion,g=new THREE.Matrix4,h=new THREE.Matrix4)}
var d,e,f,g,h,i=[];return function(j){if(this.isPlaying!==!1&&(this.currentTime+=j*this.timeScale,b(),this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var k=0,l=this.hierarchy.length;k<l;k++){for(var m=this.hierarchy[k],n=m.animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){var p=this.keyTypes[o],q=n.prevKey[p],r=n.nextKey[p];if(r.time<=this.currentTime||q.time>=this.currentTime){for(q=this.data.hierarchy[k].keys[0],r=this.getNextKeyWith(p,k,1);r.time<this.currentTime&&r.index>q.index;)q=r,r=this.getNextKeyWith(p,k,r.index+1);n.prevKey[p]=q,n.nextKey[p]=r}var s=q[p],t=r[p];if(r.time!==q.time&&void 0!==s&&void 0!==t){var u=(this.currentTime-q.time)/(r.time-q.time);if(u<0&&(u=0),u>1&&(u=1),"pos"===p)if(this.interpolationType===c.LINEAR)e.x=s[0]+(t[0]-s[0])*u,e.y=s[1]+(t[1]-s[1])*u,e.z=s[2]+(t[2]-s[2])*u,m.position.copy(e);else{i[0]=this.getPrevKeyWith("pos",k,q.index-1).pos,i[1]=s,i[2]=t,i[3]=this.getNextKeyWith("pos",k,r.index+1).pos,u=.33*u+.33;var v=a(i,u);if(e.x=v[0],e.y=v[1],e.z=v[2],m.position.copy(e),this.interpolationType===c.CATMULLROM_FORWARD){var w=a(i,1.01*u);d.set(w[0],w[1],w[2]),d.sub(vector),d.y=0,d.normalize();var x=Math.atan2(d.x,d.z);m.rotation.set(0,x,0)}}else"rot"===p?(THREE.Quaternion.slerp(s,t,f,u),m.quaternion.copy(f)):"scl"===p&&(e.x=s[0]+(t[0]-s[0])*u,e.y=s[1]+(t[1]-s[1])*u,e.z=s[2]+(t[2]-s[2])*u,m.scale.copy(e))}}if(!this.relativeTransform){var y=g.compose(m.position,m.quaternion,m.scale),z=h;m.getOriginalWorldMatrix(z),z.getInverse(z);var A=g.multiplyMatrices(y,z);A.decompose(m.position,m.quaternion,m.scale)}m.updateAnimTransform()}}}();var g=function(a,b,c){e.call(this,a,b,c)};g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.keyTypes=["pos","up","target","fov","perspective"],g.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},g.prototype.update=function(){function b(){d||(d=new THREE.Vector3,e=new THREE.Vector3)}var d,e,f=[];return function(g){if(this.isPlaying!==!1&&(this.currentTime+=g*this.timeScale,b(),this.resetIfLooped(),!this.isPlayingOutOfRange())){for(var h=0,i=this.hierarchy.length;h<i;h++){for(var j=this.hierarchy[h],k=j.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var m=this.keyTypes[l],n=k.prevKey[m],o=k.nextKey[m];if(o.time<=this.currentTime||n.time>=this.currentTime){for(n=this.data.hierarchy[h].keys[0],o=this.getNextKeyWith(m,h,1);o.time<this.currentTime&&o.index>n.index;)n=o,o=this.getNextKeyWith(m,h,o.index+1);k.prevKey[m]=n,k.nextKey[m]=o}var p=n[m],q=o[m];if(o.time!==n.time&&void 0!==p&&void 0!==q){var r=(this.currentTime-n.time)/(o.time-n.time);r<0&&(r=0),r>1&&(r=1);var s;if("pos"===m)s=j.position;else if("up"===m)s=j.up;else if("target"===m)s=j.target;else{if("fov"===m){j.setFov(p+(q-p)*r);continue}if("perspective"===m){var t=r>.5?q:p;t?j.toPerspective():j.toOrthographic();continue}}if(this.interpolationType===c.LINEAR)e.x=p[0]+(q[0]-p[0])*r,e.y=p[1]+(q[1]-p[1])*r,e.z=p[2]+(q[2]-p[2])*r,s.copy(e);else{f[0]=this.getPrevKeyWith(m,h,n.index-1)[m],f[1]=p,f[2]=q,f[3]=this.getNextKeyWith(m,h,o.index+1)[m],r=.33*r+.33;var u=a(f,r);if(e.x=u[0],e.y=u[1],e.z=u[2],s.copy(e),this.interpolationType===c.CATMULLROM_FORWARD){var v=a(f,1.01*r);d.set(v[0],v[1],v[2]),d.sub(s),d.y=0,d.normalize();var w=Math.atan2(d.x,d.z);j.rotation.set(0,w,0)}}}}j.matrixAutoUpdate=!0,j.matrixWorldNeedsUpdate=!0}j.lookAt(j.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}();var h=function(a,b,c,d){e.call(this,a,b,d),this.nodeId=c,this.epsilon=.1,this.root.setMaterial(this.viewer.matman().cloneMaterial(a.getMaterial()))};h.prototype=Object.create(e.prototype),h.prototype.constructor=h,h.prototype.keyTypes=["vis","opa"],h.prototype.defaultKey={viz:1,opa:1},h.prototype.update=function(){return function(a){if(this.isPlaying!==!1&&(this.currentTime+=a*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var b=0,c=this.hierarchy.length;b<c;b++)for(var d=this.hierarchy[b],e=d.animationCache[this.data.name],f=0;f<this.keyTypes.length;f++){var g=this.keyTypes[f],h=e.prevKey[g],i=e.nextKey[g];if(i.time<=this.currentTime||h.time>=this.currentTime){for(h=this.data.hierarchy[b].keys[0],i=this.getNextKeyWith(g,b,1);i.time<this.currentTime&&i.index>h.index;)h=i,i=this.getNextKeyWith(g,b,i.index+1);e.prevKey[g]=h,e.nextKey[g]=i}var j=h[g],k=i[g];if(i.time!==h.time&&void 0!==j&&void 0!==k){var l=d.getMaterial();if("vis"===g){var m=Math.abs(this.currentTime-i.time)<this.epsilon,n=m?k:j;this.viewer.visibilityManager.setNodeOff(this.nodeId,!n)}else if("opa"===g){var o=(this.currentTime-h.time)/(i.time-h.time);o<0&&(o=0),o>1&&(o=1);var p=j+(k-j)*o;l.transparent=1!==p,l.opacity=p,p>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1)}}}}}();var i=function(a,b,c){var d=this;null===a&&(a=function(a,b,c){var e=d.container=document.createElement("div"),f=a.name;e.id=f,e.style.cursor="pointer",e.style.visibility=c;var g=document.createElement("div");g.id=f+"-txt",g.style.cssText="display: none;position: absolute;z-index: 1;",e.appendChild(g);var h=document.createElement("img"),i=a.custom&&a.custom.att&&1===a.custom.att;h.src=i?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",h.id=f+"-img",h.style.cssText="display: block;position: absolute;z-index: 1;",e.appendChild(h),b.api.container.appendChild(e),e.addEventListener("click",function(){g.style.display="none"===g.style.display?"block":"none"});var j=new THREE.SphereGeometry(.01),k=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),l=new THREE.Mesh(j,k);return l.visible=!1,void 0===b.overlayScenes.annotation&&b.createOverlayScene("annotation"),b.addOverlay("annotation",l),l}(b,c.viewer,"hidden")),e.call(this,a,b,c),this.id=b.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(b){d.updateText(a.position,d.text)})};i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.keyTypes=["pos","text","vis"],i.prototype.defaultKey={pos:0,text:"",vis:1},i.prototype.stop=function(){e.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},i.prototype.updateText=function(a,b){var c=function(a,b,c){var d=a.clone(),e=new THREE.Matrix4;return b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),e.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),d.applyProjection(e),{x:(d.x+1)*c.width/2+c.offsetLeft,y:(1-d.y)*c.height/2+c.offsetTop}}(a,this.viewer.camera,this.viewer.canvas),d=document.getElementById(this.id+"-txt");d&&(d.innerHTML=b,d.style.left=c.x+"px",d.style.top=c.y+"px",this.text=b),(d=document.getElementById(this.id+"-img"))&&(d.style.left=c.x+"px",d.style.top=c.y-24+"px")},i.prototype.update=function(){function b(){d||(d=new THREE.Vector3,e=new THREE.Vector3)}var d,e,f=[];return function(g){if(this.isPlaying!==!1&&(this.currentTime+=g*this.timeScale,b(),this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime){var h=document.getElementById(this.id);return void(h&&(h.style.visibility=this.state))}for(var i=0,j=this.hierarchy.length;i<j;i++){for(var k=this.hierarchy[i],l=k.animationCache[this.data.name],m=0;m<this.keyTypes.length;m++){var n=this.keyTypes[m],o=l.prevKey[n],p=l.nextKey[n];if(p.time<=this.currentTime||o.time>=this.currentTime){for(o=this.data.hierarchy[i].keys[0],p=this.getNextKeyWith(n,i,1);p.time<this.currentTime&&p.index>o.index;)o=p,p=this.getNextKeyWith(n,i,p.index+1);l.prevKey[n]=o,l.nextKey[n]=p}var q=o[n],r=p[n];if(p.time!==o.time&&void 0!==q&&void 0!==r){var s=(this.currentTime-o.time)/(p.time-o.time);if(s<0&&(s=0),s>1&&(s=1),"pos"===n){if(this.interpolationType===c.LINEAR)e.x=q[0]+(r[0]-q[0])*s,e.y=q[1]+(r[1]-q[1])*s,e.z=q[2]+(r[2]-q[2])*s,k.position.copy(e);else if(this.interpolationType===c.CATMULLROM||this.interpolationType===c.CATMULLROM_FORWARD){f[0]=this.getPrevKeyWith("pos",i,o.index-1).pos,f[1]=q,f[2]=r,f[3]=this.getNextKeyWith("pos",i,p.index+1).pos,s=.33*s+.33;var t=a(f,s);if(e.x=t[0],e.y=t[1],e.z=t[2],k.position.copy(e),this.interpolationType===c.CATMULLROM_FORWARD){var u=a(f,1.01*s);d.set(u[0],u[1],u[2]),d.sub(vector),d.y=0,d.normalize();var v=Math.atan2(d.x,d.z);k.rotation.set(0,v,0)}}}else if("text"===n){var w=Math.abs(this.currentTime-p.time)<this.epsilon?r:q;this.updateText(k.position,w)}else if("vis"===n){var h=document.getElementById(this.id);if(h){var x=Math.abs(this.currentTime-p.time)<this.epsilon?r:q;h.style.visibility=x?"visible":"hidden"}}}}k.matrixAutoUpdate=!0,k.matrixWorldNeedsUpdate=!0}}}}();var j=function(a,b,c){this.viewer=c.viewer,null===a&&(a=this.createPolyline([])),e.call(this,a,b,c),this.epsilon=.1};j.prototype=Object.create(e.prototype),j.prototype.constructor=j,j.prototype.keyTypes=["points","vis"],j.prototype.defaultKey={points:[],vis:1},j.prototype.stop=function(){e.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},j.prototype.update=function(){function a(a){a.root&&(a.viewer.removeOverlay("polyline",a.root),a.root=null)}return function(b){if(this.isPlaying!==!1&&(this.currentTime+=b*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime)return void a(this);for(var c=0,d=this.hierarchy.length;c<d;c++)for(var e=this.hierarchy[c],f=e.animationCache[this.data.name],g=0;g<this.keyTypes.length;g++){var h=this.keyTypes[g],i=f.prevKey[h],j=f.nextKey[h];if(j.time<=this.currentTime||i.time>=this.currentTime){for(i=this.data.hierarchy[c].keys[0],j=this.getNextKeyWith(h,c,1);j.time<this.currentTime&&j.index>i.index;)i=j,j=this.getNextKeyWith(h,c,j.index+1);f.prevKey[h]=i,f.nextKey[h]=j}var k=i[h],l=j[h];if(j.time!==i.time&&void 0!==k&&void 0!==l){var m=(this.currentTime-i.time)/(j.time-i.time);if(m<0&&(m=0),m>1&&(m=1),"points"===h){var n=m<.5?k:l;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var o=[],p=0;p<n.length;p++){var q=n[p].slice();if(0===p)q[0]=k[p][0]+(l[p][0]-k[p][0])*m,q[1]=k[p][1]+(l[p][1]-k[p][1])*m,q[2]=k[p][2]+(l[p][2]-k[p][2])*m;else if(p===n.length-1){var r=k.length-1,s=l.length-1;q[0]=k[r][0]+(l[s][0]-k[r][0])*m,q[1]=k[r][1]+(l[s][1]-k[r][1])*m,q[2]=k[r][2]+(l[s][2]-k[r][2])*m}var t=new THREE.Vector3(q[0],q[1],q[2]);o.push(t)}this.root=this.createPolyline(o)}else if("vis"===h){var u=Math.abs(this.currentTime-j.time)<this.epsilon?l:k;this.root.visible=u,u||a(this)}}}}}}(),j.prototype.createPolyline=function(a){for(var b=new THREE.Geometry,c=0;c<a.length;c++)b.vertices.push(a[c]);b.computeLineDistances();var d=new THREE.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),e=new THREE.Line(b,d,THREE.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",e),e},b.Animation=e,b.AnimationHandler=d,b.MeshAnimation=f,b.CameraAnimation=g,b.PolylineAnimation=j,b.VisibilityAnimation=h,b.AnnotationAnimation=i}(),function(){"use strict";var a=Autodesk.Viewing.Private,b=function(a,b){this.animations=[],this.viewer=a,this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=b,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new Autodesk.Viewing.Private.AnimationHandler,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2};b.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},b.prototype.add=function(b){if(!(!b.hierarchy||b.hierarchy.length<1||!b.hierarchy[0].keys||b.hierarchy[0].keys.length<2)){var c=null,d=this;if("camera"===b.type?(c=new a.CameraAnimation(d.viewer.camera,b,d),d.animations.push(c)):"annotation"===b.type?(c=new a.AnnotationAnimation(null,b,d),d.animations.push(c)):"polyline"===b.type?(c=new a.PolylineAnimation(null,b,d),d.animations.push(c)):"mesh"!==b.type&&"visibility"!==b.type||d.viewer.model.getData().instanceTree.enumNodeFragments(b.id,function(e){var f=d.viewer.getFragmentProxy(d.viewer.model,e);f&&(c="mesh"===b.type?new a.MeshAnimation(f,b,d):new a.VisibilityAnimation(f,b,b.id,d),d.animations.push(c))},!0),c){for(var e=0,f=b.hierarchy.length;e<f;e++)for(var g=b.hierarchy[e].keys,h=0;h<g.length;h++)void 0===g[h].xk&&d.keys.push(g[h].time);!function(a){a.sort(function(a,b){return a-b}),function(a,b,c){for(b=a.length;c=--b;)for(;c--;)a[b]!==a[c]||a.splice(c,1)}(a)}(d.keys)}this.updateFlag|=this.UPDATE_SCENE}},b.prototype.update=function(a){this.animationHandler.update(a);var b=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=a,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&this.pause(),b|=this.UPDATE_SCENE),this.updateFlag=0,b},b.prototype.play=function(a,b){if(this.onPlayCallback=b,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)return void this.pause();for(var c=0;c<this.animations.length;c++){this.animations[c].play(a)}this.isPlaying=!0,this.isPaused=!1},b.prototype.pause=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b.isPaused===this.isPaused&&b.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},b.prototype.pauseCameraAnimations=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b instanceof Autodesk.Viewing.Private.CameraAnimation&&b.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},b.prototype.stop=function(){for(var a=0;a<this.animations.length;a++){this.animations[a].stop()}this.isPlaying=!1,this.isPaused=!1},b.prototype.goto=function(a){if(void 0!==a){for(var b=0;b<this.animations.length;b++){this.animations[b].goto(a)}this.isPlaying=!0,this.isPaused=!0,this.currentTime=a,this.updateFlag|=this.UPDATE_SCENE}},b.prototype.next=function(){var a=function(a,b){for(var c=-1,d=0;d<b.length;d++)if(b[d]>a){c=b[d];break}return c<0?b[b.length-1]:c}(this.currentTime,this.keys);this.goto(a)},b.prototype.prev=function(){var a=function(a,b){for(var c=-1,d=b.length-1;d>-1;d--)if(b[d]<a){c=b[d];break}return c<0?b[0]:c}(this.currentTime,this.keys);this.goto(a)},a.KeyFrameAnimator=b}();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,ENABLE_DEBUG=avp.ENABLE_DEBUG||!0,ENABLE_TRACE=avp.ENABLE_TRACE||!0;!function(){"use strict";function a(a,b){function c(a){if(!a)return null;var b=window.devicePixelRatio;b||(b=1);var c=av.InitParametersSetting;c.canvas=a,c.devicePixelRatio=b;var d=new avp.FireflyWebGLRenderer(c);return d.context?(d.autoClear=!1,d.sortObjects=!1,d):null}function d(a){var b=K,c=b==avp.RENDER_NORMAL,d=A.settings.idbuffer&&b!=avp.RENDER_HIDDEN;b==avp.RENDER_HIDDEN?a.overrideMaterial=G.fadeMaterial:b==avp.RENDER_HIGHLIGHTED&&(a.overrideMaterial=G.highlightMaterial),A.renderScenePart(a,!0,c,d),a.overrideMaterial=null}function e(a){aa++,$>0&&(_=.8*_+.2*(a-$)),G.fpsCallback&&G.fpsCallback(G.fps())}function f(a){if(G.keyFrameAnimator){var b=$>0?(a-$)/1e3:0,c=G.keyFrameAnimator.update(b);if(c&&(G.sceneUpdated(!0),c&G.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}function g(){v&&(G.camera.aspect=w/x,G.camera.clientWidth=w,G.camera.clientHeight=x,A.setSize(w,x),G.controls.handleResize(),E&&E.setSize(w,x),G.invalidate(!0,!0,!0),v=!1,G.api.fireEvent({type:av.VIEWER_RESIZE_EVENT,width:w,height:x}))}function h(){if((D.enabled||E)&&!G.is2d){var a;if(a=G.model&&!G.model.isLoadDone()?G.model.getData().bbox:G.getVisibleBounds(!0,!1)){D.needClear=!0;var b=G.camera,c=a.clone(),d=new THREE.Vector3(1,0,0),e=Q.clone();b.worldUpTransform&&(c.applyMatrix4(b.worldUpTransform),d.applyMatrix4(b.worldUpTransform),e.applyMatrix4(b.worldUpTransform)),c.min.y-=.005*(c.max.y-c.min.y),B&&B.expandByGroundShadow(c,e);var f=c.size(),g=c.center();if(B||(f.x*=1.25,f.z*=1.25,f.x=f.z=Math.max(f.x,f.z)),b.worldUpTransform){var h=(new THREE.Matrix4).getInverse(b.worldUpTransform);g.applyMatrix4(h)}if(D.setTransform(g,f,b.worldup,d),E){var i=(new THREE.Vector3).subVectors(g,b.worldup.clone().multiplyScalar(f.y/2));E.setTransform(i,b.worldup,f)}B&&B.setGroundShadowTransform(g,f,b.worldup,d)}}}function i(a){V&&(h(),V=!1)}function j(a){for(var b in G.selectionMeshes){var c=G.selectionMeshes[b];if(c.model){var d=c.model.getFragmentList();c.geometry===d.getGeometry(c.fragId)&&d.getWorldMatrix(c.fragId,c.matrix)}}}function k(){B&&(B.state=avp.SHADOWMAP_NEEDS_UPDATE)}function l(a){if(!B||!G)return a;var b=S||R;if(K==avp.RENDER_SHADOWMAP){if(b)return K=avp.RENDER_FINISHED,a;a=B.continueUpdate(F,a,y),B.state==avp.SHADOWMAP_VALID&&(K=avp.RENDER_FINISHED,R=!0,S=!0)}return B.state==avp.SHADOWMAP_NEEDS_UPDATE?a=B.startUpdate(F,a,G.camera,Q,y):b||K==avp.RENDER_FINISHED&&B.state==avp.SHADOWMAP_INCOMPLETE&&(a=B.startUpdate(F,a,G.camera,Q,y),K=avp.RENDER_SHADOWMAP),a}function m(a){var b=y.updateMaterials();G.invalidate(b.needsClear,b.needsRender,b.overlayDirty);var c=f(a),h=G.controls.update(a),k=F&&F.update(a),m=h||c||C||k,n=v;v&&g(),R=R||m,T=T||m,T&&j(a),T=T||A.overlayUpdate(a);var o=G.model&&(G.model.isLoadDone()||G.model.myData.partPacksLoadDone===!0),p=G.progressiveRender?G.targetFrameBudget:1e10,q=p,r=F;if(V&&i(a),q=l(q),!B||K!=avp.RENDER_SHADOWMAP){var s=!1;!D||G.is2d||ba||(s=D.prepareGroundShadow(G));var t=R,u=F.frameResumePossible();if((R=R||!u)||S){if(m&&G.skipAOWhenMoving&&A.settings.sao&&!da&&(A.setAOEnabled(!1),da=!0),o&&G.signalProgress(0,av.ProgressState.RENDERING),Y>0){Z=.75*Z+.25*(a-Y)}Y=a,Z<I&&p<H?G.targetFrameBudget+=1:Z>I&&p>J&&(G.targetFrameBudget-=1),G.updateCameraMatrices(),A.beginScene(G.scene,G.camera,G.lightsOn?G.lights:G.no_lights,R),(m||n)&&G.api.fireEvent(G.cameraChangedEvent),s&&!E&&G.renderGroundShadow(),r&&(K=r.hasHighlighted()?avp.RENDER_HIGHLIGHTED:avp.RENDER_NORMAL,r.reset(G.camera,K,t))}else Y=-1;if(E&&!G.is2d&&!ba){E.prepareGroundReflection(G,D,R)&&F.isDone()&&G.showGhosting&&!F.areAllVisible()&&(K=avp.RENDER_HIDDEN,F.reset(G.camera,K))}var w=!1;r.isEmpty()||r.isDone()||(w=!0,q=r.renderSome(d,q),r.isDone()&&K===avp.RENDER_HIGHLIGHTED&&(K=avp.RENDER_NORMAL,r.reset(G.camera,K),q=r.renderSome(d,q)),r.isDone()?(K===avp.RENDER_NORMAL&&!r.areAllVisible()&&G.showGhosting?E&&!E.finished||(K=avp.RENDER_HIDDEN,r.reset(G.camera,K),q=r.renderSome(d,q)):(K=avp.RENDER_FINISHED,A.renderScenePart(G.sceneAfter,!0,!0,!0)),o&&G.signalProgress(100,av.ProgressState.RENDERING)):o&&G.signalProgress(100*r.getRenderProgress(),av.ProgressState.RENDERING),e(a)),T&&(w=!0,A.renderScenePart(G.sceneAfter,!0,!0,!0),!r.isEmpty()&&r.isDone()||G.showOverlaysWhileMoving?(G.renderOverlays(),r.isEmpty()||r.isDone()||(T=!0)):A.clearAllOverlays());var x=!0;G.skipAOWhenMoving&&(m||!r.isDone()?x=!1:N&&(w=!0,da&&(ea=!0))),r.enableNonResumableFrames&&K!==avp.RENDER_FINISHED&&!m&&(w=!1),w&&A.composeFinalFrame(!x),W!==w&&(W=w,G.api.fireEvent({type:av.FINAL_FRAME_RENDERED_CHANGED_EVENT,value:{finalFrame:!w}})),N=m,$=a,r&&r.needsRender()?(S=!0,r.resetNeedsRender()):S=!1,R=!1,C=!1,ea&&(ea=!1,A.setAOEnabled(!0),da=!1,G.invalidate(!0,!0))}}function n(){for(var a in G.selectionMeshes){var b=G.selectionMeshes[a];b.model&&b.model.isConsolidated()&&b.model.updateRenderProxy(b,b.fragId)}}function o(a){function b(){if(c.animations){G.keyFrameAnimator=new avp.KeyFrameAnimator(G,c.animations.duration);for(var a in c.animations.animations)G.keyFrameAnimator.add(c.animations.animations[a]);G.keyFrameAnimator.goto(0),G.api.fireEvent({type:av.ANIMATION_READY_EVENT})}G.api.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,b)}var c=a.getData();a.isObjectTreeCreated()?b():G.api.addEventListener(av.OBJECT_TREE_CREATED_EVENT,b)}function p(a,b){ka=ka||new THREE.Box3,b.updateMatrixWorld(!0),b.traverse(function(b){var c=b.geometry;void 0!==c&&c.visible&&(c.boundingBox||c.computeBoundingBox(),ka.copy(c.boundingBox),ka.applyMatrix4(b.matrixWorld),a.union(ka))})}function q(){var a=new THREE.Box3,b=G.overlayScenes;for(var c in b)b.hasOwnProperty(c)&&p(a,b[c].scene);return p(a,G.scene),a}function r(a){var b,c,d;if(a.indexOf(";base64,")==-1)return b=a.split(","),c=b[0].split(":")[1],d=decodeURIComponent(b[1]),new Blob([d],{type:c});b=a.split(";base64,"),c=b[0].split(":")[1],d=window.atob(b[1]);for(var e=d.length,f=new Uint8Array(e),g=0;g<e;++g)f[g]=d.charCodeAt(g);return new Blob([f],{type:c})}function s(a){this.bounds=a,this.point=new THREE.Vector4,this.point.z=0,this.point.w=1}var t,u,v,w,x,y,z,A,B,C,D,E,F,G=this,H=1e3/15,I=1e3/30,J=1e3/120,K=avp.RENDER_NORMAL,L=-1,M=-1,N=!1,O="y",P=null,Q=null,R=!1,S=!1,T=!1,U={type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,state:Autodesk.Viewing.ProgressState.LOADING,percent:0},V=!1,W=!1,X=0,Y=0,Z=0,$=0,_=1e3/60,aa=0,ba=!0,ca=!1,da=!1,ea=!1,fa=!1,ga=null,ha=null,ia=av.getGlobal();a&&setInterval(function(){ba||aa<60||G.track({name:"fps",value:Number(G.fps().toFixed(2)),aggregate:"last"})},3e4),this.api=b,this.canvas=a,this.loader=null,this.initialize=function(){if(t=new THREE.Vector3(0,1,0),F=new avp.RenderScene,(z=c(a))||av.isNodeJS){A=new avp.RenderContext,A.init(z,a?a.clientWidth:0,a?a.clientHeight:0),this.use2dInstancing=av.isMobileDevice()&&this.glrenderer().supportsInstancedArrays(),y=new avp.createMaterialManager(z),avp.init_UnifiedCamera(THREE),this.camera=new av.UnifiedCamera(a?a.clientWidth:512,a?a.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],ga=(new THREE.Color).setRGB(1,1,1),ha=(new THREE.Color).setRGB(1,1,1),this.cameraChangedEvent=this.camera.getCameraChangedEvent(),P=new THREE.Vector3(1,1,1),Q=(new THREE.Vector3).copy(P),this.scene=new THREE.Scene,this.sceneAfter=new THREE.Scene,this.sceneAfter.sortObjects=!1,this.overlayScenes={},this.selectionMaterial2d=null,this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0}),this.selectionMaterialTop.packedNormals=!0,this.selectionMaterialBase.packedNormals=!0,ja("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,avp.addInstancingSupport(this.fadeMaterial),y.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.highlightMaterial.packedNormals=!0,avp.addInstancingSupport(this.highlightMaterial),y.addMaterial("__highlightMaterial__",this.highlightMaterial,!0),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=I,av.isMobileDevice()&&(H*=2,J/=2,I*=2,this.targetFrameBudget/=2),this.controls={update:function(a){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new avp.MultiModelSelector(this),this.visibilityManager=new avp.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0;var b=avp.LightPresets[avp.DefaultLightPreset].bgColorGradient;this.setClearColors(b[0],b[1],b[2],b[3],b[4],b[5]),D=new av.Shaders.GroundShadow(z),D.enabled=!0,y.addMaterialNonHDR("groundShadowDepthMaterial",D.getDepthMaterial()),y.addOverrideMaterial("normalsMaterial",A.getDepthMaterial()),A.beginScene(this.scene,this.camera,this.noLights,!0),A.composeFinalFrame(!0,av.isIE11)}},this.renderGroundShadow=function(a){B?B.state==avp.SHADOWMAP_VALID&&B.renderGroundShadow(G.camera,a||A.getColorTarget()):(D.renderShadow(G.camera,a||A.getColorTarget()),D.rendered=!0)},this.setLmvDisplay=function(a){ia=a},this.run=function(){u=0,setTimeout(function(){!function a(b){u=ia.requestAnimationFrame(a),m(b)}()},1)},this.toggleProgressive=function(a){this.progressiveRender=a,R=!0},this.toggleSwapBlackAndWhite=function(a){this.swapBlackAndWhite=a,A.toggleSwapBlackAndWhite(a),R=!0},this.toggleGhosting=function(a){this.showGhosting=a,R=!0},this.toggleOverlaysWhileMoving=function(a){this.showOverlaysWhileMoving=a},this.togglePostProcess=function(a,b){A.initPostPipeline(a,b),this.fireRenderOptionChanged(),R=!0},this.toggleCelShading=function(a){A.toggleCelShading(a),this.fireRenderOptionChanged(),R=!0},this.toggleGroundShadow=function(a){D.enabled!==a&&(D.enabled=a,D.clear(),h(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(a){D.enabled&&(D.setColor(a),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(a){D.enabled&&(D.setAlpha(a),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(a){a&&E||!a&&!E||(a?(E=new av.Shaders.GroundReflection(z,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:A.getClearPass()}),E.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),E.toggleEnvMapBackground(ca),E.setEnvRotation(A.getEnvRotation()),h()):(E.cleanup(),E=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(a){E&&(E.setColor(a),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(a){E&&(E.setAlpha(a),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(a){ca=a,A.toggleEnvMapBackground(a),E&&E.toggleEnvMapBackground(a),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return ca},this.setOptimizeNavigation=function(a){this.skipAOWhenMoving=a},this.renderOverlays=function(){n();var a=this.lightsOn;a||this.toggleLights(!0,!0);var b;this.dir_light1&&(b=this.dir_light1.intensity,this.dir_light1.intensity=1),A.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),a||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=b),T=!1},this.setLayerVisible=function(a,b){this.matman().setLayerVisible(a,b),this.invalidate(!0)},this.isLayerVisible=function(a){return this.matman().isLayerVisible(a)},this.getVisibleLayerIds=function(){var a=this.model.getData(),b=a.layersMap,c=[];for(var d in b)this.isLayerVisible(d)&&c.push(b[d]);return c},this.updateCameraMatrices=function(){function a(){b=new THREE.Matrix4,c=new THREE.Matrix4,d=new THREE.Box3}var b,c,d;return function(){d||a();var e=this.camera;if(b.compose(e.position,e.quaternion,e.scale),c.getInverse(b),e.worldup&&this.setWorldUp(e.worldup),this.model){var f=this.getVisibleBounds(!0,T);if(d.copy(f),E){var g=new THREE.Vector3;g.multiplyVectors(d.max,e.worldup);var h=new THREE.Vector3;h.multiplyVectors(d.min,e.worldup),g.sub(h),g.x>=0?d.min.x-=g.x:d.max.x-=g.x,g.y>=0?d.min.y-=g.y:d.max.y-=g.y,g.z>=0?d.min.z-=g.z:d.max.z-=g.z}B&&B.groundShapeBox&&d.union(B.groundShapeBox),d.applyMatrix4(c);var i=1e-5*(d.max.z-d.min.z),j=.5*(d.max.y-d.min.y),k=-(d.max.z+i)-j,l=-(d.min.z-i)+j;e.isPerspective&&(k=Math.max(k,Math.min(1,1e-4*Math.abs(l-k)))),l=Math.max(l,k),e.near=k,e.far=l,e.updateProjectionMatrix();var m;if(this.model.is2d()){var n=this.intersectGroundViewport(new THREE.Vector3(0,0,1));m=n?e.position.distanceTo(n):e.position.distanceTo(f.center());var o=A.settings.deviceHeight/(2*m*Math.tan(THREE.Math.degToRad(.5*e.fov)));y.updatePixelScale(o),y.updateSwapBlackAndWhite(this.swapBlackAndWhite)}else{var p,q=y.getCutPlanesRaw();if(q&&q.length){var r=q[0],s=e.target.clone().sub(e.position).normalize(),t=s.dot(r);if(0===t)p=f.center();else{var u=-(e.position.clone().dot(r)+r.w)/t;p=f.clampPoint(s.multiplyScalar(u).add(e.position))}}else p=f.center();m=e.position.distanceTo(p);var o=A.settings.deviceHeight/(2*m*Math.tan(THREE.Math.degToRad(.5*e.fov)));y.updatePixelScale(o)}}}}(),this.initLights=function(){this.dir_light1=new THREE.DirectionalLight(ga,1),this.dir_light1.position.set(-1,0,1),this.amb_light=new THREE.AmbientLight(ha),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),fa=!0},this.toggleLights=function(a,b){if(this.amb_light){this.lightsOn=a;var c=avp.LightPresets[L],d=c.ambientColor,e=c.directLightColor;d=d||ha.toArray(),e=e||ga.toArray(),this.lightsOn?(b&&this.amb_light?this.amb_light.color.setRGB(.5*e[0],.5*e[1],.5*e[2]):this.amb_light&&this.amb_light.color.setRGB(d[0],d[1],d[2]),this.dir_light1&&this.dir_light1.color.setRGB(e[0],e[1],e[2])):this.amb_light&&b&&this.amb_light.color.setRGB(d[0],d[1],d[2])}},this.syncCamera=function(a){this.camera.updateProjectionMatrix(),a&&this.setWorldUp(this.api.navigation.getWorldUpVector()),C=!0},this.setViewFromFile=function(a,b){var c,d=a.getDefaultCamera();if(d)c=d;else{c={};var e=a.getBoundingBox(),f=e.size();if(c.target=e.center(),a.is2d()){c.isPerspective=!1
;var g=f.x/f.y,h=this.camera.aspect;c.orthoScale=h>g?f.y:f.x/h,c.up=new THREE.Vector3(0,0,1),c.position=c.target.clone(),c.position.z+=c.orthoScale,c.target.y+=1e-6*f.y}else c.isPerspective=!0,c.fov=this.camera.fov,c.up=this.camera.up.clone(),c.position=c.target.clone(),c.position.z+=1.5*Math.max(f.x,f.y,f.z)}this.setViewFromCamera(c,b)},this.adjustOrthoCamera=function(a){if(!a.isPerspective&&this.model){var b=this.model.getBoundingBox(),c=b.size(),d=a.target.clone().sub(a.position),e=d.length();if(e>1e3*c.length()){var f=a.position.distanceTo(b.center());a.target.copy(a.position).add(d.normalize().multiplyScalar(f))}else if(Math.abs(e-a.orthoScale)/e>1e-5){avp.logger.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?");var g=0===a.fov&&1===a.orthoScale,h=!g;h&&a.position.copy(a.target).add(d.normalize().multiplyScalar(-a.orthoScale))}}},this.setViewFromCamera=function(a,b){this.adjustOrthoCamera(a);var c=this.controls.isToolActivated("freeorbit"),d=this.model?this.model.getUpVector():null;this.model&&this.model.getData().basePath.indexOf("SaRang")!=-1&&(d=[0,0,1]);var e;e=d?(new THREE.Vector3).fromArray(d):c?a.up.clone():av.Navigation.snapToAxis(a.up.clone()),c?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",e.equals(a.up)):a.up=e;var f=this.api.navigation;if(f){var g=this.camera;if(b)g.up.copy(a.up),g.position.copy(a.position),g.target.copy(a.target),a.isPerspective?g.fov=a.fov:(g.saveFov=a.fov,g.fov=av.UnifiedCamera.ORTHO_FOV),g.isPerspective=a.isPerspective,g.orthoScale=a.orthoScale,g.dirty=!0,f.setWorldUpVector(c?e:g.up),f.setView(g.position,g.target),f.setPivotPoint(g.target),this.syncCamera(!0);else if(g.isPerspective=a.isPerspective,a.isPerspective||(g.saveFov=a.fov,a.fov=av.UnifiedCamera.ORTHO_FOV),c)f.setRequestTransitionWithUp(!0,a.position,a.target,a.fov,a.up,e);else{var h=f.computeOrthogonalUp(a.position,a.target);f.setRequestTransitionWithUp(!0,a.position,a.target,a.fov,h,e)}}C=!0},this.setViewFromViewBox=function(a,b,c,d){if(a.is2d()){var e={},f=a.getBoundingBox(),g={width:b[2]-b[0],height:b[3]-b[1]};g.aspect=g.width/g.height,g.centerX=b[0]+g.width/2,g.centerY=b[1]+g.height/2;var h=this.camera.aspect;h>g.aspect?e.orthoScale=g.height:e.orthoScale=g.width/h,e.isPerspective=!1,e.position=new THREE.Vector3(g.centerX,g.centerY,f.center().z+e.orthoScale),e.target=new THREE.Vector3(g.centerX,g.centerY,f.center().z),e.target.y+=1e-6*g.height,e.up=new THREE.Vector3(0,0,1),this.setViewFromCamera(e,d)}},this.setWorldUp=function(a){if(!t.equals(a)){t.copy(a);var b=Math.abs(a.x);O="x",Math.abs(a.y)>b&&(O="y",b=Math.abs(a.y)),Math.abs(a.z)>b&&(O="z");var c=new THREE.Vector3(0,1,0);G.camera.worldUpTransform=function(a,b){var c=(new THREE.Vector3).crossVectors(b,a).normalize(),d=Math.acos(a.dot(b));return(new THREE.Matrix4).makeRotationAxis(c,d)}(c,a),this.sceneUpdated(!1)}},this.addModel=function(a){if(a){var b=!!this.model,c=a.is2d(),d=0;if(!this.model){this.model=a,A.setUnitScale(a.getUnitScale());d=a.getData().bbox.size().length()}if(F.addModel(a),this.selector.addModel(a),this.visibilityManager.addModel(a),c){var e=a.getData();y.initLayersTexture(e.layerCount,e.layersMap);var f=y.create2DMaterial(a,{useInstancing:this.use2dInstancing},!0,!1,function(){G.invalidate(!1,!0,!1)}),g=y.findMaterial(a,f);if(A.enter2DMode(g),!b){this.is2d=!0,M=L,this.setLightPreset(avp.DefaultLightPreset2d);var h=a.getData();if(h.hidePaper){var i=h.bgColor,j=i>>16&255,k=i>>8&255,l=255&i;this.setClearColors(j,k,l,j,k,l)}}}if(this.api.navigation){this.api.navigation.setIs2D(c&&!b),this.api.setActiveNavigationTool();var m=a.getData();m.isLeaflet?this.api.navigation.setConstraints2D(m.bbox,m.maxPixelPerUnit):this.api.navigation.setConstraints2D()}b||a.getData().loadOptions.preserveView||(this.setViewFromFile(a,!0),this.controls.recordHomeView()),c||this.setLightPresetFromFile(a)||(M>=0?(this.setLightPreset(M,!0),M=-1):this.setLightPreset(L,!1)),d>0&&A.setAOOptions(Math.min(10,.05*d)),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.getSvfMaterialId=function(a){return this.model.getFragmentList().getSvfMaterialId(a)},this.getMaterials=function(){return y},this.setupMesh=function(a,b,c,d){var e=a.getData(),f={geometry:b,matrix:d,isLine:b.isLines,isWideLine:b.isWideLines,isPoint:b.isPoints,is2d:b.is2d};if(b.isLines||b.isPoints){var g,h=!!b.attributes.color,i=y.findMaterial(a,c);b.isPoints?g=new THREE.PointCloudMaterial({vertexColors:h,size:b.pointSize}):b.isWideLines?(g=new THREE.MeshBasicMaterial({vertexColors:h}),g.wideLines=!0,b.isLines=!1,f.isLine=!1,g.polygonOffset=i.polygonOffset,g.polygonOffsetFactor=i.polygonOffsetFactor,g.polygonOffsetUnits=i.polygonOffsetUnits):g=new THREE.LineBasicMaterial({vertexColors:h}),h||(g.color=i.color),g.svfMatId=c,y.addMaterialNonHDR(e.basePath+c+"_line_"+g.id,g),f.material=g,e.hasLines=!0}else{var g=y.findMaterial(a,c);g&&(g.svfMatId=c),y.applyGeometryFlagsToMaterial(g,b),f.material=g}return f},this.onDemandLoadComplete=function(a){ba=!1,this.signalProgress(100,av.ProgressState.LOADING),this.invalidate(!1,!0),this.is2d&&(this.selectionMaterial2d=y.init2DSelectionMaterial(a,this.use2dInstancing,function(){G.invalidate(!1,!0,!1)}),this.createOverlayScene("selection2d",this.selectionMaterial2d)),a.getData().hasLines&&y.togglePolygonOffset(!0),o(a),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:a,onDemandLoad:!0})},this.onLoadComplete=function(a){ba=!1,this.signalProgress(100,av.ProgressState.LOADING),this.sceneUpdated(!1),this.is2d&&(this.selectionMaterial2d=y.init2DSelectionMaterial(a,this.use2dInstancing,function(){G.invalidate(!1,!0,!1)}),this.createOverlayScene("selection2d",this.selectionMaterial2d));var b=a.getData();F.getGeometryList()&&F.getGeometryList().printStats(),b.hasLines&&y.togglePolygonOffset(!0),o(a),a.hasGeometry()||avp.logger.warn("Loaded model has not geometry."),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:a})},this.signalProgress=function(a,b){U.percent===a&&U.state===b||(U.percent=a,U.state=b,this.api.fireEvent(U))},this.resize=function(a,b){v=!0,w=a,x=b},this.unloadModel=function(a){this.removeModel(a)&&a.loader&&a.loader.dtor()},this._addLoadingFile=function(a){this.loaders||(this.loaders=[]),this.loaders.push(a)},this._removeLoadingFile=function(a){if(this.loaders){var b=this.loaders.indexOf(a);b>=0&&this.loaders.splice(b,1)}},this.removeModel=function(a){return!!F.removeModel(a)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),a.dtor(this.glrenderer()),y.cleanup(a),this.selector.removeModel(a),this.visibilityManager.removeModel(a),a===this.model&&(this.model=null,F.isEmpty()||(this.model=F.getModels()[0])),this.api.fireEvent({type:av.MODEL_UNLOADED_EVENT,model:a}),this.invalidate(!0,!0,!0),!0)},this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlayScene("selection2d"),A.exit2DMode(),L=M),A.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),A.composeFinalFrame(!0),this.loaders&&(this.loaders.forEach(function(a){a.dtor()}),this.loaders=[]);for(var a=F.getModels(),b=a.length-1;b>=0;b--)this.unloadModel(a[b])};var ja=function(a,b,c){b.depthWrite=!1,b.depthTest=!0,b.side=THREE.DoubleSide,c.depthWrite=!1,c.depthTest=!0,c.side=THREE.DoubleSide,avp.addInstancingSupport(b),avp.addInstancingSupport(c),G.createOverlayScene(a,b,c)};this.createOverlayScene=function(a,b,c,d){b&&y.addOverrideMaterial(a+"_pre",b),c&&y.addOverrideMaterial(a+"_post",c);var e=new THREE.Scene;e.__lights=this.scene.__lights,this.overlayScenes[a]={scene:e,camera:d,materialPre:b,materialPost:c}},this.removeOverlayScene=function(a){this.overlayScenes[a]&&(delete this.overlayScenes[a],this.invalidate(!1,!1,!0))},this.addOverlay=function(a,b){this.overlayScenes[a].scene.add(b),this.invalidate(!1,!1,!0)},this.addMultipleOverlays=function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.addOverlay(a,b[c])},this.removeOverlay=function(a,b){this.overlayScenes[a]&&(this.overlayScenes[a].scene.remove(b),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.removeOverlay(a,b[c])},this.clearOverlay=function(a){if(this.overlayScenes[a]){var b,c,d=this.overlayScenes[a].scene;for(c=d.children.length-1;c>=0;--c)(b=d.children[c])&&d.remove(b);this.invalidate(!1,!1,!0)}},this.setClearColors=function(a,b,c,d,e,f){if(this.clearColorTop=new THREE.Vector3(a/255,b/255,c/255),this.clearColorBottom=new THREE.Vector3(d/255,e/255,f/255),!y._reflectionMap||y._reflectionMap.isBgColor){var g=y.setCubeMapFromColors(this.clearColorTop,this.clearColorBottom);A.setCubeMap(g),this.invalidate(!0)}A.setClearColors(this.clearColorTop,this.clearColorBottom),E&&E.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),R=!0,this.fireRenderOptionChanged()};var ka;this.getVisibleBounds=function(a,b){var c=new THREE.Box3;return F.isEmpty()||(p(c,this.scene),c=F.getVisibleBounds(a).union(c),b&&(c=q().union(c))),c},this.getFitBounds=function(a){var b;return a||null===this.selector||(b=this.selector.getSelectionBounds()),b&&!b.empty()||(b=this.getVisibleBounds()),b},this.getRenderProxy=function(a,b){return a.getFragmentList().getVizmesh(b)},this.promiseRenderProxy=function(a,b){var c=a.getFragmentList().promiseVizmesh(b);return c.lmv_model=a,c},this.cancelPromisedRenderProxy=function(a){return!!a.lmv_model&&a.lmv_model.getFragmentList().cancelPromisedVizmesh(a)},this.getFragmentProxy=function(a,b){return new avp.FragmentPointer(a.getFragmentList(),b)},this.getRenderProxyCount=function(a){return a.getFragmentList().getCount()},this.getRenderProxyDbIds=function(a,b){return a.getFragmentList().getDbIds(b)},this.isWholeModelVisible=function(a){return!F||F.areAllVisible()},this.isNodeVisible=function(a,b){return this.visibilityManager.isNodeVisible(b,a)},this.highlightObjectNode=function(a,b,c,d){a.is2d()&&(y.highlightObject2D(b,c),this.invalidate(!1,!1,!0));var e=this,f=a.getData().instanceTree;if(f&&!a.is2d())f.enumNodeFragments(b,function(b){e.highlightFragment(a,b,c,d)},!1);else{var g=b;if(a.is2d()&&(g=a.getData().fragments.dbId2fragId[b]),Array.isArray(g))for(var h=0;h<g.length;h++)e.highlightFragment(a,g[h],c,d);else e.highlightFragment(a,g,c,d)}},this.highlightFragment=function(a,b,c,d){var e=this.getRenderProxy(a,b);if(e){var f=!d||e.is2d||e.isPoint,g=a.id+":"+b;if(f){var h="selection";if(a.is2d()&&(h+="2d"),e.isPoint&&(h+="_points"),c){var i=this.promiseRenderProxy(a,b),j=this;this.selectionMeshes[g]=i,i.then(function(c){var d,e=j.getRenderProxy(c.model,c.fragId);if(e&&e.geometry){if(e.isPoint){var f=e.material.clone();f.color=j.selectionMaterialBase.color,f.needsUpdate=!0,d=new THREE.Mesh(e.geometry,f)}else d=new THREE.Mesh(e.geometry,e.material);d.matrix.copy(e.matrixWorld),d.matrixAutoUpdate=!1,d.matrixWorldNeedsUpdate=!0,d.frustumCulled=!1,d.model=a,d.fragId=b,c.model.getFragmentList().lockGeometry(b),j.addOverlay(h,d),j.selectionMeshes[g]=d}}).catch(function(a){a.canceled||delete j.selectionMeshes[g]})}else if(this.selectionMeshes.hasOwnProperty(g)){var k=this.selectionMeshes[g];k instanceof Promise?this.cancelPromisedRenderProxy(k):(a.getFragmentList().unlockGeometry(b),this.removeOverlay(h,k)),delete this.selectionMeshes[g]}}f&&c||a.setHighlighted(b,c)&&this.invalidate(!0)}},this.explode=function(a){a!=X&&(X=a,F.explode(a),this.sceneUpdated(!0),this.api.fireEvent({type:av.EXPLODE_CHANGE_EVENT,scale:a}))},this.getExplodeScale=function(){return X},this.setGhostingBrightness=function(a){this.fadeMaterial.color=a?new THREE.Color(1052688):new THREE.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.setLightPreset=function(a,b){if(fa||this.initLights(),L!=a||b){(a<0||avp.LightPresets.length<=a)&&(a=avp.DefaultLightPreset),L=a;var c=avp.LightPresets[a];if(c&&c.path){var d="res/environments/"+c.path,e=avp.getResourceUrl(d+"_mipdrop."+(c.type||"")+".dds"),f=avp.getResourceUrl(d+"_irr."+(c.type||"")+".dds"),g=(y.setIrradianceMap(f,c.E_bias,function(){G.invalidate(!0)}),y.setCubeMap(e,c.E_bias,function(a){G.invalidate(!0),a||y.setCubeMapFromColors(G.clearColorTop,G.clearColorBottom)}));A.setCubeMap(g),y.setEnvExposure(-c.E_bias),A.setEnvExposure(-c.E_bias),this.setTonemapExposureBias(c.E_bias),this.setTonemapMethod(c.tonemap),this.setGhostingBrightness(c.darkerFade)}else{y.setIrradianceMap(null);var g=y.setCubeMap(null);A.setCubeMap(g),y.setEnvExposure(0),A.setEnvExposure(0),this.setTonemapExposureBias(0),this.setTonemapMethod(0),this.setGhostingBrightness(!1),this.invalidate(!0)}var h=av.Shaders.SAOShader.uniforms.radius.value,i=av.Shaders.SAOShader.uniforms.intensity.value;c.hasOwnProperty("saoRadius")&&(h=c.saoRadius),c.hasOwnProperty("saoIntensity")&&(i=c.saoIntensity),A.setAOOptions(h,i);var j=c.bgColorGradient;j||(j=avp.BackgroundPresets.Custom),this.setClearColors(j[0],j[1],j[2],j[3],j[4],j[5]);var l=1;null!==c.lightMultiplier&&void 0!==c.lightMultiplier&&(l=c.lightMultiplier),Q.copy(P),c.lightDirection&&Q.fromArray(c.lightDirection).negate(),B&&k(),this.dir_light1&&(this.dir_light1.intensity=l,c.lightDirection&&this.dir_light1.position.set(-c.lightDirection[0],-c.lightDirection[1],-c.lightDirection[2])),y.setEnvRotation(c.rotation||0),A.setEnvRotation(c.rotation||0),E&&E.setEnvRotation(c.rotation||0),this.toggleLights(0!==l),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged()}},this.setLightPresetFromFile=function(a){if(!a||a.is2d())return!1;var b=a.getMetadata("renderEnvironmentStyle","value",null);if(null===b||""===b)return!1;var c=a.getMetadata("renderEnvironmentGroundReflection","value",null);null!==c&&(this.api.prefs.hasTag("groundReflection","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundReflection is locked. No changes."):(this.api.prefs.tag("no-storage","groundReflection"),this.api.setGroundReflection(c)));var d=a.getMetadata("renderEnvironmentGroundShadow","value",null);null!==d&&(this.api.prefs.hasTag("groundShadow","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundShadow is locked. No changes."):(this.api.prefs.tag("no-storage","groundShadow"),this.api.setGroundShadow(d)));var e=a.getMetadata("renderEnvironmentAmbientShadows","value",null);null!==e&&(this.api.prefs.hasTag("ambientShadows","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): ambientShadows is locked. No changes."):(this.api.prefs.tag("no-storage","ambientShadows"),this.api.setQualityLevel(e,A.getAntialiasing())));var f=a.getMetadata("renderEnvironmentDisplayLines","value",null);null!==f&&(this.api.prefs.hasTag("lineRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): lineRendering is locked. No changes."):(this.api.prefs.tag("no-storage","lineRendering"),this.api.hideLines(!f)));var g=a.getMetadata("renderEnvironmentDisplayPoints","value",null);null!==g&&(this.api.prefs.hasTag("pointRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): pointRendering is locked. No changes."):(this.api.prefs.tag("no-storage","pointRendering"),this.api.hidePoints(!g)));var h=avp.LightPresets.filter(function(a){return a.name===b});if(h=h[0]||null)if(this.api.prefs.hasTag("lightPreset","ignore-producer"))avp.logger.debug("setLightPresetFromFile(): lightPreset is locked. No changes.");else{this.api.prefs.tag("no-storage","lightPreset");var i=avp.ModelSettingsEnvironment;i||(i=avp.ModelSettingsEnvironment={},avp.LightPresets.push(i)),avp.copyLightPreset(h,i),i.name="(Custom: Model defined)";var j=a.getMetadata("renderEnvironmentExposureBias","value",null),k=a.getMetadata("renderEnvironmentExposureBase","value",null);null!==j&&null!==k&&(i.E_bias=j+k);var l=a.getMetadata("renderEnvironmentBackgroundColor","value",null);this.api.prefs.hasTag("backgroundColorPreset","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): backgroundColorPreset is locked. No changes."):l&&(i.bgColorGradient=[255*l[0],255*l[1],255*l[2],255*l[0],255*l[1],255*l[2]]);var m=a.getMetadata("renderEnvironmentRotation","value",null);null!==m&&(i.rotation=m);var n=avp.LightPresets.indexOf(i);this.api.setLightPreset(n)}var o=a.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return null!==o&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(o))),h},this.setTonemapMethod=function(a){a!=A.getToneMapMethod()&&(A.setTonemapMethod(a),y.setTonemapMethod(a),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(a){a!=A.getExposureBias()&&(A.setTonemapExposureBias(a),y.setTonemapExposureBias(a),this.fireRenderOptionChanged(),this.invalidate(!0))},this.dtor=function(){window.cancelAnimationFrame(u),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.visibilityManager=null,F=null,A=null,y.dtor(),y=null},this.hideLines=function(a){return!(!F||F.isEmpty())&&(F.hideLines(a),this.sceneUpdated(!0),!0)},this.hidePoints=function(a){return!(!F||F.isEmpty())&&(F.hidePoints(a),this.sceneUpdated(!0),!0)},this.getCutPlanes=function(){return y.getCutPlanes()},this.setCutPlanes=function(a){y.setCutPlanes(a),this.sceneUpdated(),this.api.fireEvent({type:av.CUTPLANES_CHANGE_EVENT,planes:a})},this.fireRenderOptionChanged=function(){y.toggleMRTSetting(A.mrtFlags()),this.api.fireEvent({type:av.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(a,b){var c=this.camera;a.z=-1;var d=new THREE.Vector3(a.x,a.y,1);return a=a.unproject(c),d=d.unproject(c),d.sub(a).normalize(),b||(b=new THREE.Ray),b.set(c.isPerspective?c.position:a,d),b},this.rayIntersect=function(a,b,c,d){var e=F.rayIntersect(a.origin,a.direction,b,c,d);if(this.sceneAfter.children.length){var f=new THREE.Raycaster(a.origin,a.direction,this.camera.near,this.camera.far),g=[];avp.VBIntersector.intersectObject(this.sceneAfter,f,g,!0),g.length&&(!e||g[0].distance<e.distance)&&(e=g[0])}if(!e)return null;var h=e.fragId,i=e.point,j=e.face,k=e.model,l=e.dbId;if(void 0===l&&void 0!==h){l=k.getFragmentList().getDbIds(h);k.getData().instanceTree||(l=h)}return{dbId:l,fragId:h,intersectPoint:i,face:j,model:k}},this.castRayViewport=function(){var a;return function(b,c,d,e){return a=a||new THREE.Ray,F?(this.viewportToRay(b,a),this.rayIntersect(a,c,d,e)):{}}}(),this.clientToViewport=function(a,b){var c=G.canvas.getBoundingClientRect();return new THREE.Vector3((a+.5)/c.width*2-1,2*-((b+.5)/c.height)+1,1)},this.viewportToClient=function(a,b){var c=G.canvas.getBoundingClientRect();return new THREE.Vector3(.5*(a+1)*c.width-.5,(b-1)*-.5*c.height-.5,0)},this.castRay=function(a,b,c){return this.castRayViewport(this.clientToViewport(a,b),c)},this.intersectGroundViewport=function(a){var b=this.camera,c="z";this.is2d||(c=O);var d=a;d.z=-1;var e=new THREE.Vector3(d.x,d.y,1);d=d.unproject(b),e=e.unproject(b),e.sub(d).normalize();var f=e;if(Math.abs(f[c])<1e-6)return null;var g;g=b.isPerspective?b.position:d;var h=this.model?this.model.getBoundingBox().min[c]:0,i=(h-g[c])/f[c];return f.multiplyScalar(i),f.add(g),f},this.intersectGround=function(a,b){return this.intersectGroundViewport(this.clientToViewport(a,b))},this.hitTestViewport=function(a,b){var c;if(G.is2d){var d,e=[];if((d=av.isMobileDevice()?A.idAtPixels(a.x,a.y,45,e):A.idAtPixels(a.x,a.y,5,e))<=0)return null;var f=this.intersectGroundViewport(a),g=F.findModel(e[1])||G.model;c={intersectPoint:f,dbId:d,fragId:g.getData().fragments.dbId2fragId[d],model:g}}else c=this.castRayViewport(a,b);return c},this.hitTest=function(a,b,c){return G.hitTestViewport(this.clientToViewport(a,b),c)},this.snappingHitTestViewport=function(a,b){var c;if(this.model.getData().isLeaflet){var d=this.intersectGroundViewport(a);c={intersectPoint:d}}else if(G.is2d){var e;if((e=av.isMobileDevice()?A.idAtPixels(a.x,a.y,45):A.idAtPixels(a.x,a.y,17))<0)return null;var d=this.intersectGroundViewport(a),f=G.model.getData().fragments,g=f?f.dbId2fragId[e]:-1;c={intersectPoint:d,dbId:e,fragId:g}}else{var e=A.idAtPixel(a.x,a.y);c=this.castRayViewport(a,b,e>0?[e]:null)}return c},this.snappingHitTest=function(a,b,c){return this.snappingHitTestViewport(this.clientToViewport(a,b),c)},this.rolloverObjectViewport=function(a){A.rolloverObjectViewport(a.x,a.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(a,b){this.rolloverDisabled||this.rolloverObjectViewport(this.clientToViewport(a,b))},this.disableRollover=function(a){this.rolloverDisabled=a},this.rolloverObjectNode=function(a){var b=[],c=G.model.getData().instanceTree;if(c){if(c.enumNodeChildren(a,function(a){b.push(a)},!0),b.length>1){var d=b.shift();b.sort(function(a,b){return a-b}),b.unshift(d)}}else b.push(a);A.rolloverObjectViewport(null,null,b)&&this.invalidate(!1,!1,!0)},this.getScreenShotBuffer=function(a,b,c){A.presentBuffer();var d=G.canvas.toDataURL("image/png"),e=av.isSafari();if(e|=av.isIOSDevice(),e&&(a=a?a:w,b=b?b:x),!a||!b)return d;var f,g,h=0,i=0;a>b||w/x<a/b?(f=a,g=x/w*a,i=b/2-g/2):(g=b,f=w/x*b,h=a/2-f/2);var j=window.URL.createObjectURL(r(G.canvas.toDataURL("image/png"))),k=new Image;k.src=j;var l=document.createElement("canvas"),m=l.getContext("2d");l.width=a,l.height=b,k.onload=function(){e&&(m.translate(0,g),m.scale(1,-1)),m.drawImage(k,h,i,f,g);var a=l.toDataURL("image/png"),b=window.URL.createObjectURL(r(l.toDataURL("image/png")));c?c(a):window.open(b)}},this.getScreenShot=function(a,b,c){A.presentBuffer();var d=window.URL.createObjectURL(r(G.canvas.toDataURL("image/png"))),e=av.isSafari();e|=av.isIOSDevice(),e&&(a=a?a:w,b=b?b:x),function(a,b,c,d,e){if(d||b&&c){var f,g,h=0,i=0;b>c||w/x<b/c?(f=b,g=x/w*b,i=c/2-g/2):(g=c,f=w/x*c,h=b/2-f/2);var j=new Image;j.src=a;var k=document.createElement("canvas"),l=k.getContext("2d");k.width=b,k.height=c,j.onload=function(){d&&(l.translate(0,g),l.scale(1,-1)),l.drawImage(j,h,i,f,g);var a=window.URL.createObjectURL(r(k.toDataURL("image/png")));e?e(a):window.open(a)}}else e&&e(a)}(d,a,b,e,c)},this.modelQueue=function(){return F},this.glrenderer=function(){return z},this.renderer=function(){return A},this.shadowMaps=function(){return B},this.worldUp=function(){return t},this.worldUpName=function(){return O},this.setUserRenderContext=function(a){A=a?a:new avp.RenderContext,A.init(z,this.canvas.clientWidth,this.canvas.clientHeight),A.setClearColors(this.clearColorTop,this.clearColorBottom),this.invalidate(!0),this.sceneUpdated(!1)},this.invalidate=function(a,b,c){R=R||a,S=S||b,T=T||c},this.sceneUpdated=function(a){this.invalidate(!0,!1,!0),F&&a&&(F.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),V=!0,k()},this.currentLightPreset=function(){return L},this.matman=function(){return y},this.fps=function(){return 1e3/_},this.setFPSTargets=function(a,b,c){H=1e3/c,J=1e3/a,I=1e3/b,this.targetFrameBudget=av.isMobileDevice()?I/4:I},this.track=function(a){avp.logger.track(a)},this.worldToClient=function(a){var b=new THREE.Vector4(a.x,a.y,a.z,1);return b.applyMatrix4(this.camera.matrixWorldInverse),b.applyMatrix4(this.camera.projectionMatrix),b.w>0&&(b.x/=b.w,b.y/=b.w,b.z/=b.w),this.viewportToClient(b.x,b.y)},this.clientToWorld=function(a,b,c){var d=null,e=this.model,f=e.getData();if(e.is2d()){var g=this.intersectGround(a,b);if(g){g.z=0;var h=f.bbox;(f.hidePaper||h.containsPoint(g))&&(d={point:g,model:e})}}else(d=this.hitTest(a,b,c))&&(d.point=d.intersectPoint);return d},this.setSelectionColor=function(a){this.selectionMaterialBase.color.set(a),this.selectionMaterialTop.color.set(a),this.invalidate(!1,!1,!0)},this.updateViewportId=function(a){y.updateViewportId(a),this.invalidate(!0)},this.findModel=function(a){return F.findModel(a)},this.setShadowLightDirection=function(a){Q.copy(a),k(),this.invalidate(!0,!1,!1),h()},this.getShadowLightDirection=function(a){var b=a?a:new THREE.Vector3;return b.copy(Q),b},this.toggleShadows=function(a){!!B!=!!a&&(a?B=new avp.ShadowMaps(z):(B.cleanup(y),B=null),h(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(a){F.enableNonResumableFrames=a},this.fitToView=function(a,b,c){if(b=b||this.model,c=c||!1,!b)return!1;var d={type:av.FIT_TO_VIEW_EVENT,nodeIdArray:a,immediate:c,model:b},e=this,f=function(){var f=null;if(Array.isArray(a)&&a.length>0){for(var g=new THREE.Box3,h=new THREE.Box3,i=b.getInstanceTree(),j=b.getFragmentList(),k=0;k<a.length;k++)i.enumNodeFragments(a[k],function(a){j.getWorldBounds(a,h),g.union(h)},!0);g.empty()||(f=g)}f&&!f.empty()||(f=e.getFitBounds()),e.api.navigation.fitBounds(c,f),e.api.fireEvent(d)};if(a&&a.length>0)if(b.is2d()){for(var g=new THREE.Box3,h=new s(g),i=b.getData().fragments.dbId2fragId,j=0;j<a.length;j++){var k=i[a[j]];if(Array.isArray(k))for(var l=0;l<k.length;l++)this.find2DBounds(k[l],a[j],h);else"number"==typeof k&&this.find2DBounds(k,a[j],h)}if(!g.empty())return this.api.navigation.fitBounds(c,g),void this.api.fireEvent(d)}else{var m=b.getData().propertydb,n=m&&m.attrs.length>0;if(n)return void b.getObjectTree(function(){f()})}var o=this.api.viewerState.getState(),p=o.objectSet[0];if(b.is2d()&&!p.allLayers){for(var g=new THREE.Box3,h=new s(g),q=b.getData().fragments,j=0;j<q.length;j++)this.find2DLayerBounds(j,h);if(!g.empty())return this.api.navigation.fitBounds(c,g),void this.api.fireEvent(d)}this.api.navigation.fitBounds(c,this.getFitBounds(!0)),this.api.fireEvent(d)},this.find2DBounds=function(a,b,c){var d=this.getRenderProxy(this.model,a);new avp.VertexBufferReader(d.geometry).enumGeomsForObject(b,c)},this.find2DLayerBounds=function(a,b){var c=this.getRenderProxy(this.model,a),d=new avp.VertexBufferReader(c.geometry),e=this.getVisibleLayerIds();d.enumGeomsForVisibleLayer(e,b)},s.prototype.onTriangleVertex=function(a,b,c){this.point.x=a,this.point.y=b,this.bounds.expandByPoint(this.point)},s.prototype.onLineSegment=function(a,b,c,d,e){this.onTriangleVertex(a,b),this.onTriangleVertex(c,d)},s.prototype.onCircularArc=function(a,b,c,d,e,f){this.onEllipticalArc(a,b,c,d,e,e,0,f)},s.prototype.onEllipticalArc=function(a,b,c,d,e,f,g,h){0==g?c<=0&&d>=2*Math.PI-1e-5?this.onTexQuad(a,b,2*e,2*f,g,h):(this.point.x=a+Math.cos(c)*e,this.point.y=b+Math.sin(c)*f,this.bounds.expandByPoint(this.point),this.point.x=a+Math.cos(d)*e,this.point.y=b+Math.sin(d)*f,this.bounds.expandByPoint(this.point),c>d&&(this.point.x=a+e,this.point.y=b,this.bounds.expandByPoint(this.point),c-=2*Math.PI),c<.5*Math.PI&&d>.5*Math.PI&&(this.point.x=a,this.point.y=b+f,this.bounds.expandByPoint(this.point)),c<Math.PI&&d>Math.PI&&(this.point.x=a-e,this.point.y=b,this.bounds.expandByPoint(this.point)),c<1.5*Math.PI&&d>1.5*Math.PI&&(this.point.x=a,this.point.y=b-f,this.bounds.expandByPoint(this.point))):this.onTexQuad(a,b,2*e,2*f,g,h)},s.prototype.onTexQuad=function(a,b,c,d,e,f){var g=.5*c,h=.5*c;if(0==e)this.onTriangleVertex(a-g,b-h),this.onTriangleVertex(a+g,b+h);else{var i=new THREE.Matrix4,j=new THREE.Matrix4;i.makeRotationZ(e),j.makeTranslation(a,b,0),j.multiply(i);for(var k=0;k<4;k++)this.point.x=k%2==1?g:-g,this.point.y=k>=2?h:-h,this.point.applyMatrix4(j),this.bounds.expandByPoint(this.point)}},s.prototype.onOneTriangle=function(a,b,c,d,e,f,g){this.onTriangleVertex(a,b),this.onTriangleVertex(c,d),this.onTriangleVertex(e,f)}}av.InitParametersSetting={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,devicePixelRatio:null},av.ProgressState={ROOT_LOADED:0,LOADING:1,RENDERING:2},a.prototype.constructor=a,avp.Viewer3DImpl=a}(),/** @license Copyright (c) 2013 Autodesk Inc. */
Autodesk.Viewing.Private.ViewerState=function(a){var b=Autodesk.Viewing.Private;this.getState=function(c){var d=a.navigation,e={};e.seedURN=this.getSeedUrn();var f=e.objectSet;Array.isArray(f)||(e.objectSet=f=[]),a.model&&!a.model.is2d()&&(f[0]={id:this.getSelectedNodes(),isolated:a.getIsolatedNodes(),hidden:a.getHiddenNodes(),explodeScale:a.getExplodeScale(),idType:"lmv"}),a.model&&a.model.is2d()&&(f[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),allLayers:this.areAllLayersVisible(),hidden:[],idType:"lmv"});var g=e.viewport;g||(g=e.viewport={});var h=d.getCamera().isPerspective;g.name="",g.eye=d.getPosition().toArray(),g.target=d.getTarget().toArray(),g.up=d.getCamera().up.toArray(),g.worldUpVector=d.getWorldUpVector().toArray(),g.pivotPoint=d.getPivotPoint().toArray(),g.distanceToOrbit=d.getPivotPlaneDistance(),g.aspectRatio=this.getAspectRatio(),g.projection=h?"perspective":"orthographic",g.isOrthographic=!h,h?g.fieldOfView=d.getVerticalFov():g.orthographicHeight=this.getOrthographicHeight();var i=e.renderOptions;if(i||(i=e.renderOptions={}),i.environment=b.LightPresets[a.impl.currentLightPreset()].name,i.ambientOcclusion={enabled:a.impl.renderer().getAOEnabled(),radius:a.impl.renderer().getAORadius(),intensity:a.impl.renderer().getAOIntensity()},i.toneMap={method:a.impl.renderer().getToneMapMethod(),exposure:a.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},i.appearance={ghostHidden:a.impl.showGhosting,ambientShadow:a.prefs.ambientShadows,antiAliasing:a.impl.renderer().settings.antialias,progressiveDisplay:a.prefs.progressiveRendering,swapBlackAndWhite:a.prefs.swapBlackAndWhite,displayLines:a.prefs.lineRendering,displayPoints:a.prefs.pointRendering},a.model&&!a.model.is2d())for(var j=e.cutplanes=[],k=a.getCutPlanes(),l=0;l<k.length;l++)j.push(k[l].toArray());for(var m in a.loadedExtensions){var n=a.loadedExtensions[m];n.getState&&n.getState(e)}return c&&c!==!0&&this.applyFilter(e,c),e},this.restoreState=function(c,d,e){if(!c)return b.logger.warn("restoreState has no viewer state to restore from."),!1;if(!a||!a.model)return b.logger.warn("restoreState has no viewer or model to restore."),!1;d&&d!==!0&&(c=JSON.parse(JSON.stringify(c)),this.applyFilter(c,d));var f=a.navigation,g=a.model.is2d(),h=!g;if(Array.isArray(c.objectSet)&&c.objectSet.length>0){var i=c.objectSet[0],j=i.id;if(j&&(j=this.toIntArray(j),a.select(j)),g){var k=i.isolated;Array.isArray(k)&&k.length>0?(a.setLayerVisible(null,!1),a.impl.setLayerVisible(k,!0)):a.setLayerVisible(null,!0)}else{var l=i.isolated||[];if(l=this.toIntArray(l),a.isolate(l),0===l.length){var m=i.hidden||null;m&&m.length>0&&(m=this.toIntArray(m),a.hide(m))}}if("explodeScale"in i){var n=parseFloat(i.explodeScale);a.explode&&a.explode(n)}}var o=c.viewport;if(o){var p=this.getVector3FromArray(o.eye,f.getPosition()),q=this.getVector3FromArray(o.up,f.getCamera().up),r=this.getVector3FromArray(o.target,f.getTarget()),s="fieldOfView"in o?parseFloat(o.fieldOfView):f.getVerticalFov(),t=this.getVector3FromArray(o.worldUpVector,null);if(!t){var u=a.model?a.model.getUpVector():null;t=u?(new THREE.Vector3).fromArray(u):new THREE.Vector3(0,1,0)}var v=this.getVector3FromArray(o.pivotPoint,f.getPivotPoint()),w=f.getCamera().isPerspective;"isOrthographic"in o&&(w=!o.isOrthographic);var x=this.getOrthographicHeight();"orthographicHeight"in o&&(x=Number(o.orthographicHeight));var y={position:p,target:r,up:q,worldup:t,aspect:a.impl.camera.aspect,fov:s,orthoScale:x,isPerspective:w,pivot:v};this.restoreCameraState(y,e)}var z=c.renderOptions;if(z){var A=a.impl.renderer(),B=a.prefs,C=B.ambientShadows,D=B.antialiasing,E=z.ambientOcclusion;if(E){"enabled"in E&&(C=E.enabled);var F="radius"in E?E.radius:null,G="intensity"in E?E.intensity:null;null!==F&&null!==G&&(F===A.getAORadius()&&G===A.getAOIntensity()||(A.setAOOptions(F,G),A.composeFinalFrame()))}if("environment"in z){var H=this.getLightPresetIndex(z.environment);H!==-1&&H!==B.get("lightPreset")&&h&&a.setLightPreset(H)}var I=z.toneMap;if(I){var J=!1,K="exposure"in I?I.exposure:null,L="lightMultiplier"in I?I.lightMultiplier:null;null!==K&&K!==A.getExposureBias()&&(A.setTonemapExposureBias(K),J=!0),null!==L&&a.impl.dir_light1&&L!==this.getToneMapIntensity()&&(a.impl.dir_light1.intensity=Math.pow(2,L),J=!0),J&&a.impl.invalidate(!0)}var M=z.appearance;M&&("antiAliasing"in M&&(D=M.antiAliasing),"progressiveDisplay"in M&&M.progressiveDisplay!==B.get("progressiveRendering")&&a.setProgressiveRendering(M.progressiveDisplay),"swapBlackAndWhite"in M&&M.swapBlackAndWhite!==B.get("swapBlackAndWhite")&&a.setSwapBlackAndWhite(M.swapBlackAndWhite),"ghostHidden"in M&&M.ghostHidden!==B.get("ghosting")&&h&&a.setGhosting(M.ghostHidden),"displayLines"in M&&M.displayLines!==B.get("lineRendering")&&a.hideLines(!M.displayLines),"displayPoints"in M&&M.displayPoints!==B.get("pointRendering")&&a.hidePoints(!M.displayPoints)),h&&C!==B.ambientShadows&&D!==B.antialiasing&&a.setQualityLevel(C,D)}if(Array.isArray(c.cutplanes)&&a.model&&h){for(var N=[],O=0;O<c.cutplanes.length;O++){var P=c.cutplanes[O];Array.isArray(P)&&P.length>=4&&N.push(new THREE.Vector4(P[0],P[1],P[2],P[3]))}a.setCutPlanes(N)}for(var Q in a.loadedExtensions){var R=a.loadedExtensions[Q];R.restoreState&&R.restoreState(c,e)}return!0},this.restoreCameraState=function(b,c){a.impl.adjustOrthoCamera(b);var d=a.navigation;c?(b.isPerspective?d.toPerspective():d.toOrthographic(),d.setCameraUpVector(b.up),d.setWorldUpVector(b.worldup),d.setView(b.position,b.target),d.setPivotPoint(b.pivot),d.setVerticalFov(b.fov,!1),a.impl.syncCamera(!0)):(a.impl.camera.isPerspective=b.isPerspective,d.setRequestTransitionWithUp(!0,b.position,b.target,b.fov,b.up,b.worldup,b.pivot))},this.areEqual=function(a,b,c){function d(a,b){if(a=a||[],b=b||[],a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}function e(a,b,c){return a=a||[],b=b||[],a.length===b.length&&(0!==a.length&&(f(a[0],b[0],c)||f(a[1],b[1],c)||f(a[2],b[2],c)))}function f(a,b,c){var d=a?parseFloat(a):null,e=a?parseFloat(b):null,f=typeof d,g=typeof e;return"number"===f&&"number"===g?Math.abs(a-b)<c:(a=a?a:null,b=b?b:null,a===b)}var g=a,h=b;if(c&&c!==!0&&(g=this.applyFilter(g,c),h=this.applyFilter(h,c)),g.seedURN!==h.seedURN)return!1;var i=g.objectSet||[],j=h.objectSet||[];if(i.length!==j.length)return!1;var k=i[0]||{},l=j[0]||{};if(!(k.idType===l.idType&&f(k.explodeScale,l.explodeScale,1e-9)&&d(k.id,l.id)&&d(k.isolated,l.isolated)&&d(k.hidden,l.hidden)))return!1;var m=g.viewport||{},n=h.viewport||{};return!!(m.name===n.name&&m.projection===n.projection&&m.isOrthographic===n.isOrthographic&&f(m.distanceToOrbit,n.distanceToOrbit,1e-9)&&f(m.fieldOfView,n.fieldOfView,1e-9)&&f(m.orthographicHeight,n.orthographicHeight,1e-9)&&e(m.eye,n.eye,1e-9)&&e(m.target,n.target,1e-9)&&e(m.up,n.up,1e-9)&&e(m.worldUpVector,n.worldUpVector,1e-9)&&e(m.pivotPoint,n.pivotPoint,1e-9))},this.toIntArray=function(a){var b=[];if(Array.isArray(a))for(var c=0,d=a.length;c<d;++c)b.push(parseInt(a[c]));return b},this.extractSelectedNodeIds=function(a){if(a&&Array.isArray(a.objectSet)&&a.objectSet.length>0){var b=a.objectSet[0];return this.toIntArray(b.id)}return[]},this.extractIsolatedNodeIds=function(a){if(a&&Array.isArray(a.objectSet)&&a.objectSet.length>0){var b=a.objectSet[0];return this.toIntArray(b.isolated)}return[]},this.getVector3FromArray=function(a,b){return a instanceof Array&&a.length>2?(a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]),(new THREE.Vector3).fromArray(a)):b},this.getSelectedNodes=function(){return a.impl&&a.impl.selector?a.impl.selector.getSelection():[]},this.getVisibleLayers2d=function(){var b=[],c=a.impl.matman(),d=c._layersMap;for(var e in d)d.hasOwnProperty(e)&&c.isLayerVisible(e)&&b.push(e);return b},this.areAllLayersVisible=function(){var b=a.impl.matman(),c=b._layersMap;for(var d in c)if(c.hasOwnProperty(d)&&!b.isLayerVisible(d))return!1;return!0},this.getAspectRatio=function(){var b=a.navigation.getScreenViewport();return b.width/b.height},this.getOrthographicHeight=function(){var b=a.navigation.getCamera();return b.isPerspective?0:Math.abs(2*b.orthographicCamera.top)},this.getSeedUrn=function(){return a.model&&a.model.loader?a.model.loader.svfUrn||"":""},this.getToneMapIntensity=function(){var b=0;return a.impl.dir_light1&&(b=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1e-20),b},this.getLightPresetIndex=function(a){for(var c=0;c<b.LightPresets.length;c++)if(b.LightPresets[c].name===a)return c;return-1},this.applyFilter=function(a,c){if(c!==!0)for(var d in a)if(a.hasOwnProperty(d)){var e=c[d];void 0===e?(delete a[d],b.logger.log("[applyFilter] C - skipping key ["+d+"] from viewerState; unspecified in filter.")):"boolean"==typeof e?e===!1&&(delete a[d],b.logger.log("[applyFilter] D - skipping key ["+d+"] from viewerState; explicit filtering.")):e instanceof Object?a[d]instanceof Object?this.applyFilter(a[d],c[d]):b.logger.warn("[applyFilter] A - Invalid filter Object for key ["+d+"]"):b.logger.warn("[applyFilter] B - Invalid filter value for key ["+d+"]")}}},Autodesk.Viewing.Private.ViewerState.prototype.constructor=Autodesk.Viewing.Private.ViewerState,AutodeskNamespace("Autodesk.Viewing.i18n"),function(){function a(){A="aaaa",V()}function b(){A=null,V()}function c(a,b){if(!b||"function"==typeof b)return a;for(var c in b)a[c]=b[c];return a}function d(a,b,c){var d,e=0,f=a.length,g=void 0===f||"[object Array]"!==Object.prototype.toString.apply(a)||"function"==typeof a;if(c)if(g){for(d in a)if(b.apply(a[d],c)===!1)break}else for(;e<f&&b.apply(a[e++],c)!==!1;);else if(g){for(d in a)if(b.call(a[d],d,a[d])===!1)break}else for(;e<f&&b.call(a[e],e,a[e++])!==!1;);return a}function e(a){return"string"==typeof a?a.replace(/[&<>"'\/]/g,function(a){return K[a]}):a}function f(a){var b=function(a){if(window.XMLHttpRequest)return a(null,new XMLHttpRequest);if(window.ActiveXObject)try{return a(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(b){return a(null,new ActiveXObject("Microsoft.XMLHTTP"))}return a(new Error)},c=function(a){if("string"==typeof a)return a;var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},d=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},e=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a=d(a);var c,e,f,g,h,i,j,k="",l=0;do{c=a.charCodeAt(l++),e=a.charCodeAt(l++),f=a.charCodeAt(l++),g=c>>2,h=(3&c)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),k+=b.charAt(g)+b.charAt(h)+b.charAt(i)+b.charAt(j),c=e=f="",g=h=i=j=""}while(l<a.length);return k},f=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},g=function(a,d,e,h){"function"==typeof e&&(h=e,e={}),e.doNotCache=e.doNotCache||!1,e.data=e.data||{},e.headers=e.headers||{},e.jsonp=e.jsonp||!1,e.async=void 0===e.async||e.async;var i,j=f({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},g.headers,e.headers);if(i="application/json"===j["content-type"]?JSON.stringify(e.data):c(e.data),"GET"===a){var k=[];if(i&&(k.push(i),i=null),e.doNotCache&&k.push("_="+(new Date).getTime()),e.jsonp&&(k.push("callback="+e.jsonp),k.push("jsonp="+e.jsonp)),k=k.join("&"),k.length>1&&(d+=d.indexOf("?")>-1?"&"+k:"?"+k),e.jsonp){var l=document.getElementsByTagName("head")[0],m=document.createElement("script");return m.type="text/javascript",m.src=d,void l.appendChild(m)}}b(function(b,c){if(b)return h(b);c.open(a,d,e.async);for(var f in j)j.hasOwnProperty(f)&&c.setRequestHeader(f,j[f]);c.onreadystatechange=function(){if(4===c.readyState){var a=c.responseText||"";if(!h)return;h(c.status,a)}},c.send(i)})};({authBasic:function(a,b){g.headers.Authorization="Basic "+e(a+":"+b)},connect:function(a,b,c){return g("CONNECT",a,b,c)},del:function(a,b,c){return g("DELETE",a,b,c)},get:function(a,b,c){return g("GET",a,b,c)},head:function(a,b,c){return g("HEAD",a,b,c)},headers:function(a){g.headers=a||{}},isAllowed:function(a,b,c){this.options(a,function(a,d){c(d.text().indexOf(b)!==-1)})},options:function(a,b,c){return g("OPTIONS",a,b,c)},patch:function(a,b,c){return g("PATCH",a,b,c)},post:function(a,b,c){return g("POST",a,b,c)},put:function(a,b,c){return g("PUT",a,b,c)},trace:function(a,b,c){return g("TRACE",a,b,c)}})[a.type?a.type.toLowerCase():"get"](a.url,a,function(b,c){200===b?a.success(c,b,null):a.error(c,b,null)})}function g(a,b){"function"==typeof a&&(b=a,a={}),a=a||{},O.extend(J,a),delete J.fixLng,"string"==typeof J.ns&&(J.ns={namespaces:[J.ns],defaultNs:J.ns}),"string"==typeof J.fallbackNS&&(J.fallbackNS=[J.fallbackNS]),"string"!=typeof J.fallbackLng&&"boolean"!=typeof J.fallbackLng||(J.fallbackLng=[J.fallbackLng]),J.interpolationPrefixEscaped=O.regexEscape(J.interpolationPrefix),J.interpolationSuffixEscaped=O.regexEscape(J.interpolationSuffix),J.lng||(J.lng=O.detectLanguage()),J.lng?J.useCookie&&O.cookie.create(J.cookieName,J.lng,J.cookieExpirationTime,J.cookieDomain):(J.lng=J.fallbackLng[0],J.useCookie&&O.cookie.remove(J.cookieName)),H=O.toLanguages(J.lng),B=H[0],O.log("currentLng set to: "+B);var c=u;if(a.fixLng&&(c=function(a,b){return b=b||{},b.lng=b.lng||c.lng,u(a,b)},c.lng=B),Q.setCurrentLng(B),J.resStore)return F=J.resStore,I=!0,void(b&&b(c));var d=O.toLanguages(J.lng);"string"==typeof J.preload&&(J.preload=[J.preload]);for(var e=0,f=J.preload.length;e<f;e++)for(var g=O.toLanguages(J.preload[e]),h=0,i=g.length;h<i;h++)d.indexOf(g[h])<0&&d.push(g[h]);Autodesk.Viewing.i18n.sync.load(d,J,function(a,d){F=d,I=!0,b&&b(c)})}function h(a,b){"string"==typeof a&&(a=[a]);for(var c=0,d=a.length;c<d;c++)J.preload.indexOf(a[c])<0&&J.preload.push(a[c]);return g(b)}function i(a,b,c){"string"!=typeof b?(c=b,b=J.ns.defaultNs):J.ns.namespaces.indexOf(b)<0&&J.ns.namespaces.push(b),F[a]=F[a]||{},F[a][b]=F[a][b]||{},O.extend(F[a][b],c)}function j(a,b){"string"!=typeof b&&(b=J.ns.defaultNs),F[a]=F[a]||{},F[a][b]={}}function k(a){J.ns.defaultNs=a}function l(a,b){m([a],b)}function m(a,b){var c={dynamicLoad:J.dynamicLoad,resGetPath:J.resGetPath,getAsync:J.getAsync,customLoad:J.customLoad,ns:{namespaces:a,defaultNs:""}},d=O.toLanguages(J.lng);"string"==typeof J.preload&&(J.preload=[J.preload]);for(var e=0,f=J.preload.length;e<f;e++)for(var g=O.toLanguages(J.preload[e]),h=0,i=g.length;h<i;h++)d.indexOf(g[h])<0&&d.push(g[h]);for(var j=[],k=0,l=d.length;k<l;k++){var m=!1,n=F[d[k]];if(n)for(var o=0,p=a.length;o<p;o++)n[a[o]]||(m=!0);else m=!0;m&&j.push(d[k])}j.length?Autodesk.Viewing.i18n.sync._fetch(j,c,function(c,d){var e=a.length*j.length;O.each(a,function(a,c){J.ns.namespaces.indexOf(c)<0&&J.ns.namespaces.push(c),O.each(j,function(a,f){F[f]=F[f]||{},F[f][c]=d[f][c],0===--e&&b&&(J.useLocalStorage&&Autodesk.Viewing.i18n.sync._storeLocal(F),b())})})}):b&&b()}function n(a,b,c){return"function"==typeof b?(c=b,b={}):b||(b={}),b.lng=a,g(b,c)}function o(){return B}function p(a,b,c,d){if(!a)return a;if(d=d||b,a.indexOf(d.interpolationPrefix||J.interpolationPrefix)<0)return a;var e=d.interpolationPrefix?O.regexEscape(d.interpolationPrefix):J.interpolationPrefixEscaped,f=d.interpolationSuffix?O.regexEscape(d.interpolationSuffix):J.interpolationSuffixEscaped,g="HTML"+f;return O.each(b,function(b,h){var i=c?c+J.keyseparator+b:b;"object"==typeof h&&null!==h?a=p(a,h,i,d):d.escapeInterpolation||J.escapeInterpolation?(a=a.replace(new RegExp([e,i,g].join(""),"g"),h),a=a.replace(new RegExp([e,i,f].join(""),"g"),O.escape(h))):a=a.replace(new RegExp([e,i,f].join(""),"g"),h)}),a}function q(a,b){var c=O.extend({},b);for(delete c.postProcess;a.indexOf(J.reusePrefix)!=-1&&!(++G>J.maxRecursion);){var d=a.lastIndexOf(J.reusePrefix),e=a.indexOf(J.reuseSuffix,d)+J.reuseSuffix.length,f=a.substring(d,e),g=f.replace(J.reusePrefix,"").replace(J.reuseSuffix,"");if(g.indexOf(",")!=-1){var h=g.indexOf(",");if(g.indexOf("{",h)!=-1&&g.indexOf("}",h)!=-1){var i=g.indexOf("{",h),j=g.indexOf("}",i)+"}".length;try{c=O.extend(c,JSON.parse(g.substring(i,j))),g=g.substring(0,h)}catch(a){}}}var k=x(g,c);a=a.replace(f,k)}return a}function r(a){return a.context&&("string"==typeof a.context||"number"==typeof a.context)}function s(a){return void 0!==a.count&&"string"!=typeof a.count&&1!==a.count}function t(a,b){b=b||{};var c=v(a,b),d=y(a,b);return void 0!==d||d===c}function u(a,b){if(b=b||{},!I){O.log("i18next not finished initialization. you might have called t function before loading resources finished.");var c=a.indexOf(":");c<0?c=0:c++;var d=b.defaultValue||a.substr(c);return d&&(d=p(d,b)),d}return G=0,x.apply(null,arguments)}function v(a,b){return void 0!==b.defaultValue?b.defaultValue:a}function w(){for(var a=[],b=1;b<arguments.length;b++)a.push(arguments[b]);return{postProcess:"sprintf",sprintf:a}}function x(a,b){if(b&&"object"!=typeof b?"sprintf"===J.shortcutFunction?b=w.apply(null,arguments):"defaultValue"===J.shortcutFunction&&(b={defaultValue:b}):b=b||{},void 0===a||null===a)return"";"string"==typeof a&&(a=[a]);var c=a[0];if(a.length>1)for(var d=0;d<a.length&&(c=a[d],!t(c,b));d++);var e,f=v(c,b),g=y(c,b),h=b.lng?O.toLanguages(b.lng):H,i=b.ns||J.ns.defaultNs;c.indexOf(J.nsseparator)>-1&&(e=c.split(J.nsseparator),i=e[0],c=e[1]),void 0===g&&J.sendMissing&&(b.lng?P.postMissing(h[0],i,c,f,h):P.postMissing(J.lng,i,c,f,h));var j=b.postProcess||J.postProcess;if(void 0!==g&&j&&R[j]&&(g=R[j](g,c,b)),A&&void 0!==g)return A;var k=f;if(f.indexOf(J.nsseparator)>-1&&(e=f.split(J.nsseparator),k=e[1]),k===c&&J.parseMissingKey&&(f=J.parseMissingKey(f)),void 0===g&&(f=p(f,b),f=q(f,b),j&&R[j])){var l=v(c,b);g=R[j](l,c,b)}return void 0!==g?g:f}function y(a,b){b=b||{};var c,d,e=v(a,b),f=H;if(!F)return e;if("cimode"===f[0].toLowerCase())return e;if(b.lng&&(f=O.toLanguages(b.lng),!F[f[0]])){var g=J.getAsync;J.getAsync=!1,Autodesk.Viewing.i18n.sync.load(f,J,function(a,b){O.extend(F,b),J.getAsync=g})}var h=b.ns||J.ns.defaultNs;if(a.indexOf(J.nsseparator)>-1){var i=a.split(J.nsseparator);h=i[0],a=i[1]}if(r(b)){c=O.extend({},b),delete c.context,c.defaultValue=J.contextNotFound;if((d=u(h+J.nsseparator+a+"_"+b.context,c))!=J.contextNotFound)return p(d,{context:b.context})}if(s(b)){c=O.extend({},b),delete c.count,c.defaultValue=J.pluralNotFound;var j=h+J.nsseparator+a+J.pluralSuffix,k=Q.get(f[0],b.count);if(k>=0?j=j+"_"+k:1===k&&(j=h+J.nsseparator+a),(d=u(j,c))!=J.pluralNotFound)return p(d,{count:b.count,interpolationPrefix:b.interpolationPrefix,interpolationSuffix:b.interpolationSuffix})}for(var l,m=a.split(J.keyseparator),n=0,o=f.length;n<o&&void 0===l;n++){for(var t=f[n],w=0,z=F[t]&&F[t][h];m[w];)z=z&&z[m[w]],w++;if(void 0!==z){var A=Object.prototype.toString.apply(z);if("string"==typeof z)z=p(z,b),z=q(z,b);else if("[object Array]"!==A||J.returnObjectTrees||b.returnObjectTrees){if(null===z&&J.fallbackOnNull===!0)z=void 0;else if(null!==z)if(J.returnObjectTrees||b.returnObjectTrees){if("[object Number]"!==A&&"[object Function]"!==A&&"[object RegExp]"!==A){var B="[object Array]"===A?[]:{};O.each(z,function(c){B[c]=x(h+J.nsseparator+a+J.keyseparator+c,b)}),z=B}}else J.objectTreeKeyHandler&&"function"==typeof J.objectTreeKeyHandler?z=J.objectTreeKeyHandler(a,z,t,h,b):(z="key '"+h+":"+a+" ("+t+")' returned an object instead of string.",O.log(z))}else z=z.join("\n"),z=p(z,b),z=q(z,b);"string"==typeof z&&""===z.trim()&&J.fallbackOnEmpty===!0&&(z=void 0),l=z}}if(void 0===l&&!b.isFallbackLookup&&(J.fallbackToDefaultNS===!0||J.fallbackNS&&J.fallbackNS.length>0))if(b.isFallbackLookup=!0,J.fallbackNS.length){for(var C=0,D=J.fallbackNS.length;C<D;C++)if(l=y(J.fallbackNS[C]+J.nsseparator+a,b)){var E=l.indexOf(J.nsseparator)>-1?l.split(J.nsseparator)[1]:l,G=e.indexOf(J.nsseparator)>-1?e.split(J.nsseparator)[1]:e;if(E!==G)break}}else l=y(a,b);return l}function z(){var a,b=[];if("undefined"!=typeof window&&(function(){for(var a=window.location.search.substring(1),c=a.split("&"),d=0;d<c.length;d++){var e=c[d].indexOf("=");if(e>0){var f=c[d].substring(0,e),g=c[d].substring(e+1);b[f]=g}}}(),b[J.detectLngQS]&&(a=b[J.detectLngQS])),!a&&"undefined"!=typeof document&&J.useCookie){var c=O.cookie.read(J.cookieName);c&&(a=c)}return a||"undefined"==typeof navigator||(a=navigator.language?navigator.language:navigator.userLanguage),a}var A=null;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);e<c;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var B,C=this,D=C.jQuery||C.Zepto,E={},F={},G=0,H=[],I=!1;"undefined"!=typeof module&&module.exports?module.exports=E:(D&&(D.i18n=D.i18n||E),C.i18n=C.i18n||E);var J={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},L=function(a){for(var b,c,d=!1,e=!1,f="",g=0;g<a.length;g++)if(b=a[g],c=a[g+1],e||"\\"===a[g-1]||'"'!==b||(d=!d),d)f+=b;else{if(e||b+c!=="//")if("single"===e&&b+c==="\r\n")e=!1,g++;else if("single"===e&&"\n"===b)e=!1;else{if(!e&&b+c==="/*"){e="multi",g++;continue}if("multi"===e&&b+c==="*/"){e=!1,g++;continue}}else e="single",g++;e||(f+=b)}return f},M={create:function(a,b,c,d){var e;if(c){var f=new Date;f.setTime(f.getTime()+60*c*1e3),e="; expires="+f.toGMTString()}else e="";d=d?"domain="+d+";":"",document.cookie=a+"="+b+e+";"+d+"path=/"},read:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},remove:function(a){this.create(a,"",-1)}},N={create:function(a,b,c,d){},read:function(a){return null},remove:function(a){}},O={extend:D?D.extend:c,each:D?D.each:d,ajax:D?D.ajax:"undefined"!=typeof document?f:function(){},cookie:"undefined"!=typeof document?M:N,detectLanguage:z,escape:e,log:function(a){J.debug&&"undefined"!=typeof console&&console.log(a)},toLanguages:function(a){var b=[];if("string"==typeof a&&a.indexOf("-")>-1){var c=a.split("-");a=J.lowerCaseLng?c[0].toLowerCase()+"-"+c[1].toLowerCase():c[0].toLowerCase()+"-"+c[1].toUpperCase(),"unspecific"!==J.load&&b.push(a),"current"!==J.load&&b.push(c[0])}else b.push(a);for(var d=0;d<J.fallbackLng.length;d++)b.indexOf(J.fallbackLng[d])===-1&&J.fallbackLng[d]&&b.push(J.fallbackLng[d]);return b},regexEscape:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};O.applyReplacement=p;var P={load:function(a,b,c){b.useLocalStorage?P._loadLocal(a,b,function(d,e){for(var f=[],g=0,h=a.length;g<h;g++)e[a[g]]||f.push(a[g]);f.length>0?P._fetch(f,b,function(a,b){O.extend(e,b),P._storeLocal(b),c(null,e)}):c(null,e)}):P._fetch(a,b,function(a,b){c(null,b)})},_loadLocal:function(a,b,c){var d={},e=(new Date).getTime();if(window.localStorage){var f=a.length;O.each(a,function(a,g){var h=window.localStorage.getItem("res_"+g);h&&(h=JSON.parse(h),h.i18nStamp&&h.i18nStamp+b.localStorageExpirationTime>e&&(d[g]=h)),0===--f&&c(null,d)})}},_storeLocal:function(a){if(window.localStorage)for(var b in a)a[b].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+b,JSON.stringify(a[b]))},_fetch:function(a,b,c){var d=b.ns,e={};if(b.dynamicLoad){var f=function(a,b){c(null,b)};if("function"==typeof b.customLoad)b.customLoad(a,d.namespaces,b,f);else{var g=p(b.resGetPath,{lng:a.join("+"),ns:d.namespaces.join("+")});g=Autodesk.Viewing.Private.getResourceUrl(g),O.ajax({url:g,success:function(a,b,c){O.log("loaded: "+g),f(0,a.json())},error:function(a,b,c){O.log("failed loading: "+g),f()},dataType:"text",async:b.getAsync})}}else{var h,i=d.namespaces.length*a.length;O.each(d.namespaces,function(d,f){O.each(a,function(a,d){var g=function(a,b){a&&(h=h||[],h.push(a)),e[d]=e[d]||{},e[d][f]=b,0===--i&&c(h,e)};"function"==typeof b.customLoad?b.customLoad(d,f,b,g):P._fetchOne(d,f,b,g)})})}},_fetchOne:function(a,b,c,d){var e=p(c.resGetPath,{lng:a,ns:b});e=Autodesk.Viewing.Private.getResourceUrl(e),O.ajax({url:e,success:function(a,b,c){O.log("loaded: "+e);var f=L(a);d(null,JSON.parse(f))},error:function(a,b,c){if(b&&200==b||a&&a.status&&200==a.status)O.log("There is a typo in: "+e);else if(b&&404==b||a&&a.status&&404==a.status)O.log("Does not exist: "+e);else{var f=b?b:a&&a.status?a.status:null;O.log(f+" when loading "+e)}d(c,{})},dataType:"text",async:c.getAsync})},postMissing:function(a,b,c,d,e){var f={};f[c]=d;var g=[];if("fallback"===J.sendMissingTo&&J.fallbackLng[0]!==!1)for(var h=0;h<J.fallbackLng.length;h++)g.push({lng:J.fallbackLng[h],url:p(J.resPostPath,{lng:J.fallbackLng[h],ns:b})});else if("current"===J.sendMissingTo||"fallback"===J.sendMissingTo&&J.fallbackLng[0]===!1)g.push({lng:a,url:p(J.resPostPath,{lng:a,ns:b})});else if("all"===J.sendMissingTo)for(var h=0,i=e.length;h<i;h++)g.push({lng:e[h],url:p(J.resPostPath,{lng:e[h],ns:b})});for(var j=0,k=g.length;j<k;j++){var l=g[j];O.ajax({url:l.url,type:J.sendType,data:f,success:function(a,e,f){O.log("posted missing key '"+c+"' to: "+l.url);for(var g=c.split("."),h=0,i=F[l.lng][b];g[h];)i=h===g.length-1?i[g[h]]=d:i[g[h]]=i[g[h]]||{},h++},error:function(a,b,d){O.log("failed posting missing key '"+c+"' to: "+l.url)},dataType:"json",async:J.postAsync})}}},Q={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(a){return Number(a>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ak:{name:"Akan",numbers:[1,2],plurals:function(a){return Number(a>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(a){return Number(a>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(a){return Number(0===a?0:1==a?1:2==a?2:a%100>=3&&a%100<=10?3:a%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ay:{name:"Aymará",numbers:[1],plurals:function(a){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(a){return Number(1!=a)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bo:{name:"Tibetan",numbers:[1],plurals:function(a){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(a){return Number(a>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},cgg:{name:"Chiga",numbers:[1],plurals:function(a){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a>=2&&a<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(a){return Number(1==a?0:2==a?1:8!=a&&11!=a?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},de:{name:"German",numbers:[1,2],plurals:function(a){return Number(1!=a)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(a){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(a){return Number(1!=a)}},en:{name:"English",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es:{name:"Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},et:{name:"Estonian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eu:{name:"Basque",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fa:{name:"Persian",numbers:[1],plurals:function(a){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(a){return Number(a>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fr:{name:"French",numbers:[1,2],plurals:function(a){return Number(a>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(a){return Number(1==a?0:2==a?1:a<7?2:a<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(a){return Number(1==a||11==a?0:2==a||12==a?1:a>2&&a<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gun:{name:"Gun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(a){return Number(1!=a)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(a){return Number(1!=a)}},id:{name:"Indonesian",numbers:[1],plurals:function(a){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(a){return Number(a%10!=1||a%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ja:{name:"Japanese",numbers:[1],plurals:function(a){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(a){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(a){return Number(0!==a)}},ka:{name:"Georgian",numbers:[1],plurals:function(a){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(a){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(a){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ko:{name:"Korean",numbers:[1],plurals:function(a){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(a){
return Number(1!=a)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(a){return Number(1==a?0:2==a?1:3==a?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(a){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(a){return Number(a>1)}},lo:{name:"Lao",numbers:[1],plurals:function(a){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&(a%100<10||a%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(a){return Number(a%10==1&&a%100!=11?0:0!==a?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(a){return Number(a>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(a){return Number(a>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(a){return Number(a>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(a){return Number(1==a||a%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(a){return Number(1==a?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ms:{name:"Malay",numbers:[1],plurals:function(a){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(a){return Number(1==a?0:0===a||a%100>1&&a%100<11?1:a%100>10&&a%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(a){return Number(1!=a)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(a){return Number(1!=a)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(a){return Number(a>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(a){return Number(1!=a)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(a){return Number(1==a?0:0===a||a%100>0&&a%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(a){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(a){return Number(1!=a)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(a){return Number(1!=a)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a>=2&&a<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(a){return Number(a%100==1?1:a%100==2?2:a%100==3||a%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},son:{name:"Songhay",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(a){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(a){return Number(1!=a)}},te:{name:"Telugu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(a){return Number(a>1)}},th:{name:"Thai",numbers:[1],plurals:function(a){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(a){return Number(a>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(a){return Number(a>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(a){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(a){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(a){return Number(a>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(a){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(a){return Number(a>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(a){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(a){return Number(1!=a)}},zh:{name:"Chinese",numbers:[1],plurals:function(a){return 0}}},addRule:function(a,b){Q.rules[a]=b},setCurrentLng:function(a){if(!Q.currentRule||Q.currentRule.lng!==a){var b=a.split("-");Q.currentRule={lng:a,rule:Q.rules[b[0]]}}},get:function(a,b){var c=a.split("-");return function(b,c){var d;if(d=Q.currentRule&&Q.currentRule.lng===a?Q.currentRule.rule:Q.rules[b]){var e=d.plurals(c),f=d.numbers[e];return 2===d.numbers.length&&1===d.numbers[0]&&(2===f?f=-1:1===f&&(f=1)),f}return 1===c?"1":"-1"}(c[0],b)}},R={},S=function(a,b){R[a]=b},T=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function b(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")}var c=function(){return c.cache.hasOwnProperty(arguments[0])||(c.cache[arguments[0]]=c.parse(arguments[0])),c.format.call(null,c.cache[arguments[0]],arguments)};return c.format=function(c,d){var e,f,g,h,i,j,k,l=1,m=c.length,n="",o=[];for(f=0;f<m;f++)if("string"===(n=a(c[f])))o.push(c[f]);else if("array"===n){if(h=c[f],h[2])for(e=d[l],g=0;g<h[2].length;g++){if(!e.hasOwnProperty(h[2][g]))throw T('[sprintf] property "%s" does not exist',h[2][g]);e=e[h[2][g]]}else e=h[1]?d[h[1]]:d[l++];if(/[^s]/.test(h[8])&&"number"!=a(e))throw T("[sprintf] expecting number but found %s",a(e));switch(h[8]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e,10);break;case"e":e=h[7]?e.toExponential(h[7]):e.toExponential();break;case"f":e=h[7]?parseFloat(e).toFixed(h[7]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=String(e))&&h[7]?e.substring(0,h[7]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(h[8])&&h[3]&&e>=0?"+"+e:e,j=h[4]?"0"==h[4]?"0":h[4].charAt(1):" ",k=h[6]-String(e).length,i=h[6]?b(j,k):"",o.push(h[5]?e+i:i+e)}return o.join("")},c.cache={},c.parse=function(a){for(var b=a,c=[],d=[],e=0;b;){if(null!==(c=/^[^\x25]+/.exec(b)))d.push(c[0]);else if(null!==(c=/^\x25{2}/.exec(b)))d.push("%");else{if(null===(c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b)))throw"[sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if(null===(h=/^([a-z_][a-z_\d]*)/i.exec(g)))throw"[sprintf] huh?";for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else{if(null===(h=/^\[(\d+)\]/.exec(g)))throw"[sprintf] huh?";f.push(h[1])}c[2]=f}else e|=2;if(3===e)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d},c}(),U=function(a,b){return b.unshift(a),T.apply(null,b)};S("sprintf",function(a,b,c){return c.sprintf?"[object Array]"===Object.prototype.toString.apply(c.sprintf)?U(a,c.sprintf):"object"==typeof c.sprintf?T(a,c.sprintf):a:a});var V=function(){function a(a){return[null,a]}Array.prototype.forEach.call(document.querySelectorAll("[data-i18n]"),function(b){var c=b.getAttribute("data-i18n"),d=a(c),e=d[0],f=d[1],g=Autodesk.Viewing.i18n.translate(f);g?e?b.setAttribute(e,g):b.textContent=g:e?b.setAttribute(e,f):b.textContent=f})};Autodesk.Viewing.i18n.init=g,Autodesk.Viewing.i18n.setLng=n,Autodesk.Viewing.i18n.preload=h,Autodesk.Viewing.i18n.addResourceBundle=i,Autodesk.Viewing.i18n.removeResourceBundle=j,Autodesk.Viewing.i18n.loadNamespace=l,Autodesk.Viewing.i18n.loadNamespaces=m,Autodesk.Viewing.i18n.localize=V,Autodesk.Viewing.i18n.setDefaultNamespace=k,Autodesk.Viewing.i18n.t=u,Autodesk.Viewing.i18n.translate=u,Autodesk.Viewing.i18n.exists=t,Autodesk.Viewing.i18n.detectLanguage=O.detectLanguage,Autodesk.Viewing.i18n.pluralExtensions=Q,Autodesk.Viewing.i18n.sync=P,Autodesk.Viewing.i18n.functions=O,Autodesk.Viewing.i18n.lng=o,Autodesk.Viewing.i18n.addPostProcessor=S,Autodesk.Viewing.i18n.options=J,Autodesk.Viewing.i18n.setDebugLocString=a,Autodesk.Viewing.i18n.clearDebugLocString=b}(),/** @license Copyright (c) 2014 Autodesk Inc. */
function(){"use strict";var a=(Autodesk.Viewing.UI,function(a,b,c,d){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.parentContainer=a,this.container=document.createElement("div"),this.container.id=b,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=c,d=d||{},d.hasOwnProperty("localizeTitle")||(d.localizeTitle=!0),this.options=d,this.container.classList.add("dockingPanel"),a.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)});a.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer)},a.prototype.uninitialize=function(){for(var a=0;a<this.listeners.length;++a){var b=this.listeners[a];b.target.removeEventListener(b.eventId,b.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},a.prototype.addVisibilityListener=function(a){this.visibilityCallbacks.push(a)},a.prototype.setVisible=function(a){if(a){var b=this.getContainerBoundingRect();if(this.container.dockRight){var c=b.width,d=300,e=this.container.lastWidth||this.container.style.width;e||(e=this.container.getBoundingClientRect().width),e&&(d=parseInt(e)),this.container.style.left=c-d+"px"}if(this.container.dockBottom){var f=b.height,g=300,h=this.container.lastHeight||this.container.style.height;h||(h=this.container.getBoundingClientRect().height),h&&(g=parseInt(h));var i=f-g;this.container.style.top=i>0?i+"px":0}this.container.style.maxHeight=b.height+"px",this.container.style.maxWidth=b.width+"px",this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var j=0;j<this.visibilityCallbacks.length;j++)this.visibilityCallbacks[j](a)},a.prototype.isVisible=function(){return"block"===this.container.style.display},a.prototype.visibilityChanged=function(){},a.prototype.initializeMoveHandlers=function(a){function b(a){var b=m.style.minWidth?parseInt(m.style.minWidth):n.kMinWdth,c=m.style.minHeight?parseInt(m.style.minHeight):n.kMinHeight,d=n.getContainerBoundingRect();m.style.maxWidth&&parseInt(m.style.width)>parseInt(m.style.maxWidth)&&(m.style.width=m.style.maxWidth),m.style.maxHeight&&parseInt(m.style.height)>parseInt(m.style.maxHeight)&&(m.style.height=m.style.maxHeight),parseInt(m.style.width)<b&&(m.style.width=b+"px"),parseInt(m.style.height)<c&&(m.style.height=c+"px"),"touchmove"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY),k+=a.screenX-g,l+=a.screenY-h,e=i+k,f=j+l;var o=parseInt(m.style.width),p=parseInt(m.style.height);isNaN(o)&&(o=n.container.getBoundingClientRect().width),isNaN(p)&&(p=n.container.getBoundingClientRect().height),e<5&&(e=0),f<5&&(f=0),m.dockRight=!1,m.dockBottom=!1,d.width-5<e+o&&(e=d.width-o,m.dockRight=!0),d.height-5<f+p&&(f=d.height-p,m.dockBottom=!0),m.style.left=e+"px",m.style.top=f+"px",m.style.maxWidth=d.width-e+"px",m.style.maxHeight=d.height-f+"px",g=a.screenX,h=a.screenY,n.onMove(a,e,f)}function c(a){window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",c),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",c),n.onEndMove(a,e,f)}function d(a){"touchstart"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY),g=a.screenX,h=a.screenY,k=0,l=0,i=n.container.offsetLeft,j=n.container.offsetTop,window.addEventListener("mousemove",b,!1),window.addEventListener("mouseup",c,!1),window.addEventListener("touchmove",b,!1),window.addEventListener("touchend",c,!1),a.preventDefault(),n.onStartMove(a,i,j)}var e,f,g,h,i,j,k,l,m=this.container,n=this;n.addEventListener(a,"mousedown",d),n.addEventListener(a,"touchstart",d)},a.prototype.initializeCloseHandler=function(a){var b=this;b.addEventListener(a,"click",function(a){b.setVisible(!1)},!1)},a.prototype.createScrollContainer=function(a){var b=document.createElement("div"),c=b.classList;return c.add("dockingPanelScroll"),c.add(a&&a.left?"left":"right"),a&&a.heightAdjustment&&(b.style.height="calc(100% - "+a.heightAdjustment+"px)"),a&&a.marginTop&&(b.style.marginTop=a.marginTop+"px"),b.id=this.container.id+"-scroll-container",this.container.appendChild(b),this.scrollContainer=b,b},a.prototype.createTitleBar=function(a){var b=document.createElement("div");b.className="dockingPanelTitle",b.textContent=a;var c=this;return c.addEventListener(b,"click",function(a){c.movedSinceLastClick||c.onTitleClick(a),c.movedSinceLastClick=!1}),c.addEventListener(b,"dblclick",function(a){c.onTitleDoubleClick(a)}),b},a.prototype.setTitle=function(a,b){b&&b.localizeTitle?(this.title.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a)):this.title.removeAttribute("data-i18n"),this.title.textContent=a},a.prototype.createCloseButton=function(){var a=document.createElement("div");return a.className="dockingPanelClose",a.innerHTML="&times;",this.initializeCloseHandler(a),a},a.prototype.onStartMove=function(a,b,c){},a.prototype.onEndMove=function(a,b,c){},a.prototype.onMove=function(a,b,c){this.movedSinceLastClick=!0},a.prototype.onTitleClick=function(a){},a.prototype.onTitleDoubleClick=function(a){},a.prototype.addEventListener=function(a,b,c){a.addEventListener(b,c),this.listeners.push({target:a,eventId:b,callback:c})},a.prototype.removeEventListener=function(a,b,c){for(var d=0;d<this.listeners.length;++d){var e=this.listeners[d];if(e.target===a&&e.eventId===b&&e.callback===c)return a.removeEventListener(b,c),this.listeners.splice(d,1),!0}return!1},a.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},a.prototype.resizeToContent=function(a){if(this.isVisible()){var b=this.getContentSize(),c=b.height,d=this.container.getBoundingClientRect(),e=this.getContainerBoundingRect(),f=a&&a.maxHeight?a.maxHeight:e.height;f-=75,c>f&&(c=f);var g=d.top;g>0&&g+c+75>e.height&&(g=Math.max(0,e.height-(c+75))),this.container.style.height=c.toString()+"px",this.container.style.top=g+"px"}},a.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},Autodesk.Viewing.UI.DockingPanel=a}(),/** @license Copyright (c) 2014 Autodesk Inc. */
function(){"use strict";var a=Autodesk.Viewing.UI,b=Autodesk.Viewing.Private,c=function(b,c,d,e){a.DockingPanel.call(this,b,c,d,e),this.container.classList.add("modelStructurePanel"),e=e||{},e.heightAdjustment||(e.heightAdjustment=40),e.marginTop||(e.marginTop=0),e.left=!0,this.createScrollContainer(e),this.options=e,this.instanceTree=null,this.tree=null,this.selectedNodes=[],this.uiCreated=!1;var f=this;this.addVisibilityListener(function(a){a&&(f.uiCreated||f.createUI(),f.resizeToContent())})};c.prototype=Object.create(a.DockingPanel.prototype),c.prototype.constructor=c,c.prototype.setModel=function(a,b){this.instanceTree=a,this.modelTitle=b,this.isVisible()?this.createUI():this.uiCreated=!1},c.prototype.createUI=function(){var c=this,d=c.instanceTree;if(d){c.selectedNodes=[];var e=c.modelTitle;e||c.options&&c.options.defaultTitle&&(e=c.options.defaultTitle);var f={};if(e||(e="Browser",f.localizeTitle=!0),c.setTitle(e,f),c.tree){for(;c.scrollContainer.hasChildNodes();)c.scrollContainer.removeChild(c.scrollContainer.lastChild);c.title.removeEventListener("click",c.onTitleClick),c.title.removeEventListener("dblclick",c.onTitleDoubleClick)}var g,h=this.rootId=d.getRootId(),i=d.getNodeName(h),j=0,k=0;d.enumNodeChildren(h,function(a){k||(g=d.getNodeName(a),j=a),k++});var l=function(){var d=new a.TreeDelegate;return d.getTreeNodeId=function(a){return"object"==typeof a?(b.logger.warn("Object used instead of dbId. Fix it."),a.dbId):a},d.getTreeNodeLabel=function(a){var b=this.getTreeNodeId(a);return c.instanceTree.getNodeName(b)||"Object "+b},d.getTreeNodeClass=function(a){return c.getNodeClass(a)},d.isTreeNodeGroup=function(a){return c.isGroupNode(a)},d.shouldCreateTreeNode=function(a){return c.shouldInclude(a)},d.onTreeNodeClick=function(a,b,d){c.onClick(b,d)},d.onTreeNodeRightClick=function(a,b,d){c.onRightClick(b,d)},d.onTreeNodeDoubleClick=function(a,b,d){c.onDoubleClick(b,d)},d.onTreeNodeIconClick=function(a,b,d){c.onIconClick(b,d)},d.forEachChild=function(a,b){var d=this.getTreeNodeId(a);c.instanceTree.enumNodeChildren(d,b)},d.onTreeNodeHover=function(a,b,d){c.onHover(b,d)},d}();this.myDelegate=l;var m=1===k&&i===g,n={excludeRoot:m,localize:!0};c.tree=new a.Tree(l,h,c.scrollContainer,n),c.options&&c.options.hasOwnProperty("startCollapsed")&&!c.options.startCollapsed||(c.tree.setAllCollapsed(!0),c.tree.setCollapsed(h,!1),m&&c.tree.setCollapsed(j,!1)),this.uiCreated=!0}},c.prototype.getNodeLabel=function(a){return this.myDelegate.getNodeLabel(a)},c.prototype.getNodeClass=function(a){return""},c.prototype.isGroupNode=function(a){var b=this.myDelegate.getTreeNodeId(a);return this.instanceTree.getChildCount(b)},c.prototype.shouldInclude=function(a){return!0},c.prototype.onClick=function(a,b){this.setSelection([a])},c.prototype.onDoubleClick=function(a,b){},c.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))},c.prototype.setGroupCollapsed=function(a,b){this.tree.delegate().isTreeNodeGroup(a)&&(this.tree.setCollapsed(a,b),this.resizeToContent())},c.prototype.isGroupCollapsed=function(a){return!!this.tree.delegate().isTreeNodeGroup(a)&&this.tree.isCollapsed(a)},c.prototype.onRightClick=function(a,b){},c.prototype.onTitleClick=function(a){},c.prototype.onTitleDoubleClick=function(a){},c.prototype.onHover=function(a,b){},c.prototype.setSelection=function(a){if(this.tree){var b,c;for(b=0;b<this.selectedNodes.length;++b)for(c=this.instanceTree.getNodeParentId(this.selectedNodes[b]);c;)this.tree.removeClass(c,"ancestor-selected"),c=this.instanceTree.getNodeParentId(c);var d=[];for(b=0;b<a.length;++b)for(d.push(a[b]),c=this.instanceTree.getNodeParentId(a[b]);c;)this.tree.addClass(c,"ancestor-selected"),c=this.instanceTree.getNodeParentId(c);this.selectedNodes=a,this.tree.setSelection(d)}},c.prototype.getContentSize=function(){var a=this.tree;if(a){var b=a.getRootContainer();if(b)return{height:b.clientHeight+this.options.heightAdjustment+35,width:b.clientWidth}}return{height:0,width:0}},c.prototype.addClass=function(a,b){return null!==this.tree&&this.tree.addClass(a,b)},c.prototype.removeClass=function(a,b){return null!==this.tree&&this.tree.removeClass(a,b)},Autodesk.Viewing.UI.ModelStructurePanel=c}(),function(){"use strict";function a(a){a=String(a);var b=' target="blank" class="propertyLink" ';return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,value:"<a"+b+'href="$&">$&</a>'},{pattern:/(^|[^\/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+b+'href="http://$2">$2</a>'}].reduce(function(a,b){return a.replace(b.pattern,b.value)},a)}var b=Autodesk.Viewing.UI,c=function(a,c,d,e){b.DockingPanel.call(this,a,c,d,e),this.container.classList.add("propertyPanel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:45,marginTop:0}),this.highlightableElements={};var f=this,g=function(){function a(a){return"category"===a.type}var c=new b.TreeDelegate;return c.getTreeNodeId=function(a){return a.name+(a.hasOwnProperty("value")?a.value:"")+(a.hasOwnProperty("category")?a.category:"")},c.getTreeNodeClass=function(b){return a(b)?f.getCategoryClass(b):f.getPropertyClass(b)},c.isTreeNodeGroup=function(b){return a(b)},c.onTreeNodeClick=function(b,c,d){a(c)?f.onCategoryClick(c,d):f.onPropertyClick(c,d)},c.onTreeNodeRightClick=function(b,c,d){a(c)?f.onCategoryRightClick(c,d):f.onPropertyRightClick(c,d)},c.onTreeNodeDoubleClick=function(b,c,d){a(c)?f.onCategoryDoubleClick(c,d):f.onPropertyDoubleClick(c,d)},c.onTreeNodeIconClick=function(b,c,d){a(c)?f.onCategoryIconClick(c,d):f.onPropertyIconClick(c,d)},c.createTreeNode=function(b,c,d){var e=null;(e=a(b)?f.displayCategory(b,c,d):f.displayProperty(b,c,d))&&(f.highlightableElements[this.getTreeNodeId(b)]=e)},c}();this.tree=new b.Tree(g,null,this.scrollContainer,{})};c.prototype=Object.create(b.DockingPanel.prototype),c.prototype.constructor=c,c.prototype.setProperties=function(a,b){this.removeAllProperties();for(var c=[],d=[],e=0;e<a.length;e++){var f=a[e];if(!f.hidden){var g=a[e].displayCategory;g&&"string"==typeof g&&""!==g?c.push(f):d.push(f)}}if(c.length+d.length===0)return void this.showNoProperties();for(var e=0;e<c.length;e++){var f=c[e],h=Autodesk.Viewing.Private.formatValueWithUnits(f.displayValue,f.units,f.type,f.precision);this.addProperty(f.displayName,h,f.displayCategory)}for(var i=c.length>0,e=0;e<d.length;e++){var f=d[e],h=Autodesk.Viewing.Private.formatValueWithUnits(f.displayValue,f.units,f.type,f.precision);this.addProperty(f.displayName,h,i?"Other":"",i?{localizeCategory:!0}:{})}},c.prototype.showNoProperties=function(){this.removeAllProperties();var a=this.tree.myRootContainer,b=document.createElement("div");b.className="noProperties";var c="No properties to display";b.setAttribute("data-i18n",c),b.textContent=Autodesk.Viewing.i18n.translate(c),a.appendChild(b)},c.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},c.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},c.prototype.addProperty=function(a,b,c,d){if(this.tree.getElementForNode({name:a,value:b,category:c}))return!1;var e=null,f={name:a,value:b,type:"property"};return c?(e=this.tree.getElementForNode({name:c}),e||(e=this.tree.createElement_({name:c,type:"category"},this.tree.myRootContainer,d&&d.localizeCategory?{localize:!0}:null)),f.category=c):e=this.tree.myRootContainer,this.tree.createElement_(f,e,d&&d.localizeProperty?{localize:!0}:null),!0},c.prototype.hasProperties=function(){for(var a in this.highlightableElements)return!0;return!1},c.prototype.removeProperty=function(a,b,c,d){var e={name:a,value:b,category:c},f=this.tree.getElementForNode(e);return!!f&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(e)],f.parentNode.removeChild(f),!0)},c.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},c.prototype.setCategoryCollapsed=function(a,b){var c=this.tree.delegate().getTreeNodeId(a);this.tree.setCollapsed(c,b)},c.prototype.isCategoryCollapsed=function(a){var b=this.tree.delegate().getTreeNodeId(a);return this.tree.isCollapsed(b)},c.prototype.getContentSize=function(){var a=this.tree.myRootContainer;return{height:a.clientHeight+55,width:a.clientWidth}},c.prototype.highlight=function(a,b){for(var c in this.highlightableElements)for(var d=this.highlightableElements[c],e=0;e<d.length;++e)!function(b){var c=b.innerHTML,d=c.replace(/(<highlight>|<\/highlight>)/gim,"");if(c!==d&&(b.innerHTML=d),a&&""!==a){var e=new RegExp("(\\b"+a+"\\b)","gim"),f=d.replace(e,"<highlight>$1</highlight>");b.innerHTML=f}}(d[e])},c.prototype.displayCategory=function(a,b,c){var d=document.createElement("div"),e=a.name;return c&&c.localize&&(d.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)),d.textContent=e,d.title=e,d.className="categoryName",b.appendChild(d),[d]},c.prototype.displayProperty=function(b,c,d){var e=document.createElement("div"),f=b.name;d&&d.localize&&(e.setAttribute("data-i18n",f),f=Autodesk.Viewing.i18n.translate(f)),e.textContent=f,e.title=f,e.className="propertyName";var g=document.createElement("div");g.className="separator";var h=document.createElement("div");h.textContent=b.value;var i=b.value;return h.title=i,i=a(i),h.innerHTML=i,h.className="propertyValue",c.appendChild(e),c.appendChild(g),c.appendChild(h),[e,h]},c.prototype.getCategoryClass=function(a){return"category"},c.prototype.getPropertyClass=function(a){return"property"},c.prototype.onCategoryClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))},c.prototype.onPropertyClick=function(a,b){},c.prototype.onCategoryIconClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))},c.prototype.onPropertyIconClick=function(a,b){},c.prototype.onCategoryDoubleClick=function(a,b){},c.prototype.onPropertyDoubleClick=function(a,b){},c.prototype.onCategoryRightClick=function(a,b){},c.prototype.onPropertyRightClick=function(a,b){},Autodesk.Viewing.UI.PropertyPanel=c}(),function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private,c=function(a){this.viewer=a,this.menus=[],this.open=!1};c.prototype.constructor=c,c.prototype.show=function(a,b){var c=this.viewer.container.getBoundingClientRect();Array.isArray(a.changedPointers)&&a.changedPointers.length>0&&(a.clientX=a.changedPointers[0].clientX,a.clientY=a.changedPointers[0].clientY);var d=a.clientX-c.left,e=a.clientY-c.top;if(!this.open){var f=this;this.showMenu(b,d,e),this.open=!0,this.hideEventListener=function(a){"menuItem"!==a.target.className&&f.hide(a)},this.isTouch="press"===a.type,document.body.addEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener,!0)}},c.prototype.showMenu=function(c,d,e){var f,g=document.createElement("div"),h=[];g.className="menu",this.viewer.container.appendChild(g),this.menus.push(g);for(var i=0;i<c.length;++i){var j=c[i],k=j.title,l=j.target;f=this.createMenuItem(g,k),"function"==typeof l?this.addCallbackToMenuItem(f,l):Array.isArray(l)?h.push({menuItem:f,target:l}):b.logger.warn("Invalid context menu option:",k,l)}var m=g.getBoundingClientRect(),n=m.width,o=m.height,p=this.viewer.container.getBoundingClientRect(),q=p.width,r=p.height,s=a.isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput();for(s&&(d-=n),d<0&&(d=0),q<d+n&&(d=q-n)<0&&(d=0),e<0&&(e=0),r<e+o&&(e=r-o)<0&&(e=0),g.style.top=Math.round(e)+"px",g.style.left=Math.round(d)+"px",i=0;i<h.length;++i){var t=h[i];f=t.menuItem,m=f.getBoundingClientRect(),d=Math.round((s?m.left:m.right)-p.left),e=Math.round(m.top-p.top),this.addSubmenuCallbackToMenuItem(f,t.target,d,e)}},c.prototype.createMenuItem=function(a,b){var c=document.createElement("div");return c.className="menuItem",c.setAttribute("data-i18n",b),c.textContent=Autodesk.Viewing.i18n.translate(b),a.appendChild(c),c},c.prototype.addCallbackToMenuItem=function(a,b){var c=this;a.addEventListener("click",function(a){return c.hide(),b(),a.preventDefault(),!1},!1)},c.prototype.addSubmenuCallbackToMenuItem=function(a,b,c,d){var e=this;a.addEventListener("click",function(){e.showMenu(b,c,d)},!1)},c.prototype.hide=function(){if(this.open){for(var a=0;a<this.menus.length;++a)this.menus[a]&&this.menus[a].parentNode.removeChild(this.menus[a]);return this.menus=[],this.open=!1,document.body.removeEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener),this.isTouch=!1,!0}return!1},Autodesk.Viewing.Private.ContextMenu=c}(),function(){"use strict";var a=(Autodesk.Viewing.UI,Autodesk.Viewing.Private),b=function(b){this.viewer=b,this.contextMenu=new a.ContextMenu(b)};b.prototype.constructor=b,b.prototype.show=function(a){var b=this.viewer.getSelectionCount(),c=this.viewer.getSelectionVisibility(),d={numSelected:b,hasSelected:0<b,hasVisible:c.hasVisible,hasHidden:c.hasHidden},e=this.buildMenu(a,d);this.viewer.runContextMenuCallbacks(e,d),e&&0<e.length&&this.contextMenu.show(a,e)},b.prototype.hide=function(){return this.contextMenu.hide()},b.prototype.buildMenu=function(a,b){return null},Autodesk.Viewing.UI.ObjectContextMenu=b}(),Autodesk.Viewing.Private.Preferences=function(a,b){function c(a,c){if(k){if(l.hasTag(a,"no-storage"))return;var d=b.prefix+a;return void 0!==c?localStorage[d]=c:c=localStorage[d],c}}function d(a,b){if("string"!=typeof a||"function"==typeof l[a])return void g.logger.log("Preferences: invalid name="+a);var d=c(a),e=!1;if(void 0!==d)try{d=JSON.parse(d),e=!0}catch(a){}l[a]=e?d:b,j[a]={}}function e(a){k&&(a=b.prefix+a,delete localStorage[a])}"string"==typeof b&&(b={prefix:b}),b||(b={}),b.prefix||(b.prefix="Autodesk.Viewing.Preferences."),b.hasOwnProperty("localStorage")||(b.localStorage=!0);var f=Autodesk.Viewing,g=Autodesk.Viewing.Private,h={},i={},j={},k=b.localStorage&&function(){var a=b.prefix+"test";try{var c=window.localStorage;return c.setItem(a,"1"),c.removeItem(a),!0}catch(a){return!1}}(),l=this;a.addEventListener(f.PREF_CHANGED_EVENT,function(a){var b=i[a.name];if(b){var c=b.changed;c&&c(a.value)}}),a.addEventListener(f.PREF_RESET_EVENT,function(a){var b=i[a.name];if(b){var c=b.reset;c&&c(a.value)}}),this.load=function(a){h=a;for(var b in h)h.hasOwnProperty(b)&&d(b,h[b])},this.tag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(h);for(var c=0;c<b.length;++c)j[b[c]][a]=!0}},this.untag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(h);for(var c=0;c<b.length;++c)j[b[c]][a]=!1}},this.hasTag=function(a,b){var c=j[a];return!!c&&c[b]===!0},this.add=function(a,b,c){if(!h.hasOwnProperty(a)){if(h[a]=b,d(a,b),c){Array.isArray(c)||(c=[c]);for(var e=0;e<c.length;++e)this.tag(c[e],a)}return!0}return g.logger.log("Preferences: "+a+" already exists"),!1},this.remove=function(a,b){return!!h.hasOwnProperty(a)&&(delete h[a],delete j[a],delete this[a],b&&e(a),!0)},this.reset=function(b,c){b&&void 0===c&&(c=!0);for(var d in h)if(h.hasOwnProperty(d)){if(b){var g=!!j[d][b];if(c&&!g||!c&&g)continue}this.set(d,h[d],!1)&&a.fireEvent({type:f.PREF_RESET_EVENT,name:d,value:this[d]}),e(d)}},this.get=function(a){return this[a]},this.set=function(b,d,e){return this[b]!==d&&(this[b]=d,c(b,d),(void 0===e||e)&&a.fireEvent({type:f.PREF_CHANGED_EVENT,name:b,value:d}),g.logger.track({category:"pref_changed",name:b,value:d}),!0)},this.addListeners=function(a,b,c){i[a]={changed:b,reset:c}},this.removeListeners=function(a){void 0!==i[a]&&delete i[a]}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.formatValueWithUnits=function(a,b,c,d){function e(a){var b=0<=a?Math.floor(a):Math.ceil(a);return{intPart:b,fracPart:a-b}}function f(a,b,c){var d="";return c&&0===a&&(d+="-"),d+=0<b?a.toFixed(b):a.toFixed(0)}function g(a,b,c){for(var d="",g=1,h=a<0,i=0;i<b;++i)g*=2;a>0?a+=.5/g:a-=.5/g;var j,k;c?k=a:(j=e(a/12).intPart,d+=f(j,0,h)+"' ",(k=a-12*j)<0&&(k=-k));var l=e(k).intPart,m=e((k-l)*g).intPart;if(0!==m&&0===l||(d+=f(l,0)),0!==m){for(l<0&&m<0&&(m=-m);m%2==0;)m/=2,g/=2;0!==l&&(d+="-"),d+=f(m,0)+"/"+f(g,0)}return d+='"'}function h(a,b){var c="";a<0&&(c="-",a=Math.abs(a));var d=e(a),g=d.intPart,h=100*d.fracPart;return c+f(g,0)+" m "+f(h,b)+" cm"}function i(a,b){var c="";a<0&&(c="-",a=Math.abs(a));var d=e(a),g=d.intPart,h=12*d.fracPart;return c+f(g,0)+"' "+f(h,b)+'"'}var j;null===d&&(d=3);try{if(1===c)j=Autodesk.Viewing.i18n.translate(a?"Yes":"No");else if(24===c){var k=a.split(" ");j=[];for(var l=0;l<k.length;++l)j.push(Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(k[l]),b,3,d));j=j.join(", ")}else 2!==c&&3!==c||!isNaN(a)?"ft-and-fractional-in"===b?j=g(12*a,d):"ft-and-fractional-in^2"===b?j=g(12*a,d)+" "+String.fromCharCode(178):"ft-and-decimal-in"===b?j=i(a,d):"ft-and-decimal-in^2"===b?j=i(a,d)+" "+String.fromCharCode(178):"decimal-in"===b||"in"===b||"inch"===b?j=f(a,d)+'"':"decimal-in^2"===b||"in^2"===b||"inch^2"===b?j=f(a,d)+'" '+String.fromCharCode(178):"decimal-ft"===b||"ft"===b||"feet"===b||"foot"===b?j=f(a,d)+"'":"decimal-ft^2"===b||"ft^2"===b||"feet^2"===b||"foot^2"===b?j=f(a,d)+"' "+String.fromCharCode(178):"fractional-in"===b?j=g(a,d,!0):"fractional-in^2"===b?j=g(a,d,!0)+" "+String.fromCharCode(178):"m-and-cm"===b?j=h(a,d):"m-and-cm^2"===b?j=h(a,d)+" "+String.fromCharCode(178):3===c&&b?(b=b.replace("^2",String.fromCharCode(178)),b=b.replace("^3",String.fromCharCode(179)),j=f(a,d)+" "+b):j=b?a+" "+b:3===c?f(a,d):a:j="NaN"}catch(c){j=b?a+" "+b:a}return j},Autodesk.Viewing.Private.convertUnits=function(a,b,c,d,e){if(c=c?c:1,a===b&&1==c)return d;var f=1;switch(b){case"mm":f=1e3;break;case"cm":f=100;break;case"m":f=1;break;case"in":f=39.37007874;break;case"ft":f=3.280839895;break;case"ft-and-fractional-in":f=3.280839895;break;case"ft-and-decimal-in":f=3.280839895;break;case"decimal-in":f=39.37007874;break;case"decimal-ft":f=3.280839895;break;case"fractional-in":f=39.37007874;break;case"m-and-cm":f=1}var g=1;switch(a){case"mm":g=.001;break;case"cm":g=.01;break;case"m":g=1;break;case"in":g=.0254;break;case"ft":g=.3048;break;case"ft-and-fractional-in":g=.3048;break;case"ft-and-decimal-in":g=.3048;break;case"decimal-in":g=.0254;break;case"decimal-ft":g=.3048;break;case"fractional-in":g=.0254;break;case"m-and-cm":g=1}return"square"===e?d*Math.pow(f*g*c,2):d*f*g*c},AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;b.OptionSlider=function(b,c,d,e,f){function g(a){a.target!=h.stepperElement&&(h.stepperElement.value=h.sliderElement.value),h.fireChangeEvent()}var h=this;this.tbody=e;var i=f&&f.insertAtIndex?f.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(i);var j=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),this.sliderElement=document.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=b+"_slider",this.sliderElement.min=c,this.sliderElement.max=d,j.appendChild(this.caption),j.appendChild(this.sliderElement),j=this.sliderRow.insertCell(1),this.stepperElement=document.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=b+"_stepper",this.stepperElement.min=c,this.stepperElement.max=d,this.stepperElement.step=1,this.stepperElement.style.width="64px",j.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",function(a){a.target!=h.sliderElement&&(h.sliderElement.value=h.stepperElement.value),h.fireChangeEvent()},!1),this.sliderElement.addEventListener("change",g,!1),this.sliderElement.addEventListener("input",g,!1)},b.OptionSlider.prototype.constructor=b.OptionSlider,a.EventDispatcher.prototype.apply(b.OptionSlider.prototype),b.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var a=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(a)}},b.OptionSlider.prototype.setValue=function(a){this.blockEvent=!0,this.value=a,this.sliderElement.value=a,this.stepperElement.value=a,this.blockEvent=!1},b.OptionSlider.prototype.setDisabled=function(a){this.sliderElement.disabled=a,this.stepperElement.disabled=a,this.caption.disabled=a},b.OptionCheckbox=function(b,c,d,e){var f=this;this.tbody=c;var g=e&&e.insertAtIndex?e.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(g);var h=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),h.appendChild(this.caption),h=this.sliderRow.insertCell(1),this.checkElement=document.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=b+"_check",this.checkElement.checked=d,h.appendChild(this.checkElement),this.blockEvent=!1,this.checked=d,this.checkElement.addEventListener("change",function(a){f.fireChangeEvent()},!1),a.isTouchDevice()&&(this.sliderRowHammer=new Hammer.Manager(this.sliderRow,{recognizers:[[Hammer.Tap]],inputClass:Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(a){a.preventDefault(),a.target.click()})),this.checkElement.addEventListener("click",function(a){a.stopPropagation()},!1),this.sliderRow.addEventListener("click",function(a){f.checkElement.disabled||(f.checkElement.checked=!f.checkElement.checked,f.fireChangeEvent())},!1)},b.OptionCheckbox.prototype.constructor=b.OptionCheckbox,a.EventDispatcher.prototype.apply(b.OptionCheckbox.prototype),b.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var a=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(a)}},b.OptionCheckbox.prototype.setChecked=function(a){this.checkElement.checked!=a&&(this.checkElement.checked=a,this.fireChangeEvent())},b.OptionCheckbox.prototype.setValue=function(a){this.blockEvent=!0,this.checked=a,this.checkElement.checked=a,this.blockEvent=!1},b.OptionCheckbox.prototype.getValue=function(){return this.checkElement.checked},b.OptionCheckbox.prototype.setDisabled=function(a){this.checkElement.disabled=a,this.caption.disabled=a},b.OptionCheckbox.prototype.setVisibility=function(a){this.sliderRow.style.display=a?"table-row":"none"},b.OptionLabel=function(b,c,d){this.tbody=c;var e=d&&d.insertAtIndex?d.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(e);var f=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),f.appendChild(this.caption),f.colSpan="2",f.style.paddingLeft="10px",f.style.paddingRight="10px",this.blockEvent=!1},b.OptionDropDown=function(b,c,d,e,f,g){var h=this;this.tbody=c;var i=g&&g.insertAtIndex?g.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(i),this.dropdownElement=document.createElement("select"),this.dropdownElement.id=b+"_dropdown",this.dropdownElement.className="optionDropDown";for(var j=0;j<d.length;j++){var k=document.createElement("option");k.value=j,k.setAttribute("data-i18n",d[j]),k.textContent=a.i18n.translate(d[j]),this.dropdownElement.add(k)}this.selectedIndex=this.dropdownElement.selectedIndex=e;var l=this.sliderRow.insertCell(0);if(this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),l.appendChild(this.caption),f){l.colSpan="2",l.style.paddingLeft="10px",l.style.paddingRight="10px",this.sliderRow=this.tbody.insertRow(i);var l=this.sliderRow.insertCell(0);l.appendChild(this.dropdownElement),l.colSpan="2",this.dropdownElement.style.width="100%"}else{var l=this.sliderRow.insertCell(1);l.appendChild(this.dropdownElement)}l.style.paddingLeft="5px",l.style.paddingRight="5px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",function(a){h.fireChangeEvent()},!1)},b.OptionDropDown.prototype.constructor=b.OptionDropDown,a.EventDispatcher.prototype.apply(b.OptionDropDown.prototype),b.OptionDropDown.prototype.setSelectedIndex=function(a){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=a,this.blockEvent=!1},b.OptionDropDown.prototype.setSelectedValue=function(a){this.blockEvent=!0,this.dropdownElement.selectedValue=a,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},b.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var a=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(a)}},b.OptionDropDown.prototype.setDisabled=function(a){this.dropdownElement.disabled=a,this.caption.disabled=a}}(),function(){"use strict";var a=function(a){this.bg=document.createElement("div"),this.bg.className="progressbg",this.fg=document.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),this.lastValue=-1,a.appendChild(this.bg),this.widthScale=this.fg.clientWidth};a.prototype.setPercent=function(a){a!=this.lastValue&&(this.lastValue=a,a>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*a*.01+"px"))},Autodesk.Viewing.Private.ProgressBar=a}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.RenderOptionsPanel=function(a){var b=this,c=Autodesk.Viewing,d=Autodesk.Viewing.Private;this.viewer=a,Autodesk.Viewing.UI.DockingPanel.call(this,a.container,"RenderOptionsPanel","Rendering Options"),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70,marginTop:20}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.celToggle=new d.OptionCheckbox("Cel Shaded",this.tbody,!1),this.addEventListener(this.celToggle,"change",function(c){var d=b.celToggle.checked;a.prefs.set("celShaded",d),a.impl.toggleCelShading(d)}),this.saoToggle=new d.OptionCheckbox("AO Enabled",this.tbody,!0),this.addEventListener(this.saoToggle,"change",function(c){var d=b.saoToggle.checked;a.prefs.set("ambientShadows",d),a.setQualityLevel(d,a.impl.renderer().settings.antialias)}),this.saoRadius=new d.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",function(c){a.impl.renderer().setAOOptions(parseFloat(b.saoRadius.value),parseFloat(b.saoIntensity.value)),a.impl.renderer().composeFinalFrame()}),this.saoIntensity=new d.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",function(c){a.impl.renderer().setAOOptions(parseFloat(b.saoRadius.value),parseFloat(b.saoIntensity.value)),a.impl.renderer().composeFinalFrame()}),this.groundShadowAlpha=new d.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",function(c){a.setGroundShadowAlpha(parseFloat(b.groundShadowAlpha.value))}),this.groundShadowColor=new d.OptionCheckbox("Shadow Color",this.tbody),c.isIE11||(this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",function(c){var d=b.groundShadowColor.checkElement.value;a.setGroundShadowColor(new THREE.Color(parseInt(d.substr(1,7),16)))}),this.groundReflectionAlpha=new d.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",function(c){a.setGroundReflectionAlpha(parseFloat(b.groundReflectionAlpha.value))}),this.groundReflectionColor=new d.OptionCheckbox("Reflection Color",this.tbody),c.isIE11||(this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",function(c){var d=b.groundReflectionColor.checkElement.value;a.setGroundReflectionColor(new THREE.Color(parseInt(d.substr(1,7),16)))});for(var e=[],f=0;f<d.LightPresets.length;f++)e.push(d.LightPresets[f].name);this.envSelect=new d.OptionDropDown("Environment",this.tbody,e,a.impl.currentLightPreset()),this.addEventListener(this.envSelect,"change",function(c){var d=b.envSelect.selectedIndex;a.setLightPreset(d)});var g=a.impl.renderer().getToneMapMethod();this.toneMapMethod=new d.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],g),this.addEventListener(this.toneMapMethod,"change",function(){var c=b.toneMapMethod.selectedIndex;a.impl.setTonemapMethod(c)}),this.exposureBias=new d.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setValue(a.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",function(c){a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)}),this.exposureBias.setDisabled(0==g),this.whiteScale=new d.OptionSlider("Light Intensity",-5,20,this.tbody);var h=0;a.impl.dir_light1&&(h=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(h),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",function(c){a.impl.dir_light1.intensity=Math.pow(2,b.whiteScale.value),a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)}),this.fovAngle=new d.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setValue(a.getFOV()),this.addEventListener(this.fovAngle,"change",function(c){a.setFOV(parseFloat(b.fovAngle.value))}),this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(c){var d=parseFloat(b.fovAngle.value),e=a.getFOV();d!=e&&b.fovAngle.setValue(e)}),this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(a){b.syncUI()}),this.addVisibilityListener(function(){b.resizeToContent()})},Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel,Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var a=this.viewer.impl,b=0;a.dir_light1&&(b=0!=a.dir_light1.intensity?Math.log(a.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(b),this.exposureBias.setValue(a.renderer().getExposureBias());var c=a.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(c),this.envSelect.setSelectedIndex(a.currentLightPreset()),this.exposureBias.setDisabled(0==c),this.saoToggle.setValue(a.renderer().getAOEnabled()),this.saoRadius.setDisabled(!a.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!a.renderer().getAOEnabled()),this.saoRadius.setValue(a.renderer().getAORadius()),this.saoIntensity.setValue(a.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV()),this.celToggle.setValue(a.renderer().settings.toonShaded)},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.bgSelect=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,
this.whiteScale=null,this.fovAngle=null,this.viewer=null},function(){"use strict";var a=Autodesk.Viewing,b=Autodesk.Viewing.UI,c=function(c,d,e){this.viewer=c,this.tree=null,this.layersRoot=null,this.visibilityImages={},this.isMac=navigator.userAgent.search("Mac OS")!==-1;var f="Layer Manager",g=c.config.viewableName,h=!0;g&&"W2D"!==g&&(f=a.i18n.translate(f)+": "+g,h=!1),this.filterImageId=e+"-layerFilterImageId",b.DockingPanel.call(this,c.container,e,f,{localizeTitle:h}),this.container.classList.add("layersPanel"),this.filterContainer=document.createElement("div"),this.filterContainer.className="filterBox",this.filterContainer.id=this.container.id+"-search-container",this.container.appendChild(this.filterContainer),this.createScrollContainer({heightAdjustment:105,marginTop:5});var i=this;c.model?i.build():i.addEventListener(c,a.GEOMETRY_LOADED_EVENT,function(){i.build()}),this.addVisibilityListener(function(){i.resizeToContent()})};c.prototype=Object.create(b.DockingPanel.prototype),c.prototype.constructor=c,c.prototype.uninitialize=function(){b.DockingPanel.prototype.uninitialize.call(this),this.viewer=null,this.tree=null,this.layersRoot=null,this.visibilityImages=null,this.scrollContainer=null,this.filterContainer=null},c.prototype.build=function(){function c(){i&&clearTimeout(i),i=setTimeout(d,500)}function d(){function a(c){var d=[];if(c.name.toLowerCase().indexOf(b)!==-1)d.push(c);else if(!c.isLayer)for(var e=c.children,f=0;f<e.length;++f)d=d.concat(a(e[f]));return d}if(h.value){var b=h.value.toLowerCase();l&&0<l.childCount&&j.setLayerVisible(a(l),!0,!0)}else j.setLayerVisible(null,!0);i=null}var e=this,f=document.createElement("div");f.className="filterSearch",e.filterContainer.appendChild(f);var g=document.createElement("div");g.className="filterImage",g.id=e.filterImageId,g.title=a.i18n.translate("Show/hide all layers"),f.appendChild(g),e.visibilityImages[e.filterImageId]=g,e.addEventListener(g,"click",function(a){e.onImageClick(null,a),a.stopPropagation()});var h=this.filterField=document.createElement("input");h.className="filterInput",h.placeholder=a.i18n.translate("Enter filter term"),h.setAttribute("data-i18n","[placeholder]Enter filter term"),h.type="search",h.incremental="incremental",f.appendChild(h);var i=null,j=e.viewer;h.addEventListener("keyup",function(a){c()}),h.addEventListener("click",function(a){if(""===h.value)return void j.setLayerVisible(null,!0);setTimeout(function(){""===h.value&&(j.setLayerVisible(null,!0),a.preventDefault())},1)});var k=function(){var a=new b.TreeDelegate;return a.getTreeNodeId=function(a){return a.id},a.getTreeNodeLabel=function(a){return e.getNodeLabel(a)},a.getTreeNodeClass=function(a){return e.getNodeClass(a)},a.isTreeNodeGroup=function(a){return e.isGroupNode(a)},a.shouldCreateTreeNode=function(a){return e.shouldInclude(a)},a.onTreeNodeClick=function(a,b,c){e.onClick(b,c)},a.onTreeNodeRightClick=function(a,b,c){e.onRightClick(b,c)},a.onTreeNodeDoubleClick=function(a,b,c){e.onDoubleClick(b,c)},a.onTreeNodeIconClick=function(a,b,c){e.onIconClick(b,c)},a.createTreeNode=function(a,b){e.createNode(a,b)},a}(),l=e.layersRoot=e.viewer.model.getLayersRoot();l&&(e.tree=new b.Tree(k,l,e.scrollContainer,{excludeRoot:!0}),e.resizeToContent(),e.update(),e.addEventListener(e.viewer,a.LAYER_VISIBILITY_CHANGED_EVENT,function(){e.update()}))},c.prototype.update=function(){function a(a,b){var c;c=1===b?"layerVisible":0===b?"layerHidden":"layerMixed",a.classList.remove("layerVisible"),a.classList.remove("layerHidden"),a.classList.remove("layerMixed"),a.classList.add(c)}function b(a,b){0===b?e.tree.addClass(a.id,"dim"):e.tree.removeClass(a.id,"dim")}function c(a){var b;if(0<a.length)for(var c=0;c<a.length;++c){var d=a[c];if(void 0===b?b=d:0===d&&1===b?b=-1:1===d&&0===b&&(b=-1),b===-1)break}else b=0;return b}function d(f){var g=f.id,h=e.visibilityImages[g];if(!f.isLayer){for(var i=f.children,j=[],k=0;k<i.length;++k)j=j.concat(d(i[k]));var l=c(j);return a(h,l),b(f,l),j}var m=e.viewer.isLayerVisible(f)?1:0;return a(h,m),b(f,m),[m]}var e=this,f=this.layersRoot&&0<this.layersRoot.childCount?d(e.layersRoot):[];a(e.visibilityImages[e.filterImageId],c(f))},c.prototype.setLayerVisible=function(a,b){var c=a?a.id:this.filterImageId,d=this.visibilityImages[c].className,e="layerVisible"!==d;this.viewer.setLayerVisible(a,e,b),this.filterField.value="",this.viewer.clearSelection()},c.prototype.getNodeLabel=function(a){return a.isLayer||0===a.childCount?a.name:a.name+" ("+a.childCount+")"},c.prototype.getNodeClass=function(a){return""},c.prototype.isGroupNode=function(a){return!a.isLayer},c.prototype.shouldInclude=function(a){return!0},c.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))},c.prototype.setGroupCollapsed=function(a,b){var c=this.tree.delegate();if(c.isTreeNodeGroup(a)){var d=c.getTreeNodeId(a);this.tree.setCollapsed(d,b),this.resizeToContent()}},c.prototype.isGroupCollapsed=function(a){var b=this.tree.delegate();if(b.isTreeNodeGroup(a)){var c=b.getTreeNodeId(a);return this.tree.isCollapsed(c)}return!1},c.prototype.onClick=function(a,b){},c.prototype.onDoubleClick=function(a,b){},c.prototype.onRightClick=function(a,b){},c.prototype.onImageClick=function(a,b){},c.prototype.getContentSize=function(){var a=this.filterContainer,b=a.clientHeight+80,c=a.clientWidth,d=this.tree;if(d){var e=d.getRootContainer();if(e)return{height:e.clientHeight+b,width:Math.max(e.clientWidth,c)}}return{height:b,width:c}},c.prototype.createNode=function(b,c){var d=document.createElement("div");c.children&&c.children.length>0?c.insertBefore(d,c.children[0]):c.appendChild(d),d.title=a.i18n.translate("Show/hide this layer"),this.visibilityImages[b.id]=d;var e=document.createElement("label");e.textContent=this.getNodeLabel(b),c.appendChild(e);var f=this;this.addEventListener(d,"click",function(a){f.onImageClick(b,a),a.stopPropagation()})},Autodesk.Viewing.UI.LayersPanel=c}(),AutodeskNamespace("Autodesk.Viewing.UI"),Autodesk.Viewing.UI.SettingsPanel=function(a,b,c,d){Autodesk.Viewing;Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,d),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0;var e=this,f=d&&void 0!==d.width?d.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=f+"px",this.container.style.top="100px",this.container.style.left=a.offsetWidth/2-170+"px",this.container.style.position="absolute",this.tabContainer=document.createElement("div"),this.tabContainer.className="settings-tabs",this.container.appendChild(this.tabContainer),this.tabs=document.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=d&&d.heightAdjustment?d.heightAdjustment:110,this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",function(a){var b=a.toElement||a.relatedTarget;if(e.mouseOver)return!0;for(var c=0;b&&b.parentNode&&b.parentNode!=window;){if(b.parentNode==this||b==this){b.preventDefault&&b.preventDefault(),e.mouseOver=!0;for(var c=0;c<e.panelTabs.length;c++)e.panelTabs[c].classList.remove("selectedmouseout");return!0}b=b.parentNode}}),this.addEventListener(this.container,"mouseout",function(a){var b=a.toElement||a.relatedTarget;if(e.mouseOver){for(;b&&b.parentNode&&b.parentNode!=window;){if(b.parentNode==this||b==this)return b.preventDefault&&b.preventDefault(),!1;b=b.parentNode}e.mouseOver=!1;for(var c=0;c<e.panelTabs.length;c++)e.panelTabs[c].classList.contains("tabselected")&&e.panelTabs[c].classList.add("selectedmouseout")}}),this.expandID=function(a){return b+"-"+a}},Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel,Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(a){a&&(this.container.style.display="block"),Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,a)},Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(a,b,c){function d(b){e.selectTab(a)}var e=this;if(void 0!==this.tabIdToIndex[a])return!1;var f=c&&void 0!==c.className?c.className:null,g=c&&void 0!==c.width?c.width:200,h=c&&void 0!==c.index?c.index:this.panelTabs.length,i=document.createElement("li");i._id=a,i.id=this.expandID(i._id);var j=document.createElement("a"),k=document.createElement("span");k.setAttribute("data-i18n",b),k.textContent=Autodesk.Viewing.i18n.translate(b),j.appendChild(k),i.appendChild(j),this.tabs.appendChild(i);var l=document.createElement("table");l._id=a+"-table",l.id=this.expandID(l._id),l.className="settings-table adsk-lmv-tftable "+f;var m=document.createElement("tbody");return l.appendChild(m),this.scrollContainer.appendChild(l),this.addEventListener(i,"touchstart",av.touchStartToClick),this.addEventListener(i,"click",d),this.panelTabs.push(i),this.tabIdToIndex[a]=h,g>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=g+"px"),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(a){var b=this.tabIdToIndex[a];if(!b)return!1;this.panelTabs.splice(b,1),this.tabs.removeChild(tabDom),this.tabIdToIndex={};for(var c=this.panelTabs.length,d=0;d<c;d++){var e=this.panelTabs[d];this.tabIdToIndex[e._id]=d}return!0},Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(a){var b=this.tabIdToIndex[a];return void 0!==this.panelTabs[b]},Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(a){if(this.isTabSelected(a))return!1;for(var b=this.panelTabs.length,c=0;c<b;c++){var d=this.panelTabs[c],e=document.getElementById(this.expandID(d._id+"-table"));a===d._id?(d.classList.add("tabselected"),e.style.display="table",this.mouseOver||d.classList.add("selectedmouseout")):(d.classList.remove("tabselected"),e.style.display="none",this.mouseOver||this.panelTabs[c].classList.remove("selectedmouseout"))}return this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(a){var b=this.tabIdToIndex[a],c=this.panelTabs[b];return c&&c.classList.contains("tabselected")},Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(a,b,c,d,e){if(void 0===this.tabIdToIndex[a])return null;var f=document.getElementById(this.expandID(a+"-table")),g=new Autodesk.Viewing.Private.OptionCheckbox(b,f.tBodies[0],c,e);return g.changeListener=function(a){d(a.detail.target.checked)},this.addEventListener(g,"change",g.changeListener),this.addControl(a,g)},Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(a,b,c,d,e,f,g){if(void 0===this.tabIdToIndex[a])return null;var h=document.getElementById(this.expandID(a+"-table")),i=new Autodesk.Viewing.Private.OptionSlider(b,c,d,h.tBodies[0],g);return i.setValue(e),i.sliderElement.step=i.stepperElement.step=1,this.addEventListener(i,"change",function(a){f(a)}),this.addControl(a,i)},Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(a,b,c,d,e,f){if(void 0===this.tabIdToIndex[a])return null;var g=document.getElementById(this.expandID(a+"-table")),h=new Autodesk.Viewing.Private.OptionDropDown(b,g.tBodies[0],c,d,f);return this.addEventListener(h,"change",function(a){e(a)}),this.addControl(a,h)},Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(a,b,c){if(void 0===this.tabIdToIndex[a])return null;if(!b.hasOwnProperty("sliderRow")){var d=c&&c.insertAtIndex?c.insertAtIndex:-1,e=c&&c.caption?c.caption:null,f=document.getElementById(this.expandID(a+"-table"));d>f.length&&(d=-1);var g=f.tBodies[0].insertRow(d),h=g.insertCell(0);if(e){var i=document.createElement("div");i.setAttribute("data-i18n",e),i.textContent=Autodesk.Viewing.i18n.translate(e),h.appendChild(i),h=g.insertCell(1)}else h.colSpan=2;h.appendChild(b),b.sliderRow=g,b.tbody=f.tBodies[0]}var j=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[j]=b,this.resizeToContent(),j},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(a){var b;if(void 0===(b="object"==typeof a&&a.tbody?a:this.controls[a]))return!1;var c=b.tbody,d=b.sliderRow,e=d.rowIndex;return c.deleteRow(e),delete this.controls[a],this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(a){return this.controls[a]||null},Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var a=this.heightAdjustment,b=this.panelTabs.length>this.panelTabs[0]?0:null,c=0;c<this.panelTabs.length;c++){var d=this.panelTabs[c];if(this.isTabSelected(d._id)){b=d;break}}if(b){a+=document.getElementById(this.expandID(d._id+"-table")).clientHeight}return{height:a,width:this.container.clientWidth}},function(){"use strict";var a=function(){};a.instances=[],a.displayError=function(b,c,d,e,f){var g=document.createElement("div");g.className="alertBox error",b.appendChild(g);var h=e;h||(h="img-item-not-found");var i=document.createElement("div");i.className="alertBoxImage "+h,g.appendChild(i);var j=document.createElement("div");j.className="alertBoxMsg",g.appendChild(j);var k=d;k||(k=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));var l=document.createElement("div");l.className="alertBoxTitle",l.textContent=k,j.appendChild(l);var m=document.createElement("div");if(m.className="alertBoxText",m.textContent=c,j.appendChild(m),f){var n=document.createElement("div");n.className="alertBoxContent",j.appendChild(n);var o=document.createElement("ul");o.className="alertBoxContent";for(var p=0;p<f.length;p++){var q=f[p];if(q){var r=document.createElement("li");o.appendChild(r);var s=this.extractList(q);if(s.list.length){var t=this.generateListElement(list);o.appendChild(t)}r.innerHTML=s.msg}}n.appendChild(o)}var u=document.createElement("div");u.className="alertBoxOK",u.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var v={alertBox:g,container:b};u.addEventListener("click",function(c){g.style.visibility="hidden",b.removeChild(g),a.instances.splice(a.instances.indexOf(v),1)}),g.appendChild(u),g.style.visibility="visible",a.instances.push(v)},a.displayErrors=function(b,c,d){var e=document.createElement("div");e.className="alertBox errors",b.appendChild(e);var f=c;f||(f="img-item-not-found");var g=document.createElement("div");g.className="alertBoxImage "+f,e.appendChild(g);var h=document.createElement("div");h.className="alertBoxMsg errors",e.appendChild(h);for(var i=0;i<d.length;i++){var j=d[i].header;j||(j=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}));var k=document.createElement("div");k.className="alertBoxTitle errors",k.textContent=j,h.appendChild(k);var l=document.createElement("div");l.className="alertBoxText errors";var m=d[i].msg,n=this.extractList(m);if(n.list.length){var o=document.createElement("div"),p=this.generateListElement(n.list);o.appendChild(p),l.textContent=n.msg,l.appendChild(o)}else l.textContent=m;if(h.appendChild(l),d[i].hints){var q=document.createElement("ul");q.className="alertBoxContent";for(var r=d[i].hints,s=0;s<r.length;s++){var t=r[s];if(t){var u=document.createElement("li");q.appendChild(u);var n=this.extractList(t);if(n.list.length){var p=this.generateListElement(n.list);q.appendChild(p)}u.innerHTML=n.msg}}h.appendChild(q)}}var v=document.createElement("div");v.className="alertBoxOK",v.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var w={alertBox:e,container:b};v.addEventListener("click",function(c){e.style.visibility="hidden",b.removeChild(e),a.instances.splice(a.instances.indexOf(w),1)}),e.appendChild(v),e.style.visibility="visible",a.instances.push(w)},a.extractList=function(a){var b={msg:a,list:[]};if(a&&a.indexOf("<ul>")!=-1){var c=a.split("<ul>");b.msg=c[0],c=c[1].split("</ul>"),b.list=c[0].split(", "),1===b.list.length&&(b.list=c[0].split(","))}return b},a.generateListElement=function(a){for(var b=document.createElement("ul"),c=0;c<a.length;c++){var d=document.createElement("li");d.textContent=a[c],b.appendChild(d)}return b},a.dismiss=function(){if(a.instances.length>0){var b=a.instances.pop();return b.alertBox.style.visibility="hidden",b.container.removeChild(b.alertBox),!0}return!1},Autodesk.Viewing.Private.AlertBox=a}(),function(){"use strict";var a=Autodesk.Viewing,b=function(){};b.instances=[],b.displayMessage=function(c,d,e,f,g){if(!(b.instances.length>0)){var h=d.msgTitleKey,i=d.msgTitleDefaultValue||h,j=d.messageKey,k=d.messageDefaultValue||j,l=d.buttonText,m=d.checkboxChecked||!1,n=document.createElement("div");n.className="hud",c.appendChild(n);var o=document.createElement("div");if(o.className="hudTitle",o.textContent=a.i18n.translate(h,{defaultValue:i}),o.setAttribute("data-i18n",h),n.appendChild(o),e){var p=document.createElement("div");p.className="hudClose",p.innerHTML="&times;",p.addEventListener("click",function(a){b.dismiss(),e&&e(a)}),n.appendChild(p)}var q=document.createElement("div");if(q.className="hudMessage",q.textContent=a.i18n.translate(j,{defaultValue:k}),q.setAttribute("data-i18n",k),n.appendChild(q),f){var r=document.createElement("div");r.className="hudButton",r.textContent=a.i18n.translate(l,{defaultValue:l}),r.setAttribute("data-i18n",l),r.addEventListener("click",f),n.appendChild(r)}if(g){var s=document.createElement("div"),t=document.createElement("input");t.className="hudCheckbox",t.type="checkbox",t.checked=m,s.appendChild(t);var u="Do not show this message again",v=document.createElement("label");v.setAttribute("for",u),v.setAttribute("data-i18n",u),v.textContent=a.i18n.translate(u,{defaultValue:u}),s.appendChild(v),t.addEventListener("change",g),n.appendChild(s)}var w={hudMessage:n,container:c};b.instances.push(w)}},b.dismiss=function(){if(b.instances.length>0){var a=b.instances.pop();return a.hudMessage.style.visibility="hidden",a.container.removeChild(a.hudMessage),!0}return!1},Autodesk.Viewing.Private.HudMessage=b}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=Autodesk.Viewing,c=Autodesk.Viewing.Private,d=function(){};d.prototype.constructor=d,d.prototype.isTreeNodeGroup=function(a){throw"isTreeNodeGroup is not implemented."},d.prototype.getTreeNodeId=function(a){throw"getTreeNodeId is not implemented."},d.prototype.getTreeNodeLabel=function(a){return a.name},d.prototype.shouldCreateTreeNode=function(a){return!0},d.prototype.forEachChild=function(a,b){for(var c=a.children?a.children.length:0,d=0;d<c;++d){b(a.children[d])}},d.prototype.createTreeNode=function(a,b,c){var d=document.createElement("label");b.appendChild(d);var e=this.getTreeNodeLabel(a);c&&c.localize&&(d.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)),d.textContent=e},d.prototype.onTreeNodeClick=function(a,b,c){},d.prototype.onTreeNodeIconClick=function(a,b,c){a.delegate().isTreeNodeGroup(b)&&a.setCollapsed(b,!a.isCollapsed(b))},d.prototype.onTreeNodeDoubleClick=function(a,b,c){},d.prototype.onTreeNodeRightClick=function(a,b,c){},d.prototype.getTreeNodeClass=function(a){return""},d.prototype.onTreeNodeHover=function(a,b,c){};var e=function(a,b,c,d){this.myDelegate=a,this.mySelectedNodes=[],this.myOptions=d||{};this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var e=this.myRootContainer=this.createHtmlElement_(c,"div","treeview"),f=this.rootElem=this.createElement_(b,e,d,0);this.setInputHandlers_(),d&&d.excludeRoot&&f.classList.add("exclude")};e.prototype.constructor=e,e.prototype.show=function(a){var b=this.myRootContainer;b.style.display=a?"block":"none"},e.prototype.getRootContainer=function(){return this.myRootContainer},e.prototype.getElementForNode=function(a){return"number"!=typeof a&&"string"!=typeof a&&(a=this.myDelegate.getTreeNodeId(a)),this.nodeToElement[a]},e.prototype.delegate=function(){return this.myDelegate},e.prototype.isCollapsed=function(a){return this.hasClass(a,"collapsed")},e.prototype.setCollapsed=function(a,b,c){b?(this.addClass(a,"collapsed",c),this.removeClass(a,"expanded",c)):(this.addClass(a,"expanded",c),this.removeClass(a,"collapsed",c))},e.prototype.setAllCollapsed=function(a){var b,c;a?(b=function(a){return a.classList.contains("expanded")},c=function(a){a.classList.add("collapsed"),a.classList.remove("expanded")}):(b=function(a){return a.classList.contains("collapsed")},c=function(a){a.classList.add("expanded"),a.classList.remove("collapsed")});for(var d=0;d<this.myGroupNodes.length;++d){var e=this.myGroupNodes[d];b(e)&&c(e)}},e.prototype.addToSelection=function(a){for(var b=this,c=a.length,d=0;d<c;++d){var e=a[d];(function(a){return b.mySelectedNodes.indexOf(a)===-1&&(b.mySelectedNodes.push(a),!0)})(e)&&this.addClass(e,"selected")}},e.prototype.removeFromSelection=function(a){for(var b=this,c=a.length-1;c>=0;--c){var d=a[c];(function(a){var c=b.mySelectedNodes.indexOf(a);return c!==-1&&(b.mySelectedNodes.splice(c,1),!0)})(d)&&this.removeClass(d,"selected")}},e.prototype.setSelection=function(a){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(a),this.mySelectedNodes},e.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},e.prototype.isSelected=function(a){return this.hasClass(a,"selected")},e.prototype.scrollTo=function(a){var b=this.getElementForNode(a);if(b){var c=b.offsetTop;for(b=b.parentNode;b&&b!=this.myRootContainer;)c+=b.offsetTop,b=b.parentNode;this.myRootContainer.parentNode.scrollTop=c}},e.prototype.addClass=function(a,b,c){var d=this.getElementForNode(a);if(d){if(c){d=d.parentNode;for(var e=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;d&&d!==e;)d.classList.add(b),d=d.parentNode}else d.classList.add(b);return!0}return!1},e.prototype.removeClass=function(a,b,c){var d=this.getElementForNode(a);if(d){if(c){d=d.parentNode;for(var e=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;d&&d!==e;)d.classList.remove(b),d=d.parentNode}else d.classList.remove(b);return!0}return!1},e.prototype.hasClass=function(a,b){return this.getElementForNode(a).classList.contains(b)},e.prototype.clear=function(){for(var a=this.myRootContainer;a.hasChildNodes();)a.removeChild(a.lastChild);this.nodeToElement={},this.nodeIdToNode={}},e.prototype.createElement_=function(a,b,c,d){function e(b,d,e,f){var h=g.createHtmlElement_(b,d,e),i=g.myDelegate.getTreeNodeId(f);h.setAttribute("lmv-nodeId",i);var j=g.createHtmlElement_(h,"header");return g.createHtmlElement_(j,"icon").addEventListener("click",function(b){g.myDelegate.onTreeNodeIconClick(g,a,b),b.stopPropagation(),b.preventDefault()},!1),g.myDelegate.createTreeNode(a,j,c),h}if(void 0===a||null===a)return null;if(!this.myDelegate.shouldCreateTreeNode(a))return null;var f,g=this,h=this.myDelegate.getTreeNodeId(a);if(g.myDelegate.isTreeNodeGroup(a)){f=e(b,"group","expanded",a),g.nodeToElement[h]=f,g.nodeIdToNode[h]=a;var i=g.myOptions.excludeRoot?1:0;d==i&&(f.style.left="0px"),g.myGroupNodes.push(f),g.myDelegate.forEachChild(a,function(a){g.createElement_(a,f,c,d+1)})}else{f=e(b,"leaf","expanded",a),g.nodeToElement[h]=f,g.nodeIdToNode[h]=a;var i=g.myOptions.excludeRoot?1:0;d==i&&(f.style.marginLeft="0px")}var j=g.myDelegate.getTreeNodeClass(a);return j&&f.classList.add(j),f},e.prototype.setInputHandlers_=function(){var a=this,c=this.myRootContainer,d=function(b){var d=null,e=!1;do{b&&b!==c?b.hasAttribute("lmv-nodeId")?(d=b,e=!0):b=b.parentElement:(d=null,e=!0)}while(!e);if(d){var f=d.getAttribute("lmv-nodeId");return a.nodeIdToNode[f]||null}return null};b.isTouchDevice()&&(this.hammer=new Hammer.Manager(c,{recognizers:[[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.on("doubletap",function(b){var c=d(b.target);null!==c&&a.myDelegate.onTreeNodeDoubleClick(a,c,b)}),this.hammer.on("press",function(b){var c=d(b.target);null!==c&&a.myDelegate.onTreeNodeRightClick(a,c,b)})),c.addEventListener("click",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeClick(a,c,b),b.stopPropagation(),b.target.classList.contains("propertyLink")||b.preventDefault())},!1),c.addEventListener("dblclick",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeDoubleClick(a,c,b),b.stopPropagation(),b.preventDefault())},!1),c.addEventListener("contextmenu",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeRightClick(a,c,b),b.stopPropagation(),b.preventDefault())},!1),c.addEventListener("mouseover",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeHover(a,c,b),b.stopPropagation(),b.preventDefault())},!1),c.addEventListener("mouseout",function(b){a.myDelegate.onTreeNodeHover(a,-1,b),b.stopPropagation(),b.preventDefault()},!1)},e.prototype.createHtmlElement_=function(a,b,c){var d=document.createElement(b);return a.appendChild(d),c&&(d.className=c),d},e.prototype.iterate=function(a,b){if(void 0!==a&&null!==a&&this.myDelegate.shouldCreateTreeNode(a)){var c=this.getElementForNode(a);if(c){b(a,c);var d=this;this.myDelegate.forEachChild(a,function(a){d.iterate(a,b)})}}},c.TreeDelegate=a.TreeDelegate=d,c.Tree=a.Tree=e}(),function(){"use strict";var a=function(){},b=Autodesk.Viewing,c=Autodesk.Viewing.Private;a.prototype.constructor=a,a.prototype.getNodeId=function(a){throw"getId is not implemented."},a.prototype.getNodeLabel=function(a){return a.name},a.prototype.getNodeClass=function(a){return""},a.prototype.hasThumbnail=function(a){return!1},a.prototype.getThumbnailOptions=function(a){return null},a.prototype.getThumbnail=function(a){return null},a.prototype.onNodeClick=function(a,b,c){},a.prototype.onNodeHover=function(a,b,c){},a.prototype.selectItem=function(a){},a.prototype.deselectItem=function(a){},a.prototype.hasContent=function(a){return!1},a.prototype.addContent=function(a,b){};var d=function(a,b,c){this.myDelegate=a,this.mySelectedIds=[];this.myRootContainerId=c+"-browserview",this.idToElement={},this.myRootContainer=document.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add("browserview"),document.getElementById(c).appendChild(this.myRootContainer),this.createElements(b,this.myRootContainer)};d.prototype.constructor=d,d.prototype.show=function(a){a?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},d.prototype.getRootContainer=function(){return this.myRootContainer},d.prototype.delegate=function(){return this.myDelegate},d.prototype.addToSelection=function(a){for(var b=this,c=0,d=a.length;c<d;++c){var e=a[c];if(function(a){return b.mySelectedIds.indexOf(a)==-1&&(b.mySelectedIds.push(a),!0)}(e)){var f=b.idToElement[e];void 0===f?b.myDelegate.selectItem(e):f.classList.add("selected")}}},d.prototype.removeFromSelection=function(a){for(var b=this,c=a.length-1;c>=0;--c){var d=a[c];if(function(a){var c=b.mySelectedIds.indexOf(a);return c!=-1&&(b.mySelectedIds.splice(c,1),!0)}(d)){var e=this.idToElement[d];void 0===e?b.myDelegate.deselectItem(d):e.classList.remove("selected")}}},d.prototype.setSelection=function(a){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(a),this.mySelectedIds},d.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},d.prototype.createElements=function(a,b){if(a)for(var c=this,d=0;d<a.length;d++){var e=a[d];c.createElement(e,b)}},d.prototype.createElement=function(a,d){var e=this,f=e.myDelegate.getNodeId(a),g=document.createElement("item");d.appendChild(g),this.idToElement[f]=g,g.onmouseover=function(){e.myDelegate.onNodeHover(e,a)},g.onclick=function(b){e.myRootContainer.querySelector(".flipped").removeClass("flipped"),e.myDelegate.onNodeClick(e,a,b)};var h=document.createElement("div");h.classList.add("card"),g.appendChild(h);var i=document.createElement("div");i.classList.add("browserElement"),h.appendChild(i);var j=e.myDelegate.getNodeLabel(a),k=document.createElement("label");k.innerHTML=j,i.appendChild(k),k.onclick=function(b){e.myDelegate.onNodeClick(e,a,b)};var l=e.myDelegate.getThumbnail(a);if(l){var m=document.createElement("img");if(m.classList.add("thumb"),LMV_THIRD_PARTY_COOKIE===!1){var n=e.myDelegate.getThumbnailOptions(a);b.Document.requestThumbnailWithSecurity(n,function(a,d){if(a)return void c.logger.error("Failed to load thumbnail: "+l,b.errorCodeString(b.ErrorCodes.NETWORK_FAILURE));m.src=window.URL.createObjectURL(d),m.onload=function(){window.URL.revokeObjectURL(m.src)}})}else m.src=l;i.appendChild(m),m.onclick=function(b){e.myDelegate.onNodeClick(e,a,b)}}e.myDelegate.hasContent(a)&&e.myDelegate.addContent(a,h),g.classList.add(e.myDelegate.getNodeClass(a))},Autodesk.Viewing.Private.BrowserDelegate=a,Autodesk.Viewing.Private.Browser=d}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing.Private;a.WEBGL_HELP_LINK=null,a.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You don’t have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We can’t display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported",
"default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>There’s nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},12:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldn’t connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":"<title> Sorry </title><message>The file extension loaded into the Viewer is not supported.</message><hint> Try a different file.</hint>"}},a.currentError=null,a.currentErrors=null,a.ErrorHandler=function(){},a.ErrorHandler.prototype.constructor=a.ErrorHandler,a.ErrorHandler.getErrorCode=function(a){return 403===a||401===a?Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED:404===a?Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND:a>=500?Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR:Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE},a.ErrorHandler.reportError=function(b,c,d,e,f,g){if(a.ErrorHandler.currentError=null,a.ErrorHandler.currentErrors=null,c){var h={category:"error",code:c,message:d,httpStatusCode:e,httpStatusText:f};a.logger.track(h,!0),a.ErrorHandler.currentError=[b,c,d,g];var i=a.ErrorInfoData[c];if(i){var j={defaultValue:""};j.defaultValue=i["default-msg"];var k=i.img,l=i["globalized-msg"],m=this.parseErrorString(l,j);if(c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var n=a.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",o=0;o<m.hints.length;o++){var p=m.hints[o].indexOf('href="WEBGL_HELP"');p!==-1&&(m.hints[o]=m.hints[o].replace('href="WEBGL_HELP"','href="'+n+'"'))}a.AlertBox.displayError(b,m.msg,m.header,k,m.hints)}else{var k="img-unsupported",j={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(d,j);var m=this.parseErrorString(c,j);m.header||(m.header="warning"===g?Autodesk.Viewing.i18n.translate("header-warning"):""),a.AlertBox.displayError(b,m.msg,m.header,k,m.hints)}}},a.ErrorHandler.reportErrors=function(b,c){if(a.ErrorHandler.currentError=null,a.ErrorHandler.currentErrors=null,c){a.ErrorHandler.currentErrors=[b,c];for(var d={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},e=[],f=0;f<c.length;f++)if(c[f].code){this.parseArguments(c[f].message,d);var g=this.parseErrorString(c[f].code,d);g.header||(g.header="warning"===c[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):""),e.push(g);var h={category:"error",code:c[f].code,message:c[f].message};a.logger.track(h,!0)}if(e.length){a.AlertBox.displayErrors(b,"img-unsupported",e)}}},a.ErrorHandler.parseArguments=function(a,b){if(a)if("string"==typeof a)b.defaultValue=a;else{b.defaultValue=a[0];for(var c=1;c<a.length;c++){var d=c-1,e=d.toString();b[e]=a[c]}}},a.ErrorHandler.parseErrorString=function(a,b){var c={msg:null,msgList:null,header:null,hints:null};if(!a)return c;var d=Autodesk.Viewing.i18n.translate(a,b);if(!d)return c;if(d.indexOf("<title>")!=-1){var e=d.split("<title>")[1].split("</title>");c.header=e[0],d=e[1]}if(d&&d.indexOf("<message>")!=-1){var e=d.split("<message>")[1].split("</message>");c.msg=e[0],d=e[1]}else c.msg=d;if(d&&d.indexOf("<hint>")!=-1){c.hints=[];for(var f=d.split("<hint>"),g=0;g<f.length;g++){var h=f[g].split("</hint")[0];c.hints.push(h)}}return c},a.ErrorHandler.localize=function(){if(a.AlertBox.instances.length>0)if(a.AlertBox.dismiss(),a.ErrorHandler.currentError){var b=a.ErrorHandler.currentError.shift(),c=a.ErrorHandler.currentError;a.ErrorHandler.reportError(b,c[0],c[1],c[2])}else{var b=a.ErrorHandler.currentErrors.shift(),d=a.ErrorHandler.currentErrors[0];a.ErrorHandler.reportErrors(b,d)}}}(),function(){"use strict";var a=function(a,b){this.viewer=a,this.options=b,this.id=""};a.prototype.load=function(){return!0},a.prototype.unload=function(){return!0},a.prototype.getState=function(a){},a.prototype.restoreState=function(a,b){return!0},a.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={},Autodesk.Viewing.Private.logger.warn("Extension cache runtime creation; missing ViewingApplication context."));var a=this.viewer.extensionCache[this.id];return a||(a=this.viewer.extensionCache[this.id]={}),a},Autodesk.Viewing.Extension=a}(),function(){"use strict";var a=Autodesk.Viewing,b=a.Private,c=function(){function a(a,b){return!e.hasOwnProperty(a)&&(e[a]=b,!0)}function b(a){return e.hasOwnProperty(a)?e[a]:null}function c(a){return!!e.hasOwnProperty(a)&&(delete e[a],!0)}function d(a){for(var b in e)e.hasOwnProperty(b)&&e[b].hasOwnProperty("populateDefaultOptions")&&e[b].populateDefaultOptions(a)}var e={};return{registerExtension:a,getExtension:b,unregisterExtension:c,popuplateOptions:d}},d=new c,e=function(){};e.prototype={loadExtension:function(c,e){this.loadedExtensions||(this.loadedExtensions={});var f=!1;if(this.getExtension(c))b.logger.info("Extension already loaded: "+c);else{var g=d.getExtension(c);if(g){var h=new g(this,e);h.id=c,f=h.load(),f&&(this.loadedExtensions[c]=h,b.logger.info("Extension loaded: "+c),this.fireEvent({type:a.EXTENSION_LOADED_EVENT,extensionId:c}))}else b.logger.warn("Extension not found: "+c)}return f},getExtension:function(a){return this.loadedExtensions&&a in this.loadedExtensions?this.loadedExtensions[a]:null},unloadExtension:function(c){var d=!1,e=this.getExtension(c);return e?(d=e.unload(),b.logger.info("Extension unloaded: "+c),delete this.loadedExtensions[c],this.fireEvent({type:a.EXTENSION_UNLOADED_EVENT,extensionId:c})):b.logger.warn("Extension not found: "+c),d},apply:function(a){var b=e.prototype;a.loadExtension=b.loadExtension,a.getExtension=b.getExtension,a.unloadExtension=b.unloadExtension}},Autodesk.Viewing.theExtensionManager=d,Autodesk.Viewing.ExtensionMixin=e}(),function(){"use strict";var a=Autodesk.Viewing;a.Private.init_UnifiedCamera=function(b){if(void 0===a.UnifiedCamera){var c=function(a,c){b.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=a/c,this.left=-a/2,this.right=a/2,this.top=c/2,this.bottom=-c/2,this.clientWidth=a,this.clientHeight=c,this.target=new b.Vector3(0,0,-1),this.worldup=new b.Vector3(0,1,0),this.orthographicCamera=new b.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new b.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()};c.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,c.prototype=Object.create(b.Camera.prototype),c.prototype.clone=function(){var a=new c(2*this.right,2*this.top);return b.Camera.prototype.clone.call(this,a),a.position.copy(this.position),a.up.copy(this.up),this.target&&(a.target=this.target.clone()),this.worldup&&(a.worldup=this.worldup.clone()),this.worldUpTransform&&(a.worldUpTransform=this.worldUpTransform.clone()),a.left=this.left,a.right=this.right,a.top=this.top,a.bottom=this.bottom,a.near=this.near,a.far=this.far,a.fov=this.fov,a.aspect=this.aspect,a.zoom=this.zoom,a.isPerspective=this.isPerspective,this.updateProjectionMatrix(),a},c.prototype.__computeFovPosition=function(a){if(Math.abs(this.fov-a)<=1e-4)return this.position.clone();var c=this.target.clone().sub(this.position),d=b.Math.degToRad(this.fov),e=b.Math.degToRad(a),f=c.length()*Math.tan(.5*d)/Math.tan(.5*e),g=c.normalize().multiplyScalar(-f);return this.target.clone().add(g)},c.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},c.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var a=c.ORTHO_FOV;this.position.copy(this.__computeFovPosition(a)),this.fov=a}this.orthoScale=this.target.clone().sub(this.position).length();var b=.5*this.orthoScale,d=b*this.aspect;this.left=this.orthographicCamera.left=-d,this.right=this.orthographicCamera.right=d,this.top=this.orthographicCamera.top=b,this.bottom=this.orthographicCamera.bottom=-b,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},c.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},c.prototype.setSize=function(a,b){this.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},c.prototype.setFov=function(a){this.fov=a,this.updateProjectionMatrix()},c.prototype.setLens=function(a,c){void 0===c&&(c=24);var d=2*b.Math.radToDeg(Math.atan(c/(2*a)));return this.setFov(d),d},c.prototype.getCameraChangedEvent=function(){return{type:a.CAMERA_CHANGE_EVENT,camera:this}},a.UnifiedCamera=c}}}(),/** @license Copyright (c) 2013 Autodesk Inc. */
function(){"use strict";var a=Autodesk.Viewing,b=a.Private;a.ESCAPE_EVENT="escape",a.PROGRESS_UPDATE_EVENT="progress",a.FULLSCREEN_MODE_EVENT="fullScreenMode",a.NAVIGATION_MODE_CHANGED_EVENT="navmode",a.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",a.VIEWER_RESIZE_EVENT="viewerResize",a.VIEWER_INITIALIZED="viewerInitialized",a.VIEWER_UNINITIALIZED="viewerUninitialized",a.MODEL_ROOT_LOADED_EVENT="svfLoaded",a.GEOMETRY_LOADED_EVENT="geometryLoaded",a.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",a.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",a.MODEL_UNLOADED_EVENT="modelUnloaded",a.EXTENSION_LOADED_EVENT="extensionLoaded",a.EXTENSION_UNLOADED_EVENT="extensionUnloaded",a.SELECTION_CHANGED_EVENT="selection",a.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",a.ISOLATE_EVENT="isolate",a.HIDE_EVENT="hide",a.SHOW_EVENT="show",a.CAMERA_CHANGE_EVENT="cameraChanged",a.EXPLODE_CHANGE_EVENT="explodeChanged",a.FIT_TO_VIEW_EVENT="fitToView",a.CUTPLANES_CHANGE_EVENT="cutplanesChanged",a.TOOL_CHANGE_EVENT="toolChanged",a.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",a.FINAL_FRAME_RENDERED_CHANGED_EVENT="finalFrameRenderedChanged",a.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",a.RESET_EVENT="reset",a.PREF_CHANGED_EVENT="PrefChanged",a.PREF_RESET_EVENT="PrefReset",a.ANIMATION_READY_EVENT="animationReady",a.HYPERLINK_EVENT="hyperlink",a.LOAD_GEOMETRY_EVENT="load_geometry",a.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7};var c=a.isMobileDevice(),d=0;a.DefaultSettings={ambientShadows:!0,antialiasing:!c,groundShadow:!0,groundReflection:!1,progressiveRendering:!0,swapBlackAndWhite:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!c,lineRendering:!0,pointRendering:!0,lightPreset:b.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:c,fusionOrbit:!0,fusionOrbitConstrained:!0,useFirstPersonNavigation:!0,envMapBackground:!1,firstPersonToolPopup:!0};var e=function(c,e){if("undefined"==typeof THREE&&b.logger.warn("Initializing LMV without the THREE.js dependency is not supported.","Call Autodesk.Viewing.Initializer() first or preload the dependencies manually."),c){if(this.clientContainer=c,this.container=document.createElement("div"),this.container.className="adsk-viewing-viewer",this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(a.isTouchDevice()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=e,this.contextMenu=null,this.contextMenuCallbacks={},this.__firefoxLMBfix=!1,this.started=!1,"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this;var f={prefix:"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!0};this.prefs=new b.Preferences(this,f)}this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=d++,this.impl=new b.Viewer3DImpl(this.canvas,this)};e.populateConfigOptions=function(a){},e.prototype.constructor=e,a.EventDispatcher.prototype.apply(e.prototype),a.ScreenModeMixin.prototype.apply(e.prototype),a.ExtensionMixin.prototype.apply(e.prototype),e.ScreenMode=a.ScreenMode,e.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},e.prototype.start=function(a,b,c,d){if(this.started)return 0;this.started=!0;var e=this,f=e.initialize();return 0!==f?(d&&setTimeout(function(){d(f)},1),f):(setTimeout(function(){e.setUp(e.config)},1),a&&this.loadModel(a,b,c,d),0)},e.prototype.registerUniversalHotkeys=function(){var b,c,d,e=this,f=a.theHotkeyManager.KEYCODES;b=function(){return e.navigation.setRequestFitToView(!0),!0},a.theHotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[f.f],onPress:b}]),b=function(){return e.navigation.setRequestHomeView(!0),!0},a.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[f.h],onPress:b},{keycodes:[f.HOME],onPress:b}]),c=function(){return!(!e.objectContextMenu||!e.objectContextMenu.hide())||(e.fireEvent({type:a.ESCAPE_EVENT}),!0)},a.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[f.ESCAPE],onRelease:c}]),b=function(){return d=e.getActiveNavigationTool(),e.setActiveNavigationTool("pan")},c=function(){return e.setActiveNavigationTool(d)};var g=[{keycodes:[f.SHIFT],onPress:b,onRelease:c},{keycodes:[f.SPACE],onPress:b,onRelease:c}];a.theHotkeyManager.pushHotkeys("Autodesk.Pan",g,{tryUntilSuccess:!0})},e.prototype.createControls=function(){var b=this,c=b.impl;return b.navigation=new a.Navigation(c.camera),b.__initAutoCam(c),b.utilities=new a.ViewingUtilities(c,b.autocam,b.navigation),b.clickHandler=new a.DefaultHandler(c,b.navigation,b.utilities),b.toolController=new a.ToolController(c,b,b.autocam,b.utilities,b.clickHandler),b.toolController.registerTool(new a.GestureHandler(b)),b.toolController.registerTool(a.theHotkeyManager),b.toolController.activateTool(a.theHotkeyManager.getName()),b.registerUniversalHotkeys(),b.toolController.registerTool(new a.OrbitDollyPanTool(c,b)),b.toolController},e.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var c=this.getDimensions();if(this.canvas.width=c.width,this.canvas.height=c.height,a.isIOSDevice()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var d=a.detectWebGL();if(d<=0)return d===-1?a.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:a.ErrorCodes.BROWSER_WEBGL_DISABLED}var f=this;this.onResizeCallback=function(a){f.resize()},window.addEventListener("resize",this.onResizeCallback,!1),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.model=null,this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var g=this.config&&this.config.canvasConfig?this.config.canvasConfig:e.kDefaultCanvasConfig;if(this.setCanvasClickBehavior(g),!g.disableSpinner){this.loadSpinner=document.createElement("div"),this.loadSpinner.className="spinner",this.container.appendChild(this.loadSpinner);for(var h=1;h<=3;h++){var i=document.createElement("div");i.className="bounce"+h,this.loadSpinner.appendChild(i)}}return this.initSettings(),this.viewerState=new b.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,this.fireEvent(a.VIEWER_INITIALIZED),0},e.prototype.setUp=function(a){if(this.config=a,this.config&&this.config.hasOwnProperty("extensions"))for(var b=this.config.extensions,c=0;c<b.length;++c)this.loadExtension(b[c],this.config);var d=this.config&&this.config.canvasConfig?this.config.canvasConfig:e.kDefaultCanvasConfig;this.setCanvasClickBehavior(d)},e.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var c in this.loadedExtensions)try{this.unloadExtension(c)}catch(d){b.logger.error("Failed to unload extension: "+c,d,a.errorCodeString(a.ErrorCodes.VIEWER_INTERNAL_ERROR)),b.logger.track({category:"error_unload_extension",extensionId:c,error_message:d.message,call_stack:d.stack})}this.loadedExtensions=null}b.logger.reportRuntimeStats(!0),this.loadSpinner&&(this.loadSpinner.style.display="block"),this.model=null,this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null),this.impl.unloadCurrentModel()},e.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},e.prototype.localize=function(){a.i18n.localize()},e.prototype.__initAutoCam=function(a){function c(a){e.autocamCamera.isPerspective!==f.isPerspective&&(e.autocamCamera.isPerspective?e.navigation.toPerspective():e.navigation.toOrthographic()),e.navigation.setVerticalFov(e.autocamCamera.fov,!1),e.navigation.setView(e.autocamCamera.position,e.autocamCamera.target),e.navigation.setPivotPoint(e.autocamCamera.pivot),e.navigation.setCameraUpVector(e.autocamCamera.up),a&&e.navigation.setWorldUpVector(e.autocamCamera.worldup),e.impl.syncCamera(a)}function d(a){e.utilities?e.utilities.pivotActive(a,!1):e.impl.controls.pivotActive(a,!1)}var e=this,f=a.camera;f.pivot||(f.pivot=new THREE.Vector3(0,0,0)),f.target||(f.target=new THREE.Vector3(0,0,0)),f.worldup||(f.worldup=f.up.clone()),e.autocamCamera=f.clone(),e.autocamCamera.target=f.target.clone(),e.autocamCamera.pivot=f.pivot.clone(),e.autocamCamera.worldup=f.worldup.clone(),e.autocam=new b.Autocam(e.autocamCamera,e.navigation),e.autocam.cameraChangedCallback=c,e.autocam.pivotDisplayCallback=d,e.autocam.canvas=e.canvas,e.addEventListener("cameraChanged",function(a){var b=a.camera;e.autocam.sync(b)}),e.autocam.sync(f)},e.prototype.uninitialize=function(){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,b.logger.reportRuntimeStats(),b.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loadSpinner=null,this.model=null,this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,a.theHotkeyManager.popHotkeys("Autodesk.FitToView"),a.theHotkeyManager.popHotkeys("Autodesk.Home"),a.theHotkeyManager.popHotkeys("Autodesk.Escape"),a.theHotkeyManager.popHotkeys("Autodesk.Pan"),a.theHotkeyManager.popHotkeys("Autodesk.Orbit"),b.clearPropertyWorkerCache(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,this.viewCubeUi&&(this.viewCubeUi.uninitialize(),this.viewCubeUi=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.fireEvent(a.VIEWER_UNINITIALIZED),this.listeners={},b.logger.log("viewer destroy")},e.prototype.finish=function(){this.tearDown(),this.uninitialize()},e.prototype.load=function(a,c,d,e,f,g){b.logger.warn("viewer.load() is deprecated. Please use viewer.loadModel() instead.");var h={ids:null,sharedPropertyDbPath:c,acmSessionId:f,loadOptions:g};return this.loadModel(a,h,d,e)},e.prototype.loadModel=function(c,d,e,f,g){function h(){if(a.theHotkeyManager)if(m.model.is2d())a.theHotkeyManager.popHotkeys("Autodesk.Orbit");else{var b,c=function(){return b=m.getActiveNavigationTool(),m.setActiveNavigationTool("orbit")},d=function(){return m.setActiveNavigationTool(b)},e=[{keycodes:[a.theHotkeyManager.KEYCODES.ALT],onPress:c,onRelease:d}];a.theHotkeyManager.pushHotkeys("Autodesk.Orbit",e,{tryUntilSuccess:!0})}}function i(){if(!a.isNodeJS){var b=m.model.is2d()?"pan":"orbit";m.setActiveNavigationTool(b),m.setDefaultNavigationTool(b),m.toolController&&m.toolController.activateTool("gestures")}}function j(a){var b=!1;m.model||(m.model=a,b=!0),m.impl.addModel(a),m.loadSpinner&&(m.loadSpinner.style.display="None"),b&&(a.is2d()&&m.activateLayerState("Initial"),h(),i()),e&&e(a)}function k(a,b,c,d){m.loadSpinner&&(m.loadSpinner.style.display="None"),f&&f(a,b,c,d)}function l(){m.impl.needsRender=!0,m.removeEventListener(a.GEOMETRY_LOADED_EVENT,l)}var m=this;d=d||{},this.addEventListener(a.GEOMETRY_LOADED_EVENT,l);var n,o=c.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),p=o?o[1]:null;return n=d&&d.fileLoader?d.fileLoader:a.FileLoaderManager.getFileLoaderForExtension(p),n?new n(this.impl).loadFile(c,d,j,k,g):(b.logger.error("File extension not supported:"+p,a.errorCodeString(a.ErrorCodes.UNSUPORTED_FILE_EXTENSION)),k(a.ErrorCodes.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0,p),!1)},e.prototype.getDimensions=function(){if(this.container){var b={};return this.getScreenMode()===a.ScreenMode.kFullScreen?(b.width=screen.width,b.height=screen.height):b=this.container.getBoundingClientRect(),{width:b.width,height:b.height}}return null},e.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)},e.prototype.getCamera=function(){return this.impl.camera},e.prototype.getState=function(a){return this.viewerState.getState(a)},e.prototype.restoreState=function(b,c,d){var e=this.viewerState.restoreState(b,c,d);return e&&this.fireEvent({type:a.VIEWER_STATE_RESTORED_EVENT,value:e}),e},e.prototype.setViewFromArray=function(a,b){var c=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},d={position:new THREE.Vector3(a[0]-c.x,a[1]-c.y,a[2]-c.z),target:new THREE.Vector3(a[3]-c.x,a[4]-c.y,a[5]-c.z),up:new THREE.Vector3(a[6],a[7],a[8]),aspect:a[9],fov:THREE.Math.radToDeg(a[10]),orthoScale:a[11],isPerspective:!a[12]};this.impl.setViewFromCamera(d)},e.prototype.setViewFromViewBox=function(a,c){var d=this.model;if(d&&!d.is2d())return void b.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D");if(c&&c.length){var e,f=d.getData().metadata,g=f.views;for(e=0;e<g.length&&g[e].name!=c;e++);if(e<g.length){var h=g[e].layer_state;h&&this.activateLayerState(h)}}this.impl.setViewFromViewBox(this.model,a,c,!1)},e.prototype.activateLayerState=function(b){if(b&&b.length){var c=this.model.getData().metadata,d=c?c.layer_states:null;if(!d)return;var e;for(e=0;e<d.length&&d[e].name!=b;e++);if(e<d.length){var f=d[e],g=f.visible_layers,h={};if(g&&0<g.length)for(var i=0;i<g.length;i++)h[g[i]]=1;var j=[],k=[];for(var l in c.layers){1===h[c.layers[l].name]?j.push(l):k.push(l)}this.impl.setLayerVisible(j,!0),this.impl.setLayerVisible(k,!1),this.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}}},e.prototype.getLayerStates=function(){var a=this.model,b=a?a.getData().metadata:null,c=b?b.layers:null,d=b?b.layer_states:null;if(!c||!d)return null;var e,f={},g={};for(var h in c)if(c.hasOwnProperty(h)){var i=parseInt(h),j=c[h];e="string"==typeof j?j:j.name,f[e]=!0,this.impl.isLayerVisible(i)&&(g[e]=!0)}var k,l,m=[];for(k=0;k<d.length;++k){var n=d[k],o=n.visible_layers,p={};if(!n.hidden){if(o&&0<o.length)for(l=0;l<o.length;++l)e=o[l],f.hasOwnProperty(e)&&(p[e]=!0);m.push({name:n.name,description:n.description,active:function(a,b){var c=Object.getOwnPropertyNames(a),d=Object.getOwnPropertyNames(b);if(c.length!==d.length)return!1;for(var e=0;e<c.length;++e){var f=c[e];if(a[f]!==b[f])return!1}return!0}(g,p)})}}return 0<m.length?m:null},e.prototype.setViewFromFile=function(){this.setActiveNavigationTool(),this.impl.setViewFromFile(this.model)},e.prototype.getProperties=function(c,d,e){b.logger.track({name:"get_props_count",aggregate:"count"}),this.model?this.model.getProperties(c,d,e):e&&e(a.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},e.prototype.getObjectTree=function(b,c){this.model?this.model.getObjectTree(b,c):c&&c(a.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},e.prototype.setCanvasClickBehavior=function(a){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(a),this.clickHandler&&this.clickHandler.setClickBehavior(a),a&&a.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),a&&a.disableTwoFingerSwipe){var b=this.toolController.getTool("gestures");b&&b.disableTwoFingerSwipe()}},e.prototype.search=function(b,c,d,e,f){this.searchText=b,this.model?this.model.search(b,c,d,e,f):d&&d(a.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},e.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},e.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(b.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},e.prototype.isolate=function(a){if(this.model){var b=this.model.getData();if(b&&b.is2d&&b.loadDone&&"hasObjectProperties"in b)this.impl.visibilityManager.isolate(a);else{var c=this;this.model.getObjectTree(function(){c.impl.visibilityManager.isolate(a)})}}},e.prototype.isolateById=function(a){return b.logger.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(a)},e.prototype.setBackgroundColor=function(a,b,c,d,e,f){this.impl.setClearColors(a,b,c,d,e,f)},e.prototype.toggleSelect=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D");this.impl.selector.toggleSelection(a)},e.prototype.select=function(a){"number"==typeof a&&(a=[a]),this.impl.selector.setSelection(a)},e.prototype.clearSelection=function(){this.impl.selector.clearSelection()},e.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},e.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},e.prototype.setSelectionMode=function(a){this.impl.selector.setSelectionMode(a)},e.prototype.getSelection=function(){return this.impl.selector.getSelection()},e.prototype.getAggregateSelection=function(a){var b=this.impl.selector.getAggregateSelection();if(a)for(var c=0;c<b.length;c++)for(var d=0;d<b[c].selection.length;d++)a(b[c].model,b[c].selection[d]);return b},e.prototype.hide=function(a){b.logger.track({name:"hide",aggregate:"count"}),this.impl.visibilityManager.hide(a)},e.prototype.hideById=function(a){this.hide(a)},e.prototype.show=function(a){this.impl.visibilityManager.show(a)},e.prototype.showAll=function(){this.impl.visibilityManager.isolate(),this.model.is2d()&&this.setLayerVisible(null,!0)},e.prototype.toggleVisibility=function(a){this.impl.visibilityManager.toggleVisibility(a)},e.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},e.prototype.isNodeVisible=function(a,b){return b=b||this.model,this.impl.isNodeVisible(a,b)},e.prototype.explode=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.explode is not applicable to 2D");b.logger.track({name:"explode_count",aggregate:"count"}),this.impl.explode(a)},e.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(b.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},e.prototype.setQualityLevel=function(a,c){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D");this.prefs.set("ambientShadows",a),this.prefs.set("antialiasing",c),this.impl.togglePostProcess(a,c)},e.prototype.setGhosting=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setGhosting is not applicable to 2D");this.prefs.set("ghosting",a),this.impl.toggleGhosting(a)},e.prototype.setGroundShadow=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D");this.prefs.set("groundShadow",a),this.impl.toggleGroundShadow(a)},e.prototype.setGroundReflection=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D");this.prefs.set("groundReflection",a),this.impl.toggleGroundReflection(a)},e.prototype.setEnvMapBackground=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D");this.prefs.set("envMapBackground",a),this.impl.toggleEnvMapBackground(a)},e.prototype.setRenderPrism=function(a){b.logger.warn("viewer.setRenderPrism() has been deprecated and will get removed in version 2.15")},e.prototype.setFirstPersonToolPopup=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D");this.prefs.set("firstPersonToolPopup",a)},e.prototype.getFirstPersonToolPopup=function(){return this.model&&this.model.is2d()?void b.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D"):this.prefs.firstPersonToolPopup},e.prototype.setProgressiveRendering=function(a){this.prefs.set("progressiveRendering",a),this.impl.toggleProgressive(a)},e.prototype.setSwapBlackAndWhite=function(a){this.prefs.set("swapBlackAndWhite",a),this.impl.toggleSwapBlackAndWhite(a)},e.prototype.setOptimizeNavigation=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D");this.prefs.set("optimizeNavigation",a),this.impl.setOptimizeNavigation(a)},e.prototype.setNavigationLock=function(b){this.navigation.getIsLocked()!==b&&(this.navigation.setIsLocked(b),this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},e.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},e.prototype.setNavigationLockSettings=function(b){this.navigation.setLockSettings(b),this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},e.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},e.prototype.setActiveNavigationTool=function(b){if(b===this._pushedTool||!b&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return b&&b!==this.getDefaultNavigationToolName()||null!==this._pushedTool?!!this.impl.controls.activateTool(b)&&(this._pushedTool=b,this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0):(this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0)},e.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},e.prototype.setDefaultNavigationTool=function(a){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(a),this._defaultNavigationTool=a,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},e.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},e.prototype.getFOV=function(){return this.navigation.getVerticalFov()},e.prototype.setFOV=function(a){this.navigation.setVerticalFov(a,!0)},e.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},e.prototype.setFocalLength=function(a){this.navigation.setFocalLength(a,!0)},e.prototype.hideLines=function(b){function c(e){b&&e.model.hideLines(b),d.removeEventListener(a.GEOMETRY_LOADED_EVENT,c)}this.prefs.set("lineRendering",!b);var d=this;this.impl.hideLines(b)||this.addEventListener(a.GEOMETRY_LOADED_EVENT,c)},e.prototype.hidePoints=function(b){function c(e){b&&e.model.hidePoints(b),d.removeEventListener(a.GEOMETRY_LOADED_EVENT,c)}this.prefs.set("pointRendering",!b);var d=this;this.impl.hidePoints(b)||this.addEventListener(a.GEOMETRY_LOADED_EVENT,c)},e.prototype.applyCamera=function(a,b){this.impl.setViewFromCamera(a,!0),b&&this.fitToView()},e.prototype.fitToView=function(a,b){(b=b||this.model)&&(b.isObjectTreeLoaded()||b.is2d()?this.impl.fitToView(a,b):this.impl.fitToView(null,b))},e.prototype.setClickConfig=function(a,b,c){var d=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(a in d){var e=d[a];if(b in e)return e[b]=c,!0}return!1},e.prototype.getClickConfig=function(a,b){var c=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(a in c){var d=c[a];if(b in d)return d[b]}return null},e.prototype.setClickToSetCOI=function(a,b){b!==!1&&this.prefs.set("clickToSetCOI",a);var c=this.getClickConfig("click","onObject");a?c.indexOf("setCOI")===-1&&this.setClickConfig("click","onObject",["setCOI"]):c.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},e.prototype.initSettings=function(){this.prefs.load(a.DefaultSettings),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","lightPreset","envMapBackground","firstPersonToolPopup"]),this.prefs.untag("3d",["swapBlackAndWhite"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setSwapBlackAndWhite(this.prefs.swapBlackAndWhite),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.hidePoints(!this.prefs.pointRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setFirstPersonToolPopup(this.prefs.firstPersonToolPopup),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup);var b=this.prefs.backgroundColorPreset;if(b)try{var c=JSON.parse(b);this.impl.setClearColors(c[0],c[1],c[2],c[3],c[4],c[5])}catch(a){this.prefs.set("backgroundColorPreset",null)}var d=this.prefs.lightPreset;this.impl.setLightPreset(d)},e.prototype.setLightPreset=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setLightPreset is not applicable to 2D");this.prefs.set("lightPreset",a),this.impl.setLightPreset(a)},e.prototype.setUsePivotAlways=function(a){this.prefs.set("alwaysUsePivot",a),this.navigation.setUsePivotAlways(a)},e.prototype.setReverseZoomDirection=function(a){this.prefs.set("reverseMouseZoomDir",a),this.navigation.setReverseZoomDirection(a)},e.prototype.setReverseHorizontalLookDirection=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D");this.prefs.set("reverseHorizontalLookDirection",a),this.navigation.setReverseHorizontalLookDirection(a)},e.prototype.setReverseVerticalLookDirection=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D");this.prefs.set("reverseVerticalLookDirection",a),this.navigation.setReverseVerticalLookDirection(a)},e.prototype.setZoomTowardsPivot=function(a){this.prefs.set("zoomTowardsPivot",a),this.navigation.setZoomTowardsPivot(a)},e.prototype.setOrbitPastWorldPoles=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D");this.prefs.set("orbitPastWorldPoles",a),this.navigation.setOrbitPastWorldPoles(a)},e.prototype.setUseLeftHandedInput=function(a){this.prefs.set("leftHandedMouseSetup",a),this.navigation.setUseLeftHandedInput(a)},e.prototype.setLayerVisible=function(c,d,e){function f(a){if(a.isLayer)return[a.index];if(a.children){for(var b=[],c=a.children,d=0;d<c.length;++d)b=b.concat(f(c[d]));return b}return[]}if(this.model&&!this.model.is2d())return void b.logger.warn("Viewer3D.setLayerVisible is not yet implemented for 3D");var g=this.model.getLayersRoot();if(g&&0!==g.childCount){if(null===c&&(c=[g]),Array.isArray(c)||(c=[c]),e){var h=f(g);this.impl.setLayerVisible(h,!1),this.impl.visibilityManager.isolate(),d=!0}for(var i=[],j=0;j<c.length;++j){var k=f(c[j]);i=i.concat(k)}this.impl.setLayerVisible(i,d),this.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}},e.prototype.isLayerVisible=function(a){return this.model&&!this.model.is2d()?(b.logger.warn("Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(a&&a.isLayer&&this.impl.isLayerVisible(a.index))},e.prototype.anyLayerHidden=function(){function a(b){if(b.isLayer)return!c.impl.isLayerVisible(b.index);for(var d=b.children,e=0;e<d.length;++e)if(a(d[e]))return!0;return!1}if(this.model&&!this.model.is2d())return b.logger.warn("Viewer3D.anyLayerHidden is not yet implemented for 3D"),!1;var c=this,d=c.model.getLayersRoot();return!(!d||!a(d))},e.prototype.setGroundShadowColor=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D");this.impl.setGroundShadowColor(a)},e.prototype.setGroundShadowAlpha=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D");this.impl.setGroundShadowAlpha(a)},e.prototype.setGroundReflectionColor=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D");this.impl.setGroundReflectionColor(a)},e.prototype.setGroundReflectionAlpha=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D");this.impl.setGroundReflectionAlpha(a)},e.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(b.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},e.prototype.setCutPlanes=function(a){if(this.model&&this.model.is2d())return void b.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D");this.impl.setCutPlanes(a)},e.prototype.getScreenShot=function(a,b,c){return this.impl.getScreenShot(a,b,c)},e.prototype.getScreenShotBuffer=function(a,b,c){return this.impl.getScreenShotBuffer(a,b,c)},e.prototype.setContextMenu=function(a){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=a||null},e.prototype.setDefaultContextMenu=function(){var a=Autodesk.Viewing.Extensions;return!(!a||!a.ViewerObjectContextMenu)&&(this.setContextMenu(new a.ViewerObjectContextMenu(this)),!0)},e.prototype.triggerContextMenu=function(a){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(a),!!this.contextMenu&&(this.contextMenu.show(a),!0)},e.prototype.triggerSelectionChanged=function(a){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(a)},e.prototype.triggerDoubleTapCallback=function(a){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(a)},e.prototype.triggerSingleTapCallback=function(a){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(a)},e.prototype.initContextMenu=function(){function a(a){var c=a.button;return"buttons"in a&&(!b.__firefoxLMBfix||1&a.buttons?2===c&&1&a.buttons&&(c=0,b.__firefoxLMBfix=!0):(b.__firefoxLMBfix=!1,c=0)),c===(!!b.navigation&&b.navigation.getUseLeftHandedInput()?0:2)}(!this.config||!this.config.hasOwnProperty("disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(a){a.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var b=this,c=this.canvas||this.container
;c.addEventListener("mousedown",function(c){a(c)&&(b.startX=c.clientX,b.startY=c.clientY)}),c.addEventListener("mouseup",function(c){return a(c)&&c.clientX===b.startX&&c.clientY===b.startY&&b.triggerContextMenu(c),!0},!1)},e.prototype.registerContextMenuCallback=function(a,b){this.contextMenuCallbacks[a]=b},e.prototype.unregisterContextMenuCallback=function(a){return a in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[a],!0)},e.prototype.runContextMenuCallbacks=function(a,b){for(var c in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(c)&&this.contextMenuCallbacks[c](a,b)},e.prototype.playAnimation=function(a){var b=this.impl.keyFrameAnimator;b&&b.play(0,a)},e.prototype.joinLiveReview=function(a){this.liveReviewClient||(this.liveReviewClient=new b.LiveReviewClient(this));var c=this.liveReviewClient;b.loadDependency("lmv_io","socket.io-1.3.5.js",function(){c.joinLiveReviewSession(a)})},e.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},e.prototype.setModelUnits=function(a){this.model&&(this.model.getData().overriddenUnits=a)},e.prototype.worldToClient=function(a){return this.impl.worldToClient(a)},e.prototype.clientToWorld=function(a,b,c){return this.impl.clientToWorld(a,b,c)},e.prototype.modelHasTopology=function(){return!(!this.model||!this.model.getData().topology)},e.prototype.setSelectionColor=function(a){this.impl.setSelectionColor(a)},e.prototype.createViewCube=function(){this.viewCubeUi||(this.viewCubeUi=new b.ViewCubeUi(this),this.viewCubeUi.create())},e.prototype.displayViewCube=function(a){this.viewCubeUi&&this.viewCubeUi.displayViewCube(a,!1)},e.prototype.displayViewCubeUI=function(a){this.viewCubeUi&&this.viewCubeUi.setVisible(a)},e.prototype.setViewCube=function(a){this.viewCubeUi&&this.viewCubeUi.cube&&this.viewCubeUi.cube.cubeRotateTo(a)},e.prototype.setThemingColor=function(a,b,c){c=c||this.model,c.setThemingColor(a,b),this.impl.invalidate(!0)},e.prototype.clearThemingColors=function(a){a=a||this.model,a.clearThemingColors(),this.impl.invalidate(!0)},e.prototype.transferModel=function(a,b){var c=this.impl.findModel(a);if(c){var d=[];this.getAggregateSelection(function(b,c){b.id==a&&d.push(c)});var e=this.impl.visibilityManager.getIsolatedNodes(c),f=this.impl.visibilityManager.getHiddenNodes(c),g=this.impl.matman().exportModelMaterials(c);this.impl.removeModel(c),b.model=c,b.impl.addModel(c),b.impl.matman().importModelMaterials(g),b.loadSpinner&&(b.loadSpinner.style.display="None"),c.loader&&c.loader.viewer3DImpl===this.impl&&(c.loader.viewer3DImpl=b.impl),c.getData().loadDone&&b.impl.onLoadComplete(c),b.impl.selector.setSelection(d,c),0!=e.length?b.impl.visibilityManager.isolate(e,c):0!=f.length&&b.impl.visibilityManager.hide(f,c)}},e.prototype.hideModel=function(a){var b=this.impl.modelQueue(),c=b.hideModel(a),d=this.impl.model;return c&&d&&d.id===a&&(this.impl.model=null,b.isEmpty()||(this.impl.model=b.getModels()[0]),this.model=this.impl.model),this.impl.invalidate(!0,!0,!0),c},e.prototype.showModel=function(a){var b=this.impl.modelQueue(),c=b.showModel(a);return c&&!this.model&&(this.impl.model=b.getModels()[0],this.model=this.impl.model),this.impl.invalidate(!0,!0,!0),c},e.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels()},Autodesk.Viewing.Viewer3D=e}();var av=Autodesk.Viewing;av.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14},av.errorCodeString=function(a){return"ErrorCode:"+a+"."},/** @license Copyright (c) 2013 Autodesk Inc. */
function(){"use strict";function a(a,e,f){if(a.urlPattern=f.urn,a.tileSize=f.tileSize?f.tileSize:512,a.texWidth=f.resolution[0],a.texHeight=f.resolution[1],a.paperWidth=f.paperWidth,a.paperHeight=f.paperHeight,a.paperUnits=f.paperUnits,a.levelOffset=c.LeafletLoader.computeLevelOffset(a.tileSize),c.offline&&b.isMobileDevice()){var g=d.getSubItemsWithProperties(e,{role:"leaflet-zip"},!1);g.length>0&&(a.maxLevel=g[0].max_level-a.levelOffset)}}var b=Autodesk.Viewing,c=Autodesk.Viewing.Private,d=function(a,b,d){function e(a){if(a){var b,d=a.children?a.children.length:0;if("geometry"===a.type&&d){var f=0;for(b=0;b<d;b++){var h=a.children[b];h&&"view"===h.type&&(g.myViewGeometry[h.guid]=a,f++)}g.myNumViews[a.guid]=f}else if("application/autodesk-db"==a.mime&&a.urn)0===a.urn.indexOf(c.ViewingService.OSS_PREFIX)?g.myPropertyDb=a.urn.substr(0,a.urn.lastIndexOf("%2F")+3):g.myPropertyDb=a.urn.substr(0,a.urn.lastIndexOf("/")+1);else if(0<d)for(b=0;b<d;b++)e(a.children[b])}}function f(a){if(a)for(var b=a.children?a.children.length:0,c=0;c<b;c++)a.children[c].parent=a,f(a.children[c])}this.myPath=b,this.myData=a,this.myViewGeometry={},this.myNumViews={},this.myPropertyDb=null,this.acmSessionId=d;var g=this;e(a),f(this.myData)};d.prototype.constructor=d,d.load=function(a,e,f,g){function h(a){if(a.indexOf("urn:")===-1){if(a.indexOf("://")!==-1)return a;var b=a;return"undefined"!=typeof window?(0!==b.indexOf("/")&&(b="/"+b),window.location.protocol+"//"+window.location.host+b):b}return a}function i(a){var b=d.getSubItemsWithProperties(a.getRootItem(),{type:"folder",role:"viewable"},!0),c=b[0];return d.getSubItemsWithProperties(c,{type:"geometry"},!0).length}function j(a,b){var c=[],d=0,e=0;b=b||"children";var f=function(a){var g=a[b]||[],h=a.messages||[];h.filter(function(a){return"error"===a.type}).length>0&&(d+=1),"inprogress"===a.status&&(e+=1),Array.prototype.push.apply(c,h.slice(0));for(var i=g.length;i--;f(g[i]));};f(a);var g="translated";g=d>0?"failed":g,g=e>0?"processing":g;for(var h=c.length;h--;c[h].$translation=g);return c}function k(g){function l(a){if(/<[^>]*script/.test(a))return void(f&&f(b.ErrorCodes.BAD_DATA,"Malicious document content detected Abort loading"));var c="string"==typeof a?JSON.parse(a):a,h=new d(c,o,g);if(i(h)>0)n=j(h.getRootItem()),e&&e(h,n);else if(f){n=j(h.getRootItem());var k=b.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT;f(k,"No viewable content",n)}}function m(a,d,e){if(401===a&&void 0===LMV_THIRD_PARTY_COOKIE)LMV_THIRD_PARTY_COOKIE=!1,c.refreshRequestHeader(c.token.accessToken),k(g);else{var h=j(e);if(f){var i="Error: "+a+" ("+d+")";f(b.Private.ErrorHandler.getErrorCode(a),i,a,d,h)}}}var n,o=h(a),p={queryParams:g?"acmsession="+g:""};c.ViewingService.getManifest(c.initLoadContext(p),o,l,m)}"function"!=typeof arguments[1]&&(c.logger.warn("Document.load called with deprecated (auth) parameter"),"function"==typeof arguments[2]&&(e=arguments[2]),"function"==typeof arguments[3]&&(f=arguments[3])),g?c.ViewingService.getACMSession(b.getApiEndpoint(),g,k,f):k()},d.requestThumbnailWithSecurity=function(a,b){var d=function(a){b(null,a)},e=function(){b("error",null)},f={responseType:"blob",skipAssetCallback:!0,size:a.width,guid:a.guid},g="urn:"+a.urn;c.ViewingService.getThumbnail(c.initLoadContext(),g,d,e,f)},d.prototype.getFullPath=function(a){if(!a)return a;var d=a;if(c.offline){if(d.indexOf(b.Private.offlineResourcePrefix)==-1){var e=d.indexOf(b.Private.ViewingService.OSS_PREFIX);if(e!==-1){var f=d.substr(d.indexOf("/")+1),g=decodeURIComponent(f),h=g.substr(g.indexOf("/"));d=decodeURIComponent(b.Private.offlineResourcePrefix)+h}else d=decodeURIComponent(b.Private.offlineResourcePrefix)+d.substr(d.indexOf("/"))}}else 0===a.indexOf("urn")?d=b.getItemApi()+a:0===a.indexOf("$file$")&&(d=this.myPath.replace("/bubble.json","")+a.replace("$file$",""));return d},d.prototype.getThumbnailOptions=function(a,b,c){var d=b?b:200,e=c?c:200;return{urn:this.myData.urn,width:d,height:e,guid:encodeURIComponent(a.guid),acmsession:this.acmSessionId}},d.prototype.getThumbnailPath=function(a,c,d){var e=this.getThumbnailOptions(a,c,d),f=b.getThumbnailApi()+e.urn+"?guid="+e.guid+"&width="+e.width+"&height="+e.height;return e.acmsession&&(f+="&acmsession="+e.acmsession),f},d.prototype.getViewablePath=function(b,c){if("geometry"===b.type){var e=[];if("3d"===b.role?e=d.getSubItemsWithProperties(b,{mime:"application/autodesk-svf"},!1):"2d"===b.role&&(e=d.getSubItemsWithProperties(b,{role:"leaflet"},!1),e.length>0&&c&&a(c,b,e[0]),0===e.length&&(e=d.getSubItemsWithProperties(b,{role:"image"},!1)),0===e.length&&(e=d.getSubItemsWithProperties(b,{mime:"application/autodesk-f2d"},!1)),0===e.length&&(e=d.getSubItemsWithProperties(b,{role:"tileRoot"},!0))),e.length>0)return this.getFullPath(e[0].urn)}else if("view"===b.type){var f=this.getViewGeometry(b);if(f)return this.getViewablePath(f)}return""},d.prototype.getPropertyDbPath=function(){return this.getFullPath(this.myPropertyDb)},d.prototype.getRootItem=function(){return this.myData},d.prototype.getPath=function(){return this.myPath},d.prototype.getItemById=function(a){function b(c){if(!c)return null;for(var d in c){var e=c[d];if("guid"===d&&e===a)return c;if(null!==e&&"object"==typeof e&&"parent"!==d){var f=b(e);if(f)return f}}return null}return b(this.myData)},d.getSubItemsWithProperties=function(a,b,c){var e=[];if(!a)return[];for(var f=a.children?a.children.length:0,g=0;g<f;g++){var h=a.children[g];(function(a,b){for(var c in b)if(!(c in a)||b[c]!==a[c])return!1;return!0})(h,b)&&e.push(h),c&&e.push.apply(e,d.getSubItemsWithProperties(h,b,c))}return e},d.prototype.getViewGeometry=function(a){return this.myViewGeometry[a.guid]},d.prototype.getNumViews=function(a){return this.myNumViews[a.guid]||0},d.prototype.getParentId=function(a){var b=this.getItemById(a);if(!b)return null;var c=b.parent;return c?c.guid:null},d.prototype.getMessages=function(a,b){var c=[];if(!a)return c;var d=null;b&&(d=this.getRootItem());for(var e=a;e&&(!b||parent!==d);){if(e.messages)for(var f=0;f<e.messages.length;f++)c.push(e.messages[f]);e=e.parent}return c},b.Document=d}(),/** @license Copyright (c) 2013 Autodesk Inc. */
function(){"use strict";function a(a){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=1e-6,this.__minDistance=1e-5;var b=void 0,c=void 0,d=null,e={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(a){a!==d&&(d=a,a&&(a.hasOwnProperty("target")||(a.target=new THREE.Vector3(0,0,0)),a.hasOwnProperty("pivot")||(a.pivot=new THREE.Vector3(0,0,0)),a.worldup=a.up.clone(),a.dirty=!0))},this.getCamera=function(){return d},this.setScreenViewport=function(a){e=a},this.getScreenViewport=function(){return e},this.__setUp=function(a){if(a&&d){if(0!==a.clone().normalize().sub(d.worldup).lengthSq())return d.worldup.copy(a).normalize(),d.dirty=!0,!0}return!1},this.__getUp=function(){return d?d.worldup:new THREE.Vector3(0,1,0)},this.setView=function(a,b){d&&a&&b&&(d.position.copy(a),d.target.copy(b),d.dirty=!0)},this.orientCameraUp=function(){d&&this.isActionEnabled("roll")&&(d.up.copy(this.getAlignedUpVector()),d.dirty=!0)},this.getPivotPoint=function(){return d?d.pivot.clone():new THREE.Vector3(0,0,0)},this.setPivotPoint=function(a){d&&a&&(d.pivot.copy(a),d.dirty=!0)},this.getPosition=function(){return d?d.position.clone():new THREE.Vector3(0,0,1)},this.setPosition=function(a){d&&a&&(d.position.copy(a),d.dirty=!0)},this.setTarget=function(a){d&&a&&(d.target.copy(a),d.dirty=!0)},this.getTarget=function(){return d?d.target.clone():new THREE.Vector3(0,0,0)},this.getEyeVector=function(){return d?d.target.clone().sub(d.position):new THREE.Vector3(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(a){return d?a.center().sub(d.position):new THREE.Vector3(0,0,-1)},this.getFovMin=function(){return 6.88},this.getFovMax=function(){return 100},this.isPointVisible=function(a){return(new THREE.Frustum).setFromMatrix(d.projectionMatrix.clone().multiply(d.matrixWorldInverse)).containsPoint(a)},this.setVerticalFov=function(a,b){if((!d||d.isPerspective)&&(a<6.88?a=6.88:a>100&&(a=100),d&&this.isActionEnabled("fov"))){if(Math.abs(d.fov-a)<=1e-6)return;if(b){var c=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),e=this.getPosition(),f=this.getEyeVector(),g=THREE.Math.degToRad(d.fov),h=THREE.Math.degToRad(a),i=c?this.getPivotPlaneDistance():f.length(),j=i*Math.tan(.5*g)/Math.tan(.5*h),k=f.normalize().multiplyScalar(i-j);this.setPosition(e.add(k)),c&&this.setTarget(this.getTarget().add(k))}d.setFov(a),d.dirty=!0}},this.computeFit=function(b,c,d,e,f){if(!e||e.empty())return{position:b,target:c};f=void 0===f?1:f;for(var g=e.center(),h=e.size(),i=b.clone().sub(c).normalize(),j=Math.tan(THREE.Math.degToRad(.5*d)),k=0,l=this.computeOrthogonalUp(b,c),m=i.clone().cross(l).normalize(),n=new THREE.Vector3,o=0===h.z?4:8,p=0;p<o;p++){n.set(0==(1&p)?-.5*h.x:.5*h.x,0==(2&p)?-.5*h.y:.5*h.y,0==(4&p)?-.5*h.z:.5*h.z);var q=0;a.isPerspective&&(q=n.dot(i));var r=Math.abs(n.dot(l)),s=Math.abs(n.dot(m)),t=q+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*r/j;k<t&&(k=t),t=q+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*s/(f*j),k<t&&(k=t)}return g.add(l.multiplyScalar(-k*this.FIT_TO_VIEW_VERTICAL_OFFSET)),g.add(m.multiplyScalar(k*this.FIT_TO_VIEW_HORIZONTAL_OFFSET)),i.multiplyScalar(k),{position:g.clone().add(i),target:g}},this.computeOrthogonalUp=function(a,b){var c=this.__getUp(),d=b.clone().sub(a);if(0===d.lengthSq())return d.copy(c);var e=d.clone().cross(c);return 0===e.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z-=1e-4,e.crossVectors(d,c)),e.cross(d).normalize()},this.fitBounds=function(a,b,c){var e=this.getTarget(),f=this.getPosition();if(!this.isActionEnabled("gotoview")||!b||b.empty())return{position:f,target:e};var g=this.getVerticalFov(),h=this.computeFit(f,e,g,b,d.aspect),i=c?this.computeOrthogonalUp(f,e):d.up;return a?(d.up.copy(i),this.setView(h.position,h.target)):this.setRequestTransitionWithUp(!0,h.position,h.target,g,i),this.setPivotPoint(h.target),this.setPivotSetFlag(!0),h},this.computeOverviewDistance=function(a){if(this.__is2D){var b=a.size(),c=d.aspect,e=b.x/c,f=b.y;return Math.max(e,f)}var g=this.getVerticalFov(),b=a.size(),h=b.length();return 0===h&&(h=2),d.isPerspective?.5*h/Math.tan(THREE.Math.degToRad(.5*g)):h},this.applyDollyConstraint=function(a,e){var f=a;if((b||e)&&a>1){var g,h=d.isPerspective?this.getEyeToCenterOfBoundsVec(e):this.getEyeVector();g=b?2*this.computeOverviewDistance(b):2*this.computeOverviewDistance(e);var i=Math.abs(g/h.length());i=Math.max(i,1),f=Math.min(f,i)}if(c&&this.__is2D){var j=d.clientHeight/c,h=this.getEyeVector(),k=j/-h.z;k=Math.min(k,1),f=Math.max(f,k)}return f},this.applyPanningConstraint2D=function(a){if(this.__is2D&&b){var c=d.position.x+a.x,e=d.position.y+a.y;c=THREE.Math.clamp(c,b.min.x,b.max.x),e=THREE.Math.clamp(e,b.min.y,b.max.y);var f=c-d.position.x,g=e-d.position.y,h=Math.min(a.x,0),i=Math.min(a.y,0),j=Math.max(a.x,0),k=Math.max(a.y,0);f=THREE.Math.clamp(f,h,j),g=THREE.Math.clamp(g,i,k),a.x=f,a.y=g}},this.updateCamera=function(){d&&(d.updateProjectionMatrix(),this.orient(d,d.target,d.position,d.up),d.dirty=!1)},this.setCamera(a),this.setConstraints2D=function(a,d){b=a,c=d}}var b=Autodesk.Viewing,c=b.Private;a.prototype.constructor=a,a.prototype.setIs2D=function(a){this.__is2D=!!a},a.prototype.getIs2D=function(){return this.__is2D},a.prototype.setIsTouchDevice=function(a){this.__isTouchDevice=!!a},a.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},a.prototype.orient=function(){function a(){b||(b=new THREE.Matrix4,c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3)}var b,c,d,e;return function(f,g,h,i){a();var j=b.elements;e.subVectors(h,g).normalize(),0===e.lengthSq()&&(e.z=1),c.crossVectors(i,e).normalize(),0===c.lengthSq()&&(i.z>i.y?e.y-=1e-4:e.z+=1e-4,c.crossVectors(i,e).normalize()),d.crossVectors(e,c),j[0]=c.x,j[4]=d.x,j[8]=e.x,j[1]=c.y,j[5]=d.y,j[9]=e.y,j[2]=c.z,j[6]=d.z,j[10]=e.z,f.setRotationFromMatrix(b)}}(),a.prototype.fov2fl=function(a){var b=THREE.Math.degToRad(a);return b<=0&&(b=1e-4),Math.round(12/Math.tan(.5*b))},a.prototype.fl2fov=function(a){a<=0&&(a=1e-4);var b=2*Math.atan(12/a);return THREE.Math.radToDeg(b)},a.prototype.setCameraUpVector=function(a){if(this.isActionEnabled("roll")){var b=this.getCamera();b.up.copy(a),b.dirty=!0}},a.prototype.getCameraUpVector=function(){var a=this.getCameraRightVector(!1),b=this.getEyeVector();return a.cross(b).normalize()},a.prototype.getAlignedUpVector=function(){var a=this.getCameraRightVector(!0),b=this.getEyeVector();return a.cross(b).normalize()},a.prototype.getCameraRightVector=function(a){var b=new THREE.Vector3,c=a?this.getWorldUpVector():this.getCamera().up,d=this.getEyeVector();return b.crossVectors(d,c),0===b.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z+=1e-4,b.crossVectors(d,c)),b.normalize()},a.prototype.setWorldUpVector=function(a,b){this.isActionEnabled("roll")&&(this.__setUp(a),b&&this.orientCameraUp())},a.prototype.getWorldUpVector=function(){return this.__getUp().clone()},a.prototype.getWorldRightVector=function(){var a=new THREE.Vector3;return a.copy(this.__getUp()),Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):a.z>=0?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x),a.normalize()},a.prototype.getVerticalFov=function(){return this.getCamera().fov},a.prototype.getHorizontalFov=function(){var a=this.getScreenViewport();return this.getCamera().fov*(a.width/a.height)},a.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},a.prototype.setFocalLength=function(a,b){this.setVerticalFov(this.fl2fov(a),b)},a.prototype.setReverseZoomDirection=function(a){this.__options.reverseDolly=!!a},a.prototype.setReverseHorizontalLookDirection=function(a){if(this.getIs2D())return void c.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D");this.__options.reverseHorizontalLookDirection=!!a},a.prototype.setReverseVerticalLookDirection=function(a){if(this.getIs2D())return void c.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D");this.__options.reverseVerticalLookDirection=!!a},a.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},a.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(c.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},a.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(c.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},a.prototype.setZoomTowardsPivot=function(a){this.__options.dollyToPivot=!!a},a.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},a.prototype.setOrbitPastWorldPoles=function(a){if(this.getIs2D())return void c.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D");this.__options.orbitPastPoles=!!a},a.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(c.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},a.prototype.setUsePivotAlways=function(a){this.__options.usePivotAlways=!!a},a.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},a.prototype.setUseLeftHandedInput=function(a){this.__options.useLeftHandedInput=!!a},a.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},a.prototype.setIsLocked=function(a){this.__options.lockNavigation=!!a},a.prototype.getIsLocked=function(){return this.__options.lockNavigation},a.prototype.setLockSettings=function(a){for(var b in this.__lockSettings)a.hasOwnProperty(b)&&(this.__lockSettings[b]=a[b])},a.prototype.getLockSettings=function(){var a={};for(var b in this.__lockSettings)a[b]=this.__lockSettings[b];return a},a.prototype.isActionEnabled=function(a){return!this.__options.lockNavigation||this.__lockSettings[a]===!0},a.prototype.setPivotSetFlag=function(a){this.__pivotIsSetFlag=!!a},a.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},a.prototype.setRequestFitToView=function(a){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!a)},a.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},a.prototype.setRequestHomeView=function(a){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!a)},a.prototype.getRequestHomeView=function(){return this.__homeViewRequested},a.prototype.setRequestTransition=function(a,b,c,d,e,f){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:d,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:e,pivot:f?f.clone():c.clone()}:null},a.prototype.setRequestTransitionWithUp=function(a,b,c,d,e,f,g){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:d,up:e.clone(),worldUp:f?f:this.getWorldUpVector(),reorient:!1,pivot:g?g.clone():c.clone()}:null},a.prototype.getRequestTransition=function(){return this.__destinationView},a.prototype.setTransitionActive=function(a){this.__transitionActive=!!a},a.prototype.getTransitionActive=function(){return this.__transitionActive},a.prototype.getWorldSize=function(a){var b=this.getScreenViewport(),c=b.width/b.height,d=2*a*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov)),e=d*c;return new THREE.Vector2(e,d)},a.prototype.getWorldPoint=function(a,b){b=1-b,a=2*a-1,b=2*b-1;var c,d=this.getCamera();d.isPerspective&&(c=new THREE.Vector3(a,b,1),c=c.unproject(d));var e,f,g=this.getEyeVector(),h=this.getPosition();if(!d.isPerspective||isNaN(c.x)){var i=this.getWorldSize(g.length()),j=this.getCameraRightVector(!1).multiplyScalar(.5*a*i.x),k=this.getCameraUpVector().multiplyScalar(.5*b*i.y);e=g.clone().add(j).add(k).normalize()}else e=c.sub(h).normalize();var l=this.getPivotPoint();if(this.__pivotIsSetFlag&&(this.getIs2D()||d.isPerspective&&this.isPointVisible(l))){var m=e.dot(g);f=0!==m?Math.abs(l.sub(h).dot(g))/m:l.sub(h).length()}else f=d.isPerspective?.5*(d.near+d.far):d.orthoScale;return e.multiplyScalar(f).add(h)},a.prototype.getPivotPlaneDistance=function(){var a=this.getPivotPoint(),b=this.getEyeVector(),c=this.getPosition();return a.sub(c).dot(b.normalize())},a.prototype.panRelative=function(a,b,c){if(this.isActionEnabled("pan")){var d=this.getWorldSize(c),e=a*d.x,f=b*d.y,g=this.getCameraRightVector(!1).multiplyScalar(e),h=this.getCameraUpVector().multiplyScalar(f),i=g.add(h);this.applyPanningConstraint2D(i),this.setView(this.getPosition().add(i),this.getTarget().add(i))}},a.prototype.dollyFromPoint=function(a,b,c){if(this.isActionEnabled("zoom")&&!(Math.abs(a)<=this.__kEpsilon)){var d=this.getPosition(),e=b.clone().sub(d),f=this.getEyeVector();if(!this.getCamera().isPerspective){var g=f.lengthSq(),h=f.dot(e);if(0==h)return;e.multiplyScalar(g/h),b=d.clone().add(e)}var i=e.length(),j=i+a;j<this.__minDistance&&(j=this.__minDistance);var k=j/i;if(k=this.applyDollyConstraint(k,c),Math.abs(k-1)>this.__kEpsilon){e.multiplyScalar(k),e.set(-e.x,-e.y,-e.z);var l=e.add(b),f=this.getEyeVector();this.getCamera().isPerspective||f.multiplyScalar(k),this.setView(l,f.add(l))}}},a.prototype.toPerspective=function(){if(this.getIs2D())return void c.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");var a=this.getCamera();a.isPerspective||(a.toPerspective(),a.dirty=!0)},a.prototype.toOrthographic=function(){var a=this.getCamera();a.isPerspective&&(a.toOrthographic(),a.dirty=!0)},a.snapToAxis=function(a){var b=new THREE.Vector3(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z));return b.x>b.y&&b.x>b.z?a.set(a.x>0?1:-1,0,0):b.y>b.x&&b.y>b.z?a.set(0,a.y>0?1:-1,0):a.set(0,0,a.z>0?1:-1),a},Autodesk.Viewing.Navigation=a}(),/** @license Copyright (c) 2013 Autodesk Inc. */
function(){"use strict";function a(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e=Array.isArray(d),f=a[c],g=Array.isArray(f);e&&g?(d?e||(d=[d]):d=[],f?g||(f=[f]):f=[],a[c]=f.concat(d)):a[c]=d}}var b=Autodesk.Viewing,c=Autodesk.Viewing.Private,d=function(a,b){this.appContainerId=a,this.container=document.getElementById(a),this.options=b||{},this.myRegisteredViewers={},this.myDocument=null,this.myCurrentViewer=null,this.urn=null,this.selectedItem=null,this.bubble=null,this.extensionCache={};var c=this;this.onHyperlinkHit=function(a){var b=a.data.href,d=c.bubble.search({viewableID:b});if(d&&d.length>0)c.selectItem(d[0].data);else{var e=new RegExp(/^https?:\/\//);b.match(e)||(b="http://"+b),window.open(b)}},this.onLoadGeometry=function(a){var b=a.data;c.selectItem(b.item,b.onSuccessCb,b.onErrorCb)}};d.prototype.k3D="3D",d.prototype.finish=function(){this.myCurrentViewer&&(this.myCurrentViewer.finish(),this.myCurrentViewer=null)},d.prototype.registerViewer=function(a,d,e){if(a!==this.k3D)return void c.logger.error("The only acceptable viewer type is k3D.",b.errorCodeString(b.ErrorCodes.VIEWER_INTERNAL_ERROR));e=e||{},this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&(e.hasOwnProperty("disableBrowserContextMenu")||(e.disableBrowserContextMenu=this.options.disableBrowserContextMenu)),this.myRegisteredViewers[a]={},this.myRegisteredViewers[a].class=d,this.myRegisteredViewers[a].config=e},d.prototype.getViewerClass=function(a){return this.myRegisteredViewers.hasOwnProperty(a)?this.myRegisteredViewers[a].class:null},d.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)},d.prototype.getViewer=function(b){var c=this.myRegisteredViewers[this.k3D];if(!c)return null;var d={};a(d,c.config),a(d,b);var e=c.class;if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===e)return this.myCurrentViewer.tearDown(),this.myCurrentViewer.setUp(d),this.myCurrentViewer;this.setCurrentViewer(null);for(var f=this.getViewerContainer();f.hasChildNodes();)f.removeChild(f.lastChild);var g=new e(f,d);return this.setCurrentViewer(g),g},d.prototype.setCurrentViewer=function(a){this.myCurrentViewer&&(this.myCurrentViewer.removeEventListener(b.HYPERLINK_EVENT,this.onHyperlinkHit),this.myCurrentViewer.removeEventListener(b.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),this.myCurrentViewer.finish()),this.myCurrentViewer=a,this.myCurrentViewer&&(a.addEventListener(b.HYPERLINK_EVENT,this.onHyperlinkHit),a.addEventListener(b.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),a.extensionCache=this.extensionCache)},d.prototype.getCurrentViewer=function(){return this.myCurrentViewer},d.prototype.loadDocument=function(a,d,e,f){var g=this;c.logger.track({category:"load_document",urn:0==a.indexOf("urn:")?a.substring(4):a}),b.Document.load(a,function(a,b){g.myDocument=a,g.bubble=new Autodesk.Viewing.BubbleNode(a.myData),g.onDocumentLoaded(a,b),d&&d(a,b)},function(a,b,c,d,f){g.onDocumentFailedToLoad(a,b,f),e&&e(a,b,c,d,f)},f)},d.prototype.onDocumentLoaded=function(a,b){c.logger.log(a,b)},d.prototype.onDocumentFailedToLoad=function(a,d,e){c.logger.error(b.errorCodeString(a),d,e)},d.prototype.getDefaultGeometry=function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b].useAsDefault;if(d===!0||"true"===d)return a[b]}return a[0]},d.prototype.selectItem=function(a,b,d){var e={},f=this.myDocument.getViewablePath(a,e);if(!f)return!1;var g,h,i,j,k=!1;if("geometry"===a.type&&"3d"===a.role){var l=a.properties;if(l)for(var m in l)if(l.hasOwnProperty(m)&&l[m]._UnitLinear){j=l[m]._UnitLinear;break}k=!0,h=a.name,i=a}else if("view"===a.type&&"3d"===a.role)g=a,k=!0,(i=this.myDocument.getViewGeometry(a))&&(h=i.name);else if("geometry"===a.type&&"2d"===a.role){var n=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-f2d"},!1),o=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{role:"leaflet"},!1),p=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{role:"image"},!1);(n.length>0||o.length>0||p.length>0)&&(k=!0),h=a.name,i=a}else"view"===a.type&&"2d"===a.role&&(g=a,k=!0,(i=this.myDocument.getViewGeometry(a))&&(h=i.name));if(!k)return!1;var q=f.indexOf("urn:");c.logger.track({category:"load_viewable",role:a.role,type:a.type,urn:q!==-1?f.substring(q+4):f});var r=this.myDocument.getMessages(a,!0),s=this,t=this.myCurrentViewer&&this.urn===f,u=function(){var c=s.myCurrentViewer;g&&g.camera?c.setViewFromArray(g.camera,g.name):g&&g.viewbox?c.setViewFromViewBox(g.viewbox,g.name):t&&c.setViewFromFile(),j&&s.myCurrentViewer.setModelUnits(j),b&&b(s.myCurrentViewer,a,r)},v=function(a,b,c,e){d&&d(a,b,c,e,r)},w=!1;if(t)u&&u(),w=!0;else{this.urn=null;var x={defaultModelStructureTitle:h,viewableName:h};a.hasOwnProperty("extensions")&&(x.extensions=Array.isArray(a.extensions)?a.extensions:[a.extensions]);var y=this.getViewer(x);if(y){var z={ids:null,bubbleNode:this.bubble?this.bubble.findByGuid(a.guid):null,sharedPropertyDbPath:this.myDocument.getPropertyDbPath(),acmSessionId:this.myDocument.acmSessionId,loadOptions:e,useConsolidation:this.options.useConsolidation||!1,consolidationMemoryLimit:this.options.useConsolidation||104857600};if(y.started)y.loadModel(this.myDocument.getFullPath(f),z,u,v),w=!0;else{w=0===y.start(this.myDocument.getFullPath(f),z,u,v)}this.urn=f}}return!!w&&(this.selectedItem=a,this.onItemSelected(a,i),!0)},d.prototype.onItemSelected=function(a,b){if(c.logger.log("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRootItem().guid+"&item="+encodeURIComponent(a.guid)),this.itemSelectedObservers)for(var d=this.getCurrentViewer(),e=0;e<this.itemSelectedObservers.length;++e){var f=this.itemSelectedObservers[e];f.onItemSelected&&f.onItemSelected(d,a,b)}},d.prototype.addItemSelectedObserver=function(a){this.itemSelectedObservers||(this.itemSelectedObservers=[]),this.itemSelectedObservers.push(a)},d.prototype.selectItemById=function(a,b,c){var d=this.myDocument.getItemById(a);return!!d&&this.selectItem(d,b,c)},d.prototype.getSelectedItem=function(){return this.selectedItem},b.ViewingApplication=d}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.ViewCubeUi=function(a){this.viewer=a,this.container=null,this.cube=null,this.viewcube=null,this.infoButton=null,this.homeViewContainer=null};var avp=Autodesk.Viewing.Private;Autodesk.Viewing.Private.ViewCubeUi.prototype={constructor:Autodesk.Viewing.UI.ViewCube,create:function(){var a=this.viewer.config,b=!(!a||void 0===a.wantInfoButton)&&a.wantInfoButton;this.initContainer(),b&&this.initInfoButton(),this.initHomeButton()},initContainer:function(){this.container=document.createElement("div"),this.container.className="viewcubeUI",this.viewer.container.appendChild(this.container)},initInfoButton:function(){if(!(0<document.getElementsByClassName("infoButton").length)){this.infoButton=document.createElement("div"),this.infoButton.className="infoButton",this.infoButton.style.cursor="pointer",this.container.appendChild(this.infoButton);var a=this;this.infoButton.addEventListener("click",function(b){var c=a.viewer.getPropertyPanel(!0),d=!c.areDefaultPropertiesShown()||!c.isVisible();d&&c.showDefaultProperties(),d!==c.isVisible()&&c.setVisible(d)})}},initHomeButton:function(){if(!(0<document.getElementsByClassName("homeViewWrapper").length)){var a=document.createElement("div");a.className="homeViewWrapper",a.style.cursor="pointer",this.container.appendChild(a),this.homeViewContainer=a;var b=this;a.addEventListener("click",function(a){b.viewer.navigation.setRequestHomeView(!0)}),this._initHomeMenu(a)}},_initHomeMenu:function(a){var b=this.viewer,c=b.autocam,d=this;this.hideHomeViewMenu=function(a){h.style.display="none",document.removeEventListener("click",d.hideHomeViewMenu)};var e=document.createElement("div");e.className="homeViewMenuHandle";var f=document.createElement("img"),g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg==";f.src=g,f.width=f.height=18,e.appendChild(f),e.addEventListener("mouseover",function(a){f.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEVSURBVHja7JcxDoJAEEX/rvY2HMEb6AEsaTDxBngKIzfgDBR6AxJtiI0egN7Ght6GWBIYGzVKQHaQDYU7yYSwxb5HMvs3CCJCnyXRcxkBIzAsLwyWpx0ARyNzn29m81oBAE60mmqj237smBkwAl9PAfIssv3Y1kbMs+j9VZQvIyHEGMBI40enRHSpFdCcBR8ZUJcD2rKgnAH1Q5gmnu3HXcOBNPGUBIrQDbqUeMKL0A2UBIjo2pXEO5yIrso50IVEE7wxiH6RUIErJWEbCVW4chRzJDhw1l2gIsGFPzdmNQBLLrZr6R7pcL69WrpHkovtGoDF2o8rUCXRFt5aoCzRFl4pwCwLwOTxBGOeXi3Mv+HfC9wHAAIQ03ZDDGqmAAAAAElFTkSuQmCC"}),e.addEventListener("mouseleave",function(a){f.src=g}),a.appendChild(e);var h=document.createElement("div");h.className="homeViewMenu",this.viewer.container.appendChild(h);var i=document.createElement("div");i.className="homeViewMenuItem",i.textContent=Autodesk.Viewing.i18n.translate("Set current view as Home"),h.appendChild(i),i.addEventListener("click",function(a){c.setCurrentViewAsHome(!1),d.hideHomeViewMenu(a)});var j=document.createElement("div");j.className="homeViewMenuItem",j.textContent=Autodesk.Viewing.i18n.translate("Focus and set as Home"),h.appendChild(j),j.addEventListener("click",function(a){c.setCurrentViewAsHome(!0),d.hideHomeViewMenu(a)});var k=document.createElement("div");k.className="homeViewMenuItem",k.textContent=Autodesk.Viewing.i18n.translate("Reset Home"),h.appendChild(k),k.addEventListener("click",function(a){c.resetHome(),d.hideHomeViewMenu(a)}),a.addEventListener("mouseover",function(a){(b.model&&b.model.is2d()||b.prefs&&!b.prefs.viewCube)&&(e.style.display="block")}),a.addEventListener("mouseleave",function(a){e.style.display="none"}),e.addEventListener("click",function(a){(b.model&&b.model.is2d()||b.prefs&&!b.prefs.viewCube)&&(h.style.display="block",document.addEventListener("click",d.hideHomeViewMenu)),a.stopPropagation()}),a.addEventListener("contextmenu",function(a){(b.model&&b.model.is2d()||b.prefs&&!b.prefs.viewCube)&&(h.style.display="block",document.addEventListener("click",d.hideHomeViewMenu))})},setVisible:function(a){this.container.style.display=a?"block":"none"},displayViewCube:function(a,b){if(b&&this.viewer.prefs.set("viewCube",a),a&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.container.appendChild(this.viewcube),this.cube=new avp.Autocam.ViewCube("cube",this.viewer.autocam,this.viewcube,LOCALIZATION_REL_PATH);else if(!this.cube)return void this._positionHomeButton();this.viewcube.style.display=a?"block":"none",this._positionHomeButton(),a&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){var a,b=this.cube&&this.viewcube&&"block"===this.viewcube.style.display,c=this.viewer.container.getBoundingClientRect(),d=this.homeViewContainer.getBoundingClientRect();if(b){var e=this.viewcube.getBoundingClientRect();a=c.left+c.width-e.left-d.width}else if(this.infoButton){var f=this.infoButton.getBoundingClientRect();a=c.left+c.width-f.left+f.width-d.width}else a=10;this.homeViewContainer.style.right=a+"px"}},uninitialize:function(){this.container&&(this.viewer.container.removeChild(this.container),this.viewcube=null),this.infoButton=null,this.cube&&(this.cube.dtor(),this.cube=null),this.homeViewContainer=null,this.hideHomeViewMenu=null,this.viewer=null}};var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,avu=Autodesk.Viewing.UI,ave=Autodesk.Viewing.Extensions,stringToDOM=avp.stringToDOM=function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild};!function(){"use strict";av.TOOLBAR_CREATED_EVENT="toolbarCreated",av.VIEW_CUBE_CREATED_EVENT="viewCubeCreated",av.SIDE_BAR_OPEN_EVENT="SIDE_BAR_OPEN_EVENT",av.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools"};var a=function(a,b){b||(b={}),b.startOnInitialize=!1,av.Viewer3D.call(this,a,b),this.toolbar=null,this.dockingPanels=[],this.modelstructure=null,this.layersPanel=null};a.populateConfigOptions=function(a){a.hasOwnProperty("wantInfoButton")||(a.wantInfoButton=!0),a.hasOwnProperty("disabledExtensions")||(a.disabledExtensions={}),["measure","hyperlink","section"].forEach(function(b){a.disabledExtensions.hasOwnProperty(b)||(a.disabledExtensions[b]=!1)})},a.prototype=Object.create(av.Viewer3D.prototype),a.prototype.constructor=a,a.prototype.initialize=function(){var a=av.Viewer3D.prototype.initialize.call(this);if(a>0)return avp.ErrorHandler.reportError(this.container,a),a;var b=this;if(this.toolController){var c=new av.HotGestureTool(this);this.toolController.registerTool(c),this.toolController.activateTool(c.getName())}return this.getToolbar(!0),this.addEventListener(av.FULLSCREEN_MODE_EVENT,function(a){b.resizePanels({viewer:b}),b.updateFullscreenButton(a.mode)}),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new avp.ProgressBar(this.container),this.addEventListener(av.PROGRESS_UPDATE_EVENT,function(a){void 0!==a.percent&&b.progressbar.setPercent(a.percent)},!1),this.selectionActive=!1,this.addEventListener(av.SELECTION_CHANGED_EVENT,function(a){if(b.selectionActive=a.dbIdArray.length>0,b.prefs.openPropertiesOnSelect){b.getPropertyPanel(!0).setVisible(b.selectionActive)}}),this.addEventListener(av.ISOLATE_EVENT,function(a){(b.prefs.openPropertiesOnSelect||a.nodeIdArray[0]===a.model.getRootId())&&b.propertygrid&&b.propertygrid.setVisible(a.nodeIdArray.length>0||b.selectionActive)}),this.addEventListener(av.VIEWER_STATE_RESTORED_EVENT,function(a){b.renderoptions&&b.renderoptions.syncUI();var c=b.getSettingsPanel(!0);c&&c.syncUI()}),this.addEventListener(av.VIEWER_RESIZE_EVENT,function(a){b.resizePanels(),b.viewCubeUi&&b.viewCubeUi.cube&&b.viewCubeUi.cube.refreshCube(),b.updateToolbarButtons(a.width,a.height),b.centerToolBar&&b.centerToolBar()}),this.addEventListener(av.NAVIGATION_MODE_CHANGED_EVENT,function(a){b.updateToolbarButtons(b.container.clientWidth,b.container.clientHeight),b.centerToolBar&&b.centerToolBar()}),this.initEscapeHandlers(),this.localize(),this.run(),0},a.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null),this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null),this.propertygrid&&(this.propertygrid.uninitialize(),this.propertygrid=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),av.theHotkeyManager.popHotkeys("Autodesk.ROLL"),av.theHotkeyManager.popHotkeys("Autodesk.FOV"),this.removeEventListener(av.RENDER_OPTION_CHANGED_EVENT,this.onRenderOptionChanged),this.onRenderOptionChanged=null,this.removeEventListener(av.VIEWER_STATE_RESTORED_EVENT,this.onRestoreState),this.onRestoreState=null,this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.explodeSlider=null,this.explodeSubmenu=null,this.centerToolBar=null,this.toolbar=null,av.Viewer3D.prototype.uninitialize.call(this)},a.prototype.setUp=function(a){a||(a={}),a.startOnInitialize=!1,this.getToolbar(!0),av.Viewer3D.prototype.setUp.call(this,a)},a.prototype.tearDown=function(){av.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.modelstructure&&this.setModelStructurePanel(null),this.propertygrid&&this.setPropertyPanel(null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.layersPanel&&this.setLayersPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.removeEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube)},a.prototype.loadModel=function(a,b,c,d,e){function f(a){if(!i.running)return void avp.logger.error("createUI expects the viewer to be running.",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR));i.createUI(a)}function g(a){setTimeout(function(){f(a),c&&c.call(c,a)},1)}function h(a){avp.ErrorHandler.reportError(i.container,a),d&&d.apply(d,arguments)}var i=this;return av.Viewer3D.prototype.loadModel.call(this,a,b,g,h,e)},a.prototype.createUI=function(a){if(this.model===a){var b=this,c=this;this.initViewCube=function(){setTimeout(function(){c.displayViewCube(c.prefs.viewCube),c.removeEventListener(av.GEOMETRY_LOADED_EVENT,c.initViewCube)},1)};var d=this.config.disabledExtensions||{};this.initHotkeys(a),this.loadExtension("Autodesk.DefaultTools.NavTools",c.config),this.initModelTools(a),avp.ENABLE_DEBUG&&this.initDebugTools(),this.toolbar.container.style.display="block",this.fireEvent({type:av.TOOLBAR_CREATED_EVENT}),this.config.wantInfoButton=!0,this.createViewCube(),this.fireEvent({type:av.VIEW_CUBE_CREATED_EVENT}),this.centerToolBar=function(){b.toolbar.container.style.left="calc(50% - "+b.toolbar.getDimensions().width/2+"px)"},this.toolbar.addEventListener(avu.ToolBar.Event.SIZE_CHANGED,this.centerToolBar),this.initModality(),this.resize(),a.is2d()?(c.prefs.useFirstPersonNavigation?this.unloadExtension("Autodesk.FirstPerson"):this.unloadExtension("Autodesk.Beeline"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1),setTimeout(function(){d.measure||c.loadExtension("Autodesk.Measure",c.config),d.hyperlink||c.loadExtension("Autodesk.Hyperlink",c.config)},1)):(this.getDefaultNavigationToolName().indexOf("orbit")===-1&&this.setDefaultNavigationTool("orbit"),setTimeout(function(){c.prefs.useFirstPersonNavigation?c.loadExtension("Autodesk.FirstPerson",c.config):c.loadExtension("Autodesk.Beeline",c.config),c.prefs.fusionOrbit&&c.loadExtension("Autodesk.Viewing.FusionOrbit",c.config),d.measure||c.loadExtension("Autodesk.Measure",c.config),d.section||c.loadExtension("Autodesk.Section",c.config),d.hyperlink||c.loadExtension("Autodesk.Hyperlink",c.config),avp.isExperimentalFlagEnabled("billboards",c.config)&&(c.loadExtension("Autodesk.Comments",c.config),c.loadExtension("Autodesk.BillboardGui",c.config))},1),setTimeout(function(){avp.isExperimentalFlagEnabled("sidebar-ui",c.config)&&c.loadExtension("Autodesk.SideBarUi",c.config)},1),this.addEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube));var e=function(){if(c.modelstructure){var a=function(a){var b=c.config.defaultModelStructureTitle?c.config.defaultModelStructureTitle:"";c.modelstructure.setModel(a,b)},b=function(a){};c.model.getObjectTree(a,b)}c.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,e)};this.addEventListener(av.OBJECT_TREE_CREATED_EVENT,e)}},a.prototype.addOptionToggle=function(a,b,c,d,e){var f=e?this.prefs[e]:null;c="boolean"==typeof f?f:c;var g=document.createElement("li");g.className="toolbar-submenu-listitem";var h=document.createElement("input");h.className="toolbar-submenu-checkbox",h.type="checkbox",h.id=b,g.appendChild(h);var i=document.createElement("label");return i.setAttribute("for",b),i.setAttribute("data-i18n",b),i.textContent=av.i18n.translate(b),g.appendChild(i),a.appendChild(g),h.checked=c,h.addEventListener("touchstart",av.touchStartToClick),i.addEventListener("touchstart",av.touchStartToClick),g.addEventListener("touchstart",av.touchStartToClick),h.addEventListener("click",function(a){d(h.checked),a.stopPropagation()}),i.addEventListener("click",function(a){a.stopPropagation()}),g.addEventListener("click",function(a){d(!h.checked),a.stopPropagation()}),e&&this.prefs.addListeners(e,function(a){h.checked=a},function(a){h.checked=a,d(a)}),h},a.prototype.addOptionList=function(a,b,c,d,e,f){var g=this.prefs[f];d="number"==typeof g?g:d;var h=function(a){e(a.target.selectedIndex),a.stopPropagation()},i=document.createElement("select");i.className="optionDropDown",i.id="selectMenu_"+b;for(var j=0;j<c.length;j++){var k=document.createElement("option");k.value=j,k.setAttribute("data-i18n",c[j]),k.textContent=Autodesk.Viewing.i18n.translate(c[j]),i.add(k)}var l=document.createElement("li");l.className="toolbar-submenu-select";var m=document.createElement("div");return m.className="toolbar-submenu-selectlabel",m.setAttribute("for",b),m.setAttribute("data-i18n",b),m.textContent=av.i18n.translate(b),l.appendChild(m),l.appendChild(i),a.appendChild(l),i.selectedIndex=d,i.onchange=h,i.addEventListener("touchstart",function(a){a.stopPropagation()}),i.addEventListener("click",function(a){a.stopPropagation()}),f&&this.prefs.addListeners(f,function(a){i.selectedIndex=a},function(a){i.selectedIndex=a,e(a)}),i},a.prototype.showViewer3dOptions=function(a){var b=this.getSettingsPanel(!0);a&&b.isVisible()&&b.setVisible(!1),b.setVisible(a)},a.prototype.showRenderingOptions=function(a){this.renderoptions.setVisible(a)},a.prototype.showLayerManager=function(a){this.layersPanel.setVisible(a)},a.prototype.initHotkeys=function(a){var b,c,d=this,e=av.theHotkeyManager.KEYCODES;if(!a.is2d()){var f;b=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("fov"))&&(f=d.getActiveNavigationTool(),d.setActiveNavigationTool("fov"),!0)},c=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("fov"))&&(d.setActiveNavigationTool(f),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.FOV",[{keycodes:[e.CONTROL,e.SHIFT],onPress:b,onRelease:c}],{tryUntilSuccess:!0})}var g;b=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("roll"))&&(g=d.getActiveNavigationTool(),d.setActiveNavigationTool("worldup"),!0)},c=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("roll"))&&(d.setActiveNavigationTool(g),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.ROLL",[{keycodes:[e.ALT,e.SHIFT],onPress:b,onRelease:c}],{tryUntilSuccess:!0})},a.prototype.setModelStructurePanel=function(a){var b=this;return(a instanceof av.UI.ModelStructurePanel||null===a)&&(this.modelstructure&&(this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize()),this.modelstructure=a,a&&(this.addPanel(this.modelstructure),a.addVisibilityListener(function(c){c&&b.onPanelVisible(a,b),b.settingsTools.structurebutton.setState(c?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)}),b.model&&b.model.getObjectTree(function(a){b.modelstructure.setModel(a)})),!0)},a.prototype.setLayersPanel=function(a){var b=this;return this.model&&!this.model.is2d()?(avp.logger.warn("av.Viewer3D.setLayersPanel is not yet implemented for 3D"),!1):(a instanceof av.UI.LayersPanel||!a)&&(this.layersPanel&&(this.layersPanel.setVisible(!1),this.removePanel(this.layersPanel),this.layersPanel.uninitialize()),this.layersPanel=a,a&&(this.addPanel(a),a.addVisibilityListener(function(c){c&&b.onPanelVisible(a,b),b.settingsTools.layerButton.setState(c?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},a.prototype.setPropertyPanel=function(a){var b=this;return(a instanceof av.UI.PropertyPanel||!a)&&(this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize()),this.propertygrid=a,a&&(this.addPanel(a),a.addVisibilityListener(function(c){c&&b.onPanelVisible(a,b),b.settingsTools.propertiesbutton.setState(c?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},a.prototype.getPropertyPanel=function(a){return!this.propertygrid&&a&&this.setPropertyPanel(new ave.ViewerPropertyPanel(this)),this.propertygrid},a.prototype.setSettingsPanel=function(a){var b=this;return(a instanceof av.UI.SettingsPanel||!a)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=a,a&&(this.addPanel(a),a.addVisibilityListener(function(c){c&&b.onPanelVisible(a,b),b.viewerOptionButton.setState(c?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},a.prototype.getSettingsPanel=function(a){return!this.viewerSettingsPanel&&a&&this.setSettingsPanel(new ave.ViewerSettingsPanel(this,this.model)),this.viewerSettingsPanel},a.prototype.initModelTools=function(a){var b=this;if(a.is2d()){var c=new ave.ViewerLayersPanel(this);this.setLayersPanel(c);var d=new avu.Button("toolbar-layersTool");d.setToolTip("Layer Manager"),d.setIcon("adsk-icon-layers"),d.onClick=function(a){b.layersPanel||b.setLayersPanel(new ave.ViewerLayersPanel(b)),b.showLayerManager(!b.layersPanel.isVisible())},this.settingsTools.addControl(d),this.settingsTools.layerButton=d}else{if(!b.modelstructure){var e={docStructureConfig:b.config.docStructureConfig};b.setModelStructurePanel(new ave.ViewerModelStructurePanel(b,"Browser",e))}var f=new avu.Button("toolbar-modelStructureTool");f.setToolTip("Model browser"),f.setIcon("adsk-icon-structure"),f.onClick=function(a){b.showModelStructurePanel(!b.modelstructure.isVisible())},this.settingsTools.addControl(f),this.settingsTools.structurebutton=f,this.initExplodeSlider()}b.addEventListener(av.RESET_EVENT,function(){b.model&&!b.model.is2d()&&(b.explode(0),b.explodeSlider.value=0),b.showAll()});var g=new avu.Button("toolbar-propertiesTool");g.setToolTip("Properties"),g.setIcon("adsk-icon-properties"),g.onClick=function(a){var c=b.getPropertyPanel(!0);c.setVisible(!c.isVisible())},g.setVisible(!b.prefs.openPropertiesOnSelect),this.settingsTools.addControl(g),this.settingsTools.propertiesbutton=g;var h=new ave.ViewerSettingsPanel(this,a);this.setSettingsPanel(h),h.syncUI();var i=new avu.Button("toolbar-settingsTool");if(this.viewerOptionButton=i,i.setIcon("adsk-icon-settings"),i.setToolTip("Settings"),this.settingsTools.addControl(i),this.createViewerOptionsMenu(a),avp.ENABLE_DEBUG&&!a.is2d()){this.renderoptions=new avp.RenderOptionsPanel(this),this.addPanel(this.renderoptions);var j=new avu.Button("toolbar-renderOptionsTool");j.setToolTip("Rendering options"),j.setIcon("adsk-icon-settings-render"),j.onClick=function(a){b.showRenderingOptions(!b.renderoptions.isVisible())},this.settingsTools.addControl(j)}if(this.canChangeScreenMode()){var k=new avu.Button("toolbar-fullscreenTool",{collapsible:!1});k.setToolTip("Full screen"),k.setIcon("adsk-icon-fullscreen"),k.onClick=function(a){b.nextScreenMode()},this.settingsTools.addControl(k),this.settingsTools.fullscreenbutton=k,this.updateFullscreenButton(this.getScreenMode())}},a.prototype.setPropertiesOnSelect=function(a){this.prefs.set("openPropertiesOnSelect",a),this.settingsTools.propertiesbutton.setVisible(!a)},a.prototype.addDivider=function(a){var b=document.createElement("li");return b.className="toolbar-submenu-horizontal-divider",a.appendChild(b),b},a.prototype.createViewerOptionsMenu=function(a){function b(a){if(c.getExtension("Autodesk.SideBarUi")){var b=Autodesk.SideBarUi.Content;return void c.fireEvent({type:av.SIDE_BAR_OPEN_EVENT,content:b.Settings})}var d=c.getSettingsPanel(!0);d.isVisible()?c.showViewer3dOptions(!1):(c.showViewer3dOptions(!0),d.selectTab(a))}var c=this;this.viewerOptionButton.onClick=function(){b(ave.ViewerSettingTab.Performance)}},a.prototype.initDebugTools=function(){var a=new avu.ControlGroup("debugTools");this.debugMenu=a;var b=new avu.Button("toolbar-debugTool");b.setIcon("adsk-icon-bug"),a.addControl(b),this.debugMenu.debugSubMenuButton=b,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(a)},a.prototype.createDebugSubmenu=function(a){function b(){c.localize()}var c=this,d=document.createElement("div");d.id="toolbar-debugToolSubmenu",d.classList.add("toolbar-submenu"),d.classList.add("toolbar-settings-sub-menu"),d.classList.add("adsk-hidden"),this.debugMenu.subMenu=d,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(d),this.initModelStats(),this.addDivider(d),this.addDivider(d);var e=["English","Chinese Simplified","Chinese Traditional","Japanese","Czech","Korean","Polish","Russian","French","German","Italian","Spanish","Portuguese Brazil","Turkish"],f=["en","zh-Hans","zh-Hant","ja","cs","ko","pl","ru","fr","de","it","es","pt-br","tr"],g=c.selectedLanguage?c.selectedLanguage:0;this.addOptionList(d,"Language",e,g,function(a){var d=f[a];c.selectedLanguage=a,avp.setLanguage(d,b)},null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);var h=["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"];this.addOptionList(d,"Error",h,0,function(a){var b=a+1;avp.ErrorHandler.reportError(c.container,b,"")},null).parentNode.style.paddingBottom="15px";var i=d.getBoundingClientRect();this.debugMenu.subMenu.style.width=i.width+"px",this.container.removeChild(d),a.container.appendChild(d);var j=i.left+i.width,k=this.container.getBoundingClientRect().right;if(j>k){var l=-(j-k+10)+"px";this.debugMenu.subMenu.style.left=l}a.onMouseOver=function(a){d.classList.remove("adsk-hidden")},a.onMouseOut=function(a){d.classList.add("adsk-hidden")},av.isTouchDevice()&&(a.onClick=function(a){d.classList.toggle("adsk-hidden")})},a.prototype.initModelStats=function(){function a(a){var b=c.impl,d="";c.model&&(d+="Geom&nbsp;polys:&nbsp;"+b.modelQueue().getGeometryList().geomPolyCount+"<br>",d+="Instance&nbsp;polys:&nbsp;"+b.modelQueue().getGeometryList().instancePolyCount+"<br>",d+="Fragments:&nbsp;"+b.modelQueue().getFragmentList().getCount()+"<br>",d+="Geoms:&nbsp;"+b.modelQueue().getGeometryList().geoms.length+"<br>",d+="Loading&nbsp;time:&nbsp;"+(b.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),d+="# "+(a||""),c.modelStats.innerHTML=d}function b(){c.modelStats=document.createElement("div"),c.modelStats.className="statspanel",c.container.appendChild(c.modelStats),c.addEventListener(av.PROGRESS_UPDATE_EVENT,function(b){b.message&&a(b.message)}),c.fpsDisplay=document.createElement("div"),c.fpsDisplay.className="fps",c.container.appendChild(c.fpsDisplay)}var c=this;this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(d){d&&!c.modelStats&&(b(),a("")),c.modelStats.style.visibility=d?"visible":"hidden",c.fpsDisplay.style.visibility=d?"visible":"hidden",c.impl.fpsCallback=d?function(a){c.fpsDisplay.textContent=""+(0|a)}:null})},a.prototype.initEscapeHandlers=function(){var a=this;this.addEventListener(av.ESCAPE_EVENT,function(b){if(!a.contextMenu||!a.contextMenu.hide()){if(a.renderoptions&&a.renderoptions.isVisible())return void a.renderoptions.setVisible(!1);if(a.getActiveNavigationTool()!==a.getDefaultNavigationToolName())return a.toolController&&a.toolController.setIsLocked(!1),a.setActiveNavigationTool(),void avp.HudMessage.dismiss();if(a.selectionActive)return void a.clearSelection();if(!a.areAllVisible())return void a.showAll();if(!avp.AlertBox.dismiss()){for(var c=0;c<a.dockingPanels.length;++c){var d=a.dockingPanels[c];if("none"!==d.container.style.display&&""!==d.container.style.display)return void(d.container===a.modelstructure?a.showModelStructurePanel(!1):d.setVisible(!1))}a.escapeScreenMode()}}})},a.prototype.showViewCubeUI=function(a){this.viewCubeUi.setVisible(a)},a.prototype.displayViewCube=function(a,b){this.viewCubeUi.displayViewCube(a,b)},a.prototype.getToolbar=function(a){if(!this.toolbar&&a){var b=av.UI;this.toolbar=new b.ToolBar("guiviewer3d-toolbar"),this.navTools=new b.RadioButtonGroup(av.TOOLBAR.NAVTOOLSID),this.modelTools=new b.ControlGroup(av.TOOLBAR.MODELTOOLSID),this.settingsTools=new b.ControlGroup(av.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container),
this.toolbar.container.style.display="none"}return this.toolbar},a.prototype.showModelStructurePanel=function(a){this.modelstructure.setVisible(a),a&&this.modelstructure instanceof ave.ViewerModelStructurePanel&&(this.modelstructure.setSelection(this.getSelection()),this.modelstructure.setIsolation(this.getIsolatedNodes()))},a.prototype.onPanelVisible=function(a){this.dockingPanels.splice(this.dockingPanels.indexOf(a),1),this.dockingPanels.splice(0,0,a)},a.prototype.updateFullscreenButton=function(a){var b="adsk-icon-fullscreen";switch(a){case av.ScreenMode.kNormal:this.isScreenModeSupported(av.ScreenMode.kFullBrowser)||(b="adsk-icon-fullscreen");break;case av.ScreenMode.kFullBrowser:b=this.isScreenModeSupported(av.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case av.ScreenMode.kFullScreen:b="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(b)},a.prototype.localize=function(){av.i18n.localize(),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),avp.ErrorHandler.localize()},a.prototype.addPanel=function(a){return this.dockingPanels.indexOf(a)===-1&&(this.dockingPanels.push(a),!0)},a.prototype.removePanel=function(a){var b=this.dockingPanels.indexOf(a);return b>-1&&(this.dockingPanels.splice(b,1),!0)},a.prototype.resizePanels=function(a){a=a||{};var b=this.toolbar.getDimensions().height,c=this.getDimensions(),d=c.height;a.dimensions&&a.dimensions.height?d=a.dimensions.height:a.dimensions={height:c.height,width:c.width},a.dimensions.height=d-b;var e=a?a.viewer:null;e||(e=this);var f=a?a.dockingPanels:null;f||(f=e.dockingPanels);var g,h,i=e.container.getBoundingClientRect(),j=i.top,k=i.bottom,l=i.left,m=i.right;a&&a.dimensions?(g=a.dimensions.width,h=a.dimensions.height,k=a.dimensions.height):(g=i.width,h=i.height);for(var n=0;n<f.length;++n){var o=f[n].container,p=o.getBoundingClientRect(),q=p.top,r=p.bottom,s=p.left,t=p.right,u=p.width,v=p.height;u&&v&&(g<u&&(u=Math.round(g),o.style.width=u+"px"),h<v&&(v=Math.round(h),o.style.height=v+"px"),(m<t||o.dockRight)&&(s=Math.round(m-u-l),o.style.left=s+"px"),(k<r||o.dockBottom)&&(q=Math.round(k-v-j),q<0&&(q=0),o.style.top=q+"px"),o.style.maxWidth=Math.round(g)+"px",o.style.maxHeight=Math.round(h)+"px")}},a.prototype.initExplodeSlider=function(){var a=this,b=new avu.Button("toolbar-explodeTool");b.setIcon("adsk-icon-explode"),b.setToolTip("Explode model"),a.modelTools.addControl(b,{index:0});this.explodeSubmenu=avp.stringToDOM('<div class="explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>');var c;c=document.querySelector("#toolbar-explodeTool").parentNode,this.explodeSubmenu.classList.add("ios"),c.appendChild(this.explodeSubmenu);var d=this.explodeSubmenu.querySelector(".explode-slider");a.explodeSlider=d,d.oninput=function(b){a.explode(d.value)},d.onchange=function(b){a.explode(d.value)},this.explodeSubmenu.onclick=function(a){a.stopPropagation()};var e=b.container.querySelector(".adsk-control-tooltip");b.onClick=function(c){var f=b.getState();f===avu.Button.State.INACTIVE?(b.setState(avu.Button.State.ACTIVE),e.style.display="none",a.explodeSubmenu.style.display="",avp.logger.track({category:"tool_changed",name:"explode"})):f===avu.Button.State.ACTIVE&&(b.setState(avu.Button.State.INACTIVE),e.style.display="",d.parentNode.style.display="none",a.explode(0),a.explodeSlider.value=0)}},a.prototype.initInspectTools=function(){var a=new avu.Button("toolbar-inspectTools");a.setToolTip("Inspect"),a.setIcon("measure"),a.setVisible(!1),this.modelTools.addControl(a);var b=new avu.RadioButtonGroup("toolbar-inspectSubMenu");b.addClass("toolbar-vertical-group"),b.setVisible(!1),this.modelTools.addControl(b),a.container.insertBefore(b.container,a.container.firstChild),a.onMouseOver=function(){b.setVisible(!0)},a.onMouseOut=function(){b.setVisible(!1)},av.isTouchDevice()&&(a.onClick=function(a){b.setVisible(!b.isVisible())})},a.prototype.initModality=function(){function a(b){for(var c=0;c<2&&b.parentElement;){var d=b.id;if(0===d.indexOf("toolbar-")){if(d.indexOf("arrow")===d.length-5)return;return a(b.parentElement)||b}b=b.parentElement,c++}}function b(a){return a.id.substring(8,a.id.length)}function c(a){return a.classList.contains("active")}function d(a){var b=document.createEvent("Event");b.initEvent("click",!0,!0),a.dispatchEvent(b)}function e(a,b,c){h[a]=c?b:void 0}function f(f){if(!f.target.classList.contains("clickoff")){var i=a(f.target);if(i){var j=b(i);if(g[j]&&!("sectionTool"===j&&(f.target.classList.contains("adsk-icon-section-analysis")||f.target.querySelector(".adsk-icon-section-analysis"))||h[j]&&(e(j,i,!1),c(i)))){for(var k in h){var l=h[k];if(l){var m=b(l);c(l)?g[j][m]||d(l):e(m,l,!1)}}e(j,i,!0)}}}}var g={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{},measureTool:{},explodeTool:{},billboardTool:{}},h={};this.toolbar.container.addEventListener("click",f,!0)},a.prototype.updateToolbarButtons=function(a,b){if(this.getToolbar(!1)){var c,d;d=a>310?"block":"none",c=this.modelTools.getControl("toolbar-explodeTool"),c&&c.setDisplay(d),d=a>380?"block":"none",c=this.modelTools.getControl("toolbar-collaborateTool"),c&&c.setDisplay(d),d=a>515?"block":"none";var e=this.navTools.getControl("toolbar-cameraSubmenuTool");e&&(e.setDisplay(d),c=e.subMenu.getControl("toolbar-homeTool"),c&&c.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),c=e.subMenu.getControl("toolbar-fitToViewTool"),c&&c.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),c=e.subMenu.getControl("toolbar-focalLengthTool"),c&&c.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(c=e.subMenu.getControl("toolbar-rollTool"))&&c.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),d=a>700?"block":"none",c=this.modelTools.getControl("toolbar-measureTool"),c&&c.setDisplay(d),c=this.modelTools.getControl("toolbar-sectionTool"),c&&c.setDisplay(d),d=a>740?"block":"none",c=this.navTools.getControl("toolbar-beelineTool"),c&&c.setDisplay(this.navigation.isActionEnabled("walk")?d:"none"),c=this.navTools.getControl("toolbar-firstPersonTool"),c&&c.setDisplay(this.navigation.isActionEnabled("walk")?d:"none"),c=this.navTools.getControl("toolbar-zoomTool"),c&&c.setDisplay(this.navigation.isActionEnabled("zoom")?d:"none"),c=this.navTools.getControl("toolbar-panTool"),c&&c.setDisplay(this.navigation.isActionEnabled("pan")?d:"none"),(c=this.navTools.getControl("toolbar-orbitTools"))&&c.setDisplay(this.navigation.isActionEnabled("orbit")?d:"none")}},avp.GuiViewer3D=a}(),function(){"use strict";function a(a,b){this._id=a,this._isCollapsible=!b||b.collapsible,this._toolTipElement=null,this._listeners={},this.container=document.createElement("div"),this.container.id=a,this.addClass("adsk-control")}var b=Autodesk.Viewing;Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},b.EventDispatcher.prototype.apply(a.prototype),a.prototype.constructor=a,a.prototype.container=null,a.prototype.getId=function(){return this._id},a.prototype.setVisible=function(b){if(!this.container.classList.contains("adsk-hidden")===b)return!1;b?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var c={type:a.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:b};return this.fireEvent(c),!0},a.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},a.prototype.setToolTip=function(a){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==a)&&(this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",a),this._toolTipElement.setAttribute("tooltipText",a),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(a,{defaultValue:a}),!0)},a.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},a.prototype.setCollapsed=function(b){if(!this._isCollapsible||this.isCollapsed()===b)return!1;b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var c={type:a.Event.COLLAPSED_CHANGED,isCollapsed:b};return this.fireEvent(c),!0},a.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},a.prototype.isCollapsible=function(){return this._isCollapsible},a.prototype.addClass=function(a){this.container.classList.add(a)},a.prototype.removeClass=function(a){this.container.classList.remove(a)},a.prototype.getPosition=function(){var a=this.container.getBoundingClientRect();return{top:a.top,left:a.left}},a.prototype.getDimensions=function(){var a=this.container.getBoundingClientRect();return{width:a.width,height:a.height}},a.prototype.setDisplay=function(a){this.container.style.display=a},Autodesk.Viewing.UI.Control=a}(),function(){"use strict";function a(c,d){b.Control.call(this,c,d);var e=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(b){var c={type:a.Event.SIZE_CHANGED,childEvent:b};e.fireEvent(c)}}var b=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},a.prototype=Object.create(b.Control.prototype),a.prototype.constructor=a,a.prototype.addControl=function(c,d){var e=d&&void 0!==d.index?d.index:this._controls.length;if(null!==this.getControl(c.getId()))return!1;var f={type:a.Event.CONTROL_ADDED,control:c,index:e};return e<this._controls.length?(this.container.insertBefore(c.container,this._controls[e].container),this._controls.splice(e,0,c)):(this.container.appendChild(c.container),this._controls.push(c)),c.addEventListener(b.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),c.addEventListener(b.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),c instanceof a&&c.addEventListener(a.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(f),this.fireEvent(a.Event.SIZE_CHANGED),!0},a.prototype.indexOf=function(a){for(var b=0;b<this._controls.length;b++){var c=this._controls[b];if(c===a||"string"==typeof a&&a===c.getId())return b}return-1},a.prototype.removeControl=function(c){var d="string"==typeof c?this.getControl(c):c;if(!d)return!1;var e=this._controls.indexOf(d);if(e===-1)return!1;this._controls.splice(e,1),this.container.removeChild(d.container);var f={type:a.Event.CONTROL_REMOVED,control:d,index:e};return d.removeEventListener(b.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),d.removeEventListener(b.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),d instanceof a&&d.removeEventListener(a.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(f),this.fireEvent(a.Event.SIZE_CHANGED),!0},a.prototype.getControl=function(a){for(var b=0;b<this._controls.length;b++)if(a===this._controls[b].getId())return this._controls[b];return null},a.prototype.getControlId=function(a){return a<0||a>=this._controls.length?null:this._controls[a].getId()},a.prototype.getNumberOfControls=function(){return this._controls.length},a.prototype.setCollapsed=function(b){if(!this._isCollapsible)return!1;var c=!1;return this._controls.forEach(function(a){a.isCollapsible()&&a.setCollapsed(b)&&(c=!0)}),c&&(b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.fireEvent({type:a.Event.COLLAPSED_CHANGED,isCollapsed:b})),c},Autodesk.Viewing.UI.ControlGroup=a}(),function(){"use strict";function a(a,c){b.ControlGroup.call(this,a,c),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar")}var b=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:b.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:b.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:b.ControlGroup.Event.SIZE_CHANGED},a.prototype=Object.create(b.ControlGroup.prototype),a.prototype.constructor=a,Autodesk.Viewing.UI.ToolBar=a}(),function(){"use strict";function a(d,e){c.Control.call(this,d,e);var f=this;this._state=a.State.INACTIVE,this.icon=document.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",function(b){f.getState()!==a.State.DISABLED&&(f.fireEvent(a.Event.CLICK),f.onClick&&f.onClick(b)),b.stopPropagation()}),b.isTouchDevice()?this.container.addEventListener("touchstart",b.touchStartToClick):(this.container.addEventListener("mouseover",function(a){f.onMouseOver(a)}),this.container.addEventListener("mouseout",function(a){f.onMouseOut(a)})),this.addClass("adsk-button"),this.addClass(a.StateToClassMap[this._state])}var b=Autodesk.Viewing,c=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:c.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:c.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},a.State={ACTIVE:0,INACTIVE:1,DISABLED:2},a.StateToClassMap=function(){var b=a.State,c={};return c[b.ACTIVE]="active",c[b.INACTIVE]="inactive",c[b.DISABLED]="disabled",c}(),a.prototype=Object.create(c.Control.prototype),a.prototype.constructor=a,a.prototype.setState=function(b){if(b===this._state)return!1;this.removeClass(a.StateToClassMap[this._state]),this.addClass(a.StateToClassMap[b]),this._state=b;var c={type:a.Event.STATE_CHANGED,state:b};return this.fireEvent(c),!0},a.prototype.setIcon=function(a){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=a,this.icon.classList.add(a)},a.prototype.getState=function(){return this._state},a.prototype.onClick=function(a){},a.prototype.onMouseOver=function(a){},a.prototype.onMouseOut=function(a){},Autodesk.Viewing.UI.Button=a}(),function(){"use strict";function a(a,d){b.Button.call(this,a,d),this.arrowButton=new b.Button(a+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new b.RadioButtonGroup(a+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var e=this;this.arrowButton.onClick=function(a){e.subMenu.setVisible(!e.subMenu.isVisible())},this.toggleFlyoutVisible=function(){e.subMenu.setVisible(!e.subMenu.isVisible())},this.onClick=function(a){e.subMenu.setVisible(!e.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(a){a.isActiveButton?(e.setIcon(a.target.getActiveButton().iconClass),e.setToolTip(a.target.getActiveButton().getToolTip()),e.setState(b.Button.State.ACTIVE),e.onClick=a.button.onClick):e.setState(b.Button.State.INACTIVE)},this.subMenu.addEventListener(b.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var f=c.stringToDOM('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(f,this.subMenu.container.firstChild),f.addEventListener("click",function(a){e.subMenu.setVisible(!1),a.stopPropagation()})}var b=Autodesk.Viewing.UI,c=Autodesk.Viewing.Private;a.prototype=Object.create(b.Button.prototype),a.prototype.constructor=a,a.prototype.addControl=function(a){this.subMenu.addControl(a),a.addEventListener(b.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.removeControl=function(a){a.removeEventListener(b.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.setState=function(a){if(a===b.Button.State.INACTIVE){var c=this.subMenu.getActiveButton();c&&c.setState(b.Button.State.INACTIVE)}b.Button.prototype.setState.call(this,a)},a.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},a.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(b.Button.State.INACTIVE))},Autodesk.Viewing.UI.ComboButton=a}(),function(){"use strict";function a(c,d){b.ControlGroup.call(this,c,d);var e=this;this._activeButton=null,this._handleButtonStateChange=function(c){var d=b.Button.State;if(c.state!==d.ACTIVE)return void(c.target===e._activeButton&&(e._activeButton=null,e.fireEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:c.target,isActiveButton:!1})));e._activeButton=c.target,e.fireEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:c.target,isActiveButton:!0}),e._controls.forEach(function(a){a!==c.target&&a.getState()!==d.DISABLED&&a.setState(d.INACTIVE)})}}var b=Autodesk.Viewing.UI;a.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:b.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:b.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:b.ControlGroup.Event.SIZE_CHANGED},a.prototype=Object.create(b.ControlGroup.prototype),a.prototype.constructor=a,a.prototype.addControl=function(a,c){return a instanceof b.Button&&(!!b.ControlGroup.prototype.addControl.call(this,a,c)&&(a.addEventListener(b.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},a.prototype.removeControl=function(a){var c="string"==typeof a?this.getControl(a):a;return!(null===c||!b.ControlGroup.prototype.removeControl.call(this,c))&&(c.removeEventListener(b.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},a.prototype.getActiveButton=function(){return this._activeButton},Autodesk.Viewing.UI.RadioButtonGroup=a}(),function(){"use strict";function a(a,b){c.DomDispatcher.prototype.apply(this),this.viewer=a,this.container=b}var b=AutodeskNamespace("Autodesk.SideBarUi.Content"),c=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils"),d=Autodesk.Viewing;b.Settings=a;var e=a.prototype;a.IDS={SHOW_VIEWCUBE:1,ACT_ON_PIVOT:2,ZOOM_TOWARDS_PIVOT:3,LEFT_MOUSE_PIVOT:4,FUSION_ORBIT:5,FIRST_PERSON_WALK:6,REVERSE_MOUSE_ZOOM:7,ORBIT_PAST_POLES:8,OPEN_PROPS_ON_SELECT:9,LEFT_HAND_MOUSE_SETUP:10,MAX_NAV:11,GHOSTING:11,SMOOTH_NAVIGATION:12,ANTIALIASING:13,AMBIENT_SHADOWS:14,GROUND_SHADOWS:15,GROUND_REFLECTIONS:16,ENV_MAP_BG:17,PROGRESSIVE_RENDERING:18,SWAP_BLACK_AND_WHITE:19},a.ELEMENTS=[{id:1,text:"Show ViewCube",pref:"viewCube",defaultValue:!0,mode:["3d"]},{id:2,text:"ViewCube acts on pivot",pref:"alwaysUsePivot",defaultValue:!1,mode:["3d"]},{id:3,text:"Zoom towards pivot",pref:"zoomTowardsPivot",defaultValue:!1,mode:["3d"]},{id:4,text:"Set pivot with left mouse button",pref:"clickToSetCOI",defaultValue:!1,mode:["3d"]},{id:5,text:"Fusion style orbit",pref:"fusionOrbit",defaultValue:!1,mode:["3d"]},{id:6,text:"First person walk",pref:"useFirstPersonNavigation",defaultValue:!1,mode:["3d"]},{id:7,text:"Reverse mouse zoom direction",pref:"reverseMouseZoomDir",defaultValue:!1,mode:["2d","3d"]},{id:8,text:"Orbit past world poles",pref:"orbitPastWorldPoles",defaultValue:!0,mode:["3d"]},{id:9,text:"Open properties on select",pref:"openPropertiesOnSelect",defaultValue:!0,mode:["2d","3d"]},{id:10,text:"Left handed mouse setup",pref:"leftHandedMouseSetup",defaultValue:!1,mode:["2d","3d"]},{id:11,text:"Ghost hidden objects",pref:"ghosting",defaultValue:!0,mode:["3d"]},{id:12,text:"Smooth navigation",pref:"optimizeNavigation",defaultValue:d.isMobileDevice(),mode:["3d"]},{id:13,text:"Anti-aliasing",pref:"antialiasing",defaultValue:!0,mode:["3d"]},{id:14,text:"Ambient shadows",pref:"ambientShadows",defaultValue:!0,mode:["3d"]},{id:15,text:"Ground shadow",pref:"groundShadow",defaultValue:!0,mode:["3d"]},{id:16,text:"Ground reflection",pref:"groundReflection",defaultValue:!0,mode:["3d"]},{id:17,text:"Environment map for background",pref:"envMapBackground",defaultValue:!0,mode:["3d"]},{id:18,text:"Progressive model display",pref:"progressiveRendering",defaultValue:!0,mode:["2d","3d"]},{id:19,text:"Swap black and white",pref:"swapBlackAndWhite",defaultValue:!1,mode:["2d"]}],e.load=function(){var b=a.ELEMENTS;a.createDom(this,this.viewer,this.container,b),this.onPrefChangedBinded=this.onPrefChanged.bind(this),this.viewer.addEventListener(d.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefResetBinded=this.onPrefReset.bind(this),this.viewer.addEventListener(d.PREF_RESET_EVENT,this.onPrefResetBinded)},e.unload=function(){this.viewer.removeEventListener(d.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefChangedBinded=null,this.viewer.addEventListener(d.PREF_RESET_EVENT,this.onPrefResetBinded),this.onPrefResetBinded=null,this.unhookEvents()},e.getTitle=function(){return"Settings"},e.onPrefChanged=function(b){var c=b.name,d=a.getIdFromPref(c);if(d!==-1){var e='[data-value="'+d+'"]';this.container.querySelector(e).querySelector("input").checked=b.value}},e.onPrefReset=function(b){var c=b.name,d=a.getIdFromPref(c);d!==-1&&(this.onPrefChanged(b),a.setState(this.viewer,d,b.value))},a.getIdFromPref=function(b){var c=-1;return a.ELEMENTS.forEach(function(a){a.pref===b&&(c=a.id)}),c},a.setState=function(b,c,d){var e=a.IDS;switch(c){case e.SHOW_VIEWCUBE:b.displayViewCube(d);break;case e.ACT_ON_PIVOT:b.setUsePivotAlways(d);break;case e.ZOOM_TOWARDS_PIVOT:b.setZoomTowardsPivot(d);break;case e.LEFT_MOUSE_PIVOT:b.setClickToSetCOI(d);break;case e.FUSION_ORBIT:d?b.loadExtension("Autodesk.Viewing.FusionOrbit",null):b.unloadExtension("Autodesk.Viewing.FusionOrbit",null);break;case e.FIRST_PERSON_WALK:d?(b.unloadExtension("Autodesk.Beeline",null),b.loadExtension("Autodesk.FirstPerson",null)):(b.unloadExtension("Autodesk.FirstPerson",null),b.loadExtension("Autodesk.Beeline",null));case e.REVERSE_MOUSE_ZOOM:b.setReverseZoomDirection(d);break;case e.ORBIT_PAST_POLES:b.setOrbitPastWorldPoles(d);break;case e.OPEN_PROPS_ON_SELECT:b.setPropertiesOnSelect(d);break;case e.LEFT_HAND_MOUSE_SETUP:b.setUseLeftHandedInput(d);break;case e.GHOSTING:b.setGhosting(d);break;case e.SMOOTH_NAVIGATION:b.setOptimizeNavigation(d);break;case e.ANTIALIASING:b.setQualityLevel(b.prefs.ambientShadows,d);break;case e.AMBIENT_SHADOWS:b.setQualityLevel(d,b.prefs.antialiasing);break;case e.GROUND_SHADOWS:b.setGroundShadow(d);break;case e.GROUND_REFLECTIONS:b.setGroundReflection(d);break;case e.ENV_MAP_BG:b.setEnvMapBackground(d);break;case e.PROGRESSIVE_RENDERING:b.setProgressiveRendering(d);break;case e.SWAP_BLACK_AND_WHITE:b.setSwapBlackAndWhite(d);break;default:console.log(c)}},a.createDom=function(b,c,d,e){var f=c.model.is2d()?"2d":"3d",g=e.filter(function(a){return a.mode.indexOf(f)!==-1}),h=g.filter(function(b){return b.id<a.IDS.MAX_NAV}),i=g.filter(function(b){return b.id>=a.IDS.MAX_NAV});a.createTable(d,h,"Navigation and selection"),a.createTable(d,i,"Performance and appearance");g.forEach(function(b){var e='[data-value="'+b.id+'"]';d.querySelector(e).querySelector("input").checked=a.isChecked(c,b)}),b.hookEvent(d,"click","tr",function(b,d){var e=parseInt(d.getAttribute("data-value")),f=d.querySelector("input");b.target!==f&&(f.checked=!f.checked);var g=f.checked;a.setState(c,e,g)});var j=document.createElement("button");j.className="lmv-sidebar-menu-button",j.setAttribute("data-i18n","Restore default settings"),j.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),d.appendChild(j),b.hookEvent(j,"click","button",function(a,b){var d=f;c.prefs.reset(d)})},a.createTable=function(b,c,d){var e=document.createElement("div");e.classList.add("lmv-sidebar-menu-heading"),e.setAttribute("data-i18n",d),e.textContent=Autodesk.Viewing.i18n.translate(d),b.appendChild(e);var f=document.createElement("table");f.classList.add("adsk-lmv-tftable"),f.classList.add("adsk-lmv-settings");var g=c.map(a.renderOption);return f.innerHTML=g.join("\n"),b.appendChild(f),f},a.renderOption=function(a){var b=Autodesk.Viewing.i18n.translate(a.text);return'<tr data-value="'+a.id+'"><td><div data-i18n="'+a.text+'">'+b+'</div></td><td><input type="checkbox"></td></tr>'},a.isChecked=function(a,b){var c=b.pref?a.prefs[b.pref]:null;return"boolean"==typeof c?c:b.defaultValue}}(),function(){"use strict";function a(){}var b=AutodeskNamespace("Autodesk.Viewing.Private"),c=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils");c.DomDispatcher=a,a.prototype={constructor:a,apply:function(b){b.hookEvent=a.prototype.hookEvent,b.unhookEvents=a.prototype.unhookEvents,b.eventsHooked=[]},hookEvent:function(a,c,d,e){var f=function(a){var c=b.DomUtils.seekSelectorUp(a.target,d);c&&e(a,c)};a.addEventListener(c,f),this.eventsHooked.push({domElem:a,eventStr:c,callback:f})},unhookEvents:function(){this.eventsHooked.forEach(function(a){a.domElem.removeEventListener(a.eventStr,a.callback)}),this.eventsHooked.length=0}},c.seekSelectorUp=function(a,c){for(;a;){if(b.DomUtils.matchesSelector(a,c))return a;a=a.parentNode}return a},c.matchesSelector=function(a,b){return a.matches?a.matches(b):a.msMatchesSelector?a.msMatchesSelector(b):a.mozMatchesSelector?a.mozMatchesSelector(b):!!a.webkitMatchesSelector&&a.webkitMatchesSelector(b)},c.removeChildren=function(a){a.innerHTML=""},c.remove=function(a){a&&a.parentNode&&a.parentNode.removeChild(a)}}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),c.DomDispatcher.prototype.apply(this),this.currentContent=null}var b=AutodeskNamespace("Autodesk.SideBarUi"),c=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils");AutodeskNamespace("Autodesk.SideBarUi.Content");a.populateDefaultOptions=function(a){a.experimental.push("--sidebar-ui")},a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,b.SideBarUi=a;var d=a.prototype;d.load=function(){return this.openSideMenuBinded=this.openSideMenu.bind(this),this.viewer.addEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),!0},d.unload=function(){return this.viewer.removeEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),this.openSideMenuBinded=null,this.currentContent&&(this.currentContent.unload(),this.currentContent=null),this.domNav&&(c.remove(this.domNav),this.domNav=null),this.unhookEvents(),!0},d.createSlidingSideBar=function(a){var b=this.domNav=document.createElement("div");b.className="lmv-sidebar-menu--slide-left";b.innerHTML=['<button class="lmv-sidebar-menu__title">',"</button>",'<button class="lmv-sidebar-menu-button lmv-sidebar-menu-button__cross">&times;</button>','<div class="lmv-sidebar-menu__content">',"</div>"].join(""),a.appendChild(b),this.domContent=this.domNav.querySelector(".lmv-sidebar-menu__content"),this.domCloseBtn=this.domNav.querySelector("button.lmv-sidebar-menu__title"),this.setCloseButton(),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu__title",function(a){this.toggleCollapsed()}.bind(this)),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu-button__cross",function(a){this.closeSideMenu()}.bind(this))},d.setCloseButton=function(a){var b=a||"Close";this.domCloseBtn.setAttribute("data-i18n",b),this.domCloseBtn.textContent=Autodesk.Viewing.i18n.translate(b)},d.openSideMenu=function(a){if(this.domNav||this.createSlidingSideBar(this.viewer.container),this.currentContent&&(this.currentContent.unload(),this.currentContent=null,c.removeChildren(this.domContent)),a.content){var b=a.content;this.currentContent=new b(this.viewer,this.domContent),this.currentContent.load();var d=this.currentContent.getTitle();this.setCloseButton(d)}var e=this.domNav;requestAnimationFrame(function(){e.classList.remove("is-collapsed"),e.classList.add("is-active")})},d.toggleCollapsed=function(){this.domNav.classList.toggle("is-collapsed"),this.domNav.scrollTop=0},d.closeSideMenu=function(){this.domNav.classList.remove("is-active")},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.SideBarUi",a)}(),/** @license Copyright (c) 2015 Autodesk Inc. */
function(){function a(){this.ios=window.webkit,this.android=window.JSINTERFACE,this.iosSend=function(a,b){return window.webkit.messageHandlers.callbackHandler.postMessage({command:a,data:b})},this.androidSend=window.JSINTERFACE}AutodeskNamespace("Autodesk.Viewing");var b=a.prototype;b.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},b.onSelectionChanged=function(a){this.ios?this.iosSend("selectionChanged",a):this.android&&this.androidSend.onSelectionChanged(a)},b.onLongTap=function(a,b){this.ios?this.iosSend("onLongTap",[a,b]):this.android&&this.androidSend.onLongTap(a,b)},b.onSingleTap=function(a,b){this.ios?this.iosSend("onSingleTap",[a,b]):this.android&&this.androidSend.onSingleTap(a,b)},b.onDoubleTap=function(a,b){this.ios?this.iosSend("onDoubleTap",[a,b]):this.android&&this.androidSend.onDoubleTap(a,b)},b.setRTCSession=function(a){this.ios?this.iosSend("setRTCSession",{id:a}):this.android&&this.androidSend.setRTCSessionID(a)},b.putProperties=function(a,b){this.ios?this.iosSend("putProperties",{name:a,value:b}):this.android&&this.androidSend.putProperties(a,b)},b.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},b.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},b.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},b.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},b.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},b.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},b.updateAnimationTime=function(a){this.ios?this.iosSend("updateAnimationTime",a):this.android&&this.androidSend.updateAnimationTime(a)},b.setLoadingProgress=function(a,b){this.ios?this.iosSend("setLoadingProgress",{state:a,progress:b}):this.android&&this.androidSend.setLoadingProgress(a,b)},b.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},b.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},b.putSheets=function(a,b){this.ios?this.iosSend("putSheets",[a,b]):this.android&&this.androidSend.putSheets(a,b)},b.putAllSheets=function(a){this.ios?this.iosSend("putAllSheets",a):this.android&&this.androidSend.putAllSheets(a)},b.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},b.instanceTree=function(a){this.ios?this.iosSend("instanceTree",a):this.android&&this.androidSend.instanceTree(a)},b.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},b.sheetSelected=function(a){this.ios?this.iosSend("sheetSelected",a):this.android&&this.androidSend.sheetSelected(a)},Autodesk.Viewing.MobileCallbacks=a,window.MobileCallbacks=a}(),function(){"use strict";function a(a){return"application/autodesk-db"==a.mime&&a.urn?0===a.urn.indexOf("urn:adsk.objects:os.object")?a.urn.substr(0,a.urn.lastIndexOf("%2F")+3):a.urn.substr(0,a.urn.lastIndexOf("/")+1):null}function b(d,e){if(this.parent=e,this.id=c++,this.data=d,this.isLeaf="geometry"===d.type&&("3d"===d.role||"2d"===d.role||"lod"===d.role),Array.isArray(d.children)){this.children=[];for(var f=d.children.length,g=0;g<f;g++)this.children[g]=new b(d.children[g],this);for(var g=0;g<f;g++){var h=a(d.children[g]);h&&(this.sharedPropertyDbPath=h),"lod"===d.children[g].role&&(this.lodNode=this.children[g])}}}var c=1;b.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},b.prototype.findPropertyDbPath=function(){return this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null},b.prototype._raw=function(){return this.data},b.prototype.name=function(){return this.data.name},b.prototype.guid=function(){return this.data.guid},b.prototype.urn=function(a){var b=this.data.urn;if(!a)return b;for(var c=this.parent;!b&&c;)b=c.data.urn,c=c.parent;return b},b.prototype.getTag=function(a){return(this.data.tags?this.data.tags:this.data)[a]},b.prototype.setTag=function(a,b){this.data.tags?this.data.tags[a]=b:this.data[a]=b},b.prototype.isGeomLeaf=function(){return this.isLeaf},b.prototype.isViewable=function(){return"viewable"===this.data.role},b.prototype.getLodNode=function(){return this.lodNode},b.prototype.isGeometry=function(){return"geometry"===this.data.type},b.prototype.is2D=function(){return"2d"===this.data.role},b.prototype.is3D=function(){return"3d"===this.data.role},b.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},b.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},b.prototype.getPlacementTransform=function(){return this.data.placement},b.prototype.isMetadata=function(){if(this.data.role){if(this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription")!==-1)return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},b.prototype.findViewableParent=function(){for(var a=this;a&&!a.isViewable();)a=a.parent;return a},b.prototype.findParentGeom2Dor3D=function(){for(var a=this;a&&!a.is2DGeom()&&!a.is3DGeom();)a=a.parent;return a},b.prototype.getViewableRootPath=function(){if(!this.isGeomLeaf())return null;var a=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",b=this.search({mime:a});if(b&&b.length){return b[0].data.urn}return null},b.prototype.findByGuid=function(a){var b=null;return this.traverse(function(c){if(c.data.guid===a)return b=c,!0}),b},b.prototype.search=function(a){var b=[];return this.traverse(function(c){var d=!0;for(var e in a)if(!c.data.hasOwnProperty(e)||c.data[e]!==a[e]){d=!1;break}d&&b.push(c)}),b.length?b:null},b.prototype.searchByTag=function(a){var b=[];return this.traverse(function(c){var d=!0;for(var e in a)if(c.getTag(e)!==a[e]){d=!1;break}d&&b.push(c)}),b.length?b:null},b.prototype.traverse=function(a){if(a(this))return!0;if(this.children)for(var b=0;b<this.children.length;b++)if(this.children[b].traverse(a))return!0;return!1},b.prototype.getLevel=function(){var a=this.getTag("level");return Array.isArray(a)?a[0]:a},b.MODEL_NODE={role:"3d",type:"geometry"},b.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"},b.SHEET_NODE={role:"2d",type:"geometry"},b.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"},b.VIEWABLE_NODE={role:"viewable"},Autodesk.Viewing.BubbleNode=b}(),/** @license Copyright (c) 2014 Autodesk Inc. */
Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var a=this.parentContainer.getBoundingClientRect(),b={height:0,width:0,left:0,bottom:0,right:0,top:0},c=document.getElementsByClassName("toolbar-menu");return c&&c.length>0&&(b=c[0].getBoundingClientRect()),{height:a.height-b.height,width:a.width,left:a.left,bottom:a.bottom-b.height,right:a.right,top:a.top}}},/** @license Copyright (c) 2014 Autodesk Inc. */
function(){"use strict";var a=Autodesk.Viewing,b=(Autodesk.Viewing.Private,Autodesk.Viewing.UI),c=Autodesk.Viewing.Extensions,d={click:{onObject:["isolate"]},clickCtrl:{onObject:["toggleVisibility"]}};c.ViewerModelStructurePanel=function(a,c,e){this.viewer=a,e=e||{},e.heightAdjustment=75,b.ModelStructurePanel.call(this,a.container,a.container.id+"ViewerModelStructurePanel",c,e),this.clickConfig=e&&e.docStructureConfig?e.docStructureConfig:d,this.isMac=navigator.userAgent.search("Mac OS")!==-1,this.initSearchBox(),this.prevSearchResults=[],this.prevSearchString=""},c.ViewerModelStructurePanel.prototype=Object.create(b.ModelStructurePanel.prototype),c.ViewerModelStructurePanel.prototype.constructor=c.ViewerModelStructurePanel,c.ViewerPanelMixin.call(c.ViewerModelStructurePanel.prototype),c.ViewerModelStructurePanel.prototype.initialize=function(){b.ModelStructurePanel.prototype.initialize.call(this);var c=this;c.addEventListener(c.viewer,a.SELECTION_CHANGED_EVENT,function(a){c.setSelection(a.nodeArray.slice())}),c.addEventListener(c.viewer,a.ISOLATE_EVENT,function(a){c.setIsolation(a.nodeIdArray.slice())}),c.addEventListener(c.viewer,a.HIDE_EVENT,function(a){c.setHidden(a.nodeIdArray.slice(),!0)}),c.addEventListener(c.viewer,a.SHOW_EVENT,function(a){c.setHidden(a.nodeIdArray.slice(),!1)})},c.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer=null,b.ModelStructurePanel.prototype.uninitialize.call(this)},c.ViewerModelStructurePanel.prototype.handleAction=function(a,b){for(var c in a)switch(a[c]){case"selectOnly":this.viewer.select(b);break;case"deselectAll":this.viewer.select([]);break;case"selectToggle":this.viewer.toggleSelect(b);break;case"isolate":this.viewer.isolate(b);break;case"showAll":this.viewer.isolate(null);break;case"focus":this.viewer.fitToView();break;case"hide":this.viewer.hide(b);break;case"show":this.viewer.show(b);break;case"toggleVisibility":this.viewer.toggleVisibility(b)}},c.ViewerModelStructurePanel.prototype.ctrlDown=function(a){return this.isMac&&a.metaKey||!this.isMac&&a.ctrlKey},c.ViewerModelStructurePanel.prototype.onClick=function(a,b){if(!this.isMac||!b.ctrlKey){var c=this,d="click";c.ctrlDown(b)&&(d+="Ctrl"),b.shiftKey&&(d+="Shift"),b.altKey&&(d+="Alt"),this.clickConfig&&this.clickConfig[d]?c.handleAction(this.clickConfig[d].onObject,a):this.viewer.select(a)}},c.ViewerModelStructurePanel.prototype.onDoubleClick=function(a,b){this.handleAction(["focus"],a)},c.ViewerModelStructurePanel.prototype.onHover=function(a,b){this.viewer.impl.rolloverObjectNode(a)},c.ViewerModelStructurePanel.prototype.onRightClick=function(a,b){if(this.isMac&&b.ctrlKey&&0===b.button)return this.clickConfig&&this.clickConfig.clickCtrl?this.handleAction(this.clickConfig.clickCtrl.onObject,a):this.viewer.select(a),null;var c=[],d=!0;if(b.shiftKey||this.isMac&&b.metaKey||b.ctrlKey&&(this.isMac||2===b.button))for(var e=this.viewer.impl.selector.getSelection(),f=0;f<e.length;++f)e[f]!==a?c.push(e[f]):d=!1;return d&&c.push(a),this.viewer.select(c),this.viewer.contextMenu.show(b)},c.ViewerModelStructurePanel.prototype.setHidden=function(a,b){this.uiCreated||this.createUI();for(var c=0;c<a.length;++c)this.tree.iterate(a[c],function(a,c){c.classList.toggle("dim",b),c.classList.toggle("visible",!b)})},c.ViewerModelStructurePanel.prototype.setIsolation=function(a){if(void 0!==this.rootId&&null!==this.rootId){if(this.tree&&this.tree.iterate(this.rootId,function(a,b){b.classList.remove("dim"),b.classList.remove("visible")}),a.length>0){if(1===a.length&&a[0]===this.rootId)return;this.setHidden([this.rootId],!0),this.setHidden(a,!1)}this.searchbox&&!this.inSearchIsolate&&(this.searchbox.value="")}},c.ViewerModelStructurePanel.prototype.initSearchBox=function(){function b(){if(!f.isSearching){for(var a=0;a<f.prevSearchResults.length;a++)f.tree.setCollapsed(f.prevSearchResults[a],!0,!0);if(0===c.value.length)f.isSearching=!1,f.prevSearchString="",e.isolate();else{if(f.prevSearchString==c.value)return;f.isSearching=!0,e.search(c.value,function(a){if(f.inSearchIsolate=!0,e.isolate(a),f.inSearchIsolate=!1,a.length){for(var b=0;b<a.length;b++)f.tree.setCollapsed(a[b],!1,!0);f.resizeToContent(),f.tree.scrollTo(a[0])}f.prevSearchResults=a,f.isSearching=!1},null,["name"])}}}var c=document.createElement("input");c.className="toolbar-search-box",c.type="search",c.results=5,c.placeholder=a.i18n.translate("Filter by name"),c.incremental="incremental",c.autosave=this.container.id+"search_autosave",c.setAttribute("data-i18n","[placeholder]Filter by name"),this.scrollContainer.parentNode.insertBefore(c,this.scrollContainer),this.searchbox=c;var d,e=this.viewer,f=this;c.addEventListener("input",function(a){clearTimeout(d),d=setTimeout(b,500)}),c.addEventListener("change",function(a){clearTimeout(d),b()})}}(),function(){"use strict";var a=Autodesk.Viewing,b=a.UI,c=function(a){this.viewer=a,this.currentNodeIds=[],this.currentModel=null,this.isSelection=!1,this.isDirty=!0,this.propertyNodeId=null,b.PropertyPanel.call(this,a.container,"ViewerPropertyPanel","Object Properties Loading...")};c.prototype=Object.create(b.PropertyPanel.prototype),c.prototype.constructor=c,a.Extensions.ViewerPanelMixin.call(c.prototype),c.prototype.initialize=function(){b.PropertyPanel.prototype.initialize.call(this);var c=this;c.addEventListener(c.viewer,a.AGGREGATE_SELECTION_CHANGED_EVENT,function(a){a.selections&&a.selections.length?(c.currentNodeIds=a.selections[0].dbIdArray,c.currentModel=a.selections[0].model,c.isSelection=a.selections[0].dbIdArray.length>0):c.isSelection=!1,c.isDirty=!0,c.requestProperties()}),c.addEventListener(c.viewer,a.ISOLATE_EVENT,function(a){0==a.nodeIdArray.length&&c.isSelection||(c.currentModel=a.model,c.currentNodeIds=a.nodeIdArray,c.isDirty=!0,c.requestProperties())}),c.addEventListener(c.viewer,a.HIDE_EVENT,function(a){c.isDirty=!0,c.requestProperties()}),c.addEventListener(c.viewer,a.SHOW_EVENT,function(a){c.isDirty=!0,c.requestProperties()}),this.currentModel=c.viewer.model,this.currentNodeIds=c.viewer.getSelection(),0===this.currentNodeIds.length?this.currentNodeIds=c.viewer.getIsolatedNodes():this.isSelection=!0},c.prototype.setTitle=function(a,c){a||(a="Object Properties",c=c||{},c.localizeTitle=!0),b.PropertyPanel.prototype.setTitle.call(this,a,c)},c.prototype.setVisible=function(a){b.DockingPanel.prototype.setVisible.call(this,a),this.requestProperties()},c.prototype.visibilityChanged=function(){b.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},c.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentNodeIds.length>0?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},c.prototype.setNodeProperties=function(a){var b=this;this.propertyNodeId=a,b.currentModel.getProperties(a,function(a){if(b.setTitle(a.name),b.setProperties(a.properties),b.highlight(b.viewer.searchText),b.resizeToContent(),b.isVisible()){var c=b.viewer.toolController,d=c.lastClickX,e=c.lastClickY,f=b.container.getBoundingClientRect(),g=f.left,h=f.top,i=f.width,j=f.height,k=b.viewer.canvas.getBoundingClientRect(),l=k.left,m=k.top,n=k.width,o=k.height;g<=d&&d<g+i&&h<=e&&e<h+j&&(d<g+i/2&&d+i<l+n?(b.container.style.left=Math.round(d-l)+"px",b.container.dockRight=!1):l<=d-i?(b.container.style.left=Math.round(d-l-i)+"px",b.container.dockRight=!1):d+i<l+n?(b.container.style.left=Math.round(d-l)+"px",b.container.dockRight=!1):e+j<m+o?(b.container.style.top=Math.round(e-m)+"px",b.container.dockBottom=!1):m<=e-j&&(b.container.style.top=Math.round(e-m-j)+"px",b.container.dockBottom=!1))}})},c.prototype.showDefaultProperties=function(){var a=this.currentModel.getRootId();a?this.setNodeProperties(a):(this.propertyNodeId=null,this.setTitle("Model Properties",{localizeTitle:!0}),b.PropertyPanel.prototype.showDefaultProperties.call(this))},c.prototype.areDefaultPropertiesShown=function(){var a=this.currentModel.getRootId();return this.propertyNodeId===a},c.prototype.uninitialize=function(){b.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null},c.prototype.onCategoryClick=function(a,c){b.PropertyPanel.prototype.onCategoryClick.call(this,a,c),this.resizeToContent()},c.prototype.onCategoryIconClick=function(a,c){b.PropertyPanel.prototype.onCategoryIconClick.call(this,a,c),this.resizeToContent()},Autodesk.Viewing.Extensions.ViewerPropertyPanel=c}(),function(){"use strict";var a=function(a){var b=a.container;Autodesk.Viewing.UI.LayersPanel.call(this,a,b,b.id+"ViewerLayersPanel"),this.onRestoreStateBinded=this.onRestoreState.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded)};a.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype),a.prototype.constructor=a,Autodesk.Viewing.Extensions.ViewerPanelMixin.call(a.prototype),a.prototype.uninitialize=function(){this.onRestoreStateBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded),this.onRestoreStateBinded=null),Autodesk.Viewing.UI.LayersPanel.prototype.uninitialize.call(this)},a.prototype.onRestoreState=function(){this.update()},a.prototype.onClick=function(a,b){if(!this.isMac||!b.ctrlKey){var c=!(b.shiftKey||b.metaKey||b.ctrlKey);this.setLayerVisible(a,c)}},a.prototype.onRightClick=function(a,b){var c=!(b.shiftKey||b.metaKey||b.ctrlKey);this.setLayerVisible(a,c)},a.prototype.onImageClick=function(a,b){this.isMac&&b.ctrlKey||this.setLayerVisible(a)},a.prototype.onTitleClick=function(a){this.viewer.setLayerVisible(null,!0)},a.prototype.onTitleDoubleClick=function(a){this.viewer.fitToView()},Autodesk.Viewing.Extensions.ViewerLayersPanel=a}(),function(){"use strict";var a=Autodesk.Viewing,b=a.Private,c=Autodesk.Viewing.Extensions,d=Autodesk.Viewing.UI;c.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab"};var e=function(e,f){this.viewer=e,this.is3dMode=!f.is2d(),d.SettingsPanel.call(this,e.container,"ViewerSettingsPanel"+e.id,"Settings",{width:400,heightAdjustment:155}),this.addTab(c.ViewerSettingTab.Navigation,"Navigation and selection",{className:"navigation"}),this.addTab(c.ViewerSettingTab.Performance,"Performance and appearance",{className:"performance"}),this.restoreDiv=document.createElement("div"),this.restoreDiv.className="viewer-restore-defaults",this.restoreDiv.setAttribute("data-i18n","Restore default settings"),this.restoreDiv.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),this.addEventListener(this.restoreDiv,"touchstart",a.touchStartToClick),this.addEventListener(this.restoreDiv,"click",function(){var a=f.is2d()?"2d":"3d";e.prefs.reset(a),e.impl.setLightPresetFromFile(e.model)},!1),this.container.appendChild(this.restoreDiv),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createPerformancePanel(),this.modelPreferenceCount&&b.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI.")};e.prototype=Object.create(d.SettingsPanel.prototype),e.prototype.constructor=e,c.ViewerPanelMixin.call(e.prototype),e.prototype.uninitialize=function(){this.viewer=null,d.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},e.prototype.addCheckbox=function(a,b,c,e,f){function g(a){f&&h.prefs.set(f,a),e(a)}var h=this.viewer,i=h.prefs[f];c="boolean"==typeof i?i:c;var j=d.SettingsPanel.prototype.addCheckbox.call(this,a,b,c,g),k=this.getControl(j);return k.saveKey=f,f?h.prefs.addListeners(f,function(a){k.setValue(a)},function(a){k.setValue(a),e(a)}):k.sliderRow.classList.add("logicalgroup"),h.prefs.hasTag(f,"no-storage")&&(k.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),j},e.prototype.addDropdown=function(a,c,d,e,f,g,h){var i=new b.OptionDropDown(a,c,d,e,f);return this.addEventListener(i,"change",g),h&&this.viewer.prefs.addListeners(h,function(a){i.dropdownElement.selectedIndex=a},function(a){i.dropdownElement.selectedIndex=a,g(a)}),i},e.prototype.removeCheckbox=function(a){return this.viewer.prefs.removeListeners(a.saveKey),this.removeEventListener(a,"change",a.changeListener),d.SettingsPanel.prototype.removeCheckbox.call(this,a)},e.prototype.createNavigationPanel=function(){var a=this.viewer,b=c.ViewerSettingTab.Navigation;this.is3dMode&&(this.addCheckbox(b,"Show ViewCube",!0,function(b){a.displayViewCube(b)},"viewCube"),this.addCheckbox(b,"ViewCube acts on pivot",!1,function(b){a.setUsePivotAlways(b)},"alwaysUsePivot"),this.addCheckbox(b,"Zoom towards pivot",!1,function(b){a.setZoomTowardsPivot(b)},"zoomTowardsPivot"),this.addCheckbox(b,"Set pivot with left mouse button",!1,function(b){a.setClickToSetCOI(b)},"clickToSetCOI"),this.addCheckbox(b,"Fusion style orbit",!1,function(b){b?a.loadExtension("Autodesk.Viewing.FusionOrbit",null):a.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"),this.addCheckbox(b,"First person walk",!1,function(b){b?(a.unloadExtension("Autodesk.Beeline",null),a.loadExtension("Autodesk.FirstPerson",null)):(a.unloadExtension("Autodesk.FirstPerson",null),a.loadExtension("Autodesk.Beeline",null))},"useFirstPersonNavigation")),this.addCheckbox(b,"Reverse mouse zoom direction",!1,function(b){a.setReverseZoomDirection(b)},"reverseMouseZoomDir"),this.is3dMode&&this.addCheckbox(b,"Orbit past world poles",!0,function(b){a.setOrbitPastWorldPoles(b)},"orbitPastWorldPoles"),this.addCheckbox(b,"Open properties on select",!0,function(b){a.setPropertiesOnSelect(b)},"openPropertiesOnSelect"),this.addCheckbox(b,"Left handed mouse setup",!1,function(b){a.setUseLeftHandedInput(b)},"leftHandedMouseSetup")},e.prototype.refreshParentCheckbox=function(a,b){for(var c=this,d=0;d<a.length;d++){if(c.getControl(a[d]).getValue()===!1)return void c.getControl(b).setValue(!1)}c.getControl(b).setValue(!0)},e.prototype.createPerformancePanel=function(){function d(a,b){for(var c=0;c<a.length;c++)e.getControl(a[c]).setChecked(b)}var e=this,f=this.viewer,g=c.ViewerSettingTab.Performance,h=this.scrollContainer.childNodes[1],i={perfoptimizationGroup:[],visualoptimizationGroup:[]};if(this.is3dMode){this.perfOptimizationBoxId=this.addCheckbox(g,"Performance Optimization",!1,function(a){d(i.perfoptimizationGroup,a)}),this.optimizeNavigationhkBoxId=this.addCheckbox(g,"Smooth navigation",a.isMobileDevice(),function(a){f.setOptimizeNavigation(a),e.refreshParentCheckbox(i.perfoptimizationGroup,e.perfOptimizationBoxId)},"optimizeNavigation"),i.perfoptimizationGroup.push(this.optimizeNavigationhkBoxId),this.progressiveRenderChkBoxId=this.addCheckbox(g,"Progressive model display",!0,function(a){f.setProgressiveRendering(a),e.refreshParentCheckbox(i.perfoptimizationGroup,e.perfOptimizationBoxId)},"progressiveRendering"),i.perfoptimizationGroup.push(this.progressiveRenderChkBoxId),this.visualOptimizationBoxId=this.addCheckbox(g,"Visual Quality Optimization",!1,function(a){d(i.visualoptimizationGroup,a)}),this.antialiasingChkBoxId=this.addCheckbox(g,"Anti-aliasing",!0,function(a){f.setQualityLevel(f.prefs.ambientShadows,a),e.refreshParentCheckbox(i.visualoptimizationGroup,e.visualOptimizationBoxId)},"antialiasing"),i.visualoptimizationGroup.push(this.antialiasingChkBoxId),this.ambientshadowsChkBoxId=this.addCheckbox(g,"Ambient shadows",!0,function(a){f.setQualityLevel(a,f.prefs.antialiasing),e.refreshParentCheckbox(i.visualoptimizationGroup,e.visualOptimizationBoxId)},"ambientShadows"),i.visualoptimizationGroup.push(this.ambientshadowsChkBoxId),this.groundShadowChkBoxId=this.addCheckbox(g,"Ground shadow",!0,function(a){f.setGroundShadow(a),e.refreshParentCheckbox(i.visualoptimizationGroup,e.visualOptimizationBoxId)},"groundShadow"),i.visualoptimizationGroup.push(this.groundShadowChkBoxId),this.groundReflectionChkBoxId=this.addCheckbox(g,"Ground reflection",!1,function(a){f.setGroundReflection(a),e.refreshParentCheckbox(i.visualoptimizationGroup,e.visualOptimizationBoxId)},"groundReflection"),i.visualoptimizationGroup.push(this.groundReflectionChkBoxId),this.viewerBehaviorLabel=new b.OptionLabel("Viewer Behavior",h.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.ghosthiddenChkBoxId=this.addCheckbox(g,"Ghost hidden objects",!0,function(a){f.setGhosting(a)},"ghosting"),this.displayLinesId=this.addCheckbox(g,"Display Lines",!0,function(a){f.hideLines(!a)},"lineRendering"),this.displayPointsId=this.addCheckbox(g,"Display Points",!0,function(a){f.hidePoints(!a)},"pointRendering"),this.environmentLabel=new b.OptionLabel("Environment",h.tBodies[0]),this.environmentLabel.sliderRow.classList.add("logicalgroup"),this.envMapBackgroundChkBoxId=this.addCheckbox(g,"Environment Image Visible",!0,function(a){f.setEnvMapBackground(a)},"envMapBackground");for(var j=[],k=0;k<b.LightPresets.length;k++)j.push(b.LightPresets[k].name);var l=this.envSelect=this.addDropdown("Environment and Lighting Selection",h.tBodies[0],j,f.impl.currentLightPreset(),!0,function(a){var b=l.dropdownElement.selectedIndex;f.setLightPreset(b)},"lightPreset")}this.is3dMode||(this.perfOptimizationLabel=new b.OptionLabel("Performance Optimization",h.tBodies[0]),this.perfOptimizationLabel.sliderRow.classList.add("logicalgroup"),this.progressiveRenderChkBoxId2d=this.addCheckbox(g,"Progressive model display",!0,function(a){f.setProgressiveRendering(a)},"progressiveRendering"),this.viewerBehaviorLabel=new b.OptionLabel("Viewer Behavior",h.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(g,"Switch sheet color white to black",!0,function(a){f.setSwapBlackAndWhite(a)},"swapBlackAndWhite"))},e.prototype.syncUI=function(){var a=this.viewer,b=this.getControl(this.perfOptimizationBoxId),c=this.getControl(this.visualOptimizationBoxId),d=this.getControl(this.optimizeNavigationhkBoxId),e=this.getControl(this.antialiasingChkBoxId);e&&e.setValue(a.prefs.antialiasing);var f=this.getControl(this.ambientshadowsChkBoxId);f&&f.setValue(a.prefs.ambientShadows);var g=this.getControl(this.groundShadowChkBoxId);g&&g.setValue(a.prefs.groundShadow);var h=this.getControl(this.groundReflectionChkBoxId);h&&h.setValue(a.prefs.groundReflection);var i=this.getControl(this.envMapBackgroundChkBoxId);i&&i.setValue(a.impl.isEnvMapBackground());var j=this.getControl(this.progressiveRenderChkBoxId);j&&j.setValue(a.prefs.progressiveRendering);var k=this.getControl(this.swapBlackAndWhiteChkBoxId);k&&k.setValue(a.prefs.swapBlackAndWhite);var l=this.getControl(this.ghosthiddenChkBoxId);if(l&&l.setValue(a.prefs.ghosting),this.is3dMode){var m=j.getValue(),n=d.getValue(),o=e.getValue(),p=f.getValue(),q=g.getValue(),r=h.getValue();m&&n?b.setValue(!0):b.setValue(!1),o&&p&&q&&r?c.setValue(!0):c.setValue(!1)}},c.ViewerSettingsPanel=e}(),function(){"use strict";function a(a){b.ObjectContextMenu.call(this,a)}var b=Autodesk.Viewing.UI,c=Autodesk.Viewing.Private;a.prototype=Object.create(b.ObjectContextMenu.prototype),a.prototype.constructor=a,a.prototype.buildMenu=function(a,b){var d=this,e=[],f=this.viewer.navigation,g=this.viewer.model.is2d(),h=this.viewer.container.getBoundingClientRect(),i=a.clientX-h.left,j=a.clientY-h.top,k=d.viewer.impl.hitTest(i,j,!1);if(k&&k.dbId){k.model.selector.getSelection().indexOf(k.dbId)==-1&&this.viewer.impl.selector.setSelection([k.dbId],k.model),b.hasSelected=!0,b.hasVisible=!0}b.hasSelected&&(e.push({title:"Isolate",target:function(){var a=d.viewer.getAggregateSelection(),b=d.viewer.impl.modelQueue().getModels().concat();for(a.forEach(function(a){a.model.visibilityManager.isolate(a.selection);var c=b.indexOf(a.model);c>=0&&b.splice(c,1)});b.length;)b.pop().visibilityManager.setAllVisibility(!1);d.viewer.clearSelection(),c.logger.track({name:"isolate_count",aggregate:"count"})}}),b.hasVisible&&e.push({title:"Hide Selected",target:function(){var a=d.viewer.impl.visibilityManager;d.viewer.getAggregateSelection(function(b,c){a.hide(c,b)}),d.viewer.clearSelection()}}),b.hasHidden&&e.push({title:"Show Selected",target:function(){var a=d.viewer.getSelection();d.viewer.clearSelection(),d.viewer.show(a)}})),g&&e.push({title:"Show All Layers",target:function(){d.viewer.setLayerVisible(null,!0)}}),e.push({title:"Show All Objects",target:function(){d.viewer.showAll(),c.logger.track({name:"showall",aggregate:"count"})}});var l=d.viewer.getAggregateSelection();return!g&&1===l.length&&f.isActionEnabled("gotoview")&&e.push({title:"Focus",target:function(){if(l=d.viewer.getAggregateSelection(),l.length>0){var a=l[0];d.viewer.fitToView(a.selection,a.model)}else 0===l.length&&d.viewer.fitToView();c.logger.track({name:"fittoview",aggregate:"count"})}}),b.hasSelected&&e.push({title:"Clear Selection",target:function(){d.viewer.clearSelection(),c.logger.track({name:"clearselection",aggregate:"count"})}}),e},Autodesk.Viewing.Extensions.ViewerObjectContextMenu=a}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b)}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,a.prototype.load=function(){function a(){c.impl.setLightPreset(0,!0),c.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}var c=this.viewer,d=new b.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",this.options);return c.setModelStructurePanel(d),c.hideLines(!1),c.setGhosting(!1),c.setQualityLevel(!1,!0),c.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a),!0},a.prototype.unload=function(){this.viewer.setModelStructurePanel(null)},b.CAM360Extension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",b.CAM360Extension)}(),function(){"use strict";function a(a,b,d){c.ViewerModelStructurePanel.call(this,a,b,d),this.viewer=a}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360"),c=Autodesk.Viewing.Extensions;a.prototype=Object.create(c.ViewerModelStructurePanel.prototype),a.prototype.constructor=a,a.prototype.sortCamNodes=function(a,b){function c(a,b){function c(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function d(d){var f=c(d.properties,"9429B915-D020-4CEB-971B-6ADD0A5D4BFA");f?("CAM_Setup"==f?e.camSetupNodes.push(a):"CAM_Operation"==f?e.camOperationNodes.push(a):"CAM_Tool"===f?e.camToolNodes.push(a):"CAM_Stock"===f?e.camStockNodes.push(a):"CAM_Folder"==f&&e.camFolderNodes.push(a),e.camNodes.push(a)):e.camModelNodes.push(a),b()}function f(a,c,d){b()}e.viewer.getProperties(a,d,f)}function d(){f.length>0?c(f.shift(),d):b()}this.camNodes=[],this.camModelNodes=[],this.camSetupNodes=[],this.camStockNodes=[],this.camOperationNodes=[],this.camToolNodes=[],this.camFolderNodes=[];var e=this,f=[];a.enumNodeChildren(a.getRootId(),function(a){f.push(a)},!0),f.shift(),d()},a.prototype.setModel=function(a,b){var d=this;d.sortCamNodes(a,function(){c.ViewerModelStructurePanel.prototype.setModel.call(d,a,b),d.SetCAMNodeVisible(!1),d.setVisible(!0),d.ExpandSetupNodes(),d.resizeToContent()})},a.prototype.initialize=function(){function a(c){b.SetCAMNodeVisible(!1),b.removeEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}c.ViewerModelStructurePanel.prototype.initialize.call(this);var b=this;this.viewer.model&&this.viewer.model.isLoadDone()||b.addEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a),b.addEventListener(b.viewer,Autodesk.Viewing.SHOW_EVENT,function(a){var c=a.nodeIdArray;if(c)for(var d=0;d<c.length;d++)b.setCamNodeVisibility(c[d])}),b.addEventListener(b.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(a){var c=a.nodeArray;if(c)for(var d=0;d<c.length;d++)b.HideHightlightCAMNode(c[d])}),b.addEventListener(b.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(a){var c=a.nodeIdArray;if(c)if(0==c.length)b.SetModelVisible(),b.SetCAMNodeVisible(!0);else for(var d=0;d<c.length;d++)b.setCamNodeVisibility(c[d])})},a.prototype.IsCAMNode=function(a){return this.camNodes.indexOf(a)!==-1},a.prototype.IsCAMSetupNode=function(a){return this.camSetupNodes.indexOf(a)!==-1},a.prototype.IsCAMStockNode=function(a){return this.camStockNodes.indexOf(a)!==-1},a.prototype.IsCAMToolNode=function(a){return this.camToolNodes.indexOf(a)!==-1},a.prototype.IsCAMOperationNode=function(a){return this.camOperationNodes.indexOf(a)!==-1},a.prototype.IsCAMFolderNode=function(a){return this.camFolderNodes.indexOf(a)!==-1},a.prototype.shouldInclude=function(a){return!this.IsCAMStockNode(a)},a.prototype.isGroupNode=function(a){return!this.IsCAMOperationNode(a)&&c.ViewerModelStructurePanel.prototype.isGroupNode.call(this,a)},a.prototype.setNodeVisibility=function(a,b){b?this.viewer.show(a):this.viewer.hide(a)},a.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var a=0;a<this.camModelNodes.length;a++)this.setNodeVisibility(this.camModelNodes[a],!0)},a.prototype.SetCAMNodeVisible=function(a){if(this.camNodes){for(var b=0;b<this.camNodes.length;b++)this.setNodeVisibility(this.camNodes[b],a);this.SetToolNodeVisible(!1)}},a.prototype.SetToolNodeVisible=function(a){if(this.camToolNodes)for(var b=0;b<this.camToolNodes.length;b++)this.setNodeVisibility(this.camToolNodes[b],a)},a.prototype.HideHightlightNode=function(a){var b=this.viewer.impl,c=this;c.instanceTree.enumNodeFragments(a,function(a){b.highlightFragment(c.model,a,!1,!0)},!0)},a.prototype.HideHightlightCAMNode=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),d=this.IsCAMFolderNode(a),e=this;e.instanceTree.enumNodeChildren(a,function(a){b?e.IsCAMStockNode(a)||e.HideHightlightNode(a):c?e.IsCAMToolNode(a)&&e.HideHightlightNode(a):d&&e.HideHightlightNode(a)},!1)},a.prototype.setCamNodeVisibility=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),d=this.IsCAMFolderNode(a),e=this;b?this.instanceTree.enumNodeChildren(a,function(a){var b=e.IsCAMStockNode(a);e.setNodeVisibility(a,b)}):c?this.instanceTree.enumNodeChildren(a,function(a){e.IsCAMToolNode(a)&&e.setNodeVisibility(a,!1)}):d&&this.instanceTree.enumNodeChildren(a,function(a){e.setNodeVisibility(a,!1)})},a.prototype.onClick=function(a,b){c.ViewerModelStructurePanel.prototype.onClick.call(this,a,b),this.SetModelVisible(),this.setCamNodeVisibility(a),this.viewer.fitToView()},a.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var a=0;a<this.camSetupNodes.length;a++)this.tree.setCollapsed(this.camSetupNodes[a],!1)},b.CAMModelStructurePanel=a}(),function(){"use strict";function a(a){var b="";a<0&&(b="-",a=-a);var c=~~(a/3600),d=~~(a%3600/60),e=a%60,f=b;return c>0&&(f+=c+":"+(d<10?"0":"")),f+=d+":"+(e<10?"0":""),f+=e.toFixed(2)}var b=Autodesk.Viewing,c=b.UI;b.ANIMATION_PLAY_EVENT="animationPlayEvent",b.ANIMATION_PAUSE_EVENT="animationPauseEvent",b.ANIMATION_SEEK_EVENT="animationSeekEvent",b.ANIMATION_PREVIOUS_FRAME_EVENT="animationPreviousFrameEvent",b.ANIMATION_NEXT_FRAME_EVENT="animationNextFrameEvent",b.ANIMATION_TRACK_UPDATE_EVENT="animationTrackUpdateEvent",b.ANIMATION_TOOLBAR_CLOSE_EVENT="animationToolbarCloseEvent";var d=function(a,c){b.Extension.call(this,a,c),this.viewer=a,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.playButtonIsPaused=!0,this.prevAnimationTime=-1};d.prototype=Object.create(b.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){var a=this.viewer;return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscapeBinded),a.model&&a.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),a.addEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},d.prototype.unload=function(){var a=this.viewer;if(this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),a.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var c=a.getToolbar(!1);c&&c.getControl(b.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return a.removeEventListener(b.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.removeEventListener(b.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.removeEventListener(b.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.removeEventListener(b.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(a.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},d.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0);var a=this.viewer,b=a.impl.keyFrameAnimator;b&&(this.prevAnimationTime>0&&(b.goto(this.prevAnimationTime),this.prevAnimationTime=-1),b.play(0,this.onPlayCallbackBinded),this.updatePlayButton(b.isPaused),a.toolbar&&a.toolbar.addClass("toolbar-animationMenuplacer"),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},d.prototype.pause=function(){if(!this.isPaused()){var a=this.viewer.impl.keyFrameAnimator;a&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.isPlaying=function(){var a=this.viewer.impl.keyFrameAnimator;return!!a&&(a.isPlaying&&!a.isPaused)},d.prototype.isPaused=function(){var a=this.viewer.impl.keyFrameAnimator;return!!a&&a.isPaused},d.prototype.rewind=function(){this.setTimelineValue(0)},d.prototype.setTimelineValue=function(a){var b=this.viewer.impl.keyFrameAnimator;if(b){a=Math.min(Math.max(0,a),1);var c=a*b.duration;b.goto(c),this.updateUI()}},d.prototype.prevKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.prev(),this.updateUI())},d.prototype.nextKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.next(),this.updateUI())},d.prototype.getDuration=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.duration:0},d.prototype.getDurationLabel=function(){return a(this.getDuration())},d.prototype.getCurrentTime=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.currentTime:0},d.prototype.getCurrentTimeLabel=function(){return a(this.getCurrentTime())},d.prototype.onAnimationReady=function(){var a=this.viewer;this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),a.impl.keyFrameAnimator&&(a.toolbar&&a.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),a.addEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},d.prototype.updateUI=function(){var b=this.viewer.impl.keyFrameAnimator;this.animTools&&b&&(this.animTools.input.value=b.duration>0?b.currentTime/b.duration*100:0,this.animTools.lapse.value=a(b.currentTime),this.animTools.lapseLeft.value=a(b.currentTime-b.duration),this.updatePlayButton(b.isPaused),this.updateToolbarBackground())},d.prototype.onPlayCallback=function(c){if(this.animTools){var d=this.viewer.impl.keyFrameAnimator;this.viewer.fireEvent({type:b.ANIMATION_TRACK_UPDATE_EVENT,data:{time:d.currentTime,duration:d.duration}}),this.animTools.input.value=c,
this.animTools.lapse.value=a(d.currentTime),this.animTools.lapseLeft.value=a(d.currentTime-d.duration),c>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},d.prototype.updatePlayButton=function(a){if(this.playButton&&a!==this.playButtonIsPaused){this.playButtonIsPaused=a;var c=this.viewer.impl.keyFrameAnimator;a?(this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.viewer.fireEvent({type:b.ANIMATION_PAUSE_EVENT,data:{time:c.currentTime,duration:c.duration}})):(this.playButton.setIcon("toolbar-animationPauseIcon"),this.playButton.setToolTip("Pause"),this.viewer.fireEvent({type:b.ANIMATION_PLAY_EVENT,data:{time:c.currentTime,duration:c.duration}}))}},d.prototype.resetExplode=function(a,b){var c=this.viewer;c.model.is2d()||0===c.getExplodeScale()||(b&&c.explodeSlider&&(c.explodeSlider.value=a),c.explode(a))},d.prototype.adjustToolbarPosition=function(){var a=this.viewer;if(a.toolbar){var b=a.toolbar.getDimensions().width;b>a.container.getBoundingClientRect().width&&(b=a.modelTools.getDimensions().width);var c=b-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width)+12;this.animTools.input.style.width=c+"px",this.toolbar.container.style.left="calc(50% - "+b/2+"px)"}},d.prototype.hideAnimateToolbar=function(){this.viewer.toolbar&&this.viewer.toolbar.removeClass("toolbar-animationMenuplacer"),this.animTools&&this.animTools.setVisible(!1)},d.prototype.updateToolbarBackground=function(){if(this.animTools){var a=this.animTools.input,b=a.value,c="#393939";a.style.background="-webkit-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="-moz-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="-ms-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="-o-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="linear-gradient(to right,#ffffff "+b+"%, "+c+" "+b+"%)"}},d.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var a=this.viewer.impl.keyFrameAnimator;if(!a)return;a.isPlaying&&!a.isPaused&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(b.isTouchDevice()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},d.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},d.prototype.onExplode=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(0!==a.currentTime&&(this.prevAnimationTime=a.currentTime,a.goto(0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},d.prototype.onToolbarCreated=function(){var d=this.viewer,e=this;this.onToolbarCreatedBinded&&(d.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new c.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animationSubtoolbar"),d.container.appendChild(this.toolbar.container),this.animTools=new c.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new c.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){e.isPaused()?e.play():e.pause()},d.modelTools.addControl(this.playButton),d.modelTools.resetModelButton&&(d.modelTools.resetModelButton.onClick=function(b){d.showAll();var c=d.impl.keyFrameAnimator;c&&(c.goto(0),g.value=0,f.value=a(0),i.value=a(-c.duration),e.updatePlayButton(!0)),e.resetExplode(0,!0),e.updateToolbarBackground()}),this.animTools.backwardButton=new c.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(a){var c=d.impl.keyFrameAnimator;void 0!==c&&c&&(c.prev(),d.fireEvent({type:b.ANIMATION_PREVIOUS_FRAME_EVENT,data:{time:c.currentTime,duration:c.duration}}),e.updateUI())},this.animTools.backwardButton.addClass("toolbar-animationButton"),this.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new c.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(a){var c=d.impl.keyFrameAnimator;void 0!==c&&c&&(c.next(),d.fireEvent({type:b.ANIMATION_NEXT_FRAME_EVENT,data:{time:c.currentTime,duration:c.duration}}),e.updateUI())},this.animTools.forwardButton.addClass("toolbar-animationButton"),this.animTools.forwardButton.setIcon("toolbar-animationForwardIcon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new c.Control("toolbar-animationTimeLapse");var f=this.animTools.lapse=document.createElement("input");f.type="text",f.value="0",f.className="animationTimeLapse",f.disabled=!0,this.animTools.timeText.container.appendChild(f),this.animTools.timeText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new c.Control("toolbar-animationTimeline");var g=this.animTools.input=document.createElement("input");g.type="range",g.value="0",g.className="animationTimeline",b.isIE11&&(g.style["padding-top"]="0",g.style["padding-bottom"]="0",g.style["margin-top"]="10px"),this.animTools.timeline.container.appendChild(g),g.addEventListener("input",function(c){var h=d.impl.keyFrameAnimator;if(void 0!==h&&h){var j=g.value*h.duration/100;f.value=a(j),i.value=a(j-h.duration),h.goto(j),d.fireEvent({type:b.ANIMATION_SEEK_EVENT,data:{time:j,duration:h.duration}}),e.updatePlayButton(h.isPaused),e.updateToolbarBackground()}});var h=document.createElement("div");h.className="adsk-control-tooltip",h.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(h),g.addEventListener("mouseover",function(a){a.target===g&&(h.style.visibility="visible")}),g.addEventListener("mouseout",function(a){a.target===g&&(h.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animationButton"),this.animTools.timeline.addClass("toolbar-animationTimeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new c.Control("toolbar-animationRemainingTime");var i=this.animTools.lapseLeft=document.createElement("input");i.type="text",i.value="0",i.className="animationTimeLapse",i.disabled=!0,this.animTools.timeLeftText.container.appendChild(i),this.animTools.timeLeftText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new c.Button("toolbar-animationClose"),this.animTools.closeButton.setToolTip("Close animation timeline"),this.animTools.closeButton.onClick=function(){e.hideAnimateToolbar(),d.fireEvent({type:b.ANIMATION_TOOLBAR_CLOSE_EVENT})},this.animTools.closeButton.setIcon("toolbar-animationCloseIcon"),this.animTools.closeButton.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.closeButton)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360"),Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=d,b.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",d)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Private,c=a.Extensions,d=c.Collaboration;d.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(a){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(b){return a.takeControl(),!1},this.handleButtonDown=function(b,c){return a.takeControl(),!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(b){return a.updatePointer(b),!1},this.handleGesture=function(b){return a.takeControl(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},d.ViewTransceiver=function(c){function d(a){p=!0;var b=JSON.parse(a.data.msg);w.restoreState(b),o.impl.invalidate(!0,!1,!0),p=!1}function e(a){return Math.round(1e3*a)/1e3}function f(a){for(var b=0;b<a.length;b++)a[b]=e(a[b])}function g(a){var b=a.data.msg;b[1]===!0||r||(b[0]!=m&&(m=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),q=!1,o.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),o.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function h(a){if(q||r){var b=a.camera,d=[b.position.x,b.position.y,b.position.z,b.target.x,b.target.y,b.target.z,b.up.x,b.up.y,b.up.z];f(d),d.unshift(r),d.unshift(c.getLocalId()),s.sendMessage("camera",d,n.channelId),m!=d[0]&&(m=d[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:m}}))}}function i(a,b,c){a&&!u&&(u=document.createElement("div"),u.classList.add("collabPointer")),a&&!v?(o.container.appendChild(u),v=!0):!a&&v&&(o.container.removeChild(u),v=!1),a&&(u.style.left=b-6+"px",u.style.top=c-6+"px")}function j(a){if(!q&&!r){var b=a.data.msg;t.origin.set(b[1],b[2],b[3]),t.direction.set(b[4],b[5],b[6]);var c=t.at(o.getCamera().near);c.project(o.getCamera()),c=o.impl.viewportToClient(c.x,c.y),i(!0,c.x,c.y)}}function k(a){if(q){var b=o.impl.clientToViewport(a.canvasX,a.canvasY);o.impl.viewportToRay(b,t);var d=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z];f(d),d.unshift(c.getLocalId()),s.sendMessage("pointer",d,n.channelId)}}function l(a){if(!p){var b=w.getState(x);c.sendMessage("state",JSON.stringify(b),n.channelId)}}var m,n=this,o=this.viewer=null,p=!1,q=!1,r=!1,s=this.client=c,t=new THREE.Ray,u=null,v=!1;this.channelId=null;var w,x={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){q=!0,i(!1)},this.updatePointer=function(a){k(a)},this.connectCamera=function(a){r=!a},this.attach=function(c){o&&this.detach(),this.viewer=o=c,w=new b.ViewerState(o),s.addEventListener("cameraChange",g),s.addEventListener("pointerMove",j),s.addEventListener("viewerState",d),o.hasEventListener(a.CAMERA_CHANGE_EVENT,h)||o.addEventListener(a.CAMERA_CHANGE_EVENT,h),o.hasEventListener(a.SELECTION_CHANGED_EVENT,l)||(o.addEventListener(a.SELECTION_CHANGED_EVENT,l),o.addEventListener(a.ISOLATE_EVENT,l),o.addEventListener(a.HIDE_EVENT,l),o.addEventListener(a.SHOW_EVENT,l),o.addEventListener(a.EXPLODE_CHANGE_EVENT,l),o.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.addEventListener(a.CUTPLANES_CHANGE_EVENT,l))},this.detach=function(){s&&(s.removeEventListener("cameraChange",g),s.removeEventListener("viewerState",d)),o&&(o.removeEventListener(a.CAMERA_CHANGE_EVENT,h),o.removeEventListener(a.SELECTION_CHANGED_EVENT,l),o.removeEventListener(a.ISOLATE_EVENT,l),o.removeEventListener(a.HIDE_EVENT,l),o.removeEventListener(a.SHOW_EVENT,l),o.removeEventListener(a.EXPLODE_CHANGE_EVENT,l),o.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.removeEventListener(a.CUTPLANES_CHANGE_EVENT,l),this.viewer=o=null,w=null)}},d.ViewTransceiver.prototype.constructor=d.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(d.ViewTransceiver.prototype)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Extensions,c=a.Private,d=a.UI,e=b.Collaboration;b.Collaboration.Collaboration=function(b,c){a.Extension.call(this,b,c),c&&c.rtc&&c.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0)},b.Collaboration.Collaboration.prototype=Object.create(a.Extension.prototype),b.Collaboration.Collaboration.prototype.constructor=b.Collaboration.Collaboration,b.Collaboration.Collaboration.prototype.initNetwork=function(a){this.p2p&&!a||(this.viewtx=new e.ViewTransceiver(this.client),this.interceptor=new e.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new c.P2PClient(this.client))},b.Collaboration.Collaboration.prototype.createUI=function(){var a=this,f=this.viewer;if(this.initNetwork(!1),this.panel=new e.DockingCollabPanel(this.viewer,this.client,this.p2p,this.viewtx),b.Collaboration.Collaboration.Panel=this.panel,this.collabButton=new d.Button("toolbar-collaborateTool"),this.collabButton.setToolTip("Live review"),this.collabButton.setIcon("adsk-icon-live-review"),this.collabButton.onClick=function(b){var c=a.panel.isVisible();if(!document.getElementById("collabBox"))if(c||a.inviteDivInstantiated)a.panel.setVisible(!1,!0),a.panel.reset();else{var d=new e.CollabPromptBox,g=f.container;d.start(g,function(){a.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")}},this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0),this.panel.addVisibilityListener(function(b){if(b){if(f.model){var e=f.model.getData();a.viewtx.channelId=e.basePath,a.viewtx.attach(f),a.client.connect(a.viewtx.channelId),a.client.join(a.viewtx.channelId)}f.toolController.activateTool(a.interceptor.getName());a.collabButton.setState(d.Button.State.ACTIVE),c.logger.track({category:"viewer_rtc_start"})}else c.logger&&a.client.isConnected()&&c.logger.track({category:"viewer_rtc_stop"}),a.p2p.hangup(),a.viewtx.detach(f),a.viewtx.channelId=null,a.client.disconnect(),a.panel.reset(),f.toolController.deactivateTool(a.interceptor.getName()),a.collabButton.setState(d.Button.State.INACTIVE)}),f.modelTools.addControl(this.collabButton),Autodesk.Viewing.Private.getParameterByName("invited")){var g=new CollabPromptBox,h=f.container;g.start(h,function(){a.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")}},b.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0),this.panel.reset()},b.Collaboration.Collaboration.prototype.load=function(){function a(){function a(c){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),d.createUI()}d.client=c.MessageClient.GetInstance(d.options?d.options.messageServerURL:void 0),d.socketErrorHandler=function(a){c.ErrorHandler.reportError(b.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,a.data),d.close()},d.client.addEventListener("socketError",d.socketErrorHandler),d.presenceChannelId=window.location.host,d.client.isConnected(),b.modelTools?d.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a)}var b=this.viewer,d=this;return c.loadDependency("lmv_io","socket.io-1.3.5.js",a),!0},b.Collaboration.Collaboration.prototype.unload=function(){var a=this.viewer;return this.client.removeEventListener("socketError",this.socketErrorHandler),this.socketErrorHandler=null,this.p2p.hangup(),this.viewtx.detach(a),this.client.disconnect(),this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null),a.toolController.deactivateTool(this.interceptor.getName()),this.interceptor=null,a.modelTools.removeControl(this.collabButton.getId()),this.collabButton=null,!0},a.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",b.Collaboration.Collaboration)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){function a(a,c,d,e){this.viewer=a,this.client=c,this.p2p=d,this.viewtx=e;b.UI.DockingPanel.call(this,a.container,"CollabPanel","Live review"),this.container.classList.add("collabPanel"),this.container.style.height="auto",this.container.dockRight=!0,this.content=document.createElement("div"),this.container.appendChild(this.content),this.content.classList.add("collabPanelContent"),this.tableContainer=document.createElement("div"),this.tableContainer.classList.add("userListTable","dockingPanelScroll"),this.table=document.createElement("table"),this.table.classList.add("adsk-lmv-tftable"),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.tableContainer.appendChild(this.table),this.content.appendChild(this.tableContainer),this.inviteDiv=document.createElement("div"),this.inviteDiv.className="collabBoxOK",this.inviteDiv.style.float="left",this.inviteDiv.style.width="232px",this.inviteDiv.setAttribute("data-i18n","Invite"),this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite"),this.content.appendChild(this.inviteDiv),this.inviteDiv.addEventListener("click",function(b){var c=new CollabPromptBox,d=a.container;c.start(d,function(){var a=Autodesk.Viewing.i18n.translate("Please Join My Live Review");document.location.href="mailto:?subject="+a},"Invite Others","Email Invite",!0)}),this.chatHistory=document.createElement("div"),this.chatHistory.classList.add("chatHistory"),this.chatHistory.classList.add("textEntry"),this.chatHistory.classList.add("dockingPanelScroll"),this.content.appendChild(this.chatHistory),this.chatPanel=document.createElement("div"),this.chatPanel.classList.add("chatPanel"),this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.classList.add("textEntry"),this.textInput.placeholder=Autodesk.Viewing.i18n.translate("Type a message"),this.chatPanel.appendChild(this.textInput),this.content.appendChild(this.chatPanel),this.isCameraConnected=!0;var f=this;this.addEventListener(c,"userListChange",function(a){if(!a.channelId||a.channelId===f.viewtx.channelId){var b=f.client.getChannelInfo(f.viewtx.channelId);b&&f.updateUsers(b.users)}}),this.addEventListener(this.viewtx,"controlChange",function(a){a.channelId===f.viewtx.channelId&&f.updateUserInControl(a.data.lastInControl)}),this.addEventListener(c,"chatReceived",function(a){a.channelId===f.viewtx.channelId&&f.updateChatHistory(a)}),this.textInput.onkeyup=function(a){f.handleChatInput(a)},this.addEventListener(this.p2p,"remoteStreamAdded",function(a){f.videoPanel||f.createVideoPanel(),f.remoteVideo.src=window.URL.createObjectURL(a.data)}),this.addEventListener(this.p2p,"localStreamAdded",function(a){f.videoPanel||f.createVideoPanel(),f.localVideo.src=window.URL.createObjectURL(a.data)}),this.addEventListener(this.p2p,"remoteHangup",function(a){f.removeVideoPanel()})}var b=Autodesk.Viewing,c=b.Extensions,d=b.Private,e=(b.UI,c.Collaboration);Autodesk.Viewing.startLiveReviewSession=function(){e.Panel&&e.Panel.startSession()},Autodesk.Viewing.endLiveReviewSession=function(){e.Panel&&e.Panel.endSession()};a.prototype=Object.create(b.UI.DockingPanel.prototype),a.prototype.constructor=a,a.prototype.startSession=function(){var a=this;if(!this.isVisible()){var b=new CollabPromptBox,c=this.viewer.container;b.start(c,function(){a.setVisible(!0,!0)},"Start a Live Review","Start Review")}},a.prototype.endSession=function(){this.isVisible()&&(this.setVisible(!1,!0),this.reset())},a.prototype.updateUsers=function(a){for(var b=document.createElement("tbody"),c=0;c<a.length;c++){var d=b.insertRow(-1);d.id=a[c].id;var e=d.insertCell(0);e.style.width="14px",e.style.cursor="default";var f=document.createElement("div");f.classList.add("statusBase"),f.classList.add("statusNormal"),f.innerHTML="&#9679",e.appendChild(f);d.insertCell(1).textContent=a[c].name}this.table.replaceChild(b,this.tbody),this.tbody=b,this.fixComponentPlacement()},a.prototype.updateUserInControl=function(a){for(var b=0;b<this.tbody.rows.length;b++){var c=this.tbody.rows[b],d=c.cells[0].childNodes[0];c.id==a?(d.classList.remove("statusNormal"),d.classList.add("statusInControl"),d.innerHTML="&#9784",c.cells[1].style.color="#4CBA36"):(d.classList.remove("statusInControl"),d.classList.add("statusNormal"),d.innerHTML="&#9679",c.cells[1].style.color="#ffffff")}},a.prototype.updateChatHistory=function(a){var b=this.client.getUserById(a.data.from,a.channelId);if("/"!=a.data.msg.charAt(0)){if(this.chatHistory.lastUser!=b.name){var c=document.createElement("p"),d=document.createElement("div");d.classList.add("heading"),d.style.float="left",d.style.fontStyle="normal",d.style.color="#857E7E",d.textContent=b.name,c.appendChild(d);var e=document.createElement("div");e.classList.add("heading"),e.style.textAlign="right",e.style.fontStyle="normal",e.style.color="#857E7E",e.textContent=(new Date).toLocaleTimeString(),c.appendChild(e),this.chatHistory.appendChild(c),this.chatHistory.lastUser=b.name}else{var f=document.createElement("br");this.chatHistory.appendChild(f)}var g=document.createElement("span");g.classList.add("messageText"),g.textContent=a.data.msg,this.chatHistory.appendChild(g),this.chatHistory.scrollTop=this.chatHistory.scrollHeight}},a.prototype.handleChatInput=function(a){13==a.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")},a.prototype.fixComponentPlacement=function(a){var b=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight;this.videoPanel?(b+=this.videoPanel.offsetHeight,this.chatHistory.style.height="calc(100% - "+b+"px)"):this.chatHistory.style.height="calc(100% - "+b+"px)"},a.prototype.createVideoPanel=function(a){this.videoPanel=document.createElement("div"),this.videoPanel.classList.add("videoPanel"),this.localVideo=document.createElement("video"),this.localVideo.autoplay=!0,this.localVideo.muted=!0,this.localVideo.classList.add("videoInset"),this.videoPanel.appendChild(this.localVideo),this.remoteVideo=document.createElement("video"),this.remoteVideo.autoplay=!0,this.remoteVideo.classList.add("videoMain"),this.videoPanel.appendChild(this.remoteVideo);var b=this,c=document.createElement("div");c.classList.add("dockingPanelClose"),c.innerHTML="&times",c.title=Autodesk.Viewing.i18n.translate("End video call"),c.onclick=function(a){b.p2p.hangup(),b.removeVideoPanel()},this.videoPanel.appendChild(c),this.content.insertBefore(this.videoPanel,this.chatHistory),this.fixComponentPlacement()},a.prototype.removeCollabPrompt=function(){var a=document.getElementById("collabBox");a&&(a.style.visibility="hidden",this.viewer.container.removeChild(a))},a.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel),this.videoPanel=null},a.prototype.reset=function(a){if(this.tbody){var b=document.createElement("tbody");this.table.replaceChild(b,this.tbody),this.tbody=b}this.chatHistory.textContent="",this.textInput.value="",this.removeVideoPanel(),this.removeCollabPrompt()},CollabPromptBox=function(){},CollabPromptBox.prototype.start=function(a,b,c,e,f){if(a&&!document.getElementById("collabBox")){var g=document.createElement("div");g.id="collabBox",g.className="collabBox",a.appendChild(g);var h=document.createElement("div");h.className="collabBoxTitle",h.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c}),g.appendChild(h);var i=document.createElement("span");i.className="collabBoxText";var j="Enter your name";f&&(j="Review URL"),i.textContent=Autodesk.Viewing.i18n.translate(j,{defaultValue:j}),g.appendChild(i);var k=document.createElement("span");k.className="collabBoxInputContainer",g.appendChild(k);var l=document.createElement("input");if(l.type="text",l.className="collabBoxInputText",f){var m=window.location.toString();m+=m.indexOf("?")==-1?"?invited=true":"&invited=true",Autodesk.Viewing.Private.docItemId&&(m+="&itemid="+Autodesk.Viewing.Private.docItemId),m+="&doNotRedirect=true",l.value=m}k.appendChild(l),l.onkeyup=function(c){13==c.keyCode&&(g.style.visibility="hidden",a.removeChild(g),d.setUserName(l.value),b())};var n=document.createElement("div");if(n.className="collabBoxClose",n.innerHTML="&times;",n.addEventListener("click",function(b){g.style.visibility="hidden",a.removeChild(g)}),g.appendChild(n),f){var i=document.createElement("span");i.className="collabBoxText",i.style.marginTop="0px";var j="Copy and send this URL to invite others";i.textContent=Autodesk.Viewing.i18n.translate(j,{defaultValue:j}),g.appendChild(i)}else{var o=document.createElement("div");o.className="collabBoxOK",o.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),o.addEventListener("click",function(c){g.style.visibility="hidden",a.removeChild(g),""!==l.value.trim()&&d.setUserName(l.value),b()}),g.appendChild(o)}g.style.visibility="visible",l.focus(),f&&l.select()}},e.DockingCollabPanel=a,e.CollabPromptBox=CollabPromptBox}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline"),Autodesk.Viewing.Extensions.Beeline.BeelineExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.constructor=Autodesk.Viewing.Extensions.Beeline.BeelineExtension,Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.load=function(){function a(){return f=d.getActiveNavigationTool(),d.setActiveNavigationTool(c.tool.getName()),!0}function b(){return d.setActiveNavigationTool(f?f:d.defaultNavigationToolName),!0}var c=this,d=this.viewer,e=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.Beeline.BeelineTool(d.impl,d),d.toolController.registerTool(this.tool),this.createUI();var f;this.HOTKEYS_ID="Autodesk.Beeline.Hotkeys";var g=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.CONTROL,Autodesk.Viewing.theHotkeyManager.KEYCODES.ALT],onPress:a,onRelease:b}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,g),this.onToolChanged=function(a){if(a.toolName.indexOf("beeline")!==-1&&c.beelineButton){var b=a.active?e.Button.State.ACTIVE:e.Button.State.INACTIVE;c.beelineButton.setState(b)}},d.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar&&a.getSettingsPanel){var b=a.getToolbar(!0),c=Autodesk.Viewing.UI,d=b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),e=new c.Button("toolbar-beelineTool");e.setToolTip("Walk to"),e.setIcon("adsk-icon-walk"),e.onClick=function(b){var d=e.getState();d===c.Button.State.INACTIVE?a.setActiveNavigationTool("beeline"):d===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.beelineButton=e;var f=d.getControl("toolbar-cameraSubmenuTool");f?d.addControl(this.beelineButton,{index:d.indexOf(f.getId())}):d.addControl(this.beelineButton);var g=this,h=function(){a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,h);var b=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation,c=a.getSettingsPanel(!0);g.viewerOption_LookHorId=c.addCheckbox(b,"Reverse horizontal look direction",!1,function(b){a.setReverseHorizontalLookDirection(b)},"reverseHorizontalLookDirection"),g.viewerOption_LookVertId=c.addCheckbox(b,"Reverse vertical look direction",!1,function(b){a.setReverseVerticalLookDirection(b)},"reverseVerticalLookDirection")};this.viewer.getSettingsPanel(!1)?h():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,h)}},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.beelineButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.beelineButton.getId()),this.beelineButton=null}return a.getSettingsPanel&&(a.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookHorId),a.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookVertId)),a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Beeline",Autodesk.Viewing.Extensions.Beeline.BeelineExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");var avp=Autodesk.Viewing.Private;Autodesk.Viewing.Extensions.Beeline.BeelineTool=function(a,b){function c(){j.revertToStartState()}function d(a){var b={};b.target=a.target.clone(),b.worldup=a.worldup.clone(),b.position=a.position.clone(),b.up=a.up.clone();for(var c=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],d=0;d<c.length;d++)b[c[d]]=a[c[d]];return b}function e(a,b){if(!(a.target.equals(b.target)&&a.position.equals(b.position)&&a.worldup.equals(b.worldup)&&a.up.equals(b.up)))return!1;for(var c=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],d=0;d<c.length;d++)if(a[c[d]]!==b[c[d]])return!1;return!0}function f(c){var d=new THREE.Vector3(c.x,c.y,1),e=a.hitTestViewport(d.clone(),!1);if(!e||!e.intersectPoint)return[];var f=new THREE.Raycaster,g=d.clone(),h=a.camera,i=new THREE.Vector3(g.x,g.y,1);g.z=-1,g=g.unproject(h),i=i.unproject(h),i.sub(g).normalize(),f.set(n.isPerspective?h.position:g,i);for(var j=[],k=e.fragId instanceof Array?e.fragId:[e.fragId],l=0;l<k.length;l++){var m=a.getRenderProxy(b.model,k[l]);avp.VBIntersector.meshRayCast(m,f,j)}return j.sort(function(a,b){return a.distance-b.distance}),j}function g(){n.isPerspective||(n.toPerspective(),o.activatePivot(!1)),n.getFocalLength()>i&&n.setFocalLength(i,!0)}var h={GO_TO:0,PASS_THROUGH:1,DEFAULT:0},i=28,j=this,k=b,l=b.container,m=b.autocam,n=b.navigation,o=b.utilities,p=["beeline"],q=0,r=!1,s=0,t=null,u=null,v=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector3,z=!1,A=new THREE.Vector3,B=new THREE.Vector3,C=null,D=null;this.getNames=function(){return p},this.getName=function(){return p[0]},this.activate=function(a){s=0,b.addEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c),m.userLookSpeed=.8,this.showHUDMessage(!0)},this.deactivate=function(){b.removeEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c),this.revertToStartState(),this.showHUDMessage(!1)},this.getCursor=function(){
return r?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjaY2BgnuDo4uTKJMDAUFBUUuQe5BgZERmlwH6egY2BmYGBgYGBITG5uMAxIMCHgYGBIS8/L5UBFTAyMHy7xsDIwMDAcFnX0cXJlYE0wJpcUFTCwMBwgIGBwSgltTiZgYHhCwMDQ3p5SUEJAwNjDAMDg0hSdkEJAwNjAQMDg0h2SJAzAwNjCwMDE09JakUJAwMDg3N+QWVRZnpGiYKhpaWlgmNKflKqQnBlcUlqbrGCZ15yflFBflFiSWoKAwMD1A4GBgYGXpf8EgX3xMw8BSMDVQYqg4jIKAUICxE+CDEESC4tKoMHJQODAIMCgwGDA0MAQyJDPcMChqMMbxjFGV0YSxlXMN5jEmMKYprAdIFZmDmSeSHzGxZLlg6WW6x6rK2s99gs2aaxfWMPZ9/NocTRxfGFM5HzApcj1xZuTe4FPFI8U3mFeCfxCfNN45fhXyygI7BD0FXwilCq0A/hXhEVkb2i4aJfxCaJG4lfkaiQlJM8JpUvLS19QqZMVl32llyfvIv8H4WtioVKekpvldeqFKiaqP5UO6jepRGqqaT5QeuA9iSdVF0rPUG9V/pHDBYY1hrFGNuayJsym740u2C+02KJ5QSrOutcmzjbQDtXe2sHY0cdJzVnJRcFV3k3BXdlD3VPXS8Tbxsfd99gvwT//ID6wIlBS4N3hVwMfRnOFCEXaRUVEV0RMzN2T9yDBLZE3aSw5IaUNak30zkyLDIzs+ZmX8xlz7PPryjYVPiuWLskq3RV2ZsK/cqSql01jLVedVPrHzbqNdU0n22VaytsP9op3VXUfbpXta+x/+5Em0mzJ/+dGj/t8AyNmf2zvs9JmHt6vvmCpYtEFrcu+bYsc/m9lSGrTq9xWbtvveWGbZtMNm/ZarJt+w6rnft3u+45uy9s/4ODOYd+Hmk/Jn58xUnrU+fOJJ/9dX7SRe1LR68kXv13fc5Nm1t379TfU75/4mHeY7En+59lvhB5efB1/lv5dxc+NH0y/fzq64Lv4T8Ffp360/rP8f9/AA0ADzT6lvFdAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEtSURBVHja7JQxTkJBFEXPQ/xQEDG0ljRYSU1iLN2AtSWlC7Gw04QtGF2ApQVLIDY2hlgIDagJwWCOhf74JXxRYumbaib3ZO7c9zIhq1WBfzAfjJViDWPdYBq/w0pKITjhd7eGJwQkDu2I8rOFHYcmkqgDz4wfoeGZA01BHXtsbSla89ixZsH3an2LtpRUOQde28xFm17PgyPvVK1bl5yYEOtuq3rnyMQCXNJgiiTchuHCnhrGbYBMaXAJULGqlJz54O43bcFdH5xZUqpWJJWW7duza/tDmTWJbbv27Fs2PS2m1iZRNeGcI/aAEevOgCKnbAI7DNjjhUmk1ouf7xgHbLgF3MSzT7wCaxxSiW3hnsf4OngLotj3ILO74CoWTWzOIGcTXab4/6z+CnwbAGjXSZC++vLvAAAAAElFTkSuQmCC), auto":s<=1?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAQdJREFUeNq0k0GOgzAMRZ+jHI4VO4410qzam0aCjbsoaS1PUgfoWIqAEPnZ3z8AN0DNWoFfVeUbC0BtrOtaISNhC3tvGkC2P7ZtY1kWgHul90JEtCYTkVqo7O844LPyeZ51RJ5atQ3biZeolFJ0miYd1d4nd5A/gB+g7E++AFB7VqzWIkKkfdW/d27P8RpE4p8jRy7Z9ZBOpSEgRRb0MAv0lmxZNEXJj0IACTvwrfeksJBW9a0Z6NEh+vl4UI6qHzHBJ4nyFQv6YoaG3Ls80X7vTIqS1W+vdWvArfuSG/pplPzTBRy6ybaLkSSHAFcThoCe/c6C81n7jUY6a78rHQigftBnQY8BAEubfpuApyq2AAAAAElFTkSuQmCC), auto":null},this.update=function(){var a=n.getCamera();r=!1;var c=!1;if(1===s){var e=A.clone().sub(B);if(0!==e.x||0!==e.y){r=!0,B.x+=.7*e.x,B.y+=.7*e.y;var f=n.getWorldUpVector().dot(n.getCameraUpVector()),g=b.prefs.reverseHorizontalLookDirection?-1:1,h=b.prefs.reverseVerticalLookDirection?-1:1;e.x*=f<0?-g:g,e.y*=h,m.sync(n.getCamera()),m.look(e),c=!0,C=d(a)}}return c},this.revertToStartState=function(){o.pivotActive(!1),q=0,z=!0},this.attemptFlight=function(a,b){if(n.isActionEnabled("walk")){var c=f(a);c.length>0&&(v=c[0].point,w=c[c.length-1].point,j.fly(1e3,b))}},this.fly=function(a,b){switch(o.setPivotPoint(b===h.GO_TO?v:w,!0,!0),g(),x=n.getPosition(),u=a,b){case h.GO_TO:y=x.clone().lerp(v,.8);break;case h.PASS_THROUGH:var c=2*m.camera.near,d=w.clone().sub(x).length(),e=c/d;o.setPivotPoint(x.clone().lerp(w,1+10*e),!0,!0),y=x.clone().lerp(w,1+e);break;default:return}q=1,z=!1,t=null,requestAnimationFrame(j.step)},this.step=function(a){var b=n.getCamera();if(!z){if(null===t)C=d(b),t=a;else if(!e(b,C))return void j.revertToStartState();var c=a-t,f=c<u?c/u:1,g=x.clone().lerp(y,f),h=n.getEyeVector();h.multiplyScalar(n.getPivotPoint().sub(n.getPosition()).length()/h.length()),n.setView(g,h.add(g)),C=d(b),o.activatePivot(!1),c<u?requestAnimationFrame(j.step):j.revertToStartState()}},this.handleGesture=function(a){switch(Autodesk.Viewing.Private.HudMessage.dismiss(),a.type){case"dragstart":return D="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===D&&this.handleMouseMove(a);case"dragend":return"drag"===D&&(this.handleButtonUp(a,0),D=null,!0)}return!1},this.handleButtonDown=function(a,b){return Autodesk.Viewing.Private.HudMessage.dismiss(),s+=1<<b,0===b&&(B.x=A.x=a.canvasX,B.y=A.y=a.canvasY,!0)},this.handleButtonUp=function(a,b){return s-=1<<b,0===b},this.handleSingleClick=function(a,b){if(Autodesk.Viewing.Private.HudMessage.dismiss(),0!==b)return this.revertToStartState(),!1;var c={x:a.normalizedX,y:a.normalizedY};switch(q){case 0:j.attemptFlight(c,h.GO_TO);break;case 1:j.revertToStartState()}return!0},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!(!a.pointers||1!==a.pointers.length)&&(j.attemptFlight({x:a.normalizedX,y:a.normalizedY},h.PASS_THROUGH),!0)},this.handleDoubleClick=function(a,b){return 0===b&&(j.attemptFlight({x:a.normalizedX,y:a.normalizedY},h.PASS_THROUGH),!0)},this.handleMouseMove=function(a){return A.x=a.canvasX,A.y=a.canvasY,1===s&&(g(),!0)},this.handleBlur=function(a){return this.revertToStartState(),!1},this.showOrthoWarningMessage=function(){var a={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic Beeline",messageDefaultValue:"The view is set to Orthographic. Using this tool will switch to Perspective."},b=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(l,a,b)},this.showFocalWarningMessage=function(){var a={msgTitleKey:"Long Focal Length View Set",messageKey:"The view is set to a long focal length",messageDefaultValue:"This view has a long focal length. Using this tool will set a short focal length."},b=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(l,a,b)},this.watchCamera=function(a){if(k.toolController.getActiveToolName()===p[0]||k.toolController.getActiveToolName()===p[1]){var b=n.getCamera(),c=b&&!b.isPerspective,d=n.getFocalLength()>i;c?j.showOrthoWarningMessage():d?j.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss()}},this.showHUDMessage=function(a){var b=n.getCamera(),c=b&&!b.isPerspective,d=n.getFocalLength()>i;a&&c?j.showOrthoWarningMessage():a&&d?j.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss(),a?k.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,j.watchCamera):k.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,j.watchCamera)}},function(){"use strict";function a(a,b,c){return function(){var e=b.getState();e===d.Button.State.INACTIVE?(a.setActiveNavigationTool(c),b.setState(d.Button.State.ACTIVE)):e===d.Button.State.ACTIVE&&(a.setActiveNavigationTool(),b.setState(d.Button.State.INACTIVE))}}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools"),c=Autodesk.Viewing,d=c.UI,e=function(a,b){c.Extension.call(this,a,b)};e.prototype=Object.create(c.Extension.prototype),e.prototype.constructor=e,e.prototype.load=function(){var a=this.viewer,b=new c.FovTool(a),d=new c.WorldUpTool(a.impl,a);return a.toolController.registerTool(b),a.toolController.registerTool(d),this.createUI(),this.initCameraStateMachine(),this.initFocalLengthOverlay(),!0},e.prototype.createUI=function(){var b=this.viewer,e=b.getToolbar(!0),f=e.getControl(c.TOOLBAR.NAVTOOLSID),g=function(a){return b.navigation.isActionEnabled(a)?"block":"none"};if(b.model.is3d()){var h=new d.ComboButton("toolbar-orbitTools");h.setToolTip("Orbit"),h.setIcon("adsk-icon-orbit-constrained"),h.setDisplay(g("orbit")),this.createOrbitSubmenu(h),f.addControl(h),f.orbittoolsbutton=h,h.setState(d.Button.State.ACTIVE),f.returnToDefault=function(){h.setState(d.Button.State.ACTIVE)}}var i=new d.Button("toolbar-panTool");i.setToolTip("Pan"),i.setIcon("adsk-icon-pan"),i.onClick=a(b,i,"pan"),i.setDisplay(g("pan")),f.addControl(i),f.panbutton=i,b.model.is2d()&&(f.returnToDefault=function(){i.setState(d.Button.State.ACTIVE)},f.returnToDefault());var j=new d.Button("toolbar-zoomTool");j.setToolTip("Zoom"),j.setIcon("adsk-icon-zoom"),j.onClick=a(b,j,"dolly"),j.setDisplay(g("zoom")),f.addControl(j),f.dollybutton=j;var k=new d.ComboButton("toolbar-cameraSubmenuTool");k.setToolTip("Camera interactions"),k.setIcon("adsk-icon-camera"),k.saveAsDefault(),this.createCameraSubmenu(k),f.addControl(k),f.camerabutton=k},e.prototype.createOrbitSubmenu=function(b){var e=this.viewer,f=e.getToolbar(!0),g=f.getControl(c.TOOLBAR.NAVTOOLSID),h=new d.Button("toolbar-freeOrbitTool");h.setToolTip("Free orbit"),h.setIcon("adsk-icon-orbit-free"),h.onClick=a(e,h,"freeorbit"),b.addControl(h),g.freeorbitbutton=h;var i=new d.Button("toolbar-orbitTool");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.onClick=a(e,i,"orbit"),b.addControl(i),g.orbitbutton=i,b.onClick=i.onClick},e.prototype.createCameraSubmenu=function(b){var e=this.viewer,f=e.getToolbar(!0),g=f.getControl(c.TOOLBAR.NAVTOOLSID),h=function(a){return e.navigation.isActionEnabled(a)?"block":"none"};if(c.isTouchDevice()){var i=new d.Button("toolbar-homeTool");i.setToolTip("Home"),i.setIcon("adsk-icon-home"),i.onClick=function(){e.navigation.setRequestHomeView(!0);var a=e.getDefaultNavigationToolName();e.setActiveNavigationTool(a),b.restoreDefault()},i.setDisplay(h("gotoview")),b.addControl(i),g.homebutton=i}var j=new d.Button("toolbar-fitToViewTool");if(j.setToolTip("Fit to view"),j.setIcon("adsk-icon-fit-to-view"),j.onClick=function(a){e.fitToView(e.getSelection());var c=e.getDefaultNavigationToolName();e.setActiveNavigationTool(c),b.restoreDefault()},j.setDisplay(h("gotoview")),b.addControl(j),g.fovbutton=j,e.model.is3d()){var k=new d.Button("toolbar-focalLengthTool");k.setToolTip("Focal length"),k.setIcon("adsk-icon-fov"),k.onClick=a(e,k,"fov"),k.setDisplay(h("fov")),b.addControl(k),g.fovbutton=k}var l=new d.Button("toolbar-rollTool");l.setToolTip("Roll"),l.setIcon("adsk-icon-roll"),l.onClick=a(e,l,"worldup"),l.setDisplay(h("roll")),b.addControl(l),g.rollbutton=l},e.prototype.initCameraStateMachine=function(a){var b=this,d=this.viewer,e=d.getToolbar(!0),f=e.getControl(c.TOOLBAR.NAVTOOLSID);this.toolChangedHandler=function(a){"fov"===a.toolName&&b.showFocalLengthOverlay(a.active)},d.addEventListener(c.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.navChangedHandler=function(a){d.getDefaultNavigationToolName()===a.id&&f.returnToDefault()},d.addEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)},e.prototype.initFocalLengthOverlay=function(){var a=this.focallength=document.createElement("div");a.className="focallength";var b=document.createElement("table"),c=document.createElement("tbody");b.appendChild(c),a.appendChild(b),this.viewer.container.appendChild(a);var d=c.insertRow(-1),e=d.insertCell(0);e.setAttribute("data-i18n","Focal Length"),e.textContent=Autodesk.Viewing.i18n.translate("Focal Length"),e=d.insertCell(1),e.textContent="",e.style.width="4em",e.style.textAlign="right",this.fovCell=e,a.style.visibility="hidden"},e.prototype.showFocalLengthOverlay=function(a){function b(a){if(a){var b={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."};c.Private.HudMessage.displayMessage(h.container,b)}else c.Private.HudMessage.dismiss()}function d(a){a&&e(),g.focallength&&(g.focallength.style.visibility=a?"visible":"hidden")}function e(){var a=h.getFocalLength();i!==a&&(i=a,g.fovCell.textContent=a.toString()+" mm")}function f(a){if(e(),"fov"===h.toolController.getActiveToolName()){var c=h.navigation.getCamera(),f=c&&!c.isPerspective;d(!f),b(f)}}var g=this,h=this.viewer,i=0,j=h.navigation.getCamera(),k=j&&!j.isPerspective;d(a&&!k),b(a&&k),a?h.addEventListener(c.CAMERA_CHANGE_EVENT,f):h.removeEventListener(c.CAMERA_CHANGE_EVENT,f)},e.prototype.unload=function(){return this.destroyUI(),!0},e.prototype.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(!b)return!0;var e=b.getControl(c.TOOLBAR.NAVTOOLSID);return!e||(a.model&&a.model.is3d()&&(e.orbittoolsbutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.orbittoolsbutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.orbittoolsbutton.getId()),e.orbittoolsbutton=null,e.orbitbutton.onClick=null,e.orbitbutton=null,e.freeorbitbutton.onClick=null,e.freeorbitbutton=null),e.removeControl(e.panbutton.getId()),e.panbutton.onClick=null,e.panbutton=null,e.removeControl(e.dollybutton.getId()),e.dollybutton.onClick=null,e.dollybutton=null,e.camerabutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.camerabutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.camerabutton.getId()),e.camerabutton.onClick=null,e.camerabutton=null,e.rollbutton.onClick=null,e.rollbutton=null,e.fovbutton.onClick=null,e.fovbutton=null,this.focallength=null,a.removeEventListener(c.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,a.removeEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},b.NavToolsExtension=e,c.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",e)}(),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),b=Autodesk.Viewing,c=b.UI,d=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};d.prototype=Object.create(Autodesk.Viewing.Extension.prototype),d.prototype.constructor=d,d.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createUI()},d.prototype.load=function(){var c=this,d=this.viewer;if(this.hasUI=Autodesk.Viewing.Private.GuiViewer3D&&d instanceof Autodesk.Viewing.Private.GuiViewer3D,this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape",!d.toolController)return!1;this.options=this.options||{};var e={};return e.onCloseCallback=function(a){c.enableMeasureTool(!1)},e.calibrationFactor=this.options.calibrationFactor,e.snapperOptions=this.options.snapperOptions,this.forceCalibrate=this.options.forceCalibrate,this.isCalibrated=null!=this.options.calibrationFactor,this.tool=new a.MeasureTool(d,e),d.toolController.registerTool(this.tool),this.viewer.toolbar?this.createUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),!0},d.prototype.unload=function(){var a=this.viewer;return this.destroyUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},d.prototype.isActive=function(){return this.tool.isActive()},d.prototype.setActive=function(a){return this.enableMeasureTool(a)},d.prototype.toggle=function(){return this.isActive()?this.enableMeasureTool(!1):this.enableMeasureTool(!0),this.isActive()},d.prototype.getMeasurement=function(a,b){var c=null;return this.isActive()&&(c=this.tool.getMeasurement(a,b)),c},d.prototype.getUnitOptions=function(){return[{name:"Unknown",type:""},{name:"Decimal feet",type:"decimal-ft"},{name:"Feet and fractional inches",type:"ft"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters",type:"m"},{name:"Centimeters",type:"cm"},{name:"Millimeters",type:"mm"},{name:"Meters and centimeters",type:"m-and-cm"}]},d.prototype.getPrecisionOptions=function(a){if(a)var b=["1","1/2","1/4","1/8","1/16","1/32","1/64"];else var b=["0","0.1","0.01","0.001","0.0001","0.00001"];return b},d.prototype.getDefaultUnit=function(){return this.viewer.model.getDisplayUnit()},d.prototype.openCalibrationRequiredDialog=function(){this.hasUI&&this.calibrationToolButton&&(this.CalibrationRequiredDialog||(this.CalibrationRequiredDialog=new Autodesk.Viewing.Extensions.Measure.CalibrationRequiredDialog(this,this.viewer,"calibration-required","Calibration Required",this.options)),this.CalibrationRequiredDialog.setVisible(!0))},d.prototype.enableMeasureTool=function(a){var b=this.viewer.toolController,c=1==this.selectedTool;return this.viewer.impl.disableRollover(a),a&&!c?!this.forceCalibrate||this.forceCalibrate&&this.tool.isCalibrated()?(b.activateTool("measure"),this.selectedTool=1,this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):(this.openCalibrationRequiredDialog(),!1):!(a||!c)&&(b.deactivateTool("measure"),this.selectedTool=0,this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},d.prototype.enableCalibrationTool=function(a){var b=this.viewer.toolController,c=2==this.selectedTool;return this.viewer.impl.disableRollover(a),a&&!c?(b.activateTool("calibration"),this.selectedTool=2,this.calibrationToolButton&&this.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(a||!c)&&(b.deactivateTool("calibration"),this.selectedTool=0,this.calibrationToolButton&&this.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},d.prototype.createUI=function(){var a=this,d=this.viewer,e=d.getToolbar(!0),f=e.getControl(b.TOOLBAR.MODELTOOLSID),g=new c.ComboButton("toolbar-measurementSubmenuTool");g.setToolTip("Measure"),g.setIcon("adsk-icon-measure"),g.saveAsDefault(),this.createMeasurementSubmenu(g),f.measurementSubmenuButton=g,f&&f.addControl(g,{index:0});var h=[{keycodes:[b.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return 1==a.selectedTool?a.enableMeasureTool(!1):2!=a.selectedTool||void 0}}];b.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,h)},d.prototype.createMeasurementSubmenu=function(a){var d=this,e=this.viewer,f=e.getToolbar(!0),g=f.getControl(b.TOOLBAR.MODELTOOLSID);this.measureToolButton=new c.Button("toolbar-measureTool"),this.measureToolButton.setToolTip("Measure"),this.measureToolButton.setIcon("adsk-icon-measure"),this.measureToolButton.onClick=function(a){d.enableCalibrationTool(!1),d.enableMeasureTool(!(1==d.selectedTool))},this.onMeasureButtonStateChange=function(a){a.state===c.Button.State.ACTIVE?(d.enableMeasureTool(!0),d.selectedTool=1):a.state===c.Button.State.INACTIVE&&(d.enableMeasureTool(!1),d.selectedTool=0)},this.measureToolButton.addEventListener(c.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange),a.addControl(this.measureToolButton),g.measureToolButton=this.measureToolButton,this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),this.calibrationToolButton=new c.Button("toolbar-calibrationTool"),this.calibrationToolButton.setToolTip("Calibrate"),this.calibrationToolButton.setIcon("calibration-icon"),this.calibrationToolButton.onClick=function(a){d.enableMeasureTool(!1),d.enableCalibrationTool(!(2==d.selectedTool))},this.onCalibrationButtonStateChange=function(a){a.state===c.Button.State.ACTIVE?(d.enableCalibrationTool(!0),d.selectedTool=2):a.state===c.Button.State.INACTIVE&&(d.enableCalibrationTool(!1),d.selectedTool=0)};var h=function(b){d.calibrationToolButton&&d.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),d.selectedTool=0,a.restoreDefault(),d.enableMeasureTool(!0)};this.calibrationToolButton.addEventListener(c.Button.Event.STATE_CHANGED,this.onCalibrationButtonStateChange),e.addEventListener("finished-calibration",h),a.addControl(this.calibrationToolButton),g.calibrationToolButton=this.calibrationToolButton},d.prototype.destroyUI=function(){var a=this.viewer;this.measureToolButton&&this.measureToolButton.removeEventListener(c.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange),this.calibrationToolButton&&this.calibrationToolButton.removeEventListener(c.Button.Event.STATE_CHANGED,this.onCalibrationButtonStateChange);var d=a.getToolbar(!1);if(d){var e=d.getControl(b.TOOLBAR.MODELTOOLSID);if(e){var f=null;this.measureToolButton&&(f=e.getControl("toolbar-inspectSubMenu"),f?f.removeControl(this.measureToolButton.getId()):e.removeControl(this.measureToolButton.getId())),this.calibrationToolButton&&(f=e.getControl("toolbar-inspectSubMenu"),f?f.removeControl(this.calibrationToolButton.getId()):e.removeControl(this.calibrationToolButton.getId())),this.measureToolButton=null,this.calibrationToolButton=null}}b.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},a.MeasureExtension=d,b.theExtensionManager.registerExtension("Autodesk.Measure",d)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MeasureTool=function(a,b){function c(){A.updateLabelPositions()}function d(){i.clearMeasurement()}function e(){return!!Q&&Q.isActive()}function f(){A||(A=new h(j)),A.hide(),B&&!e()&&(B.setVisible(!0),B.updatePanel(),j.model&&j.model.is2d()&&B.isolate.setVisibility(!1),u?B.disableUnitOption(0):B.disableUnitOption())}function g(){A&&(A.hide(),A.destroy()),x={},B&&(B.setVisible(!1),B.updatePanel())}function h(a){function b(){j.impl.overlayScenes[p]||j.impl.createOverlayScene(p)}function c(a,b){if(a)for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];d&&b(d)}}function d(){K&&(j.impl.removeOverlay(p,K),K=null),L.length>0&&(j.impl.removeMultipleOverlays(p,L),L.length=0)}function f(){O.length>0&&(j.impl.removeMultipleOverlays(p,O),O.length=0)}function g(){R.length>0&&(j.impl.removeMultipleOverlays(p,R),R.length=0)}function h(){S.length>0&&(j.impl.removeMultipleOverlays(p,S),S.length=0)}var k=this,l=!1,m=.7,p="MeasureTool-common",q=null,x=null,y=null,A=null,B=null,D=null,E=null,F=null,G={first:{},second:{}},H={first:{},second:{}},I={first:{},second:{}},J={xyz:{axis:!1,color:"FF9900"},x:{axis:!0,color:"F12C2C"},y:{axis:!0,color:"0BB80B"},z:{axis:!0,color:"2C2CF1"}},K=null,L=[],N={},O=[],R=[],S=[],T=[];this.showFirstVertex=function(a){if(e())Q.updateCalibrationLine(a.x,a.y,a.z,a.x,a.y,a.z,1,!1,!0,s);else{var b=this.setScale(a);this.showEndPoint("first",a,b)}},this.showSecondVertex=function(a){if(!e()){var b=this.setScale(a);this.showEndPoint("second",a,b)}};var U=null;this.showEndPoint=function(a,c,d){q||(q=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:m,transparent:!0,depthTest:!1,depthWrite:!1})),b();var e=G[a],f=e.mesh;if(f||(U||(U=new THREE.SphereGeometry(1)),e.geometry=U,f=e.mesh=new THREE.Mesh(e.geometry,q),j.impl.addOverlay(p,f)),f.scale.x=d,f.scale.y=d,f.scale.z=d,f.position.set(c.x,c.y,c.z),f.visible=!0,j.impl.invalidate(!1,!1,!0),r||z){var g=e.label;if(!g){g=e.label=document.createElement("div"),g.className="measure-label",j.container.appendChild(g),g.style.pointerEvents="none";var h=document.createElement("div");h.className="adsk-icon-"+a+" measure-label-icon",g.appendChild(h)}g.classList.toggle("visible",!0),e.position=c.clone(),this.updateLabelPositions()}},this.setScale=function(a){var b=j.navigation,c=b.getCamera(),d=b.getEyeVector(),e=b.getPosition(),f=a.clone(),g=c.isPerspective?f.sub(e).dot(d.normalize()):b.getEyeVector().length(),h=b.getVerticalFov(),i=2*g*Math.tan(THREE.Math.degToRad(.5*h)),k=b.getScreenViewport(),l=window.devicePixelRatio||1;return 5*i/(k.height*l)},this.updateScale=function(){var a,b=this;c(G,function(a){var c=a.mesh;if(c){var d=b.setScale(c.position);c.scale.x=d,c.scale.y=d,c.scale.z=d}}),c(O,function(a){var b=this.setScale(a.geometry.vertices[0]);a.material.dashSize=4*b,a.material.gapSize=2*b}),c(H,function(a){c(a.line,function(a){b.setCylinderScale(a)})}),c(L,function(a){b.setCylinderScale(a)});for(var a in J)if(J.hasOwnProperty(a)){var d=J[a];d.line&&this.setCylinderScale(d.line)}},this.showFirstEdge=function(a,b){e()?Q.updateCalibrationLine(b.x,b.y,b.z,b.x,b.y,b.z,1,!1,!0,s):this.showEdge("first",a,b)},this.showSecondEdge=function(a,b){e()||this.showEdge("second",a,b)},this.showEdge=function(a,c,d){x||(x=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:m,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),b();var e=H[a];if(e.line&&j.impl.removeMultipleOverlays(p,e.line),e.line=this.drawEdgeAsCylinder(c,x,5,1),j.impl.addMultipleOverlays(p,e.line),r||z){var f=e.label;if(!f){f=e.label=document.createElement("div"),f.className="measure-label",j.container.appendChild(f),f.style.pointerEvents="none";var g=document.createElement("div");g.className="adsk-icon-"+a+" measure-label-icon",f.appendChild(g)}f.classList.toggle("visible",!0),e.intersectPoint=d.clone(),this.updateLabelPositions()}},this.drawEdgeAsCylinder=function(a,b,c,d){var e=[];if(1==d)for(var f=0;f<a.vertices.length;f+=2){var g=this.cylinderMesh(a.vertices[f],a.vertices[f+1],b,c);this.setCylinderScale(g),e.push(g)}else for(var f=0;f<a.vertices.length-1;f++){var g=this.cylinderMesh(a.vertices[f],a.vertices[f+1],b,c);this.setCylinderScale(g),e.push(g)}return e},this.drawLineAsCylinder=function(a,b,c){var d;return 2==a.vertices.length&&(d=this.cylinderMesh(a.vertices[0],a.vertices[1],b,c),this.setCylinderScale(d)),d};var V=null;this.cylinderMesh=function(a,b,c,d){var e=(new THREE.Vector3).subVectors(b,a),f=new THREE.Matrix4;f.lookAt(a,b,(new THREE.Object3D).up),f.multiply((new THREE.Matrix4).set(d,0,0,0,0,0,d,0,0,-e.length(),0,0,0,0,0,1)),V||(V=new THREE.CylinderGeometry(.1,.1,1,8,1,!0));var g=new THREE.Mesh(V,c);return g.applyMatrix(f),g.lmv_line_width=d,g.position.x=(b.x+a.x)/2,g.position.y=(b.y+a.y)/2,g.position.z=(b.z+a.z)/2,g},this.setCylinderScale=function(a){var b=this.setScale(a.position);a.hasOwnProperty("lmv_line_width")&&(b*=a.lmv_line_width),a.scale.x=b,a.scale.z=b},this.showFirstFace=function(a,b){this.showFace("first",a,b)},this.showSecondFace=function(a,b){this.showFace("second",a,b)},this.showFace=function(a,c,d){y||(y=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:m,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),b();var e=I[a];if(e.mesh&&j.impl.removeOverlay(p,e.mesh),e.mesh=new THREE.Mesh(c,y),j.impl.addOverlay(p,e.mesh),r||z){var f=e.label;if(!f){f=e.label=document.createElement("div"),f.className="measure-label",j.container.appendChild(f),f.style.pointerEvents="none";var g=document.createElement("div");g.className="adsk-icon-"+a+" measure-label-icon",f.appendChild(g)}f.classList.toggle("visible",!0),e.intersectPoint=d.clone(),this.updateLabelPositions()}},this.drawExtensionFace=function(a,c,d){E||(E=new THREE.MeshPhongMaterial({color:6737151,ambient:52479,opacity:.2,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),b();var e=new THREE.Mesh(a,E);e.position.set(c.x,c.y,c.z);var f=e.position.clone();f.add(d),e.lookAt(f),e.updateMatrixWorld(),R.push(e),j.impl.addOverlay(p,e)},this.drawGreyOutPlane=function(a){F||(F=new THREE.MeshPhongMaterial({color:0,ambient:0,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),b();var c=j.model.getMetadata("page_dimensions","page_width"),d=j.model.getMetadata("page_dimensions","page_height"),e=new THREE.Shape;e.moveTo(0,0),e.lineTo(c,0),e.lineTo(c,d),e.lineTo(0,d),e.lineTo(0,0);var f=P=j.model.getClip(a),g=f.contours[0],h=new THREE.Path;h.moveTo(f.points[g[0]].x,f.points[g[0]].y);for(var i=1;i<g.length;i++)h.lineTo(f.points[g[i]].x,f.points[g[i]].y);h.lineTo(f.points[g[0]].x,f.points[g[0]].y),e.holes.push(h);var k=new THREE.ShapeGeometry(e),l=new THREE.Mesh(k,F);S.push(l),j.impl.addOverlay(p,l)},this.getEdgeLength=function(a){for(var b=0,c=a.clone(),d=c.vertices,e=0;e<d.length;e+=2)j.model.is2d()&&j.model.pageToModel(d[e],d[e+1],M),b+=d[e].distanceTo(d[e+1]);return b=Autodesk.Viewing.Private.convertUnits(j.model.getUnitString(),u,w,b),Autodesk.Viewing.Private.formatValueWithUnits(b,u,3,v)},this.getCircularArcRadius=function(a){var b=a.radius;if(b){if(j.model.is2d()){var c=a.center.clone(),d=a.vertices[0].clone();j.model.pageToModel(c,d,M),b=c.distanceTo(d)}return b=Autodesk.Viewing.Private.convertUnits(j.model.getUnitString(),u,w,b),Autodesk.Viewing.Private.formatValueWithUnits(b,u,3,v)}},this.getFaceArea=function(a){for(var b=0,c=a.vertices,d=new THREE.Vector3,e=new THREE.Vector3,f=0;f<c.length;f+=3)d.subVectors(c[f+1],c[f]),e.subVectors(c[f+2],c[f]),b+=d.length()*e.length()*Math.sin(d.angleTo(e))/2;return b=Autodesk.Viewing.Private.convertUnits(j.model.getUnitString(),u,w,b,"square"),u?Autodesk.Viewing.Private.formatValueWithUnits(b,u+"^2",3,v):Autodesk.Viewing.Private.formatValueWithUnits(b,null,3,v)},this.updateLabels=function(){s===SNAP_EDGE?H.first.label.children[0].textContent=this.getEdgeLength(n):s===SNAP_FACE&&(I.first.label.children[0].textContent=this.getFaceArea(n)),t===SNAP_EDGE?H.second.label.children[0].textContent=this.getEdgeLength(o):t===SNAP_FACE&&(I.second.label.children[0].textContent=this.getFaceArea(o))},this.updateLabelPositions=function(){function a(a,b,c){var d=j.navigation.getCamera(),e=j.navigation.getScreenViewport(),f=new THREE.Vector3(a,b,c);return f=f.project(d),{x:Math.round((f.x+1)/2*e.width)+5,y:Math.round((1-f.y)/2*e.height)+5}}
for(var b in J)if(J.hasOwnProperty(b)){var c=J[b],d=c.label;if(d){var e=a((c.p1.x+c.p2.x)/2,(c.p1.y+c.p2.y)/2,(c.p1.z+c.p2.z)/2);d.style.top=e.y+"px",d.style.left=e.x+"px",T.push(d)}}if(N&&(d=N.label)){var e=a((N.p1.x+N.p2.x)/2,(N.p1.y+N.p2.y)/2,(N.p1.z+N.p2.z)/2);d.style.top=e.y+"px",d.style.left=e.x+"px",T.push(d)}for(var b in I)if(I.hasOwnProperty(b)){var f=I[b],d=f.label,g=f.intersectPoint;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",T.push(d)}}for(var b in H)if(H.hasOwnProperty(b)){var h=H[b],d=h.label,g=h.intersectPoint;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",T.push(d)}}for(var b in G)if(G.hasOwnProperty(b)){var i=G[b],d=i.label,g=i.position;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",T.push(d)}}for(var k=0;k<T.length;k++)for(var l=0;l<k;l++)this.labelsOverlapDetection(T[l],T[k]);T=[]},this.labelsOverlapDetection=function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect();d.top<=c.bottom&&d.bottom>=c.top&&(d.right>=c.left&&d.right<=c.right?b.style.left=parseInt(b.style.left,10)-(d.right-c.left)+"px":d.left>=c.left&&d.left<=c.right?b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px":d.left<=c.left&&d.right>=c.right&&(b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px"))},this.drawLine=function(a,c,d){function f(a,c,d,e,f,g,h,i){var n=J[a],o=n.line,q=n.label,s=new THREE.Vector3(c,d,e),t=new THREE.Vector3(f,g,h);if(o&&(j.impl.removeOverlay(p,o),n.line=null),q&&q.classList.remove("visible"),s.distanceTo(t)>=Math.pow(.1,v)&&i){var u="xyz"===a||!l&&r;o||(n.material=new THREE.MeshBasicMaterial({color:parseInt(n.color,16),depthTest:!1,depthWrite:!1}),b()),n.material.opacity=r?1:m;var w=n.geometry=new THREE.Geometry;w.vertices.push(s),w.vertices.push(t);var x="xyz"===a?5:"z"===a?1:2;if(o=n.line=k.drawLineAsCylinder(w,n.material,x),j.impl.addOverlay(p,o),o.visible=u,n.p1=s,n.p2=t,"xyz"!=a||r){if(!q){if(q=n.label=document.createElement("div"),q.className="measure-length","xyz"===a){var y=document.createElement("div");y.className="measure-length-text",q.appendChild(y)}q.style.pointerEvents="none",n.axis&&(q.className="adsk-icon-axis-"+a+" measure-label-axis measure-label-axis-"+a),j.container.appendChild(q)}n.axis||k.updateDistance(),q.classList.toggle("visible",u)}}}if(e())Q.updateCalibrationLine(a.x,a.y,a.z,c.x,c.y,c.z,v,r,C.isSnapped(),s);else{f("xyz",a.x,a.y,a.z,c.x,c.y,c.z,!0);var g=j.navigation.getAlignedUpVector(),h=Math.abs(g.x),i=Math.abs(g.y),n=Math.abs(g.z),o=!d&&function(a,b){var c=Math.pow(.1,v);return!(Math.abs(a.x-b.x)>=c&&Math.abs(a.y-b.y)<c&&Math.abs(a.z-b.z)<c||Math.abs(a.y-b.y)>=c&&Math.abs(a.x-b.x)<c&&Math.abs(a.z-b.z)<c||Math.abs(a.z-b.z)>=c&&Math.abs(a.x-b.x)<c&&Math.abs(a.y-b.y)<c)}(a,c);n>h&&n>i?(f("x",a.x,a.y,a.z,c.x,a.y,a.z,o),f("y",c.x,a.y,a.z,c.x,c.y,a.z,o),f("z",c.x,c.y,a.z,c.x,c.y,c.z,o)):i>h&&i>n?(f("x",a.x,a.y,a.z,c.x,a.y,a.z,o),f("z",c.x,a.y,a.z,c.x,a.y,c.z,o),f("y",c.x,a.y,c.z,c.x,c.y,c.z,o)):(f("y",a.x,a.y,a.z,a.x,c.y,a.z,o),f("z",a.x,c.y,a.z,a.x,c.y,c.z,o),f("x",a.x,c.y,c.z,c.x,c.y,c.z,o))}this.updateLabelPositions()},this.updateDistance=function(){var a=J.xyz.label;a&&(a.children[0].textContent="~ "+i.getDistance("xyz"))},this.updateAngle=function(){var a=N.label;a&&(a.children[0].textContent="~ "+i.getAngle())},this.drawExtensionLine=function(a,c,d){var e,f,g,h,i=new THREE.Vector3,k=new THREE.Vector3;if(i.subVectors(c,a),k.subVectors(d,c),h=i.dot(k),i.subVectors(d,c),h=-h/i.dot(i),i.subVectors(d,c),i.multiplyScalar(h),g=i.add(c),h<0)e=c,f=g;else{if(!(h>1))return;e=d,f=g}D||(D=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1})),b(),D.opacity=r?1:m;var l=this.setScale(e);D.dashSize=4*l,D.gapSize=2*l;var n=new THREE.Geometry;n.vertices.push(e),n.vertices.push(f),n.computeLineDistances();var o=new THREE.Line(n,D);O.push(o),j.impl.addOverlay(p,o)},this.drawExtensionLinePointToPoint=function(a,c){var d=a,e=c;D||(D=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1})),b(),D.opacity=r?1:m;var f=this.setScale(d);D.dashSize=4*f,D.gapSize=2*f;var g=new THREE.Geometry;g.vertices.push(d),g.vertices.push(e),g.computeLineDistances();var h=new THREE.Line(g,D);O.push(h),j.impl.addOverlay(p,h)},this.nearestPointsInSegmentToSegment=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3;e.subVectors(b,a),f.subVectors(d,c),g.subVectors(a,c);var h,i,j,k,l=e.dot(e),m=e.dot(f),n=f.dot(f),o=e.dot(g),p=f.dot(g),q=l*n-m*m,r=q,s=q;return q<.001?(i=0,r=1,k=p,s=n):(i=m*p-n*o,k=l*p-m*o,i<0?(i=0,k=p,s=n):i>r&&(i=r,k=p+m,s=n)),k<0?(k=0,-o<0?i=0:-o>l?i=r:(i=-o,r=l)):k>s&&(k=s,-o+m<0?i=0:-o+m>l?i=r:(i=-o+m,r=l)),h=Math.abs(i)<.001?0:i/r,j=Math.abs(k)<.001?0:k/s,e.multiplyScalar(h),f.multiplyScalar(j),g.add(e),g.sub(f),e.add(a),f.add(c),[e,f]},this.edgeToEdgeMeasure=function(a,b,c){var d=C.getEndPointsInEdge(a),f=d[0].clone(),g=d[1].clone();d=C.getEndPointsInEdge(b);var h=d[0].clone(),i=d[1].clone(),j=this.nearestPointInPointToLine(f,h,i),k=this.nearestPointInPointToLine(g,h,i),l=new THREE.Vector3,m=new THREE.Vector3;if(l.subVectors(f,g),m.subVectors(h,i),l.normalize(),m.normalize(),this.isEqualVectors(l,m,.01)||this.isInverseVectors(l,m,.01)||e())return f.distanceTo(c)<=g.distanceTo(c)?(this.drawLine(f,j),this.drawExtensionLine(f,h,i),[f,j]):(this.drawLine(g,k),this.drawExtensionLine(g,h,i),[g,k]);var n=this.nearestPointInPointToLine(c,f,g),o=this.angleVectorToVector(l,m);return f.distanceTo(h)<f.distanceTo(i)&&f.distanceTo(h)<g.distanceTo(h)&&f.distanceTo(h)<g.distanceTo(i)?this.drawAngleLineToLine(f,n,h,i,o):f.distanceTo(i)<f.distanceTo(h)&&f.distanceTo(i)<g.distanceTo(h)&&f.distanceTo(i)<g.distanceTo(i)?this.drawAngleLineToLine(f,n,i,h,o):g.distanceTo(h)<f.distanceTo(h)&&g.distanceTo(h)<f.distanceTo(i)&&g.distanceTo(h)<g.distanceTo(i)?this.drawAngleLineToLine(g,n,h,i,o):this.drawAngleLineToLine(g,n,i,h,o),o},this.curvedEdgeToEdgeMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=null,e=null,f=a.vertices,g=C.getEndPointsInEdge(b),h=0;h<f.length;h+=2){var i=this.nearestPointsInSegmentToSegment(f[h],f[h+1],g[0],g[1]),j=i[0].distanceTo(i[1]);j<c&&(c=j,d=i[0],e=i[1])}return this.drawLine(d,e),[d,e]},this.curvedEdgeToCurvedEdgeMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=null,e=null,f=a.vertices,g=b.vertices,h=0;h<f.length;h+=2)for(var i=0;i<g.length;i+=2){var j=this.nearestPointsInSegmentToSegment(f[h],f[h+1],g[i],g[i+1]),k=j[0].distanceTo(j[1]);k<c&&(c=k,d=j[0],e=j[1])}return this.drawLine(d,e),[d,e]},this.nearestPointInPointToSegment=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),e<0?d=b:e>1?d=c:(f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)),d},this.nearestPointInPointToLine=function(a,b,c){var d,e=new THREE.Vector3,f=new THREE.Vector3;return e.subVectors(b,a),f.subVectors(c,b),d=e.dot(f),e.subVectors(c,b),d=-d/e.dot(e),e.subVectors(c,b),e.multiplyScalar(d),e.add(b)},this.pointToEdgeMeasure=function(a,b,c){var d=C.getEndPointsInEdge(b),e=d[0],f=d[1],g=this.nearestPointInPointToLine(a,e,f),h=this.nearestPointInPointToLine(c,e,f),i=new THREE.Vector3;return i.subVectors(h,g),i.add(a),this.drawLine(i,h),this.drawExtensionLinePointToPoint(a,i),[a,g]},this.edgeToPointMeasure=function(a,b){var c=C.getEndPointsInEdge(a),d=c[0],e=c[1],f=this.nearestPointInPointToLine(b,d,e);return this.drawLine(b,f),this.drawExtensionLine(b,d,e),[b,f]},this.curvedEdgeToVertexMeasure=function(a,b){for(var c=a.vertices,d=Number.MAX_VALUE,e=null,f=0;f<c.length;f+=2){var g=this.nearestPointInPointToSegment(b,c[f],c[f+1]),h=b.distanceTo(g);h<d&&(d=h,e=g)}return this.drawLine(b,e),[b,e]},this.faceToFaceMeasure=function(a,b,c,d){var e=b.clone(),f=d.clone(),g=this.angleVectorToVector(b,d);if(e.x<=f.x+.01&&e.x>=f.x-.01&&e.y<=f.y+.01&&e.y>=f.y-.01&&e.z<=f.z+.01&&e.z>=f.z-.01||e.x<=.01-f.x&&e.x>=-f.x-.01&&e.y<=.01-f.y&&e.y>=-f.y-.01&&e.z<=.01-f.z&&e.z>=-f.z-.01){var h=new THREE.Vector3;h.subVectors(a,c);var i=e.dot(h)/e.dot(f);h.addVectors(c,f.multiplyScalar(i));var j=2*h.distanceTo(a),k=new THREE.PlaneBufferGeometry(j,j);return this.drawExtensionFace(k,a,b),this.drawLine(c,h,!0),[c,h,g]}return g=this.drawAngleFaceToFace(a,b,c,d)},this.angleVectorToVector=function(a,b){return 180*a.angleTo(b)/Math.PI},this.intersectPlaneToPlane=function(a,b,c,d){var e=new THREE.Vector3;e.crossVectors(b,d);var f,g=e.x>=0?e.x:-e.x,h=e.y>=0?e.y:-e.y,i=e.z>=0?e.z:-e.z;f=g>h?g>i?1:3:h>i?2:3;var j,k,l=new THREE.Vector3;switch(j=-b.dot(a),k=-d.dot(c),f){case 1:l.x=0,0!==e.x?(l.y=(k*b.z-j*d.z)/e.x,l.z=(j*d.y-k*b.y)/e.x):(l.y=-(k*b.z)/(b.z*d.y),l.z=-(j*d.y)/(b.z*d.y));break;case 2:l.y=0,0!==e.y?(l.x=(j*d.z-k*b.z)/e.y,l.z=(k*b.x-j*d.x)/e.y):(l.x=-(j*d.z)/(b.x*d.z),l.z=-(k*b.x)/(b.x*d.z));break;case 3:l.z=0,0!==e.z?(l.x=(k*b.y-j*d.y)/e.z,l.y=(j*d.x-k*b.x)/e.z):(l.x=-(k*b.y)/(b.y*d.x),l.y=-(j*d.x)/(b.y*d.x))}var m=new THREE.Vector3;return m.addVectors(l,e.multiplyScalar(100)),[this.nearestPointInPointToLine(a,l,m),this.nearestPointInPointToLine(c,l,m)]},this.drawAngle=function(a,c,e,f,g,h){A||(A=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),B=new THREE.MeshBasicMaterial({color:16750848,depthTest:!1,depthWrite:!1})),b(),d();var i=a.distanceTo(c),k=new THREE.CircleGeometry(i,100,0,g*Math.PI/180),l=new THREE.Mesh(k,A),m=l.geometry.vertices[0].clone();l.geometry.vertices.push(m),l.position.set(a.x,a.y,a.z);var n=l.position.clone();n.add(f),l.lookAt(n),l.updateMatrixWorld();var o=l.geometry.vertices[1].clone(),q=l.geometry.vertices[l.geometry.vertices.length-2].clone();o.applyMatrix4(l.matrixWorld),q.applyMatrix4(l.matrixWorld);var r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3;r.subVectors(o,a),s.subVectors(q,a),t.subVectors(c,a),u.subVectors(e,a);var v,w=r.angleTo(t),x=r.angleTo(u),y=s.angleTo(t),z=s.angleTo(u);v=(w<=.001&&w>=-.001||x<=.001&&x>=-.001)&&(y<=.001&&y>=-.001||z<=.001&&z>=-.001)?0:(w<=Math.PI+.001&&w>=Math.PI-.001||x<=Math.PI+.001&&x>=Math.PI-.001)&&(y<=Math.PI+.001&&y>=Math.PI-.001||z<=Math.PI+.001&&z>=Math.PI-.001)?Math.PI:w<=y+.001&&w>=y-.001||w<=z+.001&&w>=z-.001?w:x;var C=new THREE.Matrix4;if(C.makeRotationAxis(f,v),C.multiply(l.matrix),l.matrix=C,l.rotation.setFromRotationMatrix(l.matrix),l.updateMatrixWorld(),o=l.geometry.vertices[1].clone(),q=l.geometry.vertices[l.geometry.vertices.length-2].clone(),o.applyMatrix4(l.matrixWorld),q.applyMatrix4(l.matrixWorld),r.subVectors(o,a),s.subVectors(q,a),w=r.angleTo(t),x=r.angleTo(u),y=s.angleTo(t),z=s.angleTo(u),w>=.001&&x>=.001){var C=new THREE.Matrix4;C.makeRotationAxis(f,2*-v),C.multiply(l.matrix),l.matrix=C,l.rotation.setFromRotationMatrix(l.matrix)}var D=new THREE.CircleGeometry(.9*i,100,0,g*Math.PI/180);D.vertices.splice(0,1),l.updateMatrixWorld(),D.applyMatrix(l.matrixWorld);var E=this.drawEdgeAsCylinder(D,B,2.5,0),F=new THREE.Geometry,G=new THREE.Geometry;F.vertices.push(l.geometry.vertices[0].clone(),l.geometry.vertices[1].clone()),G.vertices.push(l.geometry.vertices[0].clone(),l.geometry.vertices[l.geometry.vertices.length-2].clone()),F.applyMatrix(l.matrixWorld),G.applyMatrix(l.matrixWorld);var H=this.drawLineAsCylinder(F,B,2.5),I=this.drawLineAsCylinder(G,B,2.5);K=l,L=E.concat([H,I]),j.impl.addOverlay(p,K),j.impl.addMultipleOverlays(p,L),h.copy(l.geometry.vertices[Math.round(l.geometry.vertices.length/2)-1]),h.applyMatrix4(l.matrixWorld)},this.drawAngleFaceToFace=function(a,b,c,d){var e=this.intersectPlaneToPlane(a,b,c,d),f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(a,e[0]),g.subVectors(c,e[1]);var h=this.angleVectorToVector(f,g),k=e[0].clone(),l=new THREE.Vector3;l.crossVectors(b,d),l.normalize(),e=this.intersectPlaneToPlane(a,b,k,l);var m=e[0].clone();e=this.intersectPlaneToPlane(c,d,k,l);var n=e[0].clone(),o=new THREE.Vector3;if(this.drawAngle(k,m,n,l,h,o),r){var p=N.label;if(!p){p=N.label=document.createElement("div"),p.className="measure-length",j.container.appendChild(p);var q=document.createElement("div");q.className="measure-length-text",p.appendChild(q),p.style.pointerEvents="none"}p.children[0].textContent=i.getAngle(),p.classList.toggle("visible",!0),N.p1=o.clone(),N.p2=o.clone(),this.updateLabelPositions()}return h},this.drawAngleLineToLine=function(a,b,c,d,e){var f=a,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3;h.subVectors(a,b),k.subVectors(c,d),g.crossVectors(h,k),g.normalize();var l=b,m=new THREE.Vector3;m.subVectors(f,c),m.add(d);var n=new THREE.Vector3;if(this.drawAngle(f,l,m,g,e,n),r){var o=N.label;if(!o){o=N.label=document.createElement("div"),o.className="measure-length",j.container.appendChild(o);var p=document.createElement("div");p.className="measure-length-text",o.appendChild(p),o.style.pointerEvents="none"}o.children[0].textContent=i.getAngle(),o.classList.toggle("visible",!0),N.p1=n.clone(),N.p2=n.clone(),this.updateLabelPositions()}},this.intersectLineToLine=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3;e.subVectors(c,a),e.cross(d),f.crossVectors(b,d);var g=e.divide(f);return f=b.clone(),f.multiplyScalar(g),e.addVectors(a,f),e},this.nearestPointInPointToPlane=function(a,b,c){var d=new THREE.Vector3,e=c.clone(),f=new THREE.Vector3;f.subVectors(a,b);var g=-e.dot(f),h=e.dot(e),i=g/h;return d.addVectors(a,e.multiplyScalar(i)),d},this.faceToPointMeasure=function(a,b,c,d){var e=a.vertices[0],f=this.nearestPointInPointToPlane(d,e,b),g=c.clone(),h=new THREE.Vector3;h.subVectors(g,f),h.add(d);var i=2*f.distanceTo(c),j=new THREE.PlaneBufferGeometry(i,i);return this.drawExtensionFace(j,c,b),this.drawLine(d,f),[d,f]},this.nearestPointInPointToTriangle=function(a,b,c,d){var e,f=Number.MAX_VALUE;if(e=this.pointProjectsInTriangle(a,b,c,d))return e;var g=this.nearestPointInPointToSegment(a,b,c);return a.distanceTo(g)<f&&(f=a.distanceTo(g),e=g.clone()),g=this.nearestPointInPointToSegment(a,b,d),a.distanceTo(g)<f&&(f=a.distanceTo(g),e=g.clone()),g=this.nearestPointInPointToSegment(a,c,d),a.distanceTo(g)<f&&(e=g.clone()),e},this.pointToFaceMeasure=function(a,b,c,d){var e=b.vertices[0],f=this.nearestPointInPointToPlane(a,e,c),g=d.clone(),h=new THREE.Vector3;return h.subVectors(g,f),h.add(a),this.drawLine(g,h),this.drawExtensionLinePointToPoint(a,h),[a,f]},this.curvedFaceToVertexMeasure=function(a,b){for(var c,d=Number.MAX_VALUE,e=a.vertices,f=0;f<e.length;f+=3){var g=this.nearestPointInPointToTriangle(b,e[f],e[f+1],e[f+2]);b.distanceTo(g)<d&&(d=b.distanceTo(g),c=g)}return this.drawLine(c,b),[c,b]},this.pointProjectsInTriangle=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;e.subVectors(c,b),f.subVectors(d,b),h.crossVectors(e,f),g.subVectors(a,b),e.cross(g);var i=e.dot(h)/h.dot(h);g.cross(f);var c=g.dot(h)/h.dot(h),b=1-i-c;if(b>=0&&b<=1&&c>=0&&c<=1&&i>=0&&i<=1){var j=THREE.Triangle.normal(b,c,d);return this.nearestPointInPointToPlane(a,b,j)}},this.nearestPointsInLineSegmentToTriangle=function(a,b,c,d,e){var f,g,h=[],i=Number.MAX_VALUE,j=this.pointProjectsInTriangle(a,c,d,e);j&&a.distanceTo(j)<i&&(i=a.distanceTo(j),h[0]=a,h[1]=j);var k=this.pointProjectsInTriangle(b,c,d,e);k&&b.distanceTo(k)<i&&(i=b.distanceTo(k),h[0]=b,h[1]=k),f=c,g=d;var l=this.nearestPointsInSegmentToSegment(a,b,f,g);return l[0].distanceTo(l[1])<i&&(i=l[0].distanceTo(l[1]),h[0]=l[0].clone(),h[1]=l[1].clone()),f=c,g=e,l=this.nearestPointsInSegmentToSegment(a,b,f,g),l[0].distanceTo(l[1])<i&&(i=l[0].distanceTo(l[1]),h[0]=l[0].clone(),h[1]=l[1].clone()),f=d,g=e,l=this.nearestPointsInSegmentToSegment(a,b,f,g),l[0].distanceTo(l[1])<i&&(h[0]=l[0].clone(),h[1]=l[1].clone()),h},this.nearestPointsInEdgeToFace=function(a,b,c){for(var d=[],e=Number.MAX_VALUE,f=0;f<c.vertices.length;f+=3){var g=this.nearestPointsInLineSegmentToTriangle(a,b,c.vertices[f],c.vertices[f+1],c.vertices[f+2]);g[0].distanceTo(g[1])<e&&(e=g[0].distanceTo(g[1]),d=g)}return d},this.nearestPointsInTriangleToTriangle=function(a,b,c,d,e,f){function g(a,b,c,d){var e=i.pointProjectsInTriangle(a,b,c,d);e&&a.distanceTo(e)<k&&(k=a.distanceTo(e),j[0]=a,j[1]=e)}function h(a,b,c,d){var e=i.nearestPointsInSegmentToSegment(a,b,c,d);e[0].distanceTo(e[1])<k&&(k=e[0].distanceTo(e[1]),j=e)}var i=this,j=[],k=Number.MAX_VALUE;return g(a,d,e,f),g(b,d,e,f),g(c,d,e,f),g(d,a,b,c),g(e,a,b,c),g(f,a,b,c),h(a,b,d,e),h(a,b,d,f),h(a,b,e,f),h(a,c,d,e),h(a,c,d,f),h(a,c,e,f),h(b,c,d,e),h(b,c,d,f),h(b,c,e,f),j},this.curvedEdgeToFaceMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=[],e=a.vertices,f=0;f<e.length;f+=2){var g=this.nearestPointsInEdgeToFace(e[f],e[f+1],b);g[0].distanceTo(g[1])<c&&(c=g[0].distanceTo(g[1]),d=g)}return this.drawLine(d[0],d[1]),[d[0],d[1]]},this.curvedFaceToFaceMeasure=function(a,b){var c=Number.MAX_VALUE,d=[],e=a.vertices,f=b.vertices;a.computeBoundingSphere(),b.computeBoundingSphere();var g=new THREE.Sphere,h=new THREE.Sphere,i=[],j=Number.MAX_VALUE,k=[],l=[];a.bSpheres=[],b.bSpheres=[];for(var m=0;m<e.length;m+=3){g.setFromPoints([e[m],e[m+1],e[m+2]]),a.bSpheres.push(g.clone());var n=g.center.distanceTo(b.boundingSphere.center)+g.radius+b.boundingSphere.radius;n<j&&(j=n)}for(var m=0;m<e.length;m+=3){g=a.bSpheres[m/3];var o=g.center.distanceTo(b.boundingSphere.center)-g.radius-b.boundingSphere.radius;o<=j&&k.push(m)}j=Number.MAX_VALUE;for(var p=0;p<f.length;p+=3){h.setFromPoints(f[p],f[p+1],f[p+2]),b.bSpheres.push(h.clone());var n=h.center.distanceTo(a.boundingSphere.center)+h.radius+a.boundingSphere.radius;n<j&&(j=n)}for(var p=0;p<f.length;p+=3){h=b.bSpheres[p/3];var o=h.center.distanceTo(a.boundingSphere.center)-h.radius-a.boundingSphere.radius;o<=j&&l.push(p)}j=Number.MAX_VALUE;for(var m=0;m<k.length;m++){g=a.bSpheres[k[m]/3];for(var p=0;p<l.length;p++){h=b.bSpheres[l[p]/3];var o=g.center.distanceTo(h.center)-g.radius-h.radius,n=g.center.distanceTo(h.center)+g.radius+h.radius;n<j&&(j=n,i.push({i:k[m],j:l[p],value:o}))}}for(var q=0;q<i.length;q++)if(i[q].value<=j&&i[q].value<c){var r=this.nearestPointsInTriangleToTriangle(e[i[q].i],e[i[q].i+1],e[i[q].i+2],f[i[q].j],f[i[q].j+1],f[i[q].j+2]);r[0].distanceTo(r[1])<c&&(c=r[0].distanceTo(r[1]),d=r)}return this.drawLine(d[0],d[1]),[d[0],d[1]]},this.faceToEdgeMeasure=function(a,b,c,d,e){var f,g,h=C.getEndPointsInEdge(d);h[0].distanceTo(c)<h[1].distanceTo(c)?(f=h[0],g=h[1]):(f=h[1],g=h[0]);var i=new THREE.Vector3;i.subVectors(g,f);var j=this.angleLineToPlane(i,b);if(i.dot(b)<=.01&&i.dot(b)>=-.01){var k=a.vertices[0],l=this.nearestPointInPointToPlane(f,k,b),m=this.nearestPointInPointToLine(e,f,g);return this.faceToPointMeasure(a,b,c,m),[f,l,j]}var n=this.nearestPointInPointToLine(e,f,g);return this.drawAngleEdgeToFace(a.vertices[0],b,c,f,n,j),j},this.edgeToFaceMeasure=function(a,b,c,d,e){var f,g,h=C.getEndPointsInEdge(a);h[0].distanceTo(e)<h[1].distanceTo(e)?(f=h[0],g=h[1]):(f=h[1],g=h[0]);var i=new THREE.Vector3;i.subVectors(g,f);var j=this.angleLineToPlane(i,d);if(i.dot(d)<=.01&&i.dot(d)>=-.01){var k=c.vertices[0],l=this.nearestPointInPointToPlane(f,k,d),m=new THREE.Vector3;m.subVectors(e,l),m.add(f);var n=new THREE.Vector3;return n.subVectors(e,l),n.add(g),this.drawLine(m,e),this.drawExtensionLinePointToPoint(m,n),[f,l,j]}var o=this.nearestPointInPointToLine(b,f,g);return this.drawAngleEdgeToFace(c.vertices[0],d,e,f,o,j),j},this.angleLineToPlane=function(a,b){var c=this.angleVectorToVector(a,b);return c>90?c-=90:c=90-c,c},this.drawAngleEdgeToFace=function(a,b,c,d,e,f){var g=this.intersectPointLineToPlane(a,b,d,e);if(g){var h=e;if(90===f)var k=c.clone();else var k=this.nearestPointInPointToPlane(e,a,b);var l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3;m.subVectors(e,d),n.subVectors(k,g),l.crossVectors(m,n),l.normalize();var o=new THREE.Vector3;if(this.drawAngle(g,h,k,l,f,o),r){var p=N.label;if(!p){p=N.label=document.createElement("div"),p.className="measure-length",j.container.appendChild(p);var q=document.createElement("div");q.className="measure-length-text",p.appendChild(q),p.style.pointerEvents="none"}p.children[0].textContent=i.getAngle(),p.classList.toggle("visible",!0),N.p1=o.clone(),N.p2=o.clone(),this.updateLabelPositions()}}},this.intersectPointLineToPlane=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3;e.subVectors(d,c),f.subVectors(c,a);var g=b.dot(e),h=-b.dot(f);return Math.abs(g)<.001?null:(e.multiplyScalar(h/g),e.add(c),e)},this.nearestVertexInVertexToEdge=function(a,b){for(var c,d=Number.MAX_VALUE,e=0;e<b.vertices.length;e++){var f=a.distanceTo(b.vertices[e]);d>f&&(c=b.vertices[e],d=f)}return c},this.isEqualVectors=function(a,b,c){return Math.abs(a.x-b.x)<=c&&Math.abs(a.y-b.y)<=c&&Math.abs(a.z-b.z)<=c},this.isInverseVectors=function(a,b,c){return Math.abs(a.x+b.x)<=c&&Math.abs(a.y+b.y)<=c&&Math.abs(a.z+b.z)<=c},this.setSimple=function(a){if(l!=a){l=a;for(var b in J)if("xyz"!==b&&J.hasOwnProperty(b)){var c=J[b];c.line&&(c.line.visible=!a,c.label&&c.label.classList.toggle("visible",!a))}j.impl.invalidate(!1,!1,!0)}},this.hide=function(){var a;for(a in G)if(G.hasOwnProperty(a)){var b=G[a];b.mesh&&(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible")}for(a in H)if(H.hasOwnProperty(a)){var c=H[a];if(c.line)for(var e in c.line)c.line[e].visible=!1;c.label&&c.label.classList.remove("visible")}for(a in I)if(I.hasOwnProperty(a)){var i=I[a];i.mesh&&(i.mesh.visible=!1),i.label&&i.label.classList.remove("visible")}for(a in J)if(J.hasOwnProperty(a)){var k=J[a];k.line&&(k.line.visible=!1),k.label&&k.label.classList.remove("visible")}N.label&&N.label.classList.remove("visible"),d(),D&&f(),E&&g(),F&&h(),j.impl.invalidate(!1,!1,!0)},this.hideClick=function(a){if(G.hasOwnProperty(a)){var b=G[a];b.mesh&&(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible")}if(H.hasOwnProperty(a)){var c=H[a];if(c.line)for(var e in c.line)c.line[e].visible=!1;c.label&&c.label.classList.remove("visible")}if(I.hasOwnProperty(a)){var h=I[a];h.mesh&&(h.mesh.visible=!1),h.label&&h.label.classList.remove("visible")}for(var i in J)if(J.hasOwnProperty(i)){var k=J[i];k.line&&(k.line.visible=!1),k.label&&k.label.classList.remove("visible")}N.label&&N.label.classList.remove("visible"),d(),D&&f(),E&&g(),j.impl.invalidate(!1,!1,!0)},this.destroy=function(){var a;for(a in G)if(G.hasOwnProperty(a)){var b=G[a];b.mesh&&(j.impl.removeOverlay(p,b.mesh),b.mesh=b.geometry=null),b.label&&(b.label.parentNode.removeChild(b.label),b.label=null)}for(a in H)if(H.hasOwnProperty(a)){var c=H[a];c.line&&(j.impl.removeMultipleOverlays(p,c.line),c.line=c.intersectPoint=null),c.label&&(c.label.parentNode.removeChild(c.label),c.label=null)}for(a in I)if(I.hasOwnProperty(a)){var e=I[a];e.mesh&&(j.impl.removeOverlay(p,e.mesh),e.mesh=e.intersectPoint=null),e.label&&(e.label.parentNode.removeChild(e.label),e.label=null)}q=null,y=null,x=null,A=null,D=null,f(),E=null,g(),F=null,h();for(a in J)if(J.hasOwnProperty(a)){var i=J[a];i.line&&(j.impl.removeOverlay(p,i.line),i.material=i.line=i.geometry=null),i.label&&(i.label.parentNode.removeChild(i.label),i.label=null),i.material=i.line=i.geometry=i.label=i.p1=i.p2=null}d(),N.label&&(N.label.parentNode.removeChild(N.label),N.label=null),N.label=N.p1=N.p2=null,U&&U.dispose(),V&&V.dispose(),j.impl.overlayScenes[p]&&j.impl.removeOverlayScene(p)}}var i=this,j=a,k=b||{},l=["measure"],m=!1,n=null,o=null,p=!1,q=0,r=!1,s=null,t=null,u="",v=null,w=k.calibrationFactor?k.calibrationFactor:1,x={},y=0,z=!1,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=Autodesk.Viewing.Private.GuiViewer3D&&a instanceof Autodesk.Viewing.Private.GuiViewer3D,P=null,Q=null,R=!1;this.register=function(){if(O&&!B&&(B=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(i,j,"measure-panel","Measure",b),j.addPanel(B)),!C){var c=k?k.snapperOptions:null;C=new Autodesk.Viewing.Extensions.Measure.Snapper(a,c),j.toolController.registerTool(C)}J||(J=new Autodesk.Viewing.Extensions.Measure.MagnifyingGlass(a),j.toolController.registerTool(J)),Q||(Q=new Autodesk.Viewing.Extensions.Measure.CalibrationTool(a,i,C,b),j.toolController.registerTool(Q))},this.deregister=function(){this.deactivate(),B&&(j.removePanel(B),B.uninitialize()),j.toolController.deregisterTool(C),j.toolController.deregisterTool(J),C=null,J=null},this.isActive=function(){return m},this.getNames=function(){return l},this.getName=function(){return l[0]},this.getCursor=function(){return p||e()?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), auto"},this.activate=function(){m=!0,q=0,p=!1,u||(u=j.model.getDisplayUnit()),null===v&&(v=j.model&&j.model.is2d()?3:1),f(),j.clearSelection(),j.toolController.activateTool("snapper"),j.toolController.activateTool("magnifyingGlass"),j.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c),j.addEventListener(Autodesk.Viewing.RESET_EVENT,d)},this.deactivate=function(){m=!1,n=o=null,x={},this.clearMeasurement(),g(),C&&C.isActive()&&j.toolController.deactivateTool("snapper"),J&&J.isActive()&&j.toolController.deactivateTool("magnifyingGlass"),j.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c),j.removeEventListener(Autodesk.Viewing.RESET_EVENT,d)},this.update=function(){return!1},this.enableCalibrate=function(a){C.enableCalibrate(a)},this.getUnits=function(){return u},this.setUnits=function(a){u!==a&&(u=a,A&&A.updateDistance())},this.getPrecision=function(){return v},this.setPrecision=function(a){v!==a&&(v=a,A&&A.updateDistance())},this.setCalibrationFactor=function(a){w=a},this.getDistance=function(a){if(j.model){var b=Autodesk.Viewing.Private.convertUnits(j.model.getUnitString(),u,w,x[a]||0);return Autodesk.Viewing.Private.formatValueWithUnits(b,u,3,v)}},this.getAngle=function(){return Autodesk.Viewing.Private.formatValueWithUnits(y,String.fromCharCode(176),3,v)},this.isCalibrated=function(){return Q.isCalibrated()},this.getMeasurement=function(a,b){u=a||u,v=b||v;var c=["Vertex","Edge","Face","Circular Arc","Curved Edge","Curved Face"];return{from:c[this.getFirstGeometry().type],to:c[this.getSecondGeometry().type],distance:this.getDistance("xyz"),deltaX:this.getDistance("x"),deltaY:this.getDistance("y"),deltaZ:this.getDistance("z"),angle:this.getAngle(),unitType:u,precision:v}},this.clearMeasurement=function(){n=o=null,s=t=null,K=L=null,M=N=null,q=1,x={},y=0,P=null,A&&A.hide(),B&&(B.updatePanel(),B.hideMeasureResult(),B.isolateMeasure&&this.clearIsolate()),j.model.is2d()&&(a.impl.updateViewportId(0),C&&C.setFirstClickVpId(null))},this.clearRubberBand=function(){o=null,t=null,A.hideClick("second")},this.clearFirstPick=function(){o?(A.hide(),n=o.clone(),s=t,D=E,F=G,K=L,M=N,H=I,j.model.is2d()&&(a.impl.updateViewportId(M),C&&C.setFirstClickVpId(M)),z=!0,s===SNAP_VERTEX?A.showFirstVertex(n):s===SNAP_EDGE?A.showFirstEdge(n,D):s===SNAP_FACE?A.showFirstFace(n,D):s===SNAP_CIRCULARARC?(n.center=o.center,n.radius=o.radius,A.showFirstEdge(n,D)):s===SNAP_CURVEDFACE&&A.showFirstFace(n,D),z=!1,o=null,t=null,L=null,N=null,I=null,q=2,x={},y=0,B&&B.isolateMeasure&&this.clearIsolate()):this.clearMeasurement(),B&&B.showSelection1()},this.clearSecondPick=function(){o=null,t=null,L=null,N=null,q=2,x={},y=0,A.hideClick("second"),B&&B.isolateMeasure&&this.clearIsolate(),j.model.is2d()&&(a.impl.updateViewportId(M),C&&C.setFirstClickVpId(M))},this.getIndicator=function(){return A},this.getFirstGeometry=function(){return{type:s,geometry:n}},this.getSecondGeometry=function(){return{type:t,geometry:o}},this.getEdgeLength=function(a){return A.getEdgeLength(a)},this.getFaceArea=function(a){return A.getFaceArea(a)},this.getCircularArcRadius=function(a){return A.getCircularArcRadius(a)},this.isolateMeasurement=function(){if(K&&L){var a=[K,L];j.isolate(a)}},this.clearIsolate=function(){j.showAll()},this.isIdenticalEdges=function(){if(n.vertices.length===o.vertices.length){for(var a=0;a<n.vertices.length;a++)if(!n.vertices[a].equals(o.vertices[a]))return!1;return!0}return!1},this.isIdenticalFaces=function(){if(n.faceId&&o.faceId){if(n.fragId===o.fragId&&n.faceId===o.faceId)return!0}else if(n.vertices.length===o.vertices.length){
for(var a=0;a<n.vertices.length;a++)if(!n.vertices[a].equals(o.vertices[a]))return!1;return!0}return!1},this.isIdenticalGeometries=function(){if(s===t)switch(s){case SNAP_VERTEX:if(n.equals(o))return!0;break;case SNAP_EDGE:return this.isIdenticalEdges();case SNAP_FACE:return this.isIdenticalFaces();case SNAP_CIRCULARARC:return this.isIdenticalEdges();case SNAP_CURVEDEDGE:return this.isIdenticalEdges();case SNAP_CURVEDFACE:return this.isIdenticalFaces()}return!1},this._handleMouseEvent=function(b){if(C.isSnapped()){if(0===q&&(this.clearMeasurement(),q=1),1===q)M=C.getViewportIndex(),s=C.getHighlightGeometry(),D=C.getIntersectPoint(),e()&&(Q.showLabel(!1),Q.showPanel(!1)),j.model.is2d()&&!R&&(a.impl.updateViewportId(M),C&&C.setFirstClickVpId(M)),n=C.getGeometry(),s===SNAP_VERTEX?A.showFirstVertex(n):s===SNAP_EDGE||s===SNAP_CURVEDEDGE?A.showFirstEdge(n,D):s===SNAP_FACE?(F=C.getFaceNormal(),A.showFirstFace(n,D)):s===SNAP_CIRCULARARC?(H=C.getCircularArcCenter(),n.center=C.getCircularArcCenter(),n.radius=C.getCircularArcRadius(),A.showFirstEdge(n,D)):s===SNAP_CURVEDFACE&&A.showFirstFace(n,D),K=C.getSnapNode(),B&&B.showSelection1();else if(2===q){var c=null;if(t=C.getHighlightGeometry(),E=C.getIntersectPoint(),o=C.getGeometry(),t===SNAP_CIRCULARARC&&(o.center=C.getCircularArcCenter(),o.radius=C.getCircularArcRadius()),this.isIdenticalGeometries())return!1;if(s===SNAP_VERTEX&&t===SNAP_VERTEX?(A.showSecondVertex(o),A.drawLine(n,o),c=[n,o]):s===SNAP_EDGE&&t===SNAP_EDGE?(A.showSecondEdge(o,E),c=A.edgeToEdgeMeasure(o,n,E)):s===SNAP_FACE&&t===SNAP_FACE?(G=C.getFaceNormal(),A.showSecondFace(o,E),c=A.faceToFaceMeasure(D,F,E,G)):s===SNAP_VERTEX&&t===SNAP_EDGE?(A.showSecondEdge(o,E),c=A.pointToEdgeMeasure(n,o,E)):s===SNAP_EDGE&&t===SNAP_VERTEX?(A.showSecondVertex(o),c=A.edgeToPointMeasure(n,o)):s===SNAP_VERTEX&&t===SNAP_FACE?(G=C.getFaceNormal(),A.showSecondFace(o,E),c=A.pointToFaceMeasure(n,o,G,E)):s===SNAP_FACE&&t===SNAP_VERTEX?(A.showSecondVertex(o),c=A.faceToPointMeasure(n,F,D,o)):s===SNAP_EDGE&&t===SNAP_FACE?(G=C.getFaceNormal(),A.showSecondFace(o,E),c=A.edgeToFaceMeasure(n,D,o,G,E)):s===SNAP_FACE&&t===SNAP_EDGE?(A.showSecondEdge(o,E),c=A.faceToEdgeMeasure(n,F,D,o,E)):s===SNAP_CIRCULARARC&&t===SNAP_CIRCULARARC?(I=C.getCircularArcCenter(),H.equals(I)?(o=A.nearestVertexInVertexToEdge(E,o),t=SNAP_VERTEX,A.showSecondVertex(o),A.drawLine(H,o),c=[H,o]):(A.showSecondEdge(o,E),A.drawLine(H,I),c=[H,I])):s===SNAP_CIRCULARARC&&t===SNAP_VERTEX?(A.showSecondVertex(o),A.drawLine(H,o),c=[H,o]):s===SNAP_VERTEX&&t===SNAP_CIRCULARARC?(I=C.getCircularArcCenter(),A.showSecondEdge(o,E),A.drawLine(n,I),c=[n,I]):s===SNAP_CIRCULARARC&&t===SNAP_EDGE?(A.showSecondEdge(o,E),c=A.pointToEdgeMeasure(H,o,E)):s===SNAP_EDGE&&t===SNAP_CIRCULARARC?(I=C.getCircularArcCenter(),A.showSecondEdge(o,E),c=A.edgeToPointMeasure(n,I)):s===SNAP_CIRCULARARC&&t===SNAP_FACE?(G=C.getFaceNormal(),A.showSecondFace(o,E),c=A.pointToFaceMeasure(H,o,G,E)):s===SNAP_FACE&&t===SNAP_CIRCULARARC?(I=C.getCircularArcCenter(),A.showSecondEdge(o,E),c=A.faceToPointMeasure(n,F,D,I)):s===SNAP_CURVEDEDGE&&t===SNAP_VERTEX?(A.showSecondVertex(o),c=A.curvedEdgeToVertexMeasure(n,o)):s===SNAP_VERTEX&&t===SNAP_CURVEDEDGE?(A.showSecondEdge(o,E),c=A.curvedEdgeToVertexMeasure(o,n)):s===SNAP_CURVEDEDGE&&t===SNAP_CIRCULARARC?(I=C.getCircularArcCenter(),A.showSecondEdge(o,E),c=A.curvedEdgeToVertexMeasure(n,I)):s===SNAP_CIRCULARARC&&t===SNAP_CURVEDEDGE?(A.showSecondEdge(o,E),c=A.curvedEdgeToVertexMeasure(o,H)):s===SNAP_CURVEDEDGE&&t===SNAP_EDGE?(A.showSecondEdge(o,E),c=A.curvedEdgeToEdgeMeasure(n,o)):s===SNAP_EDGE&&t===SNAP_CURVEDEDGE?(A.showSecondEdge(o,E),c=A.curvedEdgeToEdgeMeasure(o,n)):s===SNAP_CURVEDEDGE&&t===SNAP_CURVEDEDGE?(A.showSecondEdge(o,E),c=A.curvedEdgeToCurvedEdgeMeasure(n,o)):s!==SNAP_CURVEDEDGE||t!==SNAP_FACE&&t!==SNAP_CURVEDFACE?s!==SNAP_FACE&&s!==SNAP_CURVEDFACE||t!==SNAP_CURVEDEDGE?s===SNAP_CURVEDFACE&&t===SNAP_VERTEX?(A.showSecondVertex(o),c=A.curvedFaceToVertexMeasure(n,o)):s===SNAP_VERTEX&&t===SNAP_CURVEDFACE?(A.showSecondFace(o,E),c=A.curvedFaceToVertexMeasure(o,n)):s===SNAP_CURVEDFACE&&t===SNAP_CIRCULARARC?(I=C.getCircularArcCenter(),A.showSecondEdge(o,E),c=A.curvedFaceToVertexMeasure(n,I)):s===SNAP_CIRCULARARC&&t===SNAP_CURVEDFACE?(A.showSecondFace(o,E),c=A.curvedFaceToVertexMeasure(o,H)):s===SNAP_CURVEDFACE&&t===SNAP_EDGE?(A.showSecondEdge(o,E),c=A.curvedEdgeToFaceMeasure(o,n)):s===SNAP_EDGE&&t===SNAP_CURVEDFACE?(A.showSecondFace(o,E),c=A.curvedEdgeToFaceMeasure(n,o)):s!==SNAP_CURVEDFACE||t!==SNAP_FACE&&t!==SNAP_CURVEDFACE?s===SNAP_FACE&&t===SNAP_CURVEDFACE&&(A.showSecondFace(o,E),c=A.curvedFaceToFaceMeasure(n,o)):(A.showSecondFace(o,E),c=A.curvedFaceToFaceMeasure(n,o)):(A.showSecondEdge(o,E),c=A.curvedEdgeToFaceMeasure(o,n)):(A.showSecondFace(o,E),c=A.curvedEdgeToFaceMeasure(n,o)),r){if(void 0===c.length)y=c,B&&B.showAngleResult();else{var d=c[0].clone(),f=c[1].clone();j.model.is2d()&&j.model.pageToModel(d,f,M),x.xyz=d.distanceTo(f),x.x=Math.abs(d.x-f.x),x.y=Math.abs(d.y-f.y),x.z=Math.abs(d.z-f.z),B&&(s===SNAP_FACE&&t===SNAP_FACE?B.showDistanceResult(!0):B.showDistanceResult()),e()&&(Q.updateDistance(x.xyz),Q.showPanel(!0),Q.showLabel(!0),Q.clearSize())}B&&(B.showSelection2(),B.updatePanel()),A.updateDistance(),A.updateAngle(),L=C.getSnapNode(),N=C.getViewportIndex(),B&&B.isolateMeasure&&this.isolateMeasurement(),j.model.is2d()&&(a.impl.updateViewportId(0),C&&C.setFirstClickVpId(null))}A.updateLabelPositions()}return!0}if(2===q){var g=this.inverseProject(b.canvasX,b.canvasY);s===SNAP_VERTEX?A.drawLine(n,g):s===SNAP_EDGE?A.edgeToPointMeasure(n,g):s===SNAP_FACE?A.faceToPointMeasure(n,F,D,g):s===SNAP_CIRCULARARC?A.drawLine(H,g):s===SNAP_CURVEDEDGE?A.curvedEdgeToVertexMeasure(n,g):s===SNAP_CURVEDFACE&&A.curvedFaceToVertexMeasure(n,g)}return!1},this.inverseProject=function(a,b){var c=j.navigation.getCamera(),d=j.navigation.getScreenViewport(),e=new THREE.Vector3;return e.x=a/d.width*2-1,e.y=-(b/d.height*2-1),e.z=0,e=e.unproject(c)},this.handleButtonDown=function(a,b){return p=!0,0!==b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||(r=!0),!1},this.handleMouseMove=function(a){return r=!1,2===q&&(this.clearRubberBand(),this._handleMouseEvent(a)),!1},this.restoreMouseListeners=function(){j.toolController.getTool("gestures").controller.enableMouseButtons(!0)},this.handlePressHold=function(a){if(r=!1,av.isMobileDevice())switch(a.type){case"press":return R=!0,this.clearRubberBand(),this._handleMouseEvent(a),!0;case"pressup":return r=!0,this.restoreMouseListeners(),this.handleSingleClick(a),R=!1,!0}return!1},this.handleGesture=function(a){if(av.isMobileDevice()&&(r=!1,R))switch(this.clearRubberBand(),1==q&&(n=null,s=null,A.hideClick("first")),a.type){case"dragstart":return this._handleMouseEvent(a),!0;case"dragmove":return this._handleMouseEvent(a),!0;case"dragend":return R=!1,r=!0,this.handleSingleClick(a),this.restoreMouseListeners(),!0;case"pinchstart":this._handleMouseEvent(a);break;case"pinchmove":this._handleMouseEvent(a);break;case"pinchend":return r=!0,this.handleSingleClick(a),this.restoreMouseListeners(),!0}return!1},this.handleButtonUp=function(a,b){return p=!1,!1},this.handleSingleClick=function(a,b){return r&&(this._handleMouseEvent(a)||(this.clearMeasurement(),q=0),1!==q&&2!==q||(q=1===q?2:0),r=!1),!0},this.handleDoubleClick=function(a,b){return!0},this.handleWheelInput=function(a){return A.updateScale(),!1},this.handleSingleTap=function(a){return!0},this.handleDoubleTap=function(a){return!0},this.handleResize=function(){A&&A.updateLabelPositions()}},function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),b=Autodesk.Viewing,c=Autodesk.Viewing.Extensions,d=Autodesk.Viewing.Private,e=Autodesk.Viewing.UI,f=function(a,c,f,g,h){e.DockingPanel.call(this,c.container,f,g,h),this.kPanelExpandedHeight=310,this.kPanelCollapsedHeight=35,this.isDeltaExpanded=!0,this.isSettingsExpanded=!1,this.isolateMeasure=!1,this.measureTool=a,this.viewer=c,this.parentContainer=c.container,this.container.classList.add("measurePanel"),this.container.dockRight=!0,this.container.style.minWidth="300px",this.container.style.width="300px",this.container.style.minHeight=this.kPanelCollapsedHeight+"px",this.container.style.height=this.kPanelExpandedHeight+"px",this.container.style.maxHeight=this.kPanelExpandedHeight+"px",this.container.style.top="200px",this.container.style.left="220px",this.container.style.position="absolute",this.addEventListener(this.closer,"click",function(a){h&&h.onCloseCallback&&h.onCloseCallback()}),this.container.children[0].classList.add("expanded"),h=h||{},h.heightAdjustment||(h.heightAdjustment=40),h.marginTop||(h.marginTop=0),h.left=!1,this.createScrollContainer(h),this.measureResults=document.createElement("div"),this.scrollContainer.appendChild(this.measureResults);var i=this;this.selection1=document.createElement("div"),this.selection1.className="measure-result-container",this.measureResults.appendChild(this.selection1);var j=document.createElement("div");j.className="measure-selectionOne-label",this.selection1.appendChild(j);var k=document.createElement("div");k.className="adsk-icon-first measure-label-icon",j.appendChild(k),this.selection1Result=document.createElement("div"),this.selection1Result.className="measure-selection-result",this.selection1.appendChild(this.selection1Result);var l=document.createElement("div");l.className="adsk-icon-refresh measure-repick",l.addEventListener("click",function(a){i.firstSelectionRepick()},!0),this.selection1.appendChild(l),this.addDivider(this.selection1),this.results=document.createElement("div"),this.results.className="measure-result-container",this.measureResults.appendChild(this.results),this.distIcon=document.createElement("div"),this.distIcon.className="adsk-icon-measure-distance measure-distance-icon",this.results.appendChild(this.distIcon),this.angleIcon=document.createElement("div"),this.angleIcon.className="adsk-icon-measure-angle measure-angle-icon",this.results.appendChild(this.angleIcon),this.distanceDiv=document.createElement("div"),this.distanceDiv.className="measure-result",this.results.appendChild(this.distanceDiv),this.angleDiv=document.createElement("div"),this.angleDiv.className="measure-result",this.results.appendChild(this.angleDiv),this.initialDiv=document.createElement("div"),this.initialDiv.className="measure-initial",this.initialDiv.textContent="0.00",this.results.appendChild(this.initialDiv),this.settingsButton=document.createElement("div"),this.settingsButton.className="adsk-icon-settings measure-settings-button",this.settingsButton.addEventListener("click",function(a){i.showMeasureSettings()},!0),this.results.appendChild(this.settingsButton),this.deltaButton=document.createElement("div"),this.deltaButton.className="adsk-icon-arrow measure-delta-button",this.deltaButton.addEventListener("click",function(a){i.toggle()},!0),this.results.appendChild(this.deltaButton),this.deltaXDiv=document.createElement("div"),this.deltaXDiv.className="measure-delta-result",this.results.appendChild(this.deltaXDiv);var m=document.createElement("span");m.setAttribute("data-i18n","Delta"),m.textContent=b.i18n.translate("Delta"),this.deltaXDiv.appendChild(m);var n=document.createElement("span");n.className="measure-label-axis-x",n.textContent="X",this.deltaXDiv.appendChild(n);var o=document.createElement("span");this.deltaXDiv.appendChild(o),this.deltaYDiv=document.createElement("div"),this.deltaYDiv.className="measure-delta-result",this.results.appendChild(this.deltaYDiv);var p=document.createElement("span");p.setAttribute("data-i18n","Delta"),p.textContent=b.i18n.translate("Delta"),this.deltaYDiv.appendChild(p);var q=document.createElement("span");q.className="measure-label-axis-y",q.textContent="Y",this.deltaYDiv.appendChild(q);var r=document.createElement("span");this.deltaYDiv.appendChild(r),this.deltaZDiv=document.createElement("div"),this.deltaZDiv.className="measure-delta-result",this.results.appendChild(this.deltaZDiv);var s=document.createElement("span");s.setAttribute("data-i18n","Delta"),s.textContent=b.i18n.translate("Delta"),this.deltaZDiv.appendChild(s);var t=document.createElement("span");t.className="measure-label-axis-z",t.textContent="Z",this.deltaZDiv.appendChild(t);var u=document.createElement("span");this.deltaZDiv.appendChild(u),this.addDivider(this.results),this.selection2=document.createElement("div"),this.selection2.className="measure-result-container",this.measureResults.appendChild(this.selection2);var v=document.createElement("div");v.className="measure-selectionTwo-label",this.selection2.appendChild(v);var w=document.createElement("div");w.className="adsk-icon-second measure-label-icon",v.appendChild(w),this.selection2Result=document.createElement("div"),this.selection2Result.className="measure-selection-result",this.selection2.appendChild(this.selection2Result);var x=document.createElement("div");x.className="adsk-icon-refresh measure-repick",x.addEventListener("click",function(a){i.secondSelectionRepick()},!0),this.selection2.appendChild(x),this.addDivider(this.selection2),this.measureSettings=document.createElement("div"),this.measureSettings.className="measure-settings",this.measureSettings.style.display="none",this.measureResults.appendChild(this.measureSettings),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable measure-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.measureSettings.appendChild(this.table),this.units=[{name:"Unknown",units:"",matches:[""]},{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];for(var y=this.findUnits(),z=[],A=0;A<this.units.length;++A)z.push(this.units[A].name);this.unitList=new d.OptionDropDown("Unit type",this.tbody,z,y),this.addEventListener(this.unitList,"change",function(a){var b=i.unitList.selectedIndex,c=i.units[b].units;i.measureTool.setUnits(c),i.updatePanel(),i.setupPrecision(),d.logger.track({category:"pref_changed",name:"measure/units",value:c})}),this.precisionList=new d.OptionDropDown("Precision",this.tbody,[],-1),this.addEventListener(this.precisionList,"change",function(a){var b=i.precisionList.selectedIndex;i.measureTool.setPrecision(b),i.updatePanel(),d.logger.track({category:"pref_changed",name:"measure/precision",value:b})}),this.setupPrecision(),this.isolate=new d.OptionCheckbox("Isolate measurement",this.tbody,!1),this.addEventListener(this.isolate,"change",function(a){var b=i.isolate.checked;i.isolateMeasure=b,i.isolateMeasure?i.measureTool.isolateMeasurement():i.measureTool.clearIsolate(),d.logger.track({category:"pref_changed",name:"measure/isolate",value:b})}),this.addDivider(this.measureSettings);var B=document.createElement("div");B.className="measure-restart",B.setAttribute("data-i18n","Restart"),B.textContent=b.i18n.translate("Restart"),B.addEventListener("click",function(){i.measureTool.clearMeasurement()},!1),this.measureResults.appendChild(B),this.updatePanel(),this.addVisibilityListener(function(){i.resizeToContent({maxHeight:i.parentContainer.offsetHeight-75})}),this.hideMeasureResult()};f.prototype=Object.create(e.DockingPanel.prototype),c.ViewerPanelMixin.call(f.prototype),f.prototype.addDropDownMenu=function(a,c,d,e,f){var g=function(a){f(a.target.selectedIndex)},h=document.createElement("select");h.className="optionDropDown";for(var i=0;i<d.length;i++){var j=document.createElement("option");j.value=i,j.setAttribute("data-i18n",d[i]),j.textContent=b.i18n.translate(d[i]),h.add(j)}var k=document.createElement("div");k.className="measure-submenu-select";var l=document.createElement("div");return l.className="measure-submenu-selectlabel",l.setAttribute("for",c),l.setAttribute("data-i18n",c),l.textContent=b.i18n.translate(c),k.appendChild(l),k.appendChild(h),a.appendChild(k),h.selectedIndex=e,h.onchange=g,h},f.prototype.addDivider=function(a){var b=document.createElement("div");return b.className="measure-horizontal-divider",a.appendChild(b),b},f.prototype.findUnits=function(){var a,b,c=this.measureTool.getUnits();for(a=0;a<this.units.length;++a){var d=this.units[a].matches;if(d)for(b=0;b<d.length;++b)if(d[b]===c)return a}return 0},f.prototype.setupPrecision=function(){for(;this.precisionList.dropdownElement.lastChild;)this.precisionList.dropdownElement.removeChild(this.precisionList.dropdownElement.lastChild);var a,b=this.measureTool.getUnits();a="ft-and-fractional-in"===b||"fractional-in"===b?["1","1/2","1/4","1/8","1/16","1/32","1/64"]:["0","0.1","0.01","0.001","0.0001","0.00001"];for(var c=0;c<a.length;++c){var d=document.createElement("option");d.value=c,d.textContent=a[c],this.precisionList.dropdownElement.appendChild(d)}var e=this.measureTool.getPrecision();a.length<=e&&(e=a.length-1,self.measureTool.setPrecision(e)),this.precisionList.dropdownElement.selectedIndex=e},f.prototype.uninitialize=function(){this.viewer=null,e.DockingPanel.prototype.uninitialize.call(this)},f.prototype.onTitleClick=function(a){},f.prototype.deltaCollapse=function(){this.deltaButton.classList.toggle("rotated"),this.measureTool.getIndicator().setSimple(this.isDeltaExpanded),this.isDeltaExpanded?(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none",this.isDeltaExpanded=!1):(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"),this.isDeltaExpanded=!0),this.resizeToContent()},f.prototype.toggle=function(){this.deltaCollapse()},f.prototype.isExpanded=function(){return this.container.children[0].classList.contains("expanded")},f.prototype.getContentSize=function(){return{height:this.isExpanded()?this.measureResults.clientHeight+46:0,width:this.measureResults.clientWidth}},f.prototype.updatePanel=function(){function a(a,c){"angle"===c?a.textContent="~ "+b.measureTool.getAngle():"xyz"===c?a.textContent="~ "+b.measureTool.getDistance(c):a.children[2].textContent=" = ~ "+b.measureTool.getDistance(c)}var b=this;a(this.distanceDiv,"xyz"),a(this.deltaXDiv,"x"),a(this.deltaYDiv,"y"),a(this.deltaZDiv,"z"),a(this.angleDiv,"angle"),this.unitList.dropdownElement.selectedIndex=this.findUnits(),this.precisionList.dropdownElement.selectedIndex=this.measureTool.getPrecision(),this.initialDiv.textContent=d.formatValueWithUnits(0,null,3,this.measureTool.getPrecision()),this.showSelection1(),this.showSelection2()},f.prototype.showDistanceResult=function(a){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="inline-block",this.distIcon.style.display="inline-block",a?(this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none")):(this.deltaButton.style.display="inline-block",this.isDeltaExpanded&&(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"))),this.resizeToContent()},f.prototype.showAngleResult=function(){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="inline-block",this.angleIcon.style.display="inline-block",this.distanceDiv.style.display="none",this.distIcon.style.display="none",this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"),this.resizeToContent()},f.prototype.showSelection1=function(){var a=this.measureTool.getFirstGeometry();null!==a.type&&(a.type===SNAP_VERTEX?(this.selection1Result.setAttribute("data-i18n","Vertex"),this.selection1Result.textContent=b.i18n.translate("Vertex"),this.selection1Result.style.display="inline-block"):a.type===SNAP_EDGE||a.type===SNAP_CURVEDEDGE?(this.selection1Result.setAttribute("data-i18n","Edge"),this.selection1Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection1Result.style.display="inline-block"):a.type===SNAP_FACE||a.type===SNAP_CURVEDFACE?(this.selection1Result.setAttribute("data-i18n","Face"),this.selection1Result.textContent=b.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(a.geometry),this.selection1Result.style.display="inline-block"):a.type===SNAP_CIRCULARARC&&(this.selection1Result.setAttribute("data-i18n","Edge"),a.geometry.radius?this.selection1Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(a.geometry)+" (R)":this.selection1Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection1Result.style.display="inline-block"),this.selection1.style.display="block",this.resizeToContent())},f.prototype.showSelection2=function(){var a=this.measureTool.getSecondGeometry();null!==a.type&&(a.type===SNAP_VERTEX?(this.selection2Result.setAttribute("data-i18n","Vertex"),this.selection2Result.textContent=b.i18n.translate("Vertex"),this.selection2Result.style.display="inline-block"):a.type===SNAP_EDGE||a.type===SNAP_CURVEDEDGE?(this.selection2Result.setAttribute("data-i18n","Edge"),this.selection2Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection2Result.style.display="inline-block"):a.type===SNAP_FACE||a.type===SNAP_CURVEDFACE?(this.selection2Result.setAttribute("data-i18n","Face"),this.selection2Result.textContent=b.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(a.geometry),this.selection2Result.style.display="inline-block"):a.type===SNAP_CIRCULARARC&&(this.selection2Result.setAttribute("data-i18n","Edge"),a.geometry.radius?this.selection2Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(a.geometry)+" (R)":this.selection2Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection2Result.style.display="inline-block"),this.selection2.style.display="block",this.resizeToContent())},f.prototype.firstSelectionRepick=function(){this.measureTool.clearFirstPick(),this.selection1Result.textContent=this.selection2Result.textContent,this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},f.prototype.secondSelectionRepick=function(){this.measureTool.clearSecondPick(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},f.prototype.hideMeasureResult=function(){this.clearSelectionOne(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},f.prototype.disableUnitOption=function(a){null!=a?(this.unitList.dropdownElement.children[a].style.display="none",b.isIE11&&(this.unitList.dropdownElement.children[a].disabled=!0,this.unitList.dropdownElement.children[a].style.visibility="hidden")):this.unitList.dropdownElement.disabled=!0},f.prototype.showMeasureSettings=function(){this.isSettingsExpanded?(this.measureSettings.style.display="none",this.isSettingsExpanded=!1):(this.measureSettings.style.display="block",this.isSettingsExpanded=!0),this.resizeToContent()},f.prototype.clearSelectionOne=function(){this.selection1Result.setAttribute("data-i18n","Select Object"),this.selection1Result.textContent=b.i18n.translate("Select Object")},f.prototype.clearSelectionTwo=function(){this.selection2Result.setAttribute("data-i18n","Select Object"),this.selection2Result.textContent=b.i18n.translate("Select Object")},f.prototype.clearResult=function(){this.distIcon.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="none",this.angleDiv.style.display="none",this.initialDiv.style.display="inline-block",this.deltaButton.style.display="none",this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"},a.MeasurePanel=f}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.CalibrationTool=function(a,b,c,d){function e(a,b,c){var d=i.navigation.getCamera(),e=i.navigation.getScreenViewport(),f=new THREE.Vector3(a,b,c);return f=f.project(d),{x:Math.round((f.x+1)/2*e.width),y:Math.round((1-f.y)/2*e.height)}}function f(a,b,c){(a.classList.contains(b)&&!c||!a.classList.contains(b)&&c)&&a.classList.toggle(b,c)}function g(){z&&z.clearRect(0,0,z.canvas.width,z.canvas.height),B&&(f(B[1],"visible",!1),f(B[2],"visible",!1))}var h=this,i=a,j=b,k=c,l=d||{},m=["calibration"],n=!1,o=!1,p=null,q=null!=l.calibrationFactor,r=!1,s=d.maxPrecision||5,t=null,u=null,v=null,w=null,x=null,y=Autodesk.Viewing.Private.GuiViewer3D&&a instanceof Autodesk.Viewing.Private.GuiViewer3D,z=null,A=null,B=null,C=null,D=null,E="#FFD83C",F="#039BE5",G="#000",H=null;this.register=function(){function a(a){endpoint=B[a]=document.createElement("div"),endpoint.className="calibration-endpoint",i.container.appendChild(endpoint);var b=document.createElement("div");b.className="calibration-endpoint-text",b.textContent=a,endpoint.appendChild(b)}if(y&&!x&&(x=new Autodesk.Viewing.Extensions.Measure.CalibrationPanel(h,i,"calibration-panel","Calibration",l),i.addPanel(x)),!z){var b=document.createElement("canvas");i.container.appendChild(b);i.navigation.getScreenViewport();b.width=i.container.clientWidth,b.height=i.container.clientHeight,b.className="calibration-line",z=b.getContext("2d"),z.strokeStyle=E,z.lineWidth=3}if(!A){A=document.createElement("div"),A.className="calibration-label",f(A,"visible",!1),i.container.appendChild(A);var c=document.createElement("div");c.className="calibration-label-text",A.appendChild(c)}B||(B={},a("1"),a("2"))},this.deregister=function(){this.deactivate(),x&&(i.removePanel(x),x.uninitialize())},this.isActive=function(){return n},this.getNames=function(){return m},this.getName=function(){return m[0]},this.getCursor=function(){return o?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAYCAYAAAD+vg1LAAAAAXNSR0IArs4c6QAAAwZJREFUSA2tVEtLW0EUvjGJefoqSY0x0WBSiY+oNWiUINkU6ioLaaAlG1eudNVFoT+grgopiCkEIbUK1o0lusmurRSEWmmKG6MNtNhNosWqyU2CZPpN8cr15nFD7YHDzHnON2fOGYZhmHkw4XEW+wD4xkT4lMvl6CE0+Y2ohh+dz+cZn89HVS/5+n/d/wVMkXq9Xor2v5SBgsmymQwZHx+vOqlKpXKDXWI3eU6Tg+kqSjSh3W4/s9lsvzUajaNcAK3xY7Dyci3nd6WXSCS60dHRvMfjSRcKBfWV4SYbrVarB8p0PB5nY7HYmdVq/aDX67WlckpKKcvpOjs7X09OTvoPDw8z2Wy2Bu+imJqa+npycnJXGHOt3YRGoSyVSvvMZrNkYWFBs7GxkaoBAXFJcDJhcCW5rq5ur62trQ/EOhyOBhDT2Nj4qVKMqA31ve1yub7Rfufo/PycDA4OxpuamhqECaouhVqtfuD3+1tqa2uZQCCQDoVCWTwknVQDDvIKE1clI1ja09Ozg0cjx8fHpL+/P+50OhMU8f7+Punt7f2I5NdqXRXi9fV1z9jYWCuIWV5eziSTyWAqlXq1urqaw6AwOMiCG4lOYtEturu732xubhK0FQHSvfr6+lsog4HWPIPvIBqNErRiqCiwkkKpVFowZd8xZSQYDLImk+kJ52+xWJ4tLS3hU8yTkZGRBD2Ms4mu6Nun4XA4f3p6SoaGhuJ0+rgg/Bsmt9udYFmWzM3NZdDT05ztWsE5JV0R1AqUCfTt0fb2tjESiRRmZmaOUOcI3w9DY5mdnb03PDzMoDQ/MZFRzM20lO/E38vl8vt46UdAq0WNJWixlEwmu8B1bXioOxwjpgXJ0hMTE1og1qysrDghf+HnKtoD7c7u7i5ZXFzMGY3GF7iFuRR3dHTMr62tXWxtbZH29vZ3RYmECozu54ODAzpdP2hphHZOVigUVjChvgMDA+85fdm1q6vrrU6n+4WR9Zd1ujQ0Nzc/NBgMScSExXwZ2j5oL5Wo46UD/ZvxUemo+AdW1zJzUYr16wAAAABJRU5ErkJggg==), auto"},this.activate=function(){n=!0,r&&v&&w?(C=v,D=w,this.updatePanelPosition(C,D),this.showPanel(!0),this.updateLabelSize(t,u,j.getPrecision()),this.showLabel(!0,!1),this.drawCalibrationLine()):(C=null,D=null),j.enableCalibrate(!0),i.toolController.activateTool("measure"),this.onCameraChangeBinded=this.onCameraChange.bind(this),i.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},this.deactivate=function(){n=!1,g(),this.showLabel(!1,!1),this.showPanel(!1),j&&j.isActive()&&(j.enableCalibrate(!1),i.toolController.deactivateTool("measure")),i.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},this.updateDistance=function(a){p=a},this.updatePanelPosition=function(a,b){function c(a,b,c,d){var f=e((a.x+b.x)/2,(a.y+b.y)/2,(a.z+b.z)/2),g=a.x-b.x,h=a.y-b.y,i=null;return i=d?a.x>b.x?new THREE.Vector2(-h,g).normalize():new THREE.Vector2(h,-g).normalize():a.x<=b.x?new THREE.Vector2(-h,g).normalize():new THREE.Vector2(h,-g).normalize(),i.multiplyScalar(c),{x:Math.floor(f.x+i.x),y:Math.floor(f.y-i.y)}}function d(a,b,c,d){return a<0||a+c>i.canvas.clientWidth||b<0||b+d>i.canvas.clientHeight}if(x){var f=parseInt(x.container.style.width),g=parseInt(x.container.style.height),h=Math.sqrt(Math.pow(f,2)+Math.pow(g,2))/2,j=c(a,b,h,!0),k=j.x-Math.floor(f/2),l=j.y-Math.floor(g/2);d(k,l,f,g)&&(j=c(a,b,h,!1),k=j.x-Math.floor(f/2),l=j.y-Math.floor(g/2)),d(k,l,f,g)&&(k=i.canvas.clientWidth/2-f/2,l=i.canvas.clientHeight/2-g/2),x.container.style.left=k+"px",x.container.style.top=l+"px"}},this.calibrate=function(a,b){var c=null;return isNaN(b)||(currentSize=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),a,1,p),c=b/currentSize,j.setCalibrationFactor(c),j.setUnits(a),j.setPrecision(function(a){return Math.floor(a)===a?0:a.toString().split(".")[1].length||0}(b)),q=!0,t=b,u=a,v=C,w=D),c},this.getCurrentUnits=function(){return j.getUnits()},this.showPanel=function(a){function b(){"Escape"==event.key&&c.isActive()&&r&&(c.showPanel(!1),c.showAddCalibrationLabel(),window.removeEventListener("keyup",arguments.callee))}var c=this;a?x&&(this.clearSize(),x.updatePanel(t,u),window.setTimeout(function(){x.requestedSizeTextbox.focus()},0),x.setVisible(!0),window.addEventListener("keyup",b)):x&&x.setVisible(!1)},this.showLabel=function(a,b){A&&(A.childNodes[0].style.pointerEvents=b?"all":"none",A.classList.visible!=a&&f(A,"visible",a),this.updateLabelPosition())},this.handleButtonDown=function(a,b){return o=!0,!1},this.handleButtonUp=function(a,b){return o=!1,!1},this.isCalibrated=function(){return q},this.updateLabelSize=function(a,b,c){if(""==a)this.updateLabelText(null);else{var d=Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(a),b,3,c);this.updateLabelText(d)}},this.updateLabelText=function(a){a&&""!=a?(A.childNodes[0].setAttribute("data-i18n",a),A.childNodes[0].textContent=av.i18n.translate(a),f(A,"visible",!0),this.updateLabelPosition()):f(A,"visible",!1)},this.updateLabelPosition=function(){if(r&&A&&C&&D){var a=e((C.x+D.x)/2,(C.y+D.y)/2,(C.z+D.z)/2),b=C.x-D.x,c=C.y-D.y,d=null,f=null;if(C.x<D.x?(d=180*Math.atan2(-c,-b)/Math.PI,f=new THREE.Vector2(-c,b).normalize()):(d=180*Math.atan2(c,b)/Math.PI,f=new THREE.Vector2(c,-b).normalize()),f.multiplyScalar(8),A.style.top=a.y-f.y+"px",A.style.left=a.x-Math.floor(A.clientWidth/2)+2*f.x+"px",i.model.is2d()){var g=i.navigation.getCameraUpVector(),h=new THREE.Vector3(0,1,0),j=180*h.angleTo(g)/Math.PI;j=g.x>=0?j:-j,d=-(d+j),Math.abs(d)>90&&(d+=180),A.style.transform="rotate("+d+"deg)"}}},this.updateCalibrationLine=function(a,b,c,d,e,f,h,i,j,k){if(i&&!j)return r=!1,C=null,D=null,void g();C=new THREE.Vector3(a,b,c),D=new THREE.Vector3(d,e,f),i?(r=!0,z.setLineDash([]),this.updatePanelPosition(C,D),this.updateLabelPosition(C,D)):(r=!1,z.setLineDash([10,3])),H=k,this.drawCalibrationLine()},this.drawCalibrationLine=function(){function a(a,b,c){if("2"!=a||r){var d=B[a];f(d,"visible",!0),d.style.left=b-parseInt(d.clientWidth)/2+"px",d.style.top=c-parseInt(d.clientHeight)/2+"px"}else f(B[2],"visible",!1)}function b(b,c,d,e){z.save(),z.setLineDash([]),k.isSnapped()&&!r?(z.strokeStyle=F,z.lineWidth=2):(z.strokeStyle=G,z.lineWidth=1),z.beginPath();var f=c.clone();f.multiplyScalar(25),z.moveTo(d.x+f.x,d.y+f.y),z.lineTo(d.x-f.x,d.y-f.y),z.stroke(),z.strokeStyle=G,z.lineWidth=1,f=b.clone(),z.beginPath(),f.multiplyScalar(25),z.moveTo(d.x,d.y),z.lineTo(d.x-f.x,d.y-f.y),z.stroke(),a(e,d.x-f.x,d.y-f.y),z.lineWidth=2,z.strokeStyle=E,z.beginPath(),
f=c.clone(),f.multiplyScalar(15),z.moveTo(d.x+f.x,d.y+f.y),z.lineTo(d.x-f.x,d.y-f.y),z.stroke();var g=Math.PI/8,h=f.x*Math.cos(g)-f.y*Math.sin(g)+d.x,i=f.x*Math.sin(g)+f.y*Math.cos(g)+d.y,j=-f.x*Math.cos(g)+f.y*Math.sin(g)+d.x,l=-f.x*Math.sin(g)-f.y*Math.cos(g)+d.y;z.beginPath(),z.moveTo(h,i),z.lineTo(j,l),z.stroke(),z.restore()}if(z&&C&&D){g();var c=e(C.x,C.y,C.z),d=e(D.x,D.y,D.z);c.x!=d.x&&c.y!=d.y||r?z.strokeStyle=E:z.strokeStyle=F,z.beginPath(),z.moveTo(c.x,c.y),z.lineTo(d.x,d.y),z.stroke();var h=new THREE.Vector2(d.x-c.x,d.y-c.y).normalize(),i=new THREE.Vector2(c.x-d.x,c.y-d.y).normalize(),j=new THREE.Vector2(c.y-d.y,d.x-c.x).normalize(),l=new THREE.Vector2(d.y-c.y,c.x-d.x).normalize();H==SNAP_VERTEX?(b(h,j,c,"1"),b(i,l,d,"2")):(b(h,j,c,"2"),b(i,l,d,"1"))}},this.clearSize=function(){this.updateLabelText(""),x&&(x.requestedSizeTextbox.value="")},this.showAddCalibrationLabel=function(){var a=this;this.updateLabelText("Add Calibration"),this.showLabel(!0,!0),A.addEventListener("click",function(){A.childNodes[0].style.pointerEvents="none",a.updatePanelPosition(C,D),a.showPanel(!0),a.clearSize(),A.removeEventListener("click",arguments.callee)})},this.onCameraChange=function(){this.drawCalibrationLine(),this.updateLabelPosition()},this.getMaxPrecision=function(){return s}},function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),b=Autodesk.Viewing,c=Autodesk.Viewing.Extensions,d=Autodesk.Viewing.Private,e=Autodesk.Viewing.UI,f=function(a,c,f,i,j){var k=this;e.DockingPanel.call(this,c.container,f,i,j),this.viewer=c,this.calibrationTool=a,this.parentContainer=c.container,this.container.style.width="270px",this.container.style.height="165px",this.container.classList.add("calibration-panel"),this.addEventListener(this.closer,"click",function(a){k.setVisible(!1),k.calibrationTool.showAddCalibrationLabel()}),j=j||{},j.heightAdjustment||(j.heightAdjustment=40),j.marginTop||(j.marginTop=0),j.left=!1,this.createScrollContainer(j),this.calibrationMenu=document.createElement("div"),this.scrollContainer.appendChild(this.calibrationMenu),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable calibration-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.calibrationMenu.appendChild(this.table),this.row=this.tbody.insertRow(0),this.requestedSizeTextbox=document.createElement("input"),this.requestedSizeTextbox.className="calibration-textbox",this.requestedSizeTextbox.type="text",this.requestedSizeTextbox.autofocus="true",this.addEventListener(this.requestedSizeTextbox,"keyup",function(a){var b=k.requestedSizeTextbox.value;""!==b&&""===b.split(".")[0]&&(k.requestedSizeTextbox.value="0"+b),k.updateLabel()}),this.addEventListener(this.requestedSizeTextbox,"keypress",function(a){if("Backspace"!=a.key&&"ArrowLeft"!=a.key&&"ArrowRight"!=a.key){var b=k.requestedSizeTextbox.value,c=k.requestedSizeTextbox.selectionStart;b=[b.slice(0,c),a.key,b.slice(c)].join(""),"."!=b&&(!h(b)||g(b)>k.calibrationTool.getMaxPrecision())&&a.preventDefault()}});var l=this.row.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n","Define Size"),this.caption.textContent=b.i18n.translate("Define Size"),l.appendChild(this.caption);var l=this.row.insertCell(1);l.style.paddingLeft="5px",l.style.paddingRight="5px",l.appendChild(this.requestedSizeTextbox),this.units=[{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];for(var m=[],n=0;n<this.units.length;++n)m.push(this.units[n].name);this.unitList=new d.OptionDropDown("Unit type",this.tbody,m,0),this.addEventListener(this.unitList,"change",function(a){k.updateLabel()});var o=document.createElement("div");o.className="calibration-button",o.setAttribute("data-i18n","Set Calibration"),o.textContent=b.i18n.translate("Set Calibration"),o.style.width="225px",o.addEventListener("click",function(){var a=k.unitList.selectedIndex,b=k.units[a].units,c=parseFloat(k.requestedSizeTextbox.value);k.calibrationTool.calibrate(b,c)&&(k.calibrationTool.deactivate(),k.viewer.fireEvent({type:"finished-calibration"}))},!1),this.calibrationMenu.appendChild(o)},g=function(a){var b=a.split(".")[1];return b?b.length:0},h=function(a){return!isNaN(parseFloat(a))&&!isNaN(+a)&&parseFloat(a)>=0};f.prototype=Object.create(e.DockingPanel.prototype),c.ViewerPanelMixin.call(f.prototype),f.prototype.uninitialize=function(){this.viewer=null,e.DockingPanel.prototype.uninitialize.call(this)},f.prototype.findUnits=function(){var a,b,c=this.calibrationTool.getCurrentUnits();for(a=0;a<this.units.length;++a){var d=this.units[a].matches;if(d)for(b=0;b<d.length;++b)if(d[b]===c)return a}return 0},f.prototype.updatePanel=function(a,b){this.unitList.setSelectedIndex(this.findUnits()),this.requestedSizeTextbox.value=a},f.prototype.updateLabel=function(){var a=this.unitList.selectedIndex,b=this.units[a].units,c=this.requestedSizeTextbox.value;this.calibrationTool.updateLabelSize(c,b,g(c))};var i=function(a,c,d,f,g){var h=this;e.DockingPanel.call(this,c.container,d,f,g),this.viewer=c,this.measureExt=a,this.parentContainer=c.container,this.container.classList.add("calibration-panel"),this.container.style.width="380px",this.container.style.height="190px",this.container.style.left=(this.viewer.canvas.clientWidth-parseInt(this.container.style.width))/2+"px",this.container.style.top=(this.viewer.canvas.clientHeight-parseInt(this.container.style.height))/2+"px",g=g||{},g.heightAdjustment||(g.heightAdjustment=40),g.marginTop||(g.marginTop=0),g.left=!1,this.createScrollContainer(g),this.dialogBox=document.createElement("div"),this.scrollContainer.appendChild(this.dialogBox);var i=document.createElement("div");i.className="calibration-text";var j="Before using the ruler, the scale for this sheet needs to be set and calibrated.";i.setAttribute("data-i18n",j),i.textContent=b.i18n.translate(j),this.dialogBox.appendChild(i);var k=document.createElement("div");k.className="calibration-button",k.setAttribute("data-i18n","Calibrate Now"),k.textContent=b.i18n.translate("Calibrate Now"),k.style.float="right",k.addEventListener("click",function(){h.measureExt.enableCalibrationTool(!0),h.setVisible(!1)},!1),this.dialogBox.appendChild(k);var l=document.createElement("div");l.className="calibration-button",l.setAttribute("data-i18n","Cancel"),l.textContent=b.i18n.translate("Cancel"),l.style.float="right",l.addEventListener("click",function(){h.setVisible(!1)},!1),this.dialogBox.appendChild(l)};i.prototype=Object.create(e.DockingPanel.prototype),c.ViewerPanelMixin.call(i.prototype),i.prototype.uninitialize=function(){this.viewer=null,e.DockingPanel.prototype.uninitialize.call(this)},a.CalibrationPanel=f,a.CalibrationRequiredDialog=i}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_CIRCULARARC=3,SNAP_CURVEDEDGE=4,SNAP_CURVEDFACE=5,SNAP_PRECISION=.001,NO_OVERLAY=0,FACE_OVERLAY=1,EDGE_OVERLAY=2,POINT_OVERLAY=3;Autodesk.Viewing.Extensions.Measure.Snapper=function(a,b){function c(a,b){this.viewer=a,this.snapper=b,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=this.snapper.getDetectRadius()}function d(){return G=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}var e=a,f=b||{},g=f.markupMode?["snapper-markup"]:["snapper"],h=!1,i="MeasureTool-snapper",j=NO_OVERLAY,k=null,l=Number.MAX_VALUE,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=!1,v=!1,w=!1,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=!1;this.markupMode=f.markupMode,this.isActive=function(){return h},this.getNames=function(){return g},this.getName=function(){return g[0]},this.activate=function(){h=!0},this.deactivate=function(){h=!1,this.destroy()},this.getFace=function(){return n},this.getEdge=function(){return o},this.getVertex=function(){return p},this.getGeometry=function(){switch(r){case SNAP_VERTEX:return this.getVertex();case SNAP_EDGE:return this.getEdge();case SNAP_FACE:return this.getFace();case SNAP_CIRCULARARC:return this.getEdge();case SNAP_CURVEDEDGE:return this.getEdge();case SNAP_CURVEDFACE:return this.getFace()}},this.getSnapNode=function(){return q},this.getHighlightGeometry=function(){return r},this.getIntersectPoint=function(){return s},this.getFaceNormal=function(){return t},this.enableCalibrate=function(a){E=a},this.getEndPointsInEdge=function(a){for(var b=a.vertices,c=[],d=0;d<b.length;++d){for(var e=!1,f=0;f<b.length;++f)if(f!==d&&b[f].equals(b[d])){e=!0;break}e||c.push(b[d])}return c},this.getViewportIndex=function(){return x},this.getCircularArcCenter=function(){return y},this.getCircularArcRadius=function(){return z},this.getDetectRadius=function(){return k},this.isSnapped=function(){return w},this.clearSnapped=function(){n=null,o=null,p=null,r=null,w=!1},this.setClip=function(a){A=a},this.setFirstClickVpId=function(a){B=a},this.isEqualWithPrecision=function(a,b){return Math.abs(a-b)<=SNAP_PRECISION},this.isEqualVectorsWithPrecision=function(a,b){return Math.abs(a.x-b.x)<=SNAP_PRECISION&&Math.abs(a.y-b.y)<=SNAP_PRECISION&&Math.abs(a.z-b.z)<=SNAP_PRECISION},this.isInverseVectorsWithPrecision=function(a,b){return Math.abs(a.x+b.x)<=SNAP_PRECISION&&Math.abs(a.y+b.y)<=SNAP_PRECISION&&Math.abs(a.z+b.z)<=SNAP_PRECISION},this.snapping3D=function(a){q=a.dbId;var b=a.face;s=a.intersectPoint;var c;if(c=void 0===a.fragId.length?[a.fragId]:a.fragId,e.model.hasTopology()){q&&(c=[],e.model.getData().instanceTree.enumNodeFragments(q,function(a){c.push(a)},!0)),n=o=p=null,l=Number.MAX_VALUE;for(var d=0;d<c.length;++d){var g=c[d],h=e.impl.getRenderProxy(e.model,g),i=h.geometry,j=e.model.getTopoIndex(g),u=e.model.getTopology(j),v=u.faces,x=u.edges;u.vertices;if(!n){n=this.faceSnappingWithTopology(b,i,v,h),n&&(n.fragId=g);var A=(new THREE.Matrix3).getNormalMatrix(h.matrixWorld);t=b.normal.applyMatrix3(A).normalize()}this.edgeSnappingWithTopology(s,i,x,h)}if(p=this.vertexSnappingWithTopology(o,s),n){if(k=this.setDetectRadius(s),m<k)this.drawPoint(p),r=SNAP_VERTEX;else if(l<k){this.drawLine(o);var B=this.edgeIsCircle(o);B?(y=B,z=B.distanceTo(o.vertices[0]),r=SNAP_CIRCULARARC):r=this.edgeIsCurved(o)?SNAP_CURVEDEDGE:SNAP_EDGE}else this.drawFace(n),r=this.faceIsCurved(n)?SNAP_CURVEDFACE:SNAP_FACE;w=!0}}else for(var d=0;d<c.length;++d){var g=c[d],h=e.impl.getRenderProxy(e.model,g),i=h.geometry;if(n=this.faceSnapping(b,i)){n.applyMatrix(h.matrixWorld),o=this.edgeSnapping(n,s),p=this.vertexSnapping(o,s);var A=(new THREE.Matrix3).getNormalMatrix(h.matrixWorld);t=b.normal.applyMatrix3(A).normalize(),k=this.setDetectRadius(s),f.forceSnapVertices||m<k?(this.drawPoint(p),r=SNAP_VERTEX):f.forceSnapEdges||E||l<k?(this.drawLine(o),r=SNAP_EDGE):(this.drawFace(n),r=SNAP_FACE),w=!0;break}}},this.faceSnappingWithTopology=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Geometry,i=b.attributes;if(void 0!==i.index){for(var j=b.vb?b.vb:i.position.array,k=b.vb?b.vbstride:3,l=0;l<c.length;l++){for(var m=c[l].indexList,n=c[l].id,o=0;o<m.length;o+=3)if(a.a===m[o]){if(a.b===m[o+1]&&a.c===m[o+2]||a.b===m[o+2]&&a.c===m[o+1])break}else if(a.a===m[o+1]){if(a.b===m[o]&&a.c===m[o+2]||a.b===m[o+2]&&a.c===m[o])break}else if(a.a===m[o+2]&&(a.b===m[o]&&a.c===m[o+1]||a.b===m[o+1]&&a.c===m[o]))break;if(o<m.length)break}if(l<c.length)for(var o=0;o<m.length;o+=3){e.set(j[m[o]*k],j[m[o]*k+1],j[m[o]*k+2]),f.set(j[m[o+1]*k],j[m[o+1]*k+1],j[m[o+1]*k+2]),g.set(j[m[o+2]*k],j[m[o+2]*k+1],j[m[o+2]*k+2]);var p=h.vertices.length;h.vertices.push(e.clone()),h.vertices.push(f.clone()),h.vertices.push(g.clone()),h.faces.push(new THREE.Face3(p,p+1,p+2))}}return h.vertices.length>0?(h.faceId=n,h.applyMatrix(d.matrixWorld),h):null},this.faceSnapping=function(a,b){var c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Geometry,g=b.attributes;if(void 0!==g.index){var h=g.index.array||b.ib,i=b.vb?b.vb:g.position.array,j=b.vb?b.vbstride:3,k=b.offsets;k&&0!==k.length||(k=[{start:0,count:h.length,index:0}]);for(var l=0;l<k.length;++l)for(var m=k[l].start,n=k[l].count,o=k[l].index,p=m;p<m+n;p+=3){var q=o+h[p],r=o+h[p+1],s=o+h[p+2];c.set(i[q*j],i[q*j+1],i[q*j+2]),d.set(i[r*j],i[r*j+1],i[r*j+2]),e.set(i[s*j],i[s*j+1],i[s*j+2]);var t=THREE.Triangle.normal(c,d,e),u=new THREE.Vector3;if(u.set(i[a.a*j],i[a.a*j+1],i[a.a*j+2]),this.isEqualVectorsWithPrecision(t,a.normal)&&this.isEqualWithPrecision(t.dot(c),a.normal.dot(u))){var v=f.vertices.length;f.vertices.push(c.clone()),f.vertices.push(d.clone()),f.vertices.push(e.clone()),f.faces.push(new THREE.Face3(v,v+1,v+2))}}}return f.vertices.length>0?this.getTrianglesOnSameFace(f,a,i,j):null},this.getTrianglesOnSameFace=function(a,b,c,d){var e=!1,f=a.vertices.slice(),g=new THREE.Vector3;g.set(c[b.a*d],c[b.a*d+1],c[b.a*d+2]);var h=new THREE.Vector3;h.set(c[b.b*d],c[b.b*d+1],c[b.b*d+2]);var i=new THREE.Vector3;i.set(c[b.c*d],c[b.c*d+1],c[b.c*d+2]);var j=new THREE.Geometry;j.vertices.push(g),j.vertices.push(h),j.vertices.push(i),j.faces.push(new THREE.Face3(0,1,2));var k=[];do{k=[];for(var l=0;l<f.length;l+=3)if(f[l].equals(g)&&f[l+1].equals(h)&&f[l+2].equals(i))e=!0,k.push(l);else for(var m=0;m<j.vertices.length;m+=3)if(this.trianglesSharedEdge(f[l],f[l+1],f[l+2],j.vertices[m],j.vertices[m+1],j.vertices[m+2])){var n=j.vertices.length;j.vertices.push(f[l].clone()),j.vertices.push(f[l+1].clone()),j.vertices.push(f[l+2].clone()),j.faces.push(new THREE.Face3(n,n+1,n+2)),k.push(l);break}for(var o=k.length-1;o>=0;--o)f.splice(k[o],3)}while(k.length>0);return e?j:null},this.trianglesSharedEdge=function(a,b,c,d,e,f){var g=!1,h=!1,i=!1;return(a.equals(d)||a.equals(e)||a.equals(f))&&(g=!0),(b.equals(d)||b.equals(e)||b.equals(f))&&(h=!0),(c.equals(d)||c.equals(e)||c.equals(f))&&(i=!0),!!(g&h||g&i||h&i)},this.edgeSnappingWithTopology=function(a,b,c,d){var e,f=new THREE.Geometry,g=Number.MAX_VALUE,h=new THREE.Vector3,i=new THREE.Vector3,j=b.attributes;if(void 0!==j.index&&void 0!=c){for(var k=b.vb?b.vb:j.position.array,m=b.vb?b.vbstride:3,n=0;n<c.length;n++)for(var p=c[n].indexList,q=0;q<p.length-1;q++){h.set(k[p[q]*m],k[p[q]*m+1],k[p[q]*m+2]),i.set(k[p[q+1]*m],k[p[q+1]*m+1],k[p[q+1]*m+2]),h.applyMatrix4(d.matrixWorld),i.applyMatrix4(d.matrixWorld);var r=this.distancePointToLine(a,h,i);r<g&&(g=r,e=n)}if(e){p=c[e].indexList;for(var s=0;s<p.length-1;s++)f.vertices.push(new THREE.Vector3(k[p[s]*m],k[p[s]*m+1],k[p[s]*m+2])),f.vertices.push(new THREE.Vector3(k[p[s+1]*m],k[p[s+1]*m+1],k[p[s+1]*m+2]))}}l>=g&&f.vertices.length>0&&(l=g,f.applyMatrix(d.matrixWorld),o=f)},this.edgeSnapping=function(a,b){for(var c=new THREE.Geometry,d=!0,e=!0,f=!0,g=0;g<a.vertices.length;g+=3){for(var h=0;h<a.vertices.length;h+=3)g!==h&&((a.vertices[g].equals(a.vertices[h])||a.vertices[g].equals(a.vertices[h+1])||a.vertices[g].equals(a.vertices[h+2]))&&(a.vertices[g+1].equals(a.vertices[h])||a.vertices[g+1].equals(a.vertices[h+1])||a.vertices[g+1].equals(a.vertices[h+2]))&&(d=!1),(a.vertices[g].equals(a.vertices[h])||a.vertices[g].equals(a.vertices[h+1])||a.vertices[g].equals(a.vertices[h+2]))&&(a.vertices[g+2].equals(a.vertices[h])||a.vertices[g+2].equals(a.vertices[h+1])||a.vertices[g+2].equals(a.vertices[h+2]))&&(e=!1),(a.vertices[g+1].equals(a.vertices[h])||a.vertices[g+1].equals(a.vertices[h+1])||a.vertices[g+1].equals(a.vertices[h+2]))&&(a.vertices[g+2].equals(a.vertices[h])||a.vertices[g+2].equals(a.vertices[h+1])||a.vertices[g+2].equals(a.vertices[h+2]))&&(f=!1));d&&(c.vertices.push(a.vertices[g].clone()),c.vertices.push(a.vertices[g+1].clone())),e&&(c.vertices.push(a.vertices[g].clone()),c.vertices.push(a.vertices[g+2].clone())),f&&(c.vertices.push(a.vertices[g+1].clone()),c.vertices.push(a.vertices[g+2].clone())),d=!0,e=!0,f=!0}for(var i,j=new THREE.Geometry,k=Number.MAX_VALUE,m=0;m<c.vertices.length;m+=2){var n=this.distancePointToLine(b,c.vertices[m],c.vertices[m+1]);n<k&&(k=n,i=m)}return j.vertices.push(c.vertices[i].clone()),j.vertices.push(c.vertices[i+1].clone()),j.vertices=this.getConnectedLineSegmentsOnSameLine(c,j.vertices),l=k,j},this.distancePointToLine=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),e<0?d=a.distanceTo(b):e>1?d=a.distanceTo(c):(f.subVectors(a,b),g.subVectors(a,c),f.cross(g),g.subVectors(c,b),d=Math.sqrt(f.dot(f))/Math.sqrt(g.dot(g))),d},this.getConnectedLineSegmentsOnSameLine=function(a,b){var c=a.vertices.slice(),d=b[0],e=b[1],f=[];do{f=[];for(var g=0;g<c.length;g+=2)if(!c[g].equals(d)||!c[g+1].equals(e))for(var h=0;h<b.length;h+=2)if(c[g].equals(b[h])||c[g+1].equals(b[h])||c[g].equals(b[h+1])||c[g+1].equals(b[h+1])){var i=new THREE.Vector3,j=new THREE.Vector3;if(i.subVectors(b[h],b[h+1]),i.normalize(),j.subVectors(c[g],c[g+1]),j.normalize(),this.isEqualVectorsWithPrecision(i,j)||this.isInverseVectorsWithPrecision(i,j)){f.push(g);break}}for(var k=f.length-1;k>=0;--k)b.push(c[f[k]]),b.push(c[f[k]+1]),c.splice(f[k],2)}while(f.length>0);return b},this.vertexSnappingWithTopology=function(a,b){var c=Number.MAX_VALUE,d=new THREE.Vector3;if(a&&a.vertices.length>1){var e=b.distanceTo(a.vertices[0]),f=b.distanceTo(a.vertices[a.vertices.length-1]);e<=f?(c=e,d=a.vertices[0].clone()):(c=f,d=a.vertices[a.vertices.length-1].clone())}return m=c,d},this.vertexSnapping=function(a,b){for(var c=Number.MAX_VALUE,d=new THREE.Vector3,e=0;e<a.vertices.length;++e){var f=b.distanceTo(a.vertices[e]);f<c-SNAP_PRECISION&&(c=f,d=a.vertices[e].clone())}return m=c,d},this.edgeIsCircle=function(a){var b=a.vertices;if(b.length<8)return!1;if(b[0].equals(b[b.length-1])){for(var c=new THREE.Vector3(0,0,0),d=0;d<b.length;d+=2)c.add(b[d]);c.divideScalar(b.length/2);for(var e=c.distanceTo(b[0]),d=0;d<b.length;d+=2)if(!(Math.abs(c.distanceTo(b[d])-e)<=SNAP_PRECISION))return!1;return c}return!1},this.edgeIsCurved=function(a){var b=a.vertices;if(b.length<=2)return!1;if(b[0].equals(b[b.length-1]))return!0;var c=new THREE.Vector3;c.subVectors(b[0],b[1]);for(var d=new THREE.Vector3,e=2;e<b.length;e+=2)if(d.subVectors(b[e],b[e+1]),!this.isEqualVectorsWithPrecision(c,d))return!0;return!1},this.faceIsCurved=function(a){var b=a.vertices,c=a.faces;if(c.length<=1)return!1;for(var d=THREE.Triangle.normal(b[c[0].a],b[c[0].b],b[c[0].c]),e=b[c[0].a],f=1;f<c.length;f++){var g=THREE.Triangle.normal(b[c[f].a],b[c[f].b],b[c[f].c]),h=b[c[f].a];if(!this.isEqualVectorsWithPrecision(d,g)||!this.isEqualWithPrecision(d.dot(e),g.dot(h)))return!0}return!1},this.angleVector2=function(a){return a.x>0&&a.y>=0?Math.atan(a.y/a.x):a.x>=0&&a.y<0?Math.atan(a.y/a.x)+2*Math.PI:a.x<0&&a.y<=0?Math.atan(a.y/a.x)+Math.PI:a.x<=0&&a.y>0?Math.atan(a.y/a.x)+Math.PI:null},c.prototype.onLineSegment=function(a,b,c,d,e){var f=this.snapper.getIntersectPoint(),g=this.lineGeom.vertices,h=new THREE.Vector3(a,b,f.z),i=new THREE.Vector3(c,d,f.z),j=this.snapper.distancePointToLine(f,h,i);j<=this.detectRadius&&j<this.minDist&&(g.splice(0,2,h,i),this.minDist=j,this.vpIdLine=e)},c.prototype.onCircularArc=function(a,b,c,d,e,f){var g=this.snapper.getIntersectPoint(),h=new THREE.Vector2(g.x,g.y),i=new THREE.Vector2(a,b),j=h.distanceTo(i);h.sub(i);var k=this.snapper.angleVector2(h);if(Math.abs(j-e)<=this.detectRadius){if(d>c&&k>=c&&k<=d)var l=new THREE.CircleGeometry(e,100,c,d-c);else{if(!(d<c&&(k>=c||k<=d)))return;var l=new THREE.CircleGeometry(e,100,c,2*Math.PI-c+d)}l.vertices.splice(0,1),l.applyMatrix((new THREE.Matrix4).makeTranslation(a,b,g.z)),this.circularArc=l,this.circularArcCenter=new THREE.Vector3(a,b,g.z),this.circularArcRadius=e,this.vpIdCircular=f}},c.prototype.onEllipticalArc=function(a,b,c,d,e,f,g,h){var i=this.snapper.getIntersectPoint(),j=new THREE.Vector2(i.x,i.y),k=e-this.detectRadius,l=f-this.detectRadius,m=e+this.detectRadius,n=f+this.detectRadius,o=(j.x-a)*(j.x-a)/(k*k)+(j.y-b)*(j.y-b)/(l*l),p=(j.x-a)*(j.x-a)/(m*m)+(j.y-b)*(j.y-b)/(n*n),q=new THREE.Vector2(a,b);j.sub(q),j.x*=f,j.y*=e;var r=this.snapper.angleVector2(j);if(d>2*Math.PI&&(d=2*Math.PI),o>=1&&p<=1&&(d>c&&r>=c&&r<=d||d<c&&(r>=c||r<=d))){var s=new THREE.EllipseCurve(a,b,e,f,c,d,!1),t=new THREE.Path(s.getPoints(50)),u=t.createPointsGeometry(50);this.snapper.isEqualWithPrecision(d-c,2*Math.PI)||u.vertices.pop(),u.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,i.z)),this.ellipticalArc=u,this.ellipticalArcCenter=new THREE.Vector3(a,b,i.z),this.vpIdElliptical=h}};var F=function(a,b){var c=4*window.devicePixelRatio,d=!C||!D||Math.abs(C-a)<c&&Math.abs(D-b)<c;return C=a,D=b,d};this.snapping2D=function(a){if(a){var b=a.intersectPoint,d=a.fragId;if(void 0!==d){Array.isArray(d)||(d=[d]),s=b,k=this.setDetectRadius(b);if(!(null!=e.model.getFragmentList()))return w=!0,r=SNAP_VERTEX,p=b,void this.drawPoint(p);for(var g=new c(e,this),h=0;h<d.length;++h){var i=e.impl.getRenderProxy(e.model,d[h]);new Autodesk.Viewing.Private.VertexBufferReader(i.geometry,e.impl.use2dInstancing).enumGeomsForObject(a.dbId,g)}if(g.circularArc){if(x=g.vpIdCircular,null!==B&&B!==x)return;b.distanceTo(g.circularArc.vertices[0])<k?(p=g.circularArc.vertices[0],this.drawPoint(p),r=SNAP_VERTEX):b.distanceTo(g.circularArc.vertices[g.circularArc.vertices.length-1])<k?(p=g.circularArc.vertices[g.circularArc.vertices.length-1],this.drawPoint(p),r=SNAP_VERTEX):(this.lineStripToPieces(g.circularArc),o=g.circularArc,this.drawLine(o),y=g.circularArcCenter,z=g.circularArcRadius,r=SNAP_CIRCULARARC),w=!0}else if(g.ellipticalArc){if(x=g.vpIdElliptical,null!==B&&B!==x)return;b.distanceTo(g.ellipticalArc.vertices[0])<k?(p=g.ellipticalArc.vertices[0],this.drawPoint(p),r=SNAP_VERTEX):b.distanceTo(g.ellipticalArc.vertices[g.ellipticalArc.vertices.length-1])<k?(p=g.ellipticalArc.vertices[g.ellipticalArc.vertices.length-1],this.drawPoint(p),r=SNAP_VERTEX):(this.lineStripToPieces(g.ellipticalArc),o=g.ellipticalArc,this.drawLine(o),y=g.ellipticalArcCenter,z=null,r=SNAP_CIRCULARARC),w=!0}else if(g.lineGeom.vertices.length){if(x=g.vpIdLine,null!==B&&B!==x)return;if(this.markupMode){var j=g.lineGeom.vertices[0],l=g.lineGeom.vertices[1],m=new THREE.Vector3;m.addVectors(j,l),m.divideScalar(2);var n=b.distanceTo(m),q=b.distanceTo(j),t=b.distanceTo(l);o=g.lineGeom,n<k?(p=m,this.drawPoint(p),r=SNAP_VERTEX):q<k?(p=j,this.drawPoint(p),r=SNAP_VERTEX):t<k?(p=l,this.drawPoint(p),r=SNAP_VERTEX):(this.drawLine(o),r=SNAP_EDGE)}else b.distanceTo(g.lineGeom.vertices[0])<k?(p=g.lineGeom.vertices[0],this.drawPoint(p),r=SNAP_VERTEX):f.forceSnapVertices||b.distanceTo(g.lineGeom.vertices[1])<k?(p=g.lineGeom.vertices[1],this.drawPoint(p),r=SNAP_VERTEX):(o=g.lineGeom,this.drawLine(o),r=SNAP_EDGE);w=!0}}}},this.snappingLeaflet=function(a){if(a){var b=a.intersectPoint;s=b,k=this.setDetectRadius(b),this.drawPoint(b),r=SNAP_VERTEX,p=b,w=!0}},this.lineStripToPieces=function(a){for(var b=a.vertices,c=b.length-2;c>0;c--)b.splice(c,0,b[c])},this.createOverlay=function(){e.impl.overlayScenes[i]?j!=NO_OVERLAY&&e.impl.clearOverlay(i):e.impl.createOverlayScene(i)},this.addOverlay=function(a){e.impl.addOverlay(i,a)},this.clearOverlay=function(){e.impl.overlayScenes[i]&&e.impl.clearOverlay(i),j=NO_OVERLAY};var G=null;this.drawFace=function(a){this.createOverlay(),G||d();var b=new THREE.Mesh(a,G,!0);j=FACE_OVERLAY,this.addOverlay(b)};var H=null;this.cylinderMesh=function(a,b,c){var d=(new THREE.Vector3).subVectors(b,a),e=new THREE.Matrix4;e.lookAt(a,b,(new THREE.Object3D).up),e.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-d.length(),0,0,0,0,0,1)),H||(H=new THREE.CylinderGeometry(.5,.5,1,8,1,!0));var f=new THREE.Mesh(H,c);return f.applyMatrix(e),f.position.x=(b.x+a.x)/2,f.position.y=(b.y+a.y)/2,f.position.z=(b.z+a.z)/2,f},this.drawLine=function(a){this.createOverlay(),G||d(),j=EDGE_OVERLAY;for(var b=0;b<a.vertices.length;b+=2){var c=this.cylinderMesh(a.vertices[b],a.vertices[b+1],G);this.setEdgeScale(c),this.addOverlay(c)}},this.drawArc=function(a){this.createOverlay(),G||d(),j=EDGE_OVERLAY;for(var b=0;b<a.vertices.length-1;b++){var c=this.cylinderMesh(a.vertices[b],a.vertices[b+1],G);this.setEdgeScale(c),this.addOverlay(c)}};var I=null;this.drawPoint=function(a){this.createOverlay(),G||d(),I||(I=new THREE.SphereGeometry(1));var b=new THREE.Mesh(I,G);b.position.set(a.x,a.y,a.z),this.setPointScale(b),j=POINT_OVERLAY,this.addOverlay(b)},this.setScale=function(a){var b=e.navigation,c=b.getCamera(),d=b.getEyeVector(),f=b.getPosition(),g=a.position.clone(),h=c.isPerspective?g.sub(f).dot(d.normalize()):b.getEyeVector().length(),i=b.getVerticalFov(),j=2*h*Math.tan(THREE.Math.degToRad(.5*i)),k=b.getScreenViewport(),l=window.devicePixelRatio||1;return 5*j/(k.height*l)},this.setPointScale=function(a){var b=this.setScale(a);a.scale.x=b,a.scale.y=b,a.scale.z=b},this.setEdgeScale=function(a){var b=this.setScale(a);a.scale.x=b,a.scale.z=b},this.updatePointScale=function(){if(j==POINT_OVERLAY){var a=e.impl.overlayScenes[i];if(a)for(var b=a.scene,c=0;c<b.children.length;c++){var d=b.children[c];d&&this.setPointScale(d)}}},this.updateEdgeScale=function(){if(j==EDGE_OVERLAY){var a=e.impl.overlayScenes[i];if(a)for(var b=a.scene,c=0;c<b.children.length;c++){var d=b.children[c];d&&this.setEdgeScale(d)}}},this.setDetectRadius=function(a){var b=av.isMobileDevice()?25:10,c=e.navigation,d=c.getCamera(),f=c.getEyeVector(),g=c.getPosition(),h=a.clone(),i=d.isPerspective?h.sub(g).dot(f.normalize()):c.getEyeVector().length(),j=c.getVerticalFov(),k=2*i*Math.tan(THREE.Math.degToRad(.5*j)),l=c.getScreenViewport(),m=window.devicePixelRatio||1;return b*k/(l.height*m)},this.drawIntersectFace=function(a,b,c,d){this.createOverlay();var e=new THREE.Vector3;e.set(b[a.a*c],b[a.a*c+1],b[a.a*c+2]);var f=new THREE.Vector3;f.set(b[a.b*c],b[a.b*c+1],b[a.b*c+2]);var g=new THREE.Vector3;g.set(b[a.c*c],b[a.c*c+1],b[a.c*c+2]);var h=new THREE.Geometry;h.vertices.push(e),h.vertices.push(f),h.vertices.push(g),h.faces.push(new THREE.Face3(0,1,2));var i=new THREE.Mesh(h,d.material,!0);i.matrixWorld=d.matrixWorld,this.addOverlay(i)},this.handleWheelInput=function(a){return this.updatePointScale(),this.updateEdgeScale(),!1},this.handleButtonDown=function(a,b){return u=!0,!1},this.handleButtonUp=function(a,b){return u=!1,!1},this.handleMouseMove=function(a){if(!u&&(this.clearOverlay(),this.clearSnapped(),!av.isMobileDevice()||F(a.canvasX,a.canvasY))){var b=e.impl.snappingHitTest(a.canvasX,a.canvasY,!1);b&&b.intersectPoint&&(b.face?this.snapping3D(b):b.dbId?this.snapping2D(b):this.snappingLeaflet(b))}return!1},this.handleSingleTap=function(a){return this.handleMouseMove(a)},this.destroy=function(){this.clearOverlay(),e.impl.removeOverlayScene(i),I&&(I.dispose(),I=null),H&&(H.dispose(),H=null)},this.handlePressHold=function(a){if(av.isMobileDevice())switch(a.type){case"press":v=!0,this.onMouseMove({x:a.canvasX,y:a.canvasY});break;case"pressup":this.onMouseMove({x:a.canvasX,y:a.canvasY}),v=!1}return!1},this.handleGesture=function(a){if(v&&av.isMobileDevice())switch(a.type){case"dragstart":this.onMouseMove({x:a.canvasX,y:a.canvasY});break;case"dragmove":this.onMouseMove({x:a.canvasX,y:a.canvasY});break;case"dragend":this.onMouseMove({x:a.canvasX,y:a.canvasY}),v=!1;break;case"pinchstart":break;case"pinchmove":break;case"pinchend":}return!1},this.onMouseDown=function(a){this.onMouseMove(a)},this.onMouseMove=function(a){if(this.clearOverlay(),this.clearSnapped(),!av.isMobileDevice()||F(a.x,a.y)){var b=e.impl.snappingHitTest(a.x,a.y,!1);b&&b.intersectPoint&&(b.face?this.snapping3D(b):b.dbId?this.snapping2D(b):this.snappingLeaflet(b))}},this.nearestPointInPointToEdge=function(a,b){for(var c=a.vertices,d=Number.MAX_VALUE,e=null,f=0;f<c.length;f+=2){var g=this.nearestPointInPointToSegment(b,c[f],c[f+1]),h=b.distanceTo(g);h<d&&(d=h,e=g)}return e},this.nearestPointInPointToSegment=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),e<0?d=b:e>1?d=c:(f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)),d},this.nearestPointInPointToLine=function(a,b,c){var d,e=new THREE.Vector3,f=new THREE.Vector3;return e.subVectors(b,a),f.subVectors(c,b),d=e.dot(f),e.subVectors(c,b),d=-d/e.dot(e),e.subVectors(c,b),e.multiplyScalar(d),e.add(b)}},AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MagnifyingGlass=function(a){function b(){for(var a,b=0,c=4*h.width,d=c*h.height;(d-=c)>0;){for(a=0;a<c;++a)i[d++]=j[b++];d-=c}}var c=a,d=!1,e=["magnifyingGlass"],f=!1,g=null,h=null,i=null,j=null;this.isActive=function(){return d},this.activate=function(){d=!0},this.deactivate=function(){d=!1},this.getNames=function(){return e},this.getName=function(){return e[0]},this.setGlassPosition=function(a,b,c,d,e){a.style.left=b-d-e>0?b-d-e+"px":b+e+"px",a.style.top=c-d-e>0?c-d-e+"px":c+e+"px"},this.drawMagnifyingGlass=function(a,d){var e=window.devicePixelRatio,f=80*e,k=e*(a-20),l=e*(d-20);g||(g=document.createElement("canvas"),g.className="magnifying-glass",g.width=f,g.height=f,g.style.width="80px",g.style.height="80px",c.container.appendChild(g),h=new ImageData(Math.ceil(f/2),Math.ceil(f/2)),i=new Uint8Array(h.data.buffer),j=new Uint8Array(4*h.width*h.height));var m=g.getContext("2d");m.fillStyle="#FFFFFF",m.fillRect(0,0,f,f);var n=c.canvas.getContext("webgl");c.impl.glrenderer().setRenderTarget(null),n.readPixels(k,c.canvas.height-l-h.height,h.width,h.height,n.RGBA,n.UNSIGNED_BYTE,j),b(),m.putImageData(h,0,0),m.drawImage(g,0,0,h.width,h.height,0,0,f,f),this.setGlassPosition(g,a,d,80,15),g.classList.toggle("visible",!0)},this.clearMagnifyingGlass=function(){g.classList.remove("visible")},this.handlePressHold=function(a){if(av.isMobileDevice())switch(a.type){case"press":f=!0,this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"pressup":this.clearMagnifyingGlass(),f=!1}return!1},this.handleGesture=function(a){if(f&&av.isMobileDevice())switch(a.type){case"dragstart":this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"dragmove":this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"dragend":this.clearMagnifyingGlass(),f=!1;break;case"pinchstart":this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"pinchmove":this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"pinchend":this.clearMagnifyingGlass()}return!1},this.handleMouseMove=function(a){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonUp=function(a,b){return!1}},function(){AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(a){function b(a){if(p)return!1;var b=a.ctrlKey||e&&a.metaKey,c=a.metaKey&&!e;return b||c||a.shiftKey||a.altKey}var c,d=Autodesk.Viewing.Private,e=navigator.userAgent.search("Mac OS")!=-1,f=a.navigation,g=a.container,h=f.getCamera(),i=["firstperson"],j={SHIFT:0,ALT:0,CONTROL:0},k=Autodesk.Viewing.theHotkeyManager.KEYCODES,l=!1,m=!0,n=!1,o=0,p=null,q=new THREE.Clock(!0),r=-1,s=5e3,t=1,u=1,v=2,w=0,x=0,y=0,z=-1e20,A=0,B=0,C=-1e20,D=0,E=0,F=!1,G=!1,H=!1,I=!1,J=!1,K=!1,L=h.fov,M=h.isPerspective,N=!1;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(c=new Autodesk.Viewing.Extensions.GamepadModule(a)),this.isActive=function(){return l},this.getNames=function(){return i},this.getName=function(){return i[0]},this.activate=function(b){q.start(),M=h.isPerspective,f.toPerspective(),L=h.fov,
f.setVerticalFov(75,!0),t=a.model.getUnitScale();var d=a.model.getBoundingBox().size();u=Math.max(Math.min(Math.min(d.x,d.y),d.z)/10,1e-4),a.canvas.focus(),l=!0,a.getFirstPersonToolPopup()&&!N&&R(),addCrosshair(),c&&c.activate(this.getName())},this.deactivate=function(a){l=!1,q.stop(),P(),removeCrosshair(),c&&c.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(a){0===a?v=2:(v*=a>0?1.1:.9)<.01&&(v=.01)},this.handleGesture=function(a){switch(a.pointers&&a.pointers.length>0&&(a.pageX=a.pointers[0].pageX,a.pageY=a.pointers[0].pageY),a.type){case"dragstart":return p="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===p&&this.handleMouseMove(a);case"dragend":return"drag"===p&&(this.handleButtonUp(a,0),p=null,!0)}return!1},this.handleSingleClick=function(a,b){return!1},this.handleButtonDown=function(a,c){P(),o+=1<<c;var d=b(a);return!(0===c&&!d)||(x=a.pageX-window.innerWidth/2,A=a.pageY-window.innerHeight/2,z=a.pageX,C=a.pageY,D=E=0,y=B=0,n=!0,!0)},this.handleMouseMove=function(a){var b=z<-1e10?0:a.pageX-z,c=C<-1e10?0:a.pageY-C;return z=a.pageX,C=a.pageY,n===m&&(D+=.0035*b,E+=.0035*c),!0},this.handleButtonUp=function(a,b){return o-=1<<b,0!==b||!n||(D=E=0,y=B=0,n=!1,!0)},this.handleKeyDown=function(a,b){P();var c=!1;switch(b){case k.ESCAPE:break;case k.TAB:c=!1;break;case k.SHIFT:j.SHIFT=1,c=!0;break;case k.CONTROL:j.CONTROL=1,c=!0;break;case k.ALT:j.ALT=1,c=!0;break;case k.SPACE:j.SPACE=1,c=!0;break;case k.EQUALS:this.adjustSpeed(1),c=!0;break;case k.DASH:this.adjustSpeed(-1),c=!0;break;case k.ZERO:this.adjustSpeed(0),c=!0;break;case k.UP:case k.w:F=!0,c=!0;break;case k.LEFT:case k.a:H=!0,c=!0;break;case k.DOWN:case k.s:G=!0,c=!0;break;case k.RIGHT:case k.d:I=!0,c=!0;break;case k.q:J=!0,c=!0;break;case k.e:K=!0,c=!0;break;case k.g:c=!0;break;case k.F1:c=!0}return c},this.handleKeyUp=function(a,b){var c=!1;switch(b){case k.TAB:c=!1;break;case k.SHIFT:j.SHIFT=0,c=!0;break;case k.CONTROL:j.CONTROL=0,c=!0;break;case k.ALT:j.ALT=0,c=!0;break;case k.SPACE:j.SPACE=0,c=!0;break;case k.UP:case k.w:F=!1,c=!0;break;case k.LEFT:case k.a:H=!1,c=!0;break;case k.DOWN:case k.s:G=!1,c=!0;break;case k.RIGHT:case k.d:I=!1,c=!0;break;case k.q:J=!1,c=!0;break;case k.e:K=!1,c=!0;break;case k.g:y=B=0,m=!m,Q(m),c=!0;break;case k.F1:R(),c=!0}return c},this.handleWheelInput=function(a){return f.getReverseZoomDirection()&&(a*=-1),w+=a,!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!1},this.handleBlur=function(a){return F=G=!1,H=I=!1,J=K=!1,!1},this.update=function(){if(!l||!f.isActionEnabled("walk"))return!1;var a=q.getDelta();if(r>-1){(new Date).getTime()-r>s&&P()}h.isPerspective||(console.log("Lost perspective mode: resetting view."),f.toPerspective());var b=h.clone(),d=a*v*u*(1===j.SHIFT?4:1),e=.5*a*u*(1===j.SHIFT?4:1);if(0!=w){var g=1*w*u*(1===j.SHIFT?4:1);b.translateZ(-g),w=0}F&&b.translateZ(-d),G&&b.translateZ(d),H&&b.translateX(-d),I&&b.translateX(d),J&&b.translateY(e),K&&b.translateY(-e);var i=b.position,k=0!==i.distanceToSquared(h.position),m=b.target,n=h.target.clone().sub(h.position),o=n.clone().cross(h.up).normalize();if(0!=E){var p=new THREE.Quaternion;p.setFromAxisAngle(o,-E);var t=n.clone();t.applyQuaternion(p);var x=h.worldup.clone(),y=t.angleTo(x),z=THREE.Math.degToRad(5);y>=z&&y<=Math.PI-z&&(n.applyQuaternion(p),b.up.applyQuaternion(p)),E=0}if(0!=D){var A=new THREE.Quaternion;A.setFromAxisAngle(h.worldup,-D),n.applyQuaternion(A),b.up.applyQuaternion(A),D=0}m=i.clone().add(n);var B=0!==m.distanceToSquared(h.target);return(k||B)&&(f.setView(i,m),f.orientCameraUp()),c&&(h=c.update(h)),h.dirty};var O=function(a,b,c,d,e){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(g,a,c,d,e),b>0?(r=(new Date).getTime(),s=b):(r=-1,s=0))},P=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),r=-1},Q=function(a){P();var b=a?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation";O({msgTitleKey:"First Person Tool",messageKey:b,messageDefaultValue:b},0,function(){})},R=function(){P(),O({msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",checkboxChecked:N},0,function(){},null,function(b){N=b.target.checked,a.setFirstPersonToolPopup(!b.target.checked)})};addCrosshair=function(){d.stringToDOM&&(this.crosshair=d.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),a.canvasWrap.appendChild(this.crosshair))},removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension,Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var a=this,b=this.viewer,c=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(b),b.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(b){if(b.toolName.indexOf("firstperson")!==-1&&a.firstPersonToolButton){var d=b.active?c.Button.State.ACTIVE:c.Button.State.INACTIVE;a.firstPersonToolButton.setState(d)}},b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar){var b=this,c=Autodesk.Viewing.UI,d=a.getToolbar(!0),e=d.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new c.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(d){var e=b.firstPersonToolButton.getState();e===c.Button.State.INACTIVE?a.setActiveNavigationTool("firstperson"):e===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.firstPersonToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.firstPersonToolButton)}},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId()),this.firstPersonToolButton=null}return a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension)}(),function(){function a(a,b,c,e){var f=c.impl.camera,g=f.worldup,h=f.position,i=d[0].copy(h);i.sub(d[1].copy(g).multiplyScalar(a));var j,k,l,m=d[1].set(-g.x,-g.y,-g.z),n=c.impl.rayIntersect(new THREE.Ray(h,m),!0,!0)||c.impl.rayIntersect(new THREE.Ray(h,g),!0,!0);if(n)k=n.intersectPoint;else{var o=d[1].copy(g).multiplyScalar(i.dot(g)),p=d[2].copy(g).multiplyScalar(b);k=d[3].copy(i).sub(o),k=k.add(p)}j=d[4].copy(k).sub(i).length(),l=d[5].copy(k).sub(i),l=0!==j?l.normalize():l,e.floor=k,e.distanceFromFloor=j,e.floorDirection=l}function b(a,b){return Autodesk.Viewing.Private.convertUnits("meters",b.model.getUnitString(),1,a,"default")}function c(a){for(var b={x:1,y:1},c=a.model.getBoundingBox(),d=a.model.getUnitString(),e=Autodesk.Viewing.Private.convertUnits(d,"meters",1,c.max.x-c.min.x,"default"),f=Autodesk.Viewing.Private.convertUnits(d,"meters",1,c.max.y-c.min.y,"default"),g=Autodesk.Viewing.Private.convertUnits(d,"meters",1,c.max.z-c.min.z,"default"),h=Math.max(e,g);h<1;)h*=10,b.x*=.1;for(var i=f;i<1;)i*=10,b.y*=.1;return b.x=b.x>=1?b.x:b.x*Math.round(h)*.5,b.y=b.y>=1?b.y:b.y*Math.round(i)*.5,b}AutodeskNamespace("Autodesk.Viewing.Extensions.BimWalk");var d=[];Autodesk.Viewing.Extensions.BimWalk.BimWalkTool=function(e){function f(a){if(y)return!1;var b=a.ctrlKey||h&&a.metaKey,c=a.metaKey&&!h;return b||c||a.shiftKey||a.altKey}var g,h=navigator.userAgent.search("Mac OS")!=-1,i=e.navigation,j=i.getCamera(),k=["bimwalk"],l={SHIFT:0,ALT:0,CONTROL:0},m=Autodesk.Viewing.theHotkeyManager.KEYCODES,n=!1,o=!0,p=9.8,q=!1,r=0,s=0,t=0,u=0,v=0,w=!1,x=0,y=null,z=new THREE.Clock(!0),A=4,B=2,C=2,D=0,E=0,F=0,G=0,H=-1e20,I=0,J=0,K=-1e20,L=0,M=0,N=!1,O=!1,P=!1,Q=!1,R=!1,S=!1,T=j.fov,U=j.isPerspective;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(g=new Autodesk.Viewing.Extensions.GamepadModule(e));for(var V=0;V<10;++V)d.push(new THREE.Vector3(0,0,0));this.isActive=function(){return n},this.getNames=function(){return k},this.getName=function(){return k[0]},this.activate=function(a){n=!0,z.start(),U=j.isPerspective,i.toPerspective();(function(){var a=e.navigation.getScreenViewport();return a.width/a.height}).bind(this);T=j.fov,i.setVerticalFov(60,!0);var d=c(e);A=b(4,e)*d.x,B=b(1,e)*d.x,C=b(2,e)*d.y,p=b(9.8,e)*d.y,v=10*p*d.y,r=e.model.getData().globalOffset.y||0,s=b(1.8,e)*d.y,t=s-.5*s,u=s+.5*s,e.canvas.focus(),g&&g.activate(this.getName())},this.deactivate=function(a){n=!1,z.stop(),g&&g.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.handleGesture=function(a){switch(a.pointers&&a.pointers.length>0&&(a.pageX=a.pointers[0].pageX,a.pageY=a.pointers[0].pageY),a.type){case"dragstart":return y="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===y&&this.handleMouseMove(a);case"dragend":return"drag"===y&&(this.handleButtonUp(a,0),y=null,!0)}return!1},this.handleSingleClick=function(a,b){return!1},this.handleButtonDown=function(a,b){x+=1<<b;var c=f(a);return!(0===b&&!c)||(F=a.pageX-window.innerWidth/2,I=a.pageY-window.innerHeight/2,H=a.pageX,K=a.pageY,L=M=0,G=J=0,w=!0,!0)},this.handleMouseMove=function(a){var b=H<-1e10?0:a.pageX-H,c=K<-1e10?0:a.pageY-K;return H=a.pageX,K=a.pageY,w&&(L+=.0035*b,M+=.0035*c),!0},this.handleButtonUp=function(a,b){return x-=1<<b,0!==b||!w||(L=M=0,G=J=0,w=!1,!0)},this.handleKeyDown=function(a,b){switch(b){case m.SHIFT:case m.CONTROL:case m.ALT:return!0;case m.SPACE:return o=!o,!0;case m.UP:case m.w:return N=!0,!0;case m.LEFT:case m.a:return P=!0,!0;case m.DOWN:case m.s:return O=!0,!0;case m.RIGHT:case m.d:return Q=!0,!0;case m.r:return R=!0,!0;case m.f:return S=!0,!0}return!1},this.handleKeyUp=function(a,b){switch(b){case m.SHIFT:case m.CONTROL:case m.ALT:return!0;case m.SPACE:return!0;case m.UP:case m.w:return N=!1,!0;case m.LEFT:case m.a:return P=!1,!0;case m.DOWN:case m.s:return O=!1,!0;case m.RIGHT:case m.d:return Q=!1,!0;case m.r:return R=!1,!0;case m.f:return S=!1,!0}return!1},this.handleWheelInput=function(a){return i.getReverseZoomDirection()&&(a*=-1),D+=a,!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!1},this.handleBlur=function(a){return N=O=!1,P=Q=!1,R=S=!1,!1},this.update=function(){if(!n||!i.isActionEnabled("walk"))return!1;var b=z.getDelta();j.isPerspective||(console.log("Lost perspective mode: resetting view."),i.toPerspective());var c=j.clone(),d=c.position,f=0!==d.distanceToSquared(j.position),h=j.target.clone().sub(j.position),k=h.clone().cross(j.worldup).normalize();if(0!==M){var m=new THREE.Quaternion;m.setFromAxisAngle(k,-M);var w=h.clone();w.applyQuaternion(m);var x=j.worldup.clone(),y=w.angleTo(x),F=THREE.Math.degToRad(5);y>=F&&y<=Math.PI-F&&(h.applyQuaternion(m),c.up.applyQuaternion(m)),M=0}if(0!==L){var G=new THREE.Quaternion;G.setFromAxisAngle(j.worldup,-L),h.applyQuaternion(G),c.up.applyQuaternion(G),L=0}var H=j.worldup,I=h.clone();I.sub(H.clone().multiplyScalar(H.dot(I))),I.normalize();var J=k.clone();J.sub(H.clone().multiplyScalar(H.dot(J))),J.normalize();var K=b*A*(1===l.SHIFT?4:1),T=b*C*(1===l.SHIFT?4:1),U=new THREE.Vector3(0,0,0);0!==D?(U.add(I),K=D*B*(1===l.SHIFT?4:1),D=0):(N&&U.add(I),O&&U.sub(I),P&&U.sub(J),Q&&U.add(J),0!==U.lengthSq()&&U.normalize()),c.position.add(U.multiplyScalar(K));H.clone().multiplyScalar(-1);if(o){R&&(s=Math.min(u,s+T)),S&&(s=Math.max(t,s-T));var V={};a(s,r,e,V);var W=Math.acos(V.floorDirection.dot(H))>Math.PI/4;if(q=V.distanceFromFloor<1e-5||q&&W&&V.distanceFromFloor<s)c.position=V.floor.add(V.floorDirection.multiplyScalar(V.distanceFromFloor+s)),E=0;else{E=Math.min(v,E+b*p);var X=E*b;X>V.distanceFromFloor&&(X=V.distanceFromFloor),c.position.add(V.floorDirection.multiplyScalar(X))}}else q=!1,R&&c.position.add(H.multiplyScalar(T)),S&&c.position.sub(H.multiplyScalar(T));newTarget=d.clone().add(h);var Y=0!==newTarget.distanceToSquared(j.target);return(f||Y)&&(i.setView(d,newTarget),i.orientCameraUp()),g&&(j=g.update(j)),j.dirty}}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.BimWalk"),Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.constructor=Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension,Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.load=function(){var a=this,b=this.viewer,c=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.BimWalk.BimWalkTool(b),b.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(b){if(b.toolName.indexOf("bimwalk")!==-1&&a.bimWalkToolButton){var d=b.active?c.Button.State.ACTIVE:c.Button.State.INACTIVE;a.bimWalkToolButton.setState(d)}},b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar){var b=this,c=Autodesk.Viewing.UI,d=a.getToolbar(!0),e=d.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.bimWalkToolButton=new c.Button("toolbar-BimWalkTool"),this.bimWalkToolButton.setToolTip("BIM Walk"),this.bimWalkToolButton.onClick=function(d){var e=b.bimWalkToolButton.getState();e===c.Button.State.INACTIVE?a.setActiveNavigationTool("bimwalk"):e===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.bimWalkToolButton.setIcon("adsk-icon-first-person");var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.bimWalkToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.bimWalkToolButton)}},Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.bimWalkToolButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.bimWalkToolButton.getId()),this.bimWalkToolButton=null}return a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.BimWalk",Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.WebVR"),Autodesk.Viewing.Extensions.WebVR.StereoRenderContext=function(a,b,c,d){function e(a,b,c,d,e){a.matrixWorld.decompose(e.position,e.quaternion,e.scale),d&&e.position.set(0,0,0),e.translateOnAxis(c?m:n,q),e.projectionMatrix.elements=c?b.leftProjectionMatrix:b.rightProjectionMatrix}var a,f,g,h,i,j,k=a.getEyeParameters("left"),l=a.getEyeParameters("right"),m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.PerspectiveCamera,p=new THREE.PerspectiveCamera,q=10*a.modelScaleFactor,r=null;this.init=function(c,e,j){f=new avp.RenderContext,g=c;var o=1.5*window.devicePixelRatio;h=2*a.getEyeParameters("left").renderWidth/o,i=a.getEyeParameters("right").renderHeight/o,this.settings=f.settings,f.init(g,h,i),m.fromArray(k.offset),n.fromArray(l.offset),r=new VRFrameData,b.worldup&&1==b.worldup.z&&(d.webVR_orbitModel=!1)},this.modeFusion=function(c){var d=new THREE.Vector3(0,0,1);d.applyQuaternion((new THREE.Quaternion).fromArray(c.orientation)).multiplyScalar(2.1*q),b.position.set(d.x,d.y,d.z),b.lookAt(a.target),b.up.set(0,1,0)},this.modeWalkthrough=function(a){a.orientation&&0!=a.orientation[1]&&b.quaternion.fromArray(a.orientation),a.position&&0!=a.position[0]&&b.position.fromArray(a.position).multiplyScalar(q),b.worldup&&1==b.worldup.z&&(b.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2),b.quaternion.multiply((new THREE.Quaternion).fromArray(a.orientation)),a.position&&0!=a.position[0]&&b.position.set(b.position.x,-b.position.z,b.position.y));var c=new THREE.Vector3(0,0,-1);c.applyQuaternion(b.quaternion),b.target=b.position.clone().add(c.clone().multiplyScalar(10))},this.updateCamera=function(){if(a&&a._isPresenting&&(a.depthNear=b.near,a.depthFar=b.far,a.getFrameData(r),j=r.pose,j.orientation))return d.webVR_orbitModel?this.modeFusion(j):this.modeWalkthrough(j),b.updateMatrixWorld(),b.dirty=!0,e(b,r,!0,!1,o),e(b,r,!1,!1,p),c&&(c.camera=b.clone(),c.camera.position.set(0,0,0),e(b,r,!0,!0,c.cameraL),e(b,r,!1,!0,c.cameraR)),{L:o,R:p,C:b}},this.beginScene=function(a,c,d,e){f.beginScene(a,b,d,e)},this.renderScenePart=function(a,b,d,e,j){var k=h/2;g.setViewport(0,0,k,i),f.setCamera(o),f.renderScenePart(a,!0,!1,!1,!1),g.setViewport(k,0,k,i),f.setCamera(p),f.renderScenePart(a,!0,!1,!1,!1),c&&(g.setViewport(0,0,k,i),f.setCamera(c.cameraL),f.renderScenePart(c.scene,!0,!1,!1,!1),g.setViewport(k,0,k,i),f.setCamera(c.cameraR),f.renderScenePart(c.scene,!0,!1,!1,!1)),g.setViewport(0,0,h,i)},this.sceneDirty=function(a,b){f.sceneDirty(a,b)},this.endScene=function(){f.endScene()},this.clearAllOverlays=function(){},this.renderOverlays=function(a){},this.composeFinalFrame=function(b,c){f.composeFinalFrame(!0,c),a._isPresenting&&a.submitFrame()},this.cleanup=function(){f.cleanup()},this.setSize=function(a,b,c){h=a,i=b,f.setSize(h,i,c)},this.getMaxAnisotropy=function(){return f.getMaxAnisotropy()},this.hasMRT=function(){return f.hasMRT()},this.initPostPipeline=function(a,b,c){f.initPostPipeline(!1,!1,!1)},this.setClearColors=function(a,b){f.setClearColors(a,b)},this.setAOOptions=function(a,b){f.setAOOptions(a,b)},this.getAORadius=function(){return f.getAORadius()},this.getAOIntensity=function(){return f.getAOIntensity()},this.setTonemapExposureBias=function(a){f.setTonemapExposureBias(a)},this.getExposureBias=function(){return f.getExposureBias()},this.setTonemapMethod=function(a){f.setTonemapMethod(a)},this.getToneMapMethod=function(){return f.getToneMapMethod()},this.toggleTwoSided=function(a){f.toggleTwoSided(a)},this.enter2DMode=function(a){f.enter2DMode(a)},this.getAOEnabled=function(){return!1},this.idAtPixel=function(a,b){return 0},this.overlayUpdate=function(a){f.overlayUpdate(a)},this.rolloverObjectViewport=function(a,b){},this.screenCapture=function(){return console.warn("Screen capture not implemented by stereo render context"),null},this.setUnitScale=function(a){f.setUnitScale(a)},this.getUnitScale=function(){return f.getUnitScale()},this.getColorTarget=function(){return null}},AutodeskNamespace("Autodesk.Viewing.Extensions.WebVR"),Autodesk.Viewing.Extensions.WebVR.VRExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.WebVR.VRExtension.populateDefaultOptions=function(a){a.experimental.push("--webVR_orbitModel"),a.experimental.push("--webVR_cursor"),a.experimental.push("--webVR_menu")},Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.constructor=Autodesk.Viewing.Extensions.WebVR.VRExtension,Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.load=function(){var a=this,b=null;return avp.loadDependency("VRFrameData","webvr-polyfill.min.js",function(){navigator.getVRDisplays().then(function(c){if(c.length>0&&(b=c[0],b.capabilities.canPresent)){var d=a.viewer,e=d.getToolbar(!0),f=Autodesk.Viewing.UI;return a.tool=new Autodesk.Viewing.Extensions.WebVR.VRTool(d,a,b),d.toolController.registerTool(a.tool),a.createUI(e),a.onToolChanged=function(b){var c="vr"===b.toolName&&b.active,d=c?f.Button.State.ACTIVE:f.Button.State.INACTIVE;a.vrToolButton&&a.vrToolButton.setState(d)},void d.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,a.onToolChanged)}avp.logger.warn("Attempted to load WebVR extension, but WebVR is not supported.")})}),!0},Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.createUI=function(a){var b=this,c=this.viewer,d=Autodesk.Viewing.UI,e=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.vrToolButton=new d.Button("toolbar-vrTool"),this.vrToolButton.setToolTip("Enable VR mode"),this.vrToolButton.setIcon("adsk-icon-webvr"),this.vrToolButton.onClick=function(a){var e=b.vrToolButton.getState();e===d.Button.State.INACTIVE?c.setActiveNavigationTool("vr"):e===d.Button.State.ACTIVE&&c.setActiveNavigationTool()};var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.vrToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.vrToolButton)},Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.unload=function(){var a=this.viewer;this.onToolChanged&&(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0);var b=a.getToolbar(!1);return b&&this.vrToolButton&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.vrToolButton.getId()),this.vrToolButton=null,this.tool&&(a.toolController.deregisterTool(this.tool),this.tool=null),!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.WebVR",Autodesk.Viewing.Extensions.WebVR.VRExtension),Autodesk.Viewing.Extensions.WebVR.VRTool=function(a,b,c){var d,e,f=a.canvas,g=a.navigation,h=g.getCamera(),i={webVR_cursor:avp.isExperimentalFlagEnabled("webVR_cursor",b.options),webVR_menu:avp.isExperimentalFlagEnabled("webVR_menu",b.options),webVR_orbitModel:avp.isExperimentalFlagEnabled("webVR_orbitModel",b.options)},j=["vr"],k=!1,l=!1;this.activate=function(b){k=!0,a.impl.toggleGroundShadow(!1),a.impl.toggleGroundReflection(!1),g.toPerspective(),g.setVerticalFov(75,!0),g.setRequestFitToView(!0);var j=a.model.getBoundingBox().size();if(c.target=a.model.getBoundingBox().center(),g.setPivotPoint(c.target,!0,!0),g.setView(h.position,c.target),g.setCameraUpVector(new THREE.Vector3(0,1,0)),c.modelScaleFactor=Math.max(Math.min(Math.min(j.x,j.y),j.z)/10,1e-4),c._isPresenting=av.isMobileDevice(),c.requestPresent([{source:f}]).then(function(){a.impl.setLmvDisplay(c),c._isPresenting=!0}),c.resetPose(),av.isMobileDevice()){m(!1),a.setScreenMode(Autodesk.Viewing.ScreenMode.kFullScreen),f.addEventListener("dblclick",function(){k&&a.setActiveNavigationTool()})}(i.webVR_cursor||i.webVR_menu)&&(e=this.initHUD()),d=new Autodesk.Viewing.Extensions.WebVR.StereoRenderContext(c,h,e,i),a.impl.setUserRenderContext(d)},this.initHUD=function(){var b=new THREE.Scene,d=h.clone();if(i.webVR_menu){var e=new Autodesk.Viewing.Extensions.WebVR.Menu(c.modelScaleFactor);e.init(b)}if(i.webVR_cursor){var g=h.worldup&&1==h.worldup.z,j=new Autodesk.Viewing.Extensions.WebVR.Cursor(a.impl,a.autocam,c.modelScaleFactor,g);j.init(b),f.addEventListener("click",j.onClick)}return{scene:b,camera:d,cameraL:d.clone(),cameraR:d.clone(),menu:e,cursor:j,IPD:1.2}},this.update=function(b){if(!c)return!0;l&&!c.isPresenting&&k&&a.setActiveNavigationTool(),l=c.isPresenting;var f=d.updateCamera();return!e||(i.webVR_cursor&&e.cursor.update(f.C,e),i.webVR_menu&&e.menu.update(e.camera),!0)},this.deactivate=function(b){c&&(c.isPresenting&&c.exitPresent(),c._isPresenting=!1),k=!1,m(!0),a.impl.setUserRenderContext(null),a.setScreenMode(Autodesk.Viewing.ScreenMode.kNormal),a.resize(a.canvas.clientWidth,a.canvas.clientHeight),a.autocam.resetHome(),e&&i.webVR_cursor&&f.removeEventListener("click",e.cursor.onClick)};var m=function(b){a.displayViewCubeUI(b),a.displayViewCube(b&&!av.isMobileDevice());var c=document.getElementsByClassName("adsk-toolbar");c.length>0&&""!==c[0]&&(c[0].style.display=b?"block":"none")};this.isActive=function(){return k},this.getNames=function(){return j},this.getName=function(){return j[0]}},Autodesk.Viewing.Extensions.WebVR.Menu=function(a){var b,c,d,e,f=16777215;this.init=function(a){function d(a,b,c){return new THREE.Mesh(new THREE.PlaneBufferGeometry(b,1),new THREE.MeshBasicMaterial({map:g.loadTexture(e(a)),color:f,side:THREE.DoubleSide,depthTest:!1,transparent:!0,opacity:c}))}if(!b){var e=Autodesk.Viewing.Private.getResourceUrl,g=THREE.ImageUtils;g.crossOrigin="anonymous";var h=["back.png","zoomin.png","zoomout.png","next.png"];b=new THREE.Object3D,c=new THREE.Object3D;var i=new THREE.Object3D;i.position.set(0,-12,-14),i.rotateX(-.6);for(var j=0;j<h.length;j++){var k=d("res/webvr/"+h[j],2,1);k.position.set(2*(j-h.length/2),0,.1),k.scale.set(.94,.94,.1),i.add(k)}var l=d("res/webvr/bg.png",48,.1);i.add(l),c.add(i),b.add(c),b.visible=!0,a.add(b)}},this.onVisible=function(a){c.rotation.y=a.rotation._z,d=-b.quaternion.y},this.update=function(a){var c=a.quaternion.clone().inverse();b.quaternion.copy(c);var g=b.visible;b.visible=b.quaternion.x>.26&&b.quaternion.x<.4,!g&&b.visible&&this.onVisible(a),e>=0&&e<4&&b.children[0].children[0].children[e].material.color.setHex(f),(e=Math.floor(4.54*(d+b.quaternion.y+.14)*4))>=0&&e<4&&b.children[0].children[0].children[e].material.color.setHex(11184895)},this.onClick=function(){}},Autodesk.Viewing.Extensions.WebVR.Cursor=function(a,b,c,d){var e,f;this.init=function(a){e=new THREE.Object3D,e.scale.set(.25,.25,1),e.add(new THREE.Mesh(new THREE.RingGeometry(.6,1,32,32),new THREE.MeshBasicMaterial({color:11141154,depthTest:!1,side:THREE.DoubleSide}))),a.add(e)},this.update=function(b,d){var g;f=a.hitTestViewport(new THREE.Vector3,!1),f?(e.children[0].material.color.setHex(8874),g=f.intersectPoint.clone().sub(b.position).length()):(e.children[0].material.color.setHex(11141154),g=.5*(b.far-b.near));var h=new THREE.Matrix4;h.extractRotation(d.camera.matrixWorld);var i=new THREE.Vector3(0,0,-1);i=h.multiplyVector3(i),i.multiplyScalar(g),e.scale.set(c,c,c),e.position.copy(i),e.lookAt(d.camera.position)},this.onClick=function(){if(f){var a=f.intersectPoint;f.face.normal;d?a.z+=5:a.y+=5;var c=b.getCurrentView();c.position.copy(a),c.center.set(a.x+1e-6,a.y,a.z),c.pivot.set(a.x,a.y,a.z),b.goToView(c)}}},function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b)}function b(a){function b(){return 100*a.model.getUnitScale()}function c(a){var b=a[1];return a[1]=-a[2],a[2]=b,a}function g(a,b){var c=b.model.getData().globalOffset;return c&&(a[0]+=c.x,a[1]+=c.y,a[2]+=c.z),a}var i=new Autodesk.Viewing.Private.ViewerState(a).getState(),j=i.viewport,k=j.eye,l=j.target,m=j.up;k=g(k,a),l=g(l,a),k=c(k),l=c(l),m=c(m),l=e([l[0]-k[0],l[1]-k[1],l[2]-k[2]]),m=e(m);var n=function(a){return a.isOrthographic?a.orthographicHeight*a.aspectRatio:f(Math.tan(h(a.fieldOfView)*a.aspectRatio))}(j),o=d(a),p={Projection:{Extent:n,IsOrthographic:j.isOrthographic,NativeAspect:j.aspectRatio},Units:o,View:{Eye:k,At:l,Up:m}};return function(a){var c=b(a.Units);a.View.Eye[0]*=c,a.View.Eye[1]*=c,a.View.Eye[2]*=c,a.Projection.IsOrthographic&&(a.Projection.Extent*=c)}(p),p.Units="CENTIMETER",p}function c(a,b){function c(a,b){var c=1/(100*b.model.getUnitScale());switch(a.toUpperCase()){case"FOOT":1/30.48;break;case"INCH":1/2.54;break;case"KILOMETER":1e-5;break;case"METER":.01;break;case"CENTIMETER":1;break;case"MILLIMETER":10}return c}function d(a){var b=a[1];return a[1]=a[2],a[2]=-b,a}b=JSON.parse(JSON.stringify(b)),b.Projection.IsOrthographic=b.Projection.IsOrthographic||b.Projection.isOrthographic;var h=d(b.View.Eye),i=e(d(b.View.At)),j=e(d(b.View.Up)),k=b.Projection.NativeAspect,l=b.Projection.IsOrthographic,m=l?"orthographic":"perspective",n={viewport:{eye:h,target:[h[0]+i[0],h[1]+i[1],h[2]+i[2]],up:j,aspectRatio:k,projection:m,isOrthographic:l}};!function(a,b){var c=b.Projection,d=c.NativeAspect;c.IsOrthographic?a.viewport.orthographicHeight=c.Extent/d:a.viewport.fieldOfView=g(f(Math.tan(c.Extent))/d)}(n,b),function(a,b,d){var e=c(b.Units,d);a.viewport.eye[0]*=e,a.viewport.eye[1]*=e,a.viewport.eye[2]*=e,a.viewport.isOrthographic&&(a.viewport.orthographicHeight*=e)}(n,b,a),function(a,b){
var c=b.model.getData().globalOffset;c&&(a[0]-=c.x,a[1]-=c.y,a[2]-=c.z),a}(n.viewport.eye,a),n.viewport.target=[n.viewport.eye[0]+10*i[0],n.viewport.eye[1]+10*i[1],n.viewport.eye[2]+10*i[2]],new Autodesk.Viewing.Private.ViewerState(a).restoreState(n)}function d(a){switch(a.model.getUnitScale()){case 1:return"METER";case.3048:return"FOOT";case.0254:return"INCH";case.01:return"CENTIMETER";case.001:return"MILLIMETER";case 1e3:return"KILOMETER";default:return"METER"}}function e(a){var b=a[0],c=a[1],d=a[2],e=Math.sqrt(b*b+c*c+d*d);if(0===e)return a;var f=1/e;return[b*f,c*f,d*f]}function f(a){var b=Math.atan(a);return b<0?b+Math.PI:b}function g(a){return a*(180/Math.PI)}function h(a){return a*(Math.PI/180)}var i=AutodeskNamespace("Autodesk.Viewing.Extensions.RaaS");j=Object.create(Autodesk.Viewing.Extension.prototype),j.constructor=a,i.RaaS=a;var j=a.prototype;j.load=function(){return!0},j.unload=function(){return!0},j.setShot=function(a){},j.getShot=function(){},j.getCameraAsRenderDescriptor=function(){return b(this.viewer)},j.setCameraFromViewName=function(a){this.viewer.model.getDocumentNode().search({type:"3d",role:"view"}),this.viewer.setViewCube(a)},j.setCameraFromRenderDescriptor=function(a){return c(this.viewer,a)},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.RaaS",a)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b)}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var c=a.prototype;c.load=function(){var a=this.viewer,c=a.getToolbar(!0);return this.tool=new b.ZoomWindowTool(a),a.toolController.registerTool(this.tool),this.createUI(c),!0},c.createUI=function(a){var b=this,c=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);c.dollybutton&&(c.removeControl(c.dollybutton.getId()),this.defaultDollyButton=c.dollybutton),this.zoomWindowToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-zoomTools"),this.zoomWindowToolButton.setIcon("zoomwindowtoolicon-zoom-window"),this.createZoomSubmenu(this.zoomWindowToolButton),c.addControl(this.zoomWindowToolButton);var d=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){b.zoomWindowToolButton.getState()===Autodesk.Viewing.UI.Button.State.ACTIVE&&(b.viewer.setActiveNavigationTool(),b.zoomWindowToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}}];Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,d)},c.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);c&&(this.zoomWindowToolButton&&(this.zoomWindowToolButton.subMenu.removeEventListener(Autodesk.Viewing.UI.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.zoomWindowToolButton.subMenuActiveButtonChangedHandler(c)),c.removeControl(this.zoomWindowToolButton.getId())),this.zoomWindowToolButton=null,c.panbutton&&this.defaultDollyButton?c.addControl(this.defaultDollyButton):this.defaultDollyButton=null)}Autodesk.Viewing.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},c.createNavToggler=function(a,b,c){return function(){var d=b.getState();d===Autodesk.Viewing.UI.Button.State.INACTIVE?(a.setActiveNavigationTool(c),b.setState(Autodesk.Viewing.UI.Button.State.ACTIVE)):d===Autodesk.Viewing.UI.Button.State.ACTIVE&&(a.setActiveNavigationTool(),b.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}},c.createZoomSubmenu=function(a){var b=this.viewer,c=b.getToolbar(!0),d=(c.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),new Autodesk.Viewing.UI.Button("toolbar-zoomWindowTool"));d.setToolTip(Autodesk.Viewing.i18n.translate("Zoom window")),d.setIcon("zoomwindowtoolicon-zoom-window"),d.onClick=this.createNavToggler(b,d,"zoomwindow"),a.addControl(d);var e=new Autodesk.Viewing.UI.Button("toolbar-zoomTool");e.setToolTip("Zoom"),e.setIcon("adsk-icon-zoom"),e.onClick=this.createNavToggler(b,e,"dolly"),a.addControl(e),a.onClick=d.onClick},c.unload=function(){var a=this.viewer;return"dolly"!==a.getActiveNavigationTool()&&"zoomwindow"!==a.getActiveNavigationTool()||a.setActiveNavigationTool(),this.destroyUI(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.ZoomWindow",a)}(),function(){"use strict";function a(a){var d=["zoomwindow"],e=!1,f=!1,g=new THREE.Vector3(0,0,-10),h=new THREE.Vector3(0,0,-10),i=null,j=null,k=null,l=null,m=null,n=a.navigation.getCamera();this.isActive=function(){return e},this.getNames=function(){return d},this.getName=function(){return d[0]},this.onResize=function(){m=null;var b=a.canvas,c=b.clientWidth,d=b.clientHeight,e=new THREE.OrthographicCamera(0,c,0,d,1,1e3);a.impl.overlayScenes.ZoomWindowRect.camera=e},this.activate=function(b){if(e=!0,null===i){var c=null;c=a.navigation.getIs2D()?new THREE.Color(0):new THREE.Color(16777215),i=new THREE.LineBasicMaterial({color:c,opacity:.6,linewidth:1})}var d=a.canvas,f=d.clientWidth,g=d.clientHeight,h=new THREE.OrthographicCamera(0,f,0,g,1,1e3);a.impl.createOverlayScene("ZoomWindowRect",i,i,h),a.impl.api.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),a.toolController.getTool("dolly").activate("orbit")},this.deactivate=function(b){m=null,a.impl.removeOverlayScene("ZoomWindowRect"),e=!1,f=!1,a.impl.api.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),a.toolController.getTool("dolly").deactivate("orbit")},this.getCursor=function(){switch(a.toolController.getTool("dolly").getTriggeredMode()){case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADWSURBVEiJ1ZVNEsIwCEYfTg/UjTPuemcvojfCRRMlNKGdKguZyaLkK4/8EERVybQJQERCUU3C63p+n/Bk9QHDRtbIX2GqKh6woRfxLdL0/M1KzYRaA+7AXDW9wN5fvrXEWud6AOABLD7QwREDgCdw7WV6ZjSAsi0Lzn4JmEcHeHbYWxQXw3FTEWmvaWY1X9Iie4CIKHE1fwfIsnSAZD/X/79FGbdISyzA9QMDG3axTTTVwx3NaNbm5B2dRHY1DWCUyd4qIs0bUB8nuz32/11Cu+KPM7sOXlrOS4sOkzb1AAAAAElFTkSuQmCC), auto"},this.handleGesture=function(a){return!0},this.handleSingleClick=function(a,b){return!0},this.startDrag=function(b){if(f===!1){if(f=!0,g.x=b.canvasX,g.y=b.canvasY,h.x=b.canvasX,h.y=b.canvasY,null===m){j=new THREE.Geometry,j.vertices.push(g.clone(),g.clone(),g.clone(),g.clone(),g.clone()),k=new THREE.Geometry,k.vertices.push(g.clone(),g.clone()),l=new THREE.Geometry,l.vertices.push(g.clone(),g.clone());var c=new THREE.Line(j,i,THREE.LineStrip),d=new THREE.Line(k,i,THREE.LineStrip),e=new THREE.Line(l,i,THREE.LineStrip);m=new THREE.Group,m.add(c),m.add(d),m.add(e)}else j.vertices[0]=g.clone(),j.vertices[1]=g.clone(),j.vertices[2]=g.clone(),j.vertices[3]=g.clone(),j.vertices[4]=g.clone(),k.vertices[0]=g.clone(),k.vertices[1]=g.clone(),l.vertices[0]=g.clone(),l.vertices[1]=g.clone(),k.verticesNeedUpdate=!0,l.verticesNeedUpdate=!0,j.verticesNeedUpdate=!0;a.impl.addOverlay("ZoomWindowRect",m)}},this.handleButtonDown=function(a,b){return 0===b&&(this.startDrag(a),!0)},this.handleMouseMove=function(a){return!(!j||!f)&&(h.x=a.canvasX,h.y=a.canvasY,!0)},this.endDrag=function(b){f===!0&&(a.impl.removeOverlay("ZoomWindowRect",m),f=!1)},this.handleButtonUp=function(a,b){return 0===b&&(this.endDrag(),!0)},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a){return!1},this.handleBlur=function(a){return!1},this.update=function(){if(this.isActive()){if(!j||!f)return this.zoomWindow();j.vertices[1].x=g.x,j.vertices[1].y=h.y,j.vertices[2]=h.clone(),j.vertices[3].x=h.x,j.vertices[3].y=g.y,j.vertices[4]=j.vertices[0];var b=Math.abs(h.x-g.x),d=Math.abs(h.y-g.y),e=b>d?d:b;e>c&&(e=c);var i=.5*e,m=[.5*(h.x+g.x),.5*(h.y+g.y)];return k.vertices[0].x=m[0]-i,k.vertices[0].y=m[1],k.vertices[1].x=m[0]+i,k.vertices[1].y=m[1],l.vertices[0].x=m[0],l.vertices[0].y=m[1]-i,l.vertices[1].x=m[0],l.vertices[1].y=m[1]+i,k.verticesNeedUpdate=!0,l.verticesNeedUpdate=!0,j.verticesNeedUpdate=!0,a.impl.invalidate(!1,!1,!0),!1}},this.getScreenRay=function(a,c,d,e,f){var g=f.position.clone(),h=f.target.clone(),i=h.clone().sub(g),j=f.up.clone(),k=i.clone().cross(j),l=i.length(),m=l*Math.tan(f.fov*b),n=m*f.aspect,o=2*a*n/d,p=o-n,q=2*c*m/e,r=q-m;j=j.normalize().multiplyScalar(r),k=k.normalize().multiplyScalar(p);var s=new THREE.Vector3,t=new THREE.Vector3;return f.isPerspective?(s=g.clone(),t=i.clone(),t.add(j),t.add(k)):(s=g.clone(),s.add(k),s.add(j),t.add(i)),{rayOrigin:s,rayDirection:t}},this.queryMouseRaySceneIntersection=function(b,c){if(null==a)return null;if(null==a.model)return null;if(a.model.is2d())return null;var d=a.impl.hitTest(b,c,!1);return d?d.intersectPoint:null};this.zoomWindow=function(){var b=n,c=a.canvas.clientWidth,d=a.canvas.clientHeight,e=g.x,f=g.y,i=h.x,j=h.y,k=Math.abs(i-e),l=Math.abs(j-f);if(0===k||0===l)return!1;if(h.copy(g),a.navigation.getIs2D()){var m={x:.5*(e+i),y:.5*(f+j)},o=a.navigation.getEyeVector().length(),p=a.impl.clientToViewport(m.x,m.y),q=a.impl.clientToViewport(c/2,d/2);p.subVectors(p,q),a.navigation.panRelative(p.x/2,p.y/2,o);var r=k/c,s=l/d,t=r>s?r:s;o=a.navigation.getEyeVector().length();var u=a.navigation.getWorldPoint(.5,.5);return a.navigation.dollyFromPoint(o*(t-1),u),!0}var v=null,w=.5*(e+i),x=.5*(f+j),y=this.getScreenRay(w,x,c,d,n);null===(v=this.queryMouseRaySceneIntersection(w,x))&&(v=y.rayOrigin.add(y.rayDirection));var z=b.position.clone(),A=b.target.clone(),B=A.clone().sub(z);B.normalize(),b.up.clone().normalize();var C=k/l>c/d?c/k:d/l,D=v.distanceTo(z),E=1*D/C,F=B.clone().negate().multiplyScalar(E);return z=v.clone().add(F),b.position.set(z.x,z.y,z.z),A=v.clone(),A.clone().sub(z).normalize(),b.target.set(A.x,A.y,A.z),b.dirty=!0,!0}}AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");var b=.017453292519943295,c=20;Autodesk.Viewing.Extensions.ZoomWindow.ZoomWindowTool=a}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit");var a=Autodesk.Viewing,b=a.UI,c=a.Extensions.FusionOrbit,d=function(b,c){a.Extension.call(this,b,c)};d.prototype=Object.create(a.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){function b(){e.removeEventListener(a.TOOLBAR_CREATED_EVENT,b),d.createUI()}var d=this,e=this.viewer,f=e.getToolbar?e.getToolbar(!0):void 0;if(this.tool=new c.FusionOrbitTool,this.tool.setViewer(e),e.toolController.registerTool(this.tool),f){var g=f.getControl(a.TOOLBAR.MODELTOOLSID);g&&g.getNumberOfControls()>0?b():e.addEventListener(a.TOOLBAR_CREATED_EVENT,b)}else e.addEventListener(a.TOOLBAR_CREATED_EVENT,b);return!0},d.prototype.createUI=function(){var c=this.viewer,d=c.getToolbar(!1),e=d.getControl(a.TOOLBAR.NAVTOOLSID);this.classicBehavior={},this.classicBehavior.orbitOnClick=e.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=e.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=e.returnToDefault,e.freeorbitbutton.onClick=function(a){var d=e.freeorbitbutton.getState();d===b.Button.State.INACTIVE?(c.setActiveNavigationTool("fusion orbit"),e.freeorbitbutton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&(c.setActiveNavigationTool(),e.freeorbitbutton.setState(b.Button.State.INACTIVE))},e.orbitbutton.onClick=function(a){var d=e.orbitbutton.getState();d===b.Button.State.INACTIVE?(c.setActiveNavigationTool("fusion orbit constrained"),e.orbitbutton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&(c.setActiveNavigationTool(),e.orbitbutton.setState(b.Button.State.INACTIVE))},e.returnToDefault=function(){e.orbittoolsbutton.setState(b.Button.State.ACTIVE),e.orbittoolsbutton.setState(b.Button.State.INACTIVE)},e.orbittoolsbutton.setState(b.Button.State.INACTIVE),c.prefs.fusionOrbitConstrained?(e.orbittoolsbutton.onClick=e.orbitbutton.onClick,e.orbittoolsbutton.setIcon(e.orbitbutton.iconClass),c.setDefaultNavigationTool("orbit")):(e.orbittoolsbutton.onClick=e.freeorbitbutton.onClick,e.orbittoolsbutton.setIcon(e.freeorbitbutton.iconClass),c.setDefaultNavigationTool("freeorbit")),c.setActiveNavigationTool(),e.returnToDefault()},d.prototype.unload=function(){var c=this.viewer,d=c.getToolbar(!1),e=d.getControl(a.TOOLBAR.NAVTOOLSID);return e&&(e.orbitbutton&&(e.orbitbutton.onClick=this.classicBehavior.orbitOnClick),e.freeorbitbutton&&(e.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),e.returnToDefault=this.classicBehavior.returnToDefault,e.orbittoolsbutton&&(e.orbitbutton?e.orbittoolsbutton.onClick=e.orbitbutton.onClick:e.orbittoolsbutton.onClick=null,e.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),e.orbittoolsbutton.setState(b.Button.State.ACTIVE))),c.setActiveNavigationTool("orbit"),c.setDefaultNavigationTool("orbit"),c.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},c.FusionOrbitExtension=d,a.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",d)}(),Autodesk.Viewing.Extensions.FusionOrbit.html=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n"),Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(){var a,b,c,d,e,f=Autodesk.Viewing,g=Autodesk.Viewing.Private,h=["fusion orbit","fusion orbit constrained"],i={HORIZONTAL:0,VERTICAL:1,ROLL:2},j={HORIZONTAL:.005,VERTICAL:.005,ROLL:1},k={},l=f.isTouchDevice(),m=!1,n={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},o=this;this.setViewer=function(a){this.viewer=a,this.navapi=a?a.navigation:null};var p=function(a){n.buttons[a.touches?0:a.button]=!0,n.src=a.target.className,n.x=0,n.y=0,n.dx=0,n.dy=0,n.firstMove=!0,n.mode=void 0,"ring"===n.src?n.mode=i.ROLL:"edgemark-area"===n.src&&("layout-ver"===a.target.parentNode.className?n.mode=i.HORIZONTAL:"layout-hor"===a.target.parentNode.className&&(n.mode=i.VERTICAL)),w(),a.stopPropagation()},q=function(a){n.buttons[a.touches?0:a.button]=!1,n.src=void 0},r=function(a){n.buttons[0]&&(s(a),t(),n.firstMove=!1)},s=function(a){var b=a.touches?a.touches[0].pageX:a.pageX,c=a.touches?a.touches[0].pageY:a.pageY;n.firstMove||(n.dx=b-n.x,n.dy=c-n.y),n.x=b,n.y=c},t=function(){switch(n.mode){case i.ROLL:if(!o.navapi.isActionEnabled("roll"))return;break;case i.HORIZONTAL:case i.VERTICAL:if(!o.navapi.isActionEnabled("orbit"))return}var a=e.target.clone().sub(e.position).normalize(),b=a.clone().cross(e.up).normalize(),c=b.clone().cross(a).normalize();if(e.up.copy(c),n.mode===i.ROLL){var f=new THREE.Vector3(n.x-k.center.x,n.y-k.center.y,0),g=new THREE.Vector3(n.dx,n.dy,0).add(f);f.normalize(),g.normalize();var h=f.clone().cross(g),l=Math.asin(h.z);e.up.applyAxisAngle(a,-l*j.ROLL)}else{var m,p;n.mode===i.HORIZONTAL?(p=-n.dx*j.HORIZONTAL,d&&(e.up=Autodesk.Viewing.Navigation.snapToAxis(e.up.clone())),m=e.up):n.mode===i.VERTICAL&&(p=-n.dy*j.VERTICAL,d?(n.firstMove&&(e.up=Autodesk.Viewing.Navigation.snapToAxis(e.up.clone())),m=a.clone().cross(e.up).normalize()):m=b,e.up.applyAxisAngle(m,p));var q=o.navapi.getPivotPoint(),r=e.position.clone().sub(q);r.applyAxisAngle(m,p),e.position.addVectors(q,r);var s=e.target.clone().sub(q);s.applyAxisAngle(m,p),e.target.addVectors(q,s)}e.dirty=!0},u=function(){var a=e.target.clone().sub(e.position).normalize(),b=o.viewer.impl.rayIntersect(new THREE.Ray(e.position,a));return b&&b.intersectPoint?b.intersectPoint:e.target},v=function(a,b){var c=b||a.clone().sub(e.position).normalize();return new THREE.Plane(c,-c.x*a.x-c.y*a.y-c.z*a.z)},w=function(){var a=e.target.clone().sub(e.position).normalize(),b=v(e.position,a),c=b.distanceToPoint(e.pivot);e.pivot.copy(a).multiplyScalar(c).add(e.position)},x=function(a){a.touches||0!==a.button||w()},y=function(a){m&&o.viewer.setActiveNavigationTool()},z=function(a,b){var c,d=o.viewer.impl.hitTest(a,b);if(d&&d.intersectPoint)c=d.intersectPoint;else{c=o.viewer.impl.viewportToRay(o.viewer.impl.clientToViewport(a,b)).intersectPlane(v(e.target))}var f=e.position.clone().sub(u()).add(c);o.navapi.setRequestTransition(!0,f,c,e.fov)};this.register=function(){a=g.stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html),a.style.display="none",this.viewer.canvasWrap.insertBefore(a,this.viewer.canvasWrap.firstChild),b=a.querySelector(".ring"),b.addEventListener("mousedown",p),Array.prototype.forEach.call(a.querySelectorAll(".edgemark-area"),function(a,b){a.addEventListener("mousedown",p),l&&a.addEventListener("touchstart",p)}),window.addEventListener("mouseup",q),window.addEventListener("mousemove",r),c=a.querySelector(".outside"),c.addEventListener("mousedown",y);var d=a.querySelector(".circle");d.addEventListener("mousedown",x),l&&(b.addEventListener("touchstart",p),window.addEventListener("touchend",q),window.addEventListener("touchmove",r),c.addEventListener("touchstart",y),d.addEventListener("touchstart",x)),e=this.viewer.impl.camera},this.deregister=function(){window.removeEventListener("mouseup",q),window.removeEventListener("mousemove",r),c.removeEventListener("mousedown",y),l&&(window.removeEventListener("touchend",q),window.removeEventListener("touchmove",r),c.removeEventListener("touchstart",y)),this.viewer.canvasWrap.removeChild(a),a=void 0,b=void 0,c=void 0},this.activate=function(b){a.style.display="",this.handleResize(),d="fusion orbit constrained"===b;var c=this.viewer.toolController.isToolActivated("hyperlink");c&&this.viewer.toolController.deactivateTool("hyperlink"),d?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),c&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(b){a.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return h},this.getName=function(){return h[0]},this.update=function(){return!1},this.handleSingleClick=function(a,b){return z(a.canvasX,a.canvasY),!0},this.handleDoubleClick=function(a,b){return!0},this.handleSingleTap=function(a){return z(a.canvasX,a.canvasY),!0},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){var b,d=this.viewer.impl.canvas.getBoundingClientRect();b=d.width>d.height?new THREE.Vector2(((a.canvasX+.5)/d.width*2-1)*d.width/d.height,2*-((a.canvasY+.5)/d.height)+1):new THREE.Vector2((a.canvasX+.5)/d.width*2-1,(2*-((a.canvasY+.5)/d.height)+1)*d.height/d.width);var e=b.length(),f=e>1.2;return m!==f&&(c.style.cursor=f?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",m=f),!1},this.handleGesture=function(a){return w(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){var c=a.getBoundingClientRect();k.left=c.left+window.pageXOffset,k.top=c.top+window.pageYOffset,k.width=c.width,k.height=c.height,k.center={},k.center.x=k.left+k.width/2,k.center.y=k.top+k.height/2;var d=.8*(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth);a.style.width=a.style.height=d+"px",a.style.top=a.style.left="calc(50% - "+d/2+"px)",b.style.borderWidth=.1*d+"px"}},AutodeskNamespace("Autodesk.Viewing.Private.Collaboration"),function(){function a(a,b,c){function e(b){var c=b.data.msg;if(h.x=c.x1,h.y=c.y1,i.x=c.x2,i.y=c.y2,j=c.explode,c.command)if("gohome"==c.command)h.x=h.y=0,i.x=i.y=0,a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0),k=null;else if("select"==c.command){var d=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));d?a.impl.selector.toggleSelection(d.dbId,d.model):a.impl.selector.clearSelection()}else if("hide"==c.command){var d=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));d&&a.hide(d.dbId)}else if("fly"==c.command)k=k?null:f.target.clone().sub(f.position).normalize();else if("savepoint"==c.command){var c=g.getState(r);p.push(c),alertify.success("Savepoint created.")}else"nextsavepoint"==c.command&&p.length&&(q>=p.length&&(q=0),g.restoreState(p[q++]))}var f,g,h=new THREE.Vector2,i=new THREE.Vector2,j=0,k=null,l=a,m=.02,n=.002,o=1,p=[],q=0,r={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},s=function(){if(!a.impl.model.is2d()){var b=a.impl.model.getData().bbox.size(),c=b.length();m*=c,n*=c,a.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,s)}};a.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,s),this.getNames=function(){return["joystick"]},this.getName=function(){return"joystick"},this.activate=function(a){if(b.addEventListener("joystick",e),c.addEventListener("joystick",e),f=l.navigation.getCamera(),l.model){o=.001*l.model.getBoundingBox().size().length(),g=new d.ViewerState(l)}},this.deactivate=function(a){b.removeEventListener("joystick",e),c.removeEventListener("joystick",e),f=null,g=null,p.length=0},this.update=function(b){if(f.isPerspective||a.navigation.toPerspective(),k){var c=k.clone().multiplyScalar(n);f.position.add(c),f.target.add(c)}if(0!=j){var d=a.getExplodeScale()+.01*j;d>1&&(d=1),d<0&&(d=0),a.explode(d)}if(0==h.x&&0==h.y&&0==i.x&&0==i.y)return!(!k&&!j);var e=f.target.clone().sub(f.position),g=e.length();e.multiplyScalar(1/g);var l=e.clone().cross(f.up).normalize(),o=e.clone().multiplyScalar(h.y*m);f.position.add(o),f.target.add(o);var p=l.clone().multiplyScalar(h.x*m);f.position.add(p),f.target.add(p);var q=new THREE.Quaternion;q.setFromAxisAngle(l,.05*i.y);var r=e.clone().applyQuaternion(q);f.up.applyQuaternion(q);var s=new THREE.Quaternion;return s.setFromAxisAngle(f.worldup,.05*-i.x),r.applyQuaternion(s),f.up.applyQuaternion(s),r.multiplyScalar(g),f.target.copy(f.position).add(r),k&&k.copy(f.target).sub(f.position).normalize(),!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a,b){return!1},this.handleTouchChange=function(a,b){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,d=b.Private,e=b.UI;d.Collaboration;c.RemoteControl=function(c,e){b.Extension.call(this,c,e),this.viewer=c,this.client=d.MessageClient.GetInstance(),this.p2p=new d.P2PClient(this.client),this.controllerTool=new a(c,this.client,this.p2p),c.toolController.registerTool(this.controllerTool)},c.RemoteControl.prototype=Object.create(b.Extension.prototype),c.RemoteControl.prototype.constructor=c.RemoteControl,c.RemoteControl.prototype.createUI=function(){var a=this,b=this.viewer;this.controlButton=new e.Button("toolbar-remoteControlTool"),this.controlButton.setToolTip("Pair with controller device"),this.controlButton.onClick=function(){this.getState()===e.Button.State.INACTIVE?(a.connect(),this.setState(e.Button.State.ACTIVE)):(a.disconnect(),this.setState(e.Button.State.INACTIVE))},this.controlButton.setIcon("adsk-icon-game-controller"),b.modelTools.addControl(this.controlButton),this.panel=new Autodesk.Viewing.UI.DockingPanel(b.container,"remote-panel","Remote Control"),this.panel.width=300,this.panel.height=375,this.panel.container.style.width=this.panel.width+"px",this.panel.container.style.height=this.panel.height+"px",this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px",this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px",this.panel.body=document.createElement("div"),this.panel.body.classList.add("body"),this.panel.container.appendChild(this.panel.body);var c=Autodesk.Viewing.i18n.translate("Go to this link"),d=Autodesk.Viewing.i18n.translate("Scan the QR code with your device"),f=Autodesk.Viewing.i18n.translate("or");this.panel.body.innerHTML=['<p data-i18n="'+c+'">'+c+"</p>",'<p><a class="url" target="_blank" href="#">Link</a></p>','<p data-i18n="'+f+'">'+f+"</p>",'<p data-i18n="'+d+'">'+d+"</p>",'<img class="qr-img" src="">'].join("\n"),this.panel.link=this.panel.container.querySelector(".url"),this.panel.code=this.panel.container.querySelector(".code"),this.panel.qrImg=this.panel.container.querySelector(".qr-img")},c.RemoteControl.prototype.load=function(){function a(d){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),c.createUI()}var b=this.viewer,c=this;return b.modelTools&&b.modelTools.getNumberOfControls()>0?c.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),!0},c.RemoteControl.prototype.unload=function(){var a=this.viewer;if(this.p2p.hangup(),this.client.disconnect(),a.toolController.deactivateTool(this.controllerTool.getName()),this.panel&&(this.panel.setVisible(!1),this.panel=null),this.controlButton)try{a.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(a){d.logger.error("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0},c.RemoteControl.prototype.addCrosshair=function(){this.crosshair=d.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>'),this.viewer.canvasWrap.appendChild(this.crosshair)},c.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()},c.RemoteControl.prototype.connect=function(a){if(this.client.isConnected())return void console.log("RemoteControl already connected");var b=this;d.loadDependency("lmv_io","socket.io-1.3.5.js",function(){b.connectAux(a)})},c.RemoteControl.prototype.connectAux=function(a){var b=this,c=this.viewer;b.client.addEventListener("connectSucceeded",function(c){function e(){i&&i.setVisible(!1),b.p2p.removeEventListener("dataChannelAdded",e),b.addCrosshair()}d.logger.log("connect succeeded");var f=c.data.id+"rc";b.client.join(f);var g=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+f+"&env="+d.env,h="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(g),i=b.panel;i&&(i.link.href=g,i.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",i.qrImg.src=h,i.setVisible(!0)),b.p2p.addEventListener("dataChannelAdded",e),a&&a instanceof Function&&a(g)}),c.navigation.toPerspective(),b.client.connect(),c.toolController.activateTool(b.controllerTool.getName())},c.RemoteControl.prototype.disconnect=function(){this.p2p.hangup(),this.client.disconnect(),this.viewer.toolController.deactivateTool(this.controllerTool.getName()),this.removeCrosshair()},b.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",c.RemoteControl)}(),function(){AutodeskNamespace("Autodesk.Viewing.Extensions.GamepadModule"),Autodesk.Viewing.Extensions.GamepadModule=function(a){function b(){for(var a in C)if(C.hasOwnProperty(a)&&e.buttons[a].pressed&&.5!=e.buttons[a].value)return w[a]=!0,!0;for(var a in w)if(w.hasOwnProperty(a)&&w[a])return!0;return!(Math.abs(e.axes[A.LEFT_STICK_X])<u&&Math.abs(e.axes[A.LEFT_STICK_Y])<u&&Math.abs(e.axes[A.RIGHT_STICK_X])<u&&Math.abs(e.axes[A.RIGHT_STICK_Y])<u)}function c(){for(var a in z)z.hasOwnProperty(a)&&d(z[a])}function d(a){if(e.buttons[a].value>u)switch(w[a]=!0,a){case z.LEFT_SHOULDER:C[a]();break;case z.RIGHT_SHOULDER:C[a]();break;case z.LEFT_TRIGGER:C[a](e.buttons[z.LEFT_TRIGGER].value);break;case z.RIGHT_TRIGGER:C[a](e.buttons[z.RIGHT_TRIGGER].value)}else if(w[a])switch(w[a]=!1,a){case z.SOUTH_BTN:C[a]();break;case z.EAST_BTN:C[a]();break;case z.WEST_BTN:C[a]();break;case z.NORTH_BTN:C[a]();break;case z.NORTH_DPAD:C[a]();break;case z.SOUTH_DPAD:C[a]();break;case z.WEST_DPAD:C[a]();break;case z.EAST_DPAD:C[a]();break;case z.RIGHT_STICK_BUTTON:C[a]();break;case z.LEFT_STICK_BUTTON:C[a]();break;case z.LEFT_TRIGGER:C[a](e.buttons[z.LEFT_TRIGGER].value);break;case z.RIGHT_TRIGGER:C[a](e.buttons[z.RIGHT_TRIGGER].value)}}var e,f,g,h,i,j,k,l,m,n,o=Autodesk.Viewing.Private,p=a.navigation,q=a.container,r=p.getCamera(),s=1,t=0,u=.1,v=6,w={},x=new THREE.Clock(!0),y={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},z={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},A={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3},B=function(){},C={};for(var D in z)z.hasOwnProperty(D)&&(C[z[D]]=B);this.activate=function(b){var c=a.model.getBoundingBox().size();s=Math.max(Math.min(Math.min(c.x,c.y),c.z)/10,1e-4),e=navigator.getGamepads()[0],h=new Autodesk.Viewing.Private.ViewerState(a),i=[],j=0,n=b,H(b)},this.deactivate=function(){n=null,h=null},this.update=function(a,d){
if(d&&(r=d),a=x.getDelta(),e=navigator.getGamepads()[0],f>-1){(new Date).getTime()-f>g&&F()}if(e&&(l=2*a*s*v,r.isPerspective||p.toPerspective(),e&&b())){r.dirty=!0,k&&(m=r.position.z);var h=r.target.clone().sub(r.position),i=h.length();h.multiplyScalar(1/i);var j=h.clone().cross(r.up).normalize();if(Math.abs(e.axes[A.LEFT_STICK_Y])>u){var n=h.clone().multiplyScalar(-e.axes[A.LEFT_STICK_Y]*l);r.position.add(n),r.target.add(n)}if(Math.abs(e.axes[A.LEFT_STICK_X])>u){var o=j.clone().multiplyScalar(e.axes[A.LEFT_STICK_X]*l);r.position.add(o),r.target.add(o)}var q=new THREE.Quaternion,t=h;if(Math.abs(e.axes[A.RIGHT_STICK_Y])>u){var w=r.clone(),y=h.clone();q.setFromAxisAngle(j,-e.axes[A.RIGHT_STICK_Y]*l/2),y.applyQuaternion(q),w.up.applyQuaternion(q);var z=w.worldup.clone(),B=y.angleTo(z),C=THREE.Math.degToRad(5);B>=C&&B<=Math.PI-C&&(t=h.clone().applyQuaternion(q),r.up.applyQuaternion(q))}var D=new THREE.Quaternion;Math.abs(e.axes[A.RIGHT_STICK_X])>u&&(D.setFromAxisAngle(r.worldup,-e.axes[A.RIGHT_STICK_X]*l/2),t.applyQuaternion(D),r.up.applyQuaternion(D)),c(),k&&(r.position.z=m),t.multiplyScalar(i),r.target.copy(r.position).add(t)}return r};var E=function(a,b,c,d,e){Autodesk.Viewing.Private.HudMessage.displayMessage(q,a,c,d,e),b>0?(f=(new Date).getTime(),g=b):(f=-1,g=0)},F=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),f=-1},G=function(a){F();var b;switch(a){case"up":b=k?"Vertical Lock Mode":"Fly mode";break;case"left":break;case"right":break;case"down":}E({msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:b},2e3)},H=function(a){switch(a){case"headtracker":C[z.SOUTH_BTN]=R,C[z.SOUTH_DPAD]=I,C[z.NORTH_DPAD]=W,C[z.WEST_BTN]=U,C[z.LEFT_SHOULDER]=J,C[z.RIGHT_SHOULDER]=K,C[z.LEFT_TRIGGER]=L,C[z.RIGHT_TRIGGER]=N,C[z.RIGHT_STICK_BUTTON]=S,C[z.LEFT_STICK_BUTTON]=T;break;default:C[z.SOUTH_BTN]=R,C[z.EAST_BTN]=O,C[z.WEST_BTN]=U,C[z.NORTH_BTN]=V,C[z.SOUTH_DPAD]=I,C[z.WEST_DPAD]=P,C[z.EAST_DPAD]=Q,C[z.NORTH_DPAD]=W,C[z.LEFT_SHOULDER]=J,C[z.RIGHT_SHOULDER]=K,C[z.LEFT_TRIGGER]=M,C[z.RIGHT_TRIGGER]=N,C[z.RIGHT_STICK_BUTTON]=S,C[z.LEFT_STICK_BUTTON]=T}},I=function(){a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0)},J=function(){k?m+=-e.buttons[z.LEFT_SHOULDER].pressed*l:r.translateY(-e.buttons[z.LEFT_SHOULDER].pressed*l)},K=function(){k?m+=e.buttons[z.RIGHT_SHOULDER].pressed*l:r.translateY(e.buttons[z.RIGHT_SHOULDER].pressed*l)},L=function(b){if(b>u){if(.5==b)return void a.explode(0);t=b;var c=t;c>1&&(c=1),c<0&&(c=0),a.explode(c)}else a.explode(0)},M=function(a){if(a>u){if(.5==a)return r.fov=75,void(w[z.LEFT_TRIGGER]=!1);r.fov=-45*a+75}else r.fov=75},N=function(a){if(a>u){if(.5==a)return void(w[z.RIGHT_TRIGGER]=!1);v=6-5.5*a}else v=6},O=function(){var a=h.getState(y);i.push(a),o.logger.log("Savepoint created.")},P=function(){i.length&&(j--,j<0&&(j=i.length-1),h.restoreState(i[j]))},Q=function(){i.length&&(j++,j>=i.length&&(j=0),h.restoreState(i[j]))},R=function(){var b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==n&&r.updateMatrixWorld(),b?a.impl.selector.toggleSelection(b.dbId,b.model):a.impl.selector.clearSelection()},S=function(){a.impl.selector.clearSelection()},T=function(){a.showAll(),a.impl.selector.clearSelection(),a.explode(0)},U=function(){var b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);b&&(b.dbId in a.getHiddenNodes()?a.show(b.dbId):a.hide(b.dbId))},V=function(){a.getPropertyPanel(!0).setVisible(!a.getPropertyPanel(!0).isVisible())},W=function(){k=!k,k&&(m=r.position.z),G("up")}}}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.SectionExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension,Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){var a=this,b=this.viewer;if(this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(b),b.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],b.getToolbar){b.getToolbar(!0)?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))}this.onResetBinded=this.onReset.bind(this),b.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var c=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return a.enableSectionTool(!1)}}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,c),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var a=this.viewer;return Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.destroyUI(),a.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.isActive=function(){return this.tool.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var a=this.sectionStyle||"X";this.setSectionStyle(a,!0)}return this.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.getSectionStyle=function(){return this.sectionStyle},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.setSectionStyle=function(a,b){if(this.supportedStyles.indexOf(a)===-1)return!1;var c=this.isActive(),d=this.sectionStyle!==a||!b;return this.sectionStyle=a,c&&d?this.tool.setSection(a):c||(this.enableSectionTool(!0),d?this.tool.setSection(a):this.tool.attachControl(!0)),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(a){var b=this.viewer.toolController,c=this.tool.isActive();return a&&!c?(b.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(a||!c)&&(b.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onReset=function(){this.tool.resetSection()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var a=this.viewer,b=Autodesk.Viewing.UI;this.sectionToolButton=new b.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var c=a.getToolbar(!1),d=c.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(d){var e=d.getControl("toolbar-resetTool");e?d.addControl(this.sectionToolButton,{index:d.indexOf(e.getId())}):d.addControl(this.sectionToolButton,{index:0})}},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(a){function b(a,b){return function(){var c=a.getState(),e=function(){d.enableSectionTool(!0),a instanceof f.ComboButton==!1?d.tool.setSection(b):d.tool.attachControl(!0)};c===f.Button.State.INACTIVE?(a.setState(f.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(e,1):e()):c===f.Button.State.ACTIVE&&(a.setState(f.Button.State.INACTIVE),d.enableSectionTool(!1)),d.sectionStyle=b}}function c(){var a=function(){var a=new THREE.Vector3;return function(b,c,d){return a.subVectors(b,c),a.lengthSq()<d}}(),b=new THREE.Vector3(1,0,0),f=new THREE.Vector3(0,1,0),g=new THREE.Vector3(0,0,1),h=e.autocam.getWorldRightVector(),i=e.autocam.getWorldUpVector(),j=e.autocam.getWorldFrontVector();a(i,b,1e-4)?d.sectionYButton.setIcon("adsk-icon-plane-x"):a(i,g,1e-4)?d.sectionYButton.setIcon("adsk-icon-plane-z"):d.sectionYButton.setIcon("adsk-icon-plane-y"),a(h,f,1e-4)?d.sectionXButton.setIcon("adsk-icon-plane-y"):a(h,g,1e-4)?d.sectionXButton.setIcon("adsk-icon-plane-z"):d.sectionXButton.setIcon("adsk-icon-plane-x"),a(j,b,1e-4)?d.sectionZButton.setIcon("adsk-icon-plane-x"):a(j,f,1e-4)?d.sectionZButton.setIcon("adsk-icon-plane-y"):d.sectionZButton.setIcon("adsk-icon-plane-z"),e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)}var d=this,e=this.viewer,f=Autodesk.Viewing.UI,g=this.sectionXButton=new f.Button("toolbar-sectionTool-x");g.setToolTip("Add X plane"),g.setIcon("adsk-icon-plane-x"),g.onClick=b(g,"X"),a.addControl(g);var h=this.sectionYButton=new f.Button("toolbar-sectionTool-y");h.setToolTip("Add Y plane"),h.setIcon("adsk-icon-plane-y"),h.onClick=b(h,"Y"),a.addControl(h);var i=this.sectionZButton=new f.Button("toolbar-sectionTool-z");i.setToolTip("Add Z plane"),i.setIcon("adsk-icon-plane-z"),i.onClick=b(i,"Z"),a.addControl(i);var j=this.sectionBoxButton=new f.Button("toolbar-sectionTool-box");j.setToolTip("Add box"),j.setIcon("adsk-icon-box"),j.onClick=b(j,"BOX"),a.addControl(j),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(c&&this.sectionToolButton){var d=c.getControl("toolbar-inspectSubMenu");d?d.removeControl(this.sectionToolButton.getId()):c.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(a,b){function c(){F||(s=new THREE.TransformControls(u.camera,u.canvas,"transrotate"),s.addEventListener("change",e),s.setSnap(Math.PI/2,Math.PI/36),t=new THREE.TransformControls(u.camera,u.canvas,"translate"),t.addEventListener("change",e),void 0===u.overlayScenes[D]&&u.createOverlayScene(D),u.addOverlay(D,s),u.addOverlay(D,t),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),a.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,g),a.addEventListener(Autodesk.Viewing.HIDE_EVENT,g),a.addEventListener(Autodesk.Viewing.SHOW_EVENT,g),F=!0)}function d(){F&&(u.removeOverlay(D,s),s.removeEventListener("change",e),s=null,u.removeOverlay(D,t),t.removeEventListener("change",e),t=null,u.removeOverlayScene(D),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),a.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,g),a.removeEventListener(Autodesk.Viewing.HIDE_EVENT,g),a.removeEventListener(Autodesk.Viewing.SHOW_EVENT,g),F=!1)}function e(){u.invalidate(!1,!1,!0)}function f(){s&&s.update(),t&&t.update()}function g(){1===A.length&&(k(!0),f(),i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)))}function h(a){return a.color||new THREE.Color(16777215)}function i(a){init_three_triangulator(),init_three_intersector();var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b);var c=new THREE.Object3D;c.name="section",u.sceneAfter.add(c);var d=new THREE.Object3D;c.add(d);var e=new THREE.Object3D;c.add(e);var f=Autodesk.Viewing.Private,g=f.Intersector.makePlaneBasis(a),i=(new THREE.Matrix4).getInverse(g),j=u.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),k=u.matman().findMaterial(null,j);k.transparent=!0,k.depthTest=!0,k.polygonOffset=!0,k.polygonOffsetFactor=-1,k.polygonOffsetUnits=.1;var l=new THREE.Box3,m=u.getVisibleBounds(!0);m.size().length();u.modelQueue().getModels().forEach(function(b){var c=b.getData().instanceTree;if(c){var j=b.getFragmentList();c.enumNodeChildren(b.getRootId(),function(b){if(!c.isNodeHidden(b)&&!c.isNodeOff(b)){var m,n=[];if(c.enumNodeFragments(b,function(b){j.getWorldBounds(b,l),f.Intersector.intersectBoxPlane(a,l)&&(m=j.getVizmesh(b),m.geometry&&(m.geometry.is2d||m.geometry.isLines||m.material.cutplanes&&f.Intersector.intersectMeshPlane(a,m,n)))},!1),n.length){var o=new THREE.Box3;f.Intersector.convertToPlaneCoords(g,n,o);var p=new f.VertexBufferBuilder(!1,8*n.length),q=h(m.material),r=0|.25*q.r*255.5,s=0|.25*q.g*255.5,t=0|.25*q.b*255.5,v=4278190080|t<<16|s<<8|r,w=new f.Triangulator.ContourSet(n,o);w.snapEdges(),w.sanitizeEdges(),w.stitchContours();for(var x=0;x<w.contours.length;x++)for(var y=w.contours[x],r=0|255.5*Math.random(),s=0|255.5*Math.random(),t=0|255.5*Math.random(),z=(y[0],y[y.length-1],1);z<y.length;z++){var A=w.pts[y[z-1]],B=w.pts[y[z]];p.addSegment(A.x,A.y,B.x,B.y,0,.02,v,b,0)}var C={mesh:p.toMesh()};f.BufferGeometryUtils.meshToGeometry(C);var D=C.geometry;D.streamingDraw=!0,D.streamingIndex=!0;var E=new THREE.Mesh(D,k);E.matrix.copy(i),E.matrixAutoUpdate=!1,E.frustumCulled=!1,e.add(E);var F=new f.Triangulator.TriangulatedSurface(w);if(F.indices.length){for(var G=new THREE.BufferGeometry,H=new Float32Array(3*F.pts.length),x=0;x<F.pts.length;x++)H[3*x]=F.pts[x].x,H[3*x+1]=F.pts[x].y,H[3*x+2]=0;G.addAttribute("position",new THREE.BufferAttribute(H,3));for(var I=m.material.packedNormals,J=I?new Uint16Array(2*F.pts.length):new Float32Array(3*F.pts.length),x=0;x<F.pts.length;x++)if(I){var K=.5*(0/Math.PI+1);J[2*x]=65535*K|0,J[2*x+1]=65535}else J[3*x]=0,J[3*x+1]=0,J[3*x+2]=1;G.addAttribute("normal",new THREE.BufferAttribute(J,I?2:3)),I&&(G.attributes.normal.bytesPerItem=2,G.attributes.normal.normalize=!0);var L=new Uint16Array(F.indices.length);L.set(F.indices),G.addAttribute("index",new THREE.BufferAttribute(L,1)),G.streamingDraw=!0,G.streamingIndex=!0;var M=u.matman().cloneMaterial(m.material);M.packedNormals=I,M.cutplanes=null,M.side=THREE.FrontSide,M.depthTest=!0,M.map=null,M.bumpMap=null,M.normalMap=null,M.alphaMap=null,M.specularMap=null,M.transparent=!1,M.depthWrite=!0,M.hatchPattern=!0,M.needsUpdate=!0;var N=(m.material.id+2)*Math.PI*.125,O=Math.tan(N);M.hatchParams=new THREE.Vector2(O,10),M.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,M.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=M.prismType&&(M.defines={},M.defines[M.prismType.toUpperCase()]="","PrismWood"==M.prismType&&(M.defines.NO_UVW=""));var P=new THREE.Mesh(G,M);P.matrix.copy(i),P.matrixAutoUpdate=!1,P.dbId=b,P.fragId=n.fragId,d.add(P)}}}},!0)}})}function j(a,b){var c,d=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),a.normal);if(b){var e=a.projectPoint(b.max),f=a.projectPoint(b.min),g=d.clone().inverse();e.applyQuaternion(g),f.applyQuaternion(g);var h=(new THREE.Vector3).subVectors(e,f);c=new THREE.PlaneBufferGeometry(h.x,h.y)}else{b=u.getVisibleBounds();var h=2*b.getBoundingSphere().radius;c=new THREE.PlaneBufferGeometry(h,h)}var i=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),j=new I.SectionMesh(c,i,a),k=a.projectPoint(b.center());j.position.copy(k),j.quaternion.multiply(d);for(var l=Autodesk.Viewing.Private.LightPresets[u.currentLightPreset()].bgColorGradient,m="rgb("+(255-l[0])+","+(255-l[1])+","+(255-l[2])+")",n=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),o=j.geometry.getAttribute("position"),p=0;p<H.length;p++){var c=new THREE.Geometry;c.vertices.push((new THREE.Vector3).fromArray(o.array,H[p][0]*o.itemSize),(new THREE.Vector3).fromArray(o.array,H[p][1]*o.itemSize));var q=new THREE.Line(c,n);j.add(q),j.outlines.push(q)}return j}function k(a){l(function(b){if(b instanceof I.SectionMesh)if(b.connectivity.length>0){for(var c=(new THREE.Matrix4).getInverse(b.matrixWorld),d=new THREE.Vector3,e=b.geometry.getAttribute("position"),f=0;f<e.length/e.itemSize;f++){var g=b.connectivity[f];null!==J(b.plane,g[0],g[1],d)&&(d.applyMatrix4(c),e.setXYZ(f,d.x,d.y,d.z))}e.needsUpdate=!0,b.geometry.computeBoundingBox(),b.geometry.computeBoundingSphere();for(var f=0;f<b.outlines.length;f++){var h=b.outlines[f];h.geometry.vertices[0].fromArray(e.array,H[f][0]*e.itemSize),h.geometry.vertices[1].fromArray(e.array,H[f][1]*e.itemSize),h.geometry.verticesNeedUpdate=!0}}else if(a){var i=u.getVisibleBounds(),j=2*i.getBoundingSphere().radius,d=b.plane.projectPoint(i.center());b.geometry=new THREE.PlaneBufferGeometry(j,j),b.position.copy(d);for(var e=b.geometry.getAttribute("position"),f=0;f<b.outlines.length;f++){var h=b.outlines[f];h.geometry.vertices[0].fromArray(e.array,H[f][0]*e.itemSize),h.geometry.vertices[1].fromArray(e.array,H[f][1]*e.itemSize),h.geometry.verticesNeedUpdate=!0}}})}function l(a){for(var b=0;b<z.length;b++)z[b].traverse(a)}function m(){l(function(a){a instanceof I.SectionMesh&&a.update()}),1===A.length&&i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)),u.setCutPlanes(A)}function n(a){for(var b=0;b<z.length;b++)z[b].visible=a;y!==a&&e(),y=a}function o(b){b&&A.length>0&&(1===A.length&&i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)),a.setCutPlanes(A)),n(b)}function p(a,b){a.attach(b),a.setPosition(b.position),a.visible=!0}function q(a){u.api.navigation.getEyeVector().dot(a)>0&&a.negate();var b=new THREE.Group,c=new THREE.Plane(a,0),d=j(c,null);b.add(d),A.push(d.planeVec),z.push(b),u.addOverlay(D,b),p(s,d),s.showRotationGizmos(!0),B=s.getPicker(),m()}function r(){for(var a=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],b=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],c=new THREE.Group,d=u.getVisibleBounds(),e=d.center(),f=new THREE.Box3(d.min,e),g=[],h=[],i=0;i<a.length;i++){var k=new THREE.Plane(a[i],-1*e.dot(a[i]));if(g.push(k),i>2){var l=k.orthoPoint(f.max),n=k.orthoPoint(f.min),o=(new THREE.Vector3).subVectors(l,n);k.constant-=o.length()}var q=j(k,f);c.add(q),h.push(q),A.push(q.planeVec)}for(var i=0;i<h.length;i++)for(var q=h[i],r=b[i],v=0;v<r.length;v++){for(var w=[],x=r[v],y=0;y<x.length;y++)w.push(g[x[y]]);q.connectivity.push(w)}z.push(c),u.addOverlay(D,c),p(s,z[0].children[0]),p(t,z[0]),s.showRotationGizmos(!1),B=s.getPicker().concat(t.getPicker()),m()}var s,t,u=a.impl,v=["section"],w=!1,x=!1,y=!0,z=[],A=[],B=[],C="",D="gizmo",E=null,F=!1,G=!0,H=[[0,1],[1,3],[3,2],[2,0]],I=Autodesk.Viewing.Extensions.Section;init_TransformGizmos(),init_SectionMesh();var J=function(){var a=new THREE.Matrix3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h){a.set(e.normal.x,e.normal.y,e.normal.z,f.normal.x,f.normal.y,f.normal.z,g.normal.x,g.normal.y,g.normal.z);var i=a.determinant();return 0===i?null:(b.crossVectors(f.normal,g.normal).multiplyScalar(-e.constant),c.crossVectors(g.normal,e.normal).multiplyScalar(-f.constant),d.crossVectors(e.normal,f.normal).multiplyScalar(-g.constant),(h||new THREE.Vector3).copy(b).add(c).add(d).divideScalar(i))}}(),K=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Raycaster,d=u.camera;return function(e,f,g){var h=u.canvas.getBoundingClientRect(),i=(e.clientX-h.left)/h.width*2-1,j=2*-((e.clientY-h.top)/h.height)+1;d.isPerspective?(a.set(i,j,.5),a.unproject(d),c.set(d.position,a.sub(d.position).normalize())):(a.set(i,j,-1),a.unproject(d),b.set(0,0,-1),c.set(a,b.transformDirection(d.matrixWorld)));var k=c.intersectObjects(f,g);return k[0]?k[0]:null}}();this.isActive=function(){return w},this.setSection=function(a){switch(this.clearSection(),a){case"X":var b=new THREE.Vector3(1,0,0);q(b);break;case"Y":var b=new THREE.Vector3(0,1,0);q(b);break;case"Z":var b=new THREE.Vector3(0,0,1);q(b);break;case"BOX":r()}C=a},this.clearSection=function(){for(s&&s.detach(),t&&t.detach();A.length>0;)A.pop();for(;z.length>0;){var a=z.pop();u.removeOverlay(D,a)}var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b),u.setCutPlanes()},this.isPlaneOn=function(){return y},this.showPlane=function(a){n(a)},this.attachControl=function(a){a?(p(s,z[0].children[0]),s.highlight(),"BOX"===C&&p(t,z[0])):(s.detach(),t.detach())},this.resetSection=function(){this.setSection(C)},this.getNames=function(){return v},this.getName=function(){return v[0]},this.register=function(){},this.deregister=function(){this.clearSection(),d()},this.activate=function(a){c(),w=!0,x=!1,G=!0,A=A||[],o(!0)},this.deactivate=function(a){w=!1,x=!1;var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b),o(!1),u.setCutPlanes(),s.detach(),t.detach()},this.update=function(a){return!1},this.handleSingleClick=function(a,b){var c=a.pointers?a.pointers[0]:a,d=K(c,z[0].children);return d&&(p(s,d.object),s.highlight(),e()),!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return x=!0,!!t.onPointerDown(a)||s.onPointerDown(a)},this.handleButtonUp=function(a,b){return x=!1,!!t.onPointerUp(a)||s.onPointerUp(a)},this.handleMouseMove=function(a){if(x){if(t.onPointerMove(a))return m(),s.update(),!0;if(s.onPointerMove(a))return m(),k(),!0}if("touch"!==a.pointerType){var b=a.pointers?a.pointers[0]:a,c=K(b,z[0].children);c&&(G=!1);var d=!!(G||c||K(b,B,!0));s.visible=d,t.visible=void 0!==t.object&&d,n(d)}return!!t.onPointerHover(a)||s.onPointerHover(a)},this.handleGesture=function(a){switch(a.type){case"dragstart":return E="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===E&&this.handleMouseMove(a);case"dragend":return"drag"===E&&(E=null,this.handleButtonUp(a,0))}return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){},this.handlePressHold=function(a){return!0}},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var SimulationDef=function(){function a(){var a=this;a.SimulationStudies={LSS:"SimCaseLSS",MODAL:"SimCaseModalFrequencies",BUCKLING:"SimCaseStructuralBuckling",THERMAL:"SimCaseThermalSteady",THERMALSTRESS:"SimCaseThermalStress",SHAPEGENERATOR:"SimCaseTopOpt",NAMES:{UNKNOWN:"Unknown",LSS:"Static Stress",MODAL:"Modal Frequencies",BUCKLING:"Structural Buckling",THERMAL:"Thermal",THERMALSTRESS:"Thermal Stress",SHAPEGENERATOR:"Shape Optimization"}},a.studyNode,a.loadCases={},a.pointMasssesNode=-1,a.pointMassNodes=[],a.connectorsNode=-1,a.connectorNodes=[],a.activeLoadCaseKey=null,a.modelNodes=[],a.analysisType=a.SimulationStudies.LSS,a.modelStructurePanel=null,a.simExt=null,a.simNodes=[]}a.prototype={constructor:a};var b=a.prototype;return b.studyName=function(){var a=this.SimulationStudies.NAMES.UNKNOWN;return this.analysisType===this.SimulationStudies.LSS?a=this.SimulationStudies.NAMES.LSS:this.analysisType===this.SimulationStudies.MODAL?a=this.SimulationStudies.NAMES.MODAL:this.analysisType===this.SimulationStudies.BUCKLING?a=this.SimulationStudies.NAMES.BUCKLING:this.analysisType===this.SimulationStudies.THERMAL?a=this.SimulationStudies.NAMES.THERMAL:this.analysisType===this.SimulationStudies.THERMALSTRESS?a=this.SimulationStudies.NAMES.THERMALSTRESS:this.analysisType===this.SimulationStudies.SHAPEGENERATOR&&(a=this.SimulationStudies.NAMES.SHAPEGENERATOR),a},b.reset=function(){var a=this;a.studyNode=-1,a.modelNodes=[],a.analysisType=a.SimulationStudies.LSS,a.loadCases={},a.pointMasssesNode=-1,a.pointMassNodes=[],a.connectorsNode=-1,a.connectorNodes=[],a.activeLoadCaseKey=null,a.simNodes=[],a.modelStructurePanel=null},b.addLoadCase=function(a,b,c){var d=this,e=new aves.Fusion360Sim.SimulationLoadCaseDef;return e.loadCase=c,e.loadCaseName=a,d.loadCases["SIM_LOAD_CASE"+b]=e,1===Object.keys(d.loadCases).length&&(d.activeLoadCaseKey="SIM_LOAD_CASE"+b),e},b.shouldDisplayInTree=function(a){var b=this,c=a.dbId;if(b.simNodes.indexOf(c)<0)return!1;if(b.studyNode===c)return!0;if(null===b.activeLoadCaseKey)return!1;if(b.pointMasssesNode===c)return!0;if(b.pointMassNodes.indexOf(c)!==-1)return!0;if(b.connectorNodes.indexOf(c)!==-1)return!0;if(b.connectorsNode===c)return!0;for(var d=Object.keys(b.loadCases),e=0;e<d.length;e++){var f=b.loadCases[d[e]];if(f.isImportant(c))return f.shouldDisplayInTree(c)}return!1},a}();Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef=SimulationDef;var SimulationLoadCaseDef=function(){function a(){var a=this;a.loadCase=-1,a.loadCaseName="",a.constraintsNode=-1,a.constraintNodes=[],a.loadsNode=-1,a.loadNodes=[],a.resultsNode=-1,a.undeformedResults=-1,a.resultTypes={},a.resultGroups={},a.modalResults={}}a.prototype={constructor:a};var b=a.prototype;return b.associateResult=function(a,b){this.resultTypes[b]=a},b.associateResultGroup=function(a,b){this.resultGroups[b]=a},b.associateModalResult=function(a,b){var c=[];if(c=this.modalResults[a])c.push(b);else{var d=[];d.push(b),c=d}this.modalResults[a]=c},b.isImportant=function(a){var b=this;return b.loadCase===a||(b.loadNodes.indexOf(a)!==-1||(b.constraintNodes.indexOf(a)!==-1||(b.resultsNode===a||(b.constraintsNode===a||b.loadsNode===a))))},b.shouldDisplayInTree=function(a){var b=this;return b.loadCase===a||(b.loadNodes.indexOf(a)!==-1||(b.constraintNodes.indexOf(a)!==-1||b.resultsNode!==a&&(b.constraintsNode===a||b.loadsNode===a)))},b.reset=function(){var a=this;a.constraintsNode=-1,a.constraintNodes=[],a.loadsNode=-1,a.loadNodes=[],a.resultsNode=-1,a.undeformedResults=-1,a.resultTypes={},a.resultGroups={},a.modalResults={}},a}();Autodesk.Viewing.Extensions.Fusion360Sim.SimulationLoadCaseDef=SimulationLoadCaseDef,AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var av=Autodesk.Viewing,_ave=av.Extension,aves=av.Extensions,avem=av.theExtensionManager,avu=av.UI,i18n=av.i18n,GalleryPanel=function(){function a(a,b){if(a&&b){var c=a.style.cssText.trim();";"===c.substring(c.length-1)||(c+=";");var d=[];for(var e in b)d[d.length]=[e,b[e]].join(":");d=d.join(";"),a.style.cssText=d}}function b(){var a,b,c,d,e,f,g,h,i,j,k,l,m=this;avu.DockingPanel.prototype.initialize.call(m);var n=m.container;n.classList.add("propertyPanel","simulation-container","position-"+(m.position||"left")+"-corner"),n.dockRight=!0,d=m.legend=document.createElement("div");var o=document.createDocumentFragment(),p=document.createElement("div");p.classList.add("sim-div-Results"),c=m.resultsGroup=document.createElement("select"),c.classList.add("simulation-resultGroup"),p.appendChild(c),e=m.resultTypes=document.createElement("select"),e.classList.add("simulation-resultTypes"),p.appendChild(e),o.appendChild(p);var q=document.createElement("div");q.classList.add("sim-div-options"),b=m.optUndeformed=document.createElement("input"),b.classList.add("sim-undeformedOption"),b.setAttribute("type","checkbox"),b.setAttribute("name","optUndeformed"),b.setAttribute("id","Undeformed"),b.addEventListener("change",function(a){var b=m.simDef.loadCases[m.simDef.activeLoadCaseKey];null!==b&&b.undeformedResults!==-1&&(m.optUndeformed.checked?m.viewer.show(b.undeformedResults):m.viewer.hide(b.undeformedResults))}),b.checked=!1,q.appendChild(b),b.checked=!1,a=m.labelUndeformed=document.createElement("label"),a.classList.add("sim-undeformedOptionText"),a.htmlFor="Undeformed",a.setAttribute("data-i18n","Show Undeformed Model"),a.textContent=i18n.translate("Show Undeformed Model"),q.appendChild(a),o.appendChild(q),f=m.divColorScale=document.createElement("div"),f.classList.add("sim-div-colorscale"),f.classList.add("sim-div-colorscale-top1"),g=m.colorScale=document.createElement("div"),g.classList.add("simulation-colorscale"),f.appendChild(g),h=m.colorScaleTopText=document.createElement("div"),h.classList.add("sim-colorScaleTopText"),h.innerHTML="- 3333",f.appendChild(h),i=m.colorScaleBottomText=document.createElement("div"),i.classList.add("sim-colorScaleBottomText"),i.innerHTML="- 3333",f.appendChild(i),o.appendChild(f),j=m.line2=document.createElement("hr"),j.classList.add("sim-line2"),o.appendChild(j);var r=document.createElement("div");r.classList.add("sim-div-Table"),r.addEventListener("click",function(a){r.classList.add("sim-div-Table-Collapse"),n.classList.add("simulation-container-Collapse"),f.classList.add("sim-div-colorscale-Collapse")}),f.addEventListener("click",function(a){r.classList.remove("sim-div-Table-Collapse"),n.classList.remove("simulation-container-Collapse"),f.classList.remove("sim-div-colorscale-Collapse")}),k=m.tbl=document.createElement("table"),l=m.tblBody=document.createElement("tbody"),k.appendChild(l),k.classList.add("sim-table"),r.appendChild(k),o.appendChild(r),d.appendChild(o),n.appendChild(d)}function c(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function d(b,c){var d=!1,e='""';c<=1&&(d=!0,e="none"),b.disabled=d,a(b,{"-webkit-appearance":e,"-moz-appearance":e,appearance:e})}function e(a,b){var c=this;b=b||{},c.viewer=a,c.simDef=null,avu.DockingPanel.call(c,a.container,"Simulation-Panel","Simulation Results"),c.position=b.position||"right"}e.prototype=Object.create(avu.DockingPanel.prototype);var f=e.prototype;return f.constructor=e,f.initialize=function(){var a=this;b.call(a),a.resultsGroup.addEventListener("change",function(b){var c=a.simDef,d=c.loadCases[a.simDef.activeLoadCaseKey];a.viewer.hide(d.resultsNode);var e="fillResultTypes";c.modalAnalysis&&(e="fillModalResultTypes"),a[e](c.activeLoadCaseKey,a.resultsGroup.value),setTimeout(function(){a.setSimObjectsVisibility()},100)}),a.resultTypes.addEventListener("change",function(){var b=a.simDef.loadCases[a.simDef.activeLoadCaseKey];a.viewer.hide(b.resultsNode),a.setSimObjectsVisibility()})},f.setSimulationDef=function(a){function b(a){var b=c(a.properties,"Name");j.setTitle(b)}function d(a,b,c){}function e(a){var b=c(a.properties,"Elements"),d=c(a.properties,"Nodes");j.rowElements.cells[1].innerText=b,j.rowNodes.cells[1].innerText=d}var f,g,h,i,j=this;if(j.simDef=a,f=1*a.studyNode,a.undeformedResults===-1&&(j.optUndeformed.classList.add("sim-hide"),j.labelUndeformed.classList.add("sim-hide"),j.divColorScale.classList.remove("sim-div-colorscale-top1"),j.divColorScale.classList.add("sim-div-colorscale-top2")),j.viewer.getProperties(f,b,d),g=i18n.translate(a.studyName()),h=j.tblBody,j.rowType)j.rowType.cells[1].innerHTML=g;else{[{name:"rowType",content:[i18n.translate("Analysis Type"),g]},{name:"rowNodes",content:[i18n.translate("Nodes"),"1872"]},{name:"rowElements",content:[i18n.translate("Elements"),"1084"]},{name:"rowMin",content:[i18n.translate("Min"),"0.000E+02 MPa"]},{name:"rowMax",content:[i18n.translate("Max"),"5.117E+02 MPa"]}].forEach(function(a){j[a.name]=h.insertRow(-1),a.content.forEach(function(b){j[a.name].insertCell(-1).innerHTML=b})})}i=j.viewer,i.model.getObjectTree(function(b){j.instanceTree=b,j.fillResultsGroup(j.simDef.activeLoadCaseKey),j[a.analysisType===a.SimulationStudies.MODAL||a.analysisType===a.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes"](j.simDef.activeLoadCaseKey,j.resultsGroup.value),setTimeout(function(){a.simExt.showResultsDlg(!0),a.simExt.applySettings(),j.setSimObjectsVisibility()},500)});var k=+j.simDef.resultsNode;i.getProperties(k,e,d)},f.processNodes=function(a,b){function d(a,b){function d(d){var e=d.properties,f=c(d.properties,"A1C6011B-E1A6-4ADF-975D-A0003C592F87");if(f){switch(f){case"SIM_STUDY":h.studyNode=a;var g=c(d.properties,"Study Type");h.analysisType=g;break;case"SIM_POINT_MASSES":h.pointMasssesNode=a;break;case"SIM_POINT_MASS":h.pointMassNodes.push(a);break;case"SIM_CONNECTORS":h.connectorsNode=a;break;case"SIM_CONNECTOR":
h.connectorNodes.push(a);break;case"SIM_LOAD_CASE":j=h.addLoadCase(c(d.properties,"Name"),a,a);break;case"SIM_CONSTRAINTS":null==j&&(j=h.addLoadCase(i18n.translate("Load Case:1"),0,0)),j.constraintsNode=a;break;case"SIM_CONSTRAINT":j.constraintNodes.push(a);break;case"SIM_LOADS":null==j&&(j=h.addLoadCase(i18n.translate("Load Case:1"),0,0)),j.loadsNode=a;break;case"SIM_LOAD":j.loadNodes.push(a);break;case"SIM_RESULTS_SCALAR_PLOT":null==j&&(j=h.addLoadCase(i18n.translate("Load Case:1"),0,0)),h.analysisType===h.SimulationStudies.LSS||h.analysisType===h.SimulationStudies.THERMAL||h.analysisType===h.SimulationStudies.THERMALSTRESS||h.analysisType===h.SimulationStudies.SHAPEGENERATOR?j.associateResult(c(e,"Name"),a):j.associateModalResult(c(e,"Name"),a);break;case"SIM_RESULTS_GROUP":null==j&&(j=h.addLoadCase(i18n.translate("Load Case:1"),0,0)),h.analysisType!==h.SimulationStudies.LSS&&h.analysisType!==h.SimulationStudies.THERMAL&&h.analysisType!==h.SimulationStudies.THERMALSTRESS&&h.analysisType!==h.SimulationStudies.SHAPEGENERATOR||j.associateResultGroup(c(e,"Name"),a);break;case"SIM_RESULTS":null==j&&(j=h.addLoadCase(i18n.translate("Load Case:1"),0,0)),j.resultsNode=a;break;case"SIM_RESULTS_UNDEFORMED_FEATURE_EDGES_PLOT":null==j&&(j=h.addLoadCase(i18n.translate("Load Case:1"),0,0)),j.undeformedResults=a;break;case"SIM_RESULTS_SCALAR_PLOT_BODY":case"SIM_RESULTS_SAMPLE":}h.simNodes.push(a)}else h.modelNodes.push(a);b()}function e(a,c,d){b()}a&&i&&i.getProperties(a,d,e)}function e(){g.length>0?d(g.shift(),e):b(h)}var f=this,g=[],h=f.simDef,i=f.viewer,j=null;h?h.reset():h=new aves.Fusion360Sim.SimulationDef,a.enumNodeChildren(a.getRootId(),function(a){g[g.length]=a},!0),e()},f.initModel=function(a,b){var c=this;c.viewer&&(c.processNodes(a,function(a){a.simExt=b,c.setSimulationDef(a)}),c.addEventListener(c.viewer,av.SELECTION_CHANGED_EVENT,function(a){var b=a.nodeArray;b&&c.handleClick(b[0])}))},f.fillResultsGroup=function(a){var b=this,c=b.simDef,e=c.loadCases[a],f=b.resultsGroup;f.options.length=0;for(var g=Object.keys(c.analysisType===c.SimulationStudies.MODAL||c.analysisType===c.SimulationStudies.BUCKLING?e.modalResults:e.resultGroups),h=0;h<g.length;h++){var i=document.createElement("option");i.value=g[h];var j=c.analysisType===c.SimulationStudies.MODAL||c.analysisType===c.SimulationStudies.BUCKLING?g[h]:e.resultGroups[g[h]];i.setAttribute("data-i18n",j),i.textContent=i18n.translate(j),f.add(i)}d(f,f.options.length,!1)},f.fillResultTypes=function(a,b){function e(a,b,c){}function f(a){function b(a){if(c(a.properties,f)===g){var b=document.createElement("option");b.value=a.dbId;var e=k.resultTypes[a.dbId];b.setAttribute("data-i18n",e),b.textContent=i18n.translate(e),i.add(b),d(i,i.options.length,0===j.options.length)}}for(var f="Result group",g=c(a.properties,f),l=Object.keys(k.resultTypes),m=0;m<l.length;m++){var n=+l[m];h.getProperties(n,b,e)}}var g=this,h=g.viewer,i=g.resultTypes,j=g.resultsGroup,k=g.simDef.loadCases[a];i.options.length=0;var l=+b;h.getProperties(l,f,e)},f.fillModalResultTypes=function(a,b){function e(a){if(c(a.properties,"Result type")===k){var b=document.createElement("option");b.value=a.dbId;var e=c(a.properties,"Mode"),f=e;b.setAttribute("data-i18n",f),b.textContent=f,g.resultTypes.add(b),d(h,h.options.length,0===i.options.length)}}function f(a,b,c){}var g=this,h=g.resultTypes,i=g.resultsGroup,j=g.simDef.loadCases[a];h.options.length=0;for(var k=b,l=j.modalResults[k]||[],m=0;m<l.length;m++){var n=+l[m];g.viewer.getProperties(n,e,f)}},f.uninitialize=function(){avu.DockingPanel.prototype.uninitialize.call(this),this.viewer=null},f.setTitle=function(a,b){a||(a="Simulations",b=b||{},b.localizeTitle=!0),avu.DockingPanel.prototype.setTitle.call(this,a,b)},f.setModelNodesVisible=function(a){var b=this,c=b.viewer;if(b.simDef){var d=b.simDef.modelNodes;if(d&&d.length>0)for(var e=0;e<d.length;e++)c[a?"show":"hide"](d[e])}},f.setNodeVisibility=function(a,b){this.viewer[b?"show":"hide"](a)},f.isSimStudyNode=function(a){return!!this.simDef.studyNode&&this.simDef.studyNode===a},f.handleClick=function(a){var b=this;if(null===b.simDef)return!1;var c=b.simDef.loadCases[b.simDef.activeLoadCaseKey];if(null===c)return!1;for(var d=Object.keys(b.simDef.loadCases),e=0;e<d.length;e++){var f=b.simDef.loadCases[d[e]];if(f.isImportant(a)&&c!==f){c.loadsNode!==-1&&b.viewer.hide(c.loadsNode),c.constraintsNode!==-1&&b.viewer.hide(c.constraintsNode),c.undeformedResults!==-1&&b.viewer.hide(c.undeformedResults),c.resultsNode!==-1&&b.viewer.hide(c.resultsNode),b.simDef.activeLoadCaseKey=d[e],b.fillResultsGroup(b.simDef.activeLoadCaseKey);return b[b.simDef.analysisType===b.simDef.SimulationStudies.MODAL||b.simDef.analysisType===b.simDef.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes"](b.simDef.activeLoadCaseKey,b.resultsGroup.value),setTimeout(function(){b.simDef.simExt.showResultsDlg(!0),b.setSimObjectsVisibility()},500),!0}}return!1},f.setSimObjectsVisibility=function(a){function b(a){var b=c(a.properties,"Minimal value"),d=c(a.properties,"Maximal value"),f=c(a.properties,"Scale reversed"),g=c(a.properties,"Unit");e.rowMin.cells[1].innerText=b+" "+g,e.rowMax.cells[1].innerText=d+" "+g;var h=c(a.properties,"Lower referential value"),i=c(a.properties,"Upper referential value");"True"===f?(e.colorScale.style.transform="rotate(90deg)",e.colorScale.style.moztransform="rotate(90deg)",e.colorScale.style.webkittransform="rotate(90deg)"):(e.colorScale.style.transform="rotate(-90deg)",e.colorScale.style.moztransform="rotate(-90deg)",e.colorScale.style.webkittransform="rotate(-90deg)"),e.colorScaleTopText.innerHTML="- "+i+" "+g,e.colorScaleBottomText.innerHTML="- "+h+" "+g}function d(a,b,c){}var e=this,f=e.simDef.loadCases[e.simDef.activeLoadCaseKey];if(!e.resultTypes||0===e.resultTypes.options.length||null===f)return e.setModelNodesVisible(!0),void e.simDef.simExt.showResultsDlg(!1);var g=+e.resultTypes.value;e.setModelNodesVisible(!1),g!==-1&&e.viewer.show(g),f.loadsNode!==-1&&e.viewer.show(f.loadsNode),f.constraintsNode!==-1&&e.viewer.show(f.constraintsNode),e.optUndeformed.checked&&f.undeformedResults!==-1&&e.viewer.show(f.undeformedResults),e.viewer.getProperties(g,b,d)},e}();aves.Fusion360Sim.GalleryPanel=GalleryPanel,AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel=function(a,b,c){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,a.viewer,b,c),this.viewer=a.viewer,this.ext=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.setGallery=function(a){this.simGalleryPanel=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.initialize=function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimResultsNode=function(a){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode)&&this.simGalleryPanel.simDef.resultsNode==a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimStudyNode=function(a){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.studyNode)&&this.simGalleryPanel.simDef.studyNode==a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isModelNode=function(a){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length)&&this.simGalleryPanel.simDef.modelNodes.indexOf(a)!==-1},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.shouldInclude=function(a){var b=this;if(!b.simGalleryPanel||!b.simGalleryPanel.simDef)return!1;if(b.isModelNode(a))return!0;if(b.isSimStudyNode(a))return!0;for(var c=b.simGalleryPanel.simDef,d=Object.keys(c.loadCases),e=0;e<d.length;e++){if(c.loadCases[d[e]].resultsNode===a)return!1}return!0},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.onClick=function(a,b){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,a,b),this.simGalleryPanel.handleClick(a)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var av=Autodesk.Viewing,_ave=av.Extension,aves=av.Extensions,avem=av.theExtensionManager;av.GEOMETRY_LOAD_START="geometryLoadStarted";var Simulation=function(){function a(a,d){var e=this;d=d||{};for(var f in b)d[f]=d[f]||b[f];_ave.call(e,a,d),a.addEventListener(av.GEOMETRY_LOAD_START,function(a){c&&e.unload(),"Autodesk.Fusion360.Simulation"===a.data.extensions?c=!0:(e.unload(),c=!1)}),a.addEventListener(av.GEOMETRY_LOADED_EVENT,function(a){e.load()})}var b={},c=!1;a.prototype=Object.create(_ave.prototype);var d=a.prototype;return d.constructor=a,d.load=function(){var a=this,b=a.viewer;return!b.model||(a.galleryPanel=new aves.Fusion360Sim.GalleryPanel(a.viewer),a.viewer.addPanel(a.galleryPanel),a.simButton=new av.UI.Button("toolbar-simulation"),a.simButton.setVisible(!1),a.simButton.setToolTip("Simulation Results"),a.simButton.onClick=function(b){var c=a.galleryPanel.isVisible();a.galleryPanel.setVisible(!c),a.simButton.setState(c?av.UI.Button.State.INACTIVE:av.UI.Button.State.ACTIVE)},a.simButton.setIcon("toolbar-simulationIcon"),b.settingsTools.addControl(a.simButton,{index:1}),a.hideLines=b.prefs.get("lineRendering"),a.ghosting=b.prefs.get("ghosting"),a.ambientShadow=b.prefs.get("ambientShadows"),a.antialiazing=b.prefs.get("antialiasing"),a.lightPreset=b.prefs.get("lightPreset"),b.model.getObjectTree(function(b){setTimeout(function(){a.galleryPanel.initModel(b,a),a.initModelBrowser()},100)}),!0)},d.unload=function(){var a=this;if(a.viewer.model)return a.showResultsDlg(!1),a.viewer.settingsTools.removeControl(this.simButton),a.viewer.removePanel(this.galleryPanel),a.galleryPanel.uninitialize(),a.viewer.hideLines(!a.hideLines),a.viewer.setGhosting(a.ghosting),a.viewer.setQualityLevel(a.ambientShadow,a.antialiazing),a.viewer.setLightPreset(a.lightPreset),!0},d.initModelBrowser=function(){var a=this;setTimeout(function(){a.modelStructurePanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel(a,"Simulation Model Structure Loading",a.options),a.viewer.setModelStructurePanel(a.modelStructurePanel),a.modelStructurePanel.setGallery(a.galleryPanel)},100)},d.showResultsDlg=function(a){var b=this;b.simButton.setState(a?av.UI.Button.State.ACTIVE:av.UI.Button.State.INACTIVE),b.simButton.setVisible(a),b.galleryPanel.setVisible(a)},d.applySettings=function(){var a=this.viewer;a.hideLines(!1),a.setGhosting(!1),a.setQualityLevel(!1,!0),a.setLightPreset(4)},d.simData=function(){return this.galleryPanel.simDef},a}();aves.Simulation=Simulation,avem.registerExtension("Autodesk.Fusion360.Simulation",aves.Simulation),function(){"use strict";var a=Autodesk.Viewing,b=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),c=function(b,c){a.Extension.call(this,b,c),this.tool=null};c.prototype=Object.create(a.Extension.prototype),c.prototype.constructor=c,c.prototype.load=function(){return this.tool=new b.HyperlinkTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.viewer.toolController.activateTool(this.tool.getName()),!0},c.prototype.unload=function(){return this.viewer.toolController.deactivateTool(this.tool.getName()),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},b.HyperlinkExtension=c,a.theExtensionManager.registerExtension("Autodesk.Hyperlink",c)}(),function(){"use strict";var a=Autodesk.Viewing,b=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),c=function(b){a.ToolInterface.call(this),this.names=["hyperlink"];var c=this,d=-1,e=!1,f=[],g=[],h=null,i=null,j=null,k={},l=null,m=null,n=null;this.panel=null;var o=function(c,d,e,f){h||(h=document.createElement("div"),b.container.appendChild(h),h.setAttribute("data-i18n","Ctrl + Click to preview the link"),h.textContent=a.i18n.translate("Ctrl + Click to preview the link")),h.className="hyperlink-tooltip",h.style.top=d+20+"px",h.style.left=c+20+"px",h.intersectPoint=f},p=function(){h&&(b.container.removeChild(h),h=null)},q=function(){if(h){var a=b.navigation.getCamera(),c=b.navigation.getScreenViewport(),d=(new THREE.Vector3).copy(h.intersectPoint);d.project(a);var e=Math.round((d.x+1)/2*c.width),f=Math.round((1-d.y)/2*c.height);h.style.left=e+20+"px",h.style.top=f+20+"px"}},r=function(d){b.removeEventListener(a.GEOMETRY_LOADED_EVENT,r);var e=b.model.getData();i=e.stringDbIds,j=e.stringBoxes,c.loadHyperlinks()},s=function(){c.panel&&c.panel.updatePosition(),q()};this.activate=function(d){if(b.model&&b.model.isLoadDone()){var e=b.model.getData();i=e.stringDbIds,j=e.stringBoxes,c.loadHyperlinks()}else b.addEventListener(a.GEOMETRY_LOADED_EVENT,r);b.addEventListener(a.CAMERA_CHANGE_EVENT,s)},this.deactivate=function(c){b.removeEventListener(a.CAMERA_CHANGE_EVENT,s),f=[],g=[],p(),this.panel&&(this.panel.uninitialize(),this.panel=null),b.HyperlinkBack&&(b.HyperlinkBack.uninitialize(),b.HyperlinkBack=null),b.impl.clearOverlay("Hyperlink-bBox"),b.impl.clearOverlay("Hyperlink-bBox-select")},this.update=function(a){return!1},this.handleSingleClick=function(e,h){this.clearSelection(),this.panel&&(this.panel.uninitialize(),this.panel=null);var i=b.impl.hitTest(e.canvasX,e.canvasY,!1);if(i){var j=i.dbId,k=b.model.getDocumentNode(),l=null;k&&(l=k.data.viewableID);var m=new THREE.Vector2(e.canvasX,e.canvasY);if(b.model.is2d())for(var n in f){var o=f[n];if(o.dbId===j){var q=i.intersectPoint.x,r=i.intersectPoint.y;if(q>=o.bBox[0]&&q<=o.bBox[2]&&r>=o.bBox[1]&&r<=o.bBox[3]){if(o.node){var s=o.node.data.name;this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(c,b,m,i.intersectPoint,s,o.link,l,j,o.node.data,this.getThumbnail)}else this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(c,b,m,i.intersectPoint,null,o.link,l);return this.highlightSelection(o.bBoxMesh),!0}}}else if(e.ctrlKey&&g[d]){this.controller.setIsLocked(!1),p();var o=g[d];if(o.node){var s=o.node.data.name;this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(c,b,m,i.intersectPoint,s,o.link,l,j,o.node.data,this.getThumbnail)}else this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(c,b,m,i.intersectPoint,null,o.link,l,j);return!0}}return!1},this.handleButtonDown=function(a,b){return e=!0,!1},this.handleButtonUp=function(a,b){return e=!1,!1},this.handleMouseMove=function(a){if(!e){if(!b.model.is2d()){var c=b.impl.hitTest(a.canvasX,a.canvasY,!1);if(c){var f=c.dbId;if(f!=d&&(d=f,p()),this.panel&&this.panel.dbId===f)return;g.hasOwnProperty(d)?null!==g[d]&&o(a.canvasX,a.canvasY,g[d],c.intersectPoint):(g[d]=null,this.loadHyperlink3d(d,a.canvasX,a.canvasY,c.intersectPoint))}else p()}return!1}},this.getCursor=function(){return h?"pointer":null},this.loadHyperlinks=function(){if(i)for(var a=0;a<i.length;a++){var b=i[a];this.loadHyperlink2d(b,a)}},this.loadHyperlink2d=function(a,d){b.getProperties(a,function(e){for(var g=e.properties,h=0,i=g.length;h<i;h++){var j=g[h];if("__hyperlink__"===j.displayCategory){var k=null,l=j.displayValue,m=b.model.getDocumentNode();if(m){m=m.getRootNode();var n=m.search({viewableID:l});n&&n.length&&(k=n[0])}f[d]={dbId:a,link:l,node:k},c.highlightText(d);break}}})},this.loadHyperlink3d=function(a,c,d,e){b.getProperties(a,function(f){for(var h=f.properties,i=0,j=h.length;i<j;i++){var k=h[i];if("__hyperlink__"===k.displayCategory){var l=null,m=k.displayValue,n=b.model.getDocumentNode();if(n){n=n.getRootNode();var p=n.search({viewableID:m});p&&p.length&&(l=p[0])}g[a]={link:m,node:l},o(c,d,g[a],e);break}}})},this.getHyperlinks=function(){return _linkCache},this.getThumbnail=function(a,c,d){if(k.hasOwnProperty(a))return void d(k[a]);var e={urn:b.model.getData().urn,width:400,height:400,guid:encodeURIComponent(c.guid),acmsession:b.model.getData().acmSessionId},f=function(b){var c=new FileReader;c.onload=function(b){var c=b.target.result;k[a]=c,d(c)},c.readAsDataURL(b)},g={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid},h="urn:"+e.urn;avp.ViewingService.getThumbnail(avp.initLoadContext(),h,f,null,g)},this.highlightText=function(a){var b=j[4*a]-.2,c=j[4*a+1]-.2,d=j[4*a+2]+.2,e=j[4*a+3]+.2;f[a].bBox=[b,c,d,e],this.addRectangle(a,b,c,d,e)},this.addRectangle=function(a,c,d,e,g){var h=new THREE.Vector3(c,d,0),i=new THREE.Vector3(e,d,0),j=new THREE.Vector3(e,g,0),k=new THREE.Vector3(c,g,0),m=new THREE.Geometry;if(m.vertices.push(h),m.vertices.push(i),m.vertices.push(j),m.vertices.push(k),m.faces.push(new THREE.Face3(0,1,2)),m.faces.push(new THREE.Face3(0,3,2)),!l){l=new THREE.MeshBasicMaterial({color:240116,opacity:.8,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),b.impl.createOverlayScene("Hyperlink-bBox")}var n=f[a].bBoxMesh=new THREE.Mesh(m,l,!0);b.impl.addOverlay("Hyperlink-bBox",n)},this.highlightSelection=function(a){if(n=a,b.impl.removeOverlay("Hyperlink-bBox",a),!m){m=new THREE.MeshBasicMaterial({color:16744272,opacity:.8,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),b.impl.createOverlayScene("Hyperlink-bBox-select")}var c=new THREE.Mesh(a.geometry,m);b.impl.addOverlay("Hyperlink-bBox-select",c)},this.clearSelection=function(){n&&(b.impl.clearOverlay("Hyperlink-bBox-select"),b.impl.addOverlay("Hyperlink-bBox",n),n=null)}};b.HyperlinkTool=c}(),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),b=Autodesk.Viewing,c=(Autodesk.Viewing.Extensions,Autodesk.Viewing.Private,Autodesk.Viewing.UI,function(c,d,e,f,g,h,i,j,k,l){function m(a){n.thumbnail.src=a}var n=this;this.viewer=d,this.container=document.createElement("div"),this.container.className="hyperlink-container",d.container.appendChild(this.container),this.container.style.left=e.x+"px",this.container.style.top=e.y-70+"px",this.intersectPoint=f,this.dbId=j,this.triangle=document.createElement("div"),this.triangle.className="hyperlink-container-triangle",this.container.appendChild(this.triangle),this.panel=document.createElement("div"),this.panel.className="hyperlink-panel",this.container.appendChild(this.panel),this.title=document.createElement("div"),this.title.className="hyperlink-panel-title",g?this.title.textContent=g:(this.title.setAttribute("data-i18n","External Link"),this.title.textContent=b.i18n.translate("External Link")),this.panel.appendChild(this.title),k?(this.thumbnail=document.createElement("img"),this.thumbnail.className="hyperlink-panel-thumbnail",l(j,k,m),this.panel.appendChild(this.thumbnail)):(this.externalLink=document.createElement("div"),this.externalLink.className="hyperlink-panel-external-link",this.externalLink.textContent=h,this.panel.appendChild(this.externalLink)),this.viewButton=document.createElement("div"),this.viewButton.className="hyperlink-panel-view-button",this.viewButton.setAttribute("data-i18n","View"),this.viewButton.textContent=b.i18n.translate("View"),this.panel.appendChild(this.viewButton),this.viewButton.addEventListener("click",function(){n.uninitialize(),c.panel=null,d.HyperlinkBack&&(d.HyperlinkBack.uninitialize(),d.HyperlinkBack=null),d.fireEvent({type:b.HYPERLINK_EVENT,data:{href:h}}),k&&(d.HyperlinkBack=new a.HyperlinkBack(c,d,i))}),this.triangle.style.bottom=this.container.clientHeight-100+"px",this.boundsCheck()});c.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},c.prototype.boundsCheck=function(){var a=this.viewer.navigation.getScreenViewport(),b=this.container.clientWidth,c=this.container.clientHeight,d=parseInt(this.container.style.left,10),e=parseInt(this.container.style.top,10),f=d,g=e;d<0&&(f=0),e<0&&(g=0),a.width<d+b&&(f=a.width-b),a.height<e+c&&(g=a.height-c);var h=this.viewer.navigation.getEyeVector().length(),i=this.viewer.impl.clientToViewport(d,e),j=this.viewer.impl.clientToViewport(f,g);i.subVectors(i,j),this.viewer.navigation.panRelative(i.x/2,i.y/2,h),this.container.style.left=f+"px",this.container.style.top=g+"px"},c.prototype.updatePosition=function(){var a=this.viewer.navigation.getCamera(),b=this.viewer.navigation.getScreenViewport(),c=(new THREE.Vector3).copy(this.intersectPoint);c.project(a);var d=Math.round((c.x+1)/2*b.width),e=Math.round((1-c.y)/2*b.height);this.container.style.left=d+"px",this.container.style.top=e-70+"px"},a.HyperlinkPanel=c;var d=function(a,c,d){var e=this;this.viewer=c,this.container=document.createElement("div"),this.container.className="hyperlink-back",c.container.appendChild(this.container),this.backButton=document.createElement("div"),this.backButton.className="hyperlink-back-button",this.backButton.setAttribute("data-i18n","Back"),this.backButton.textContent=b.i18n.translate("Back"),this.container.appendChild(this.backButton),this.backButton.addEventListener("click",function(){e.uninitialize(),c.HyperlinkBack=null,a.panel&&(a.panel.uninitialize(),a.panel=null),c.fireEvent({type:b.HYPERLINK_EVENT,data:{href:d}})}),this.closer=document.createElement("div"),this.closer.className="hyperlink-back-closer",this.closer.innerHTML="&times;",this.container.appendChild(this.closer),this.closer.addEventListener("click",function(){e.uninitialize(),c.HyperlinkBack=null})};d.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},a.HyperlinkBack=d}(),function(){"use strict";function a(a){this.viewer=a,this.mappingPromise=null,this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0}}function b(a){for(var b={},c=[],d=a.length,e=0,f=0;f<d;f++){var g=a[f];1!==b[g]&&(b[g]=1,c[e++]=g)}return c}var c=AutodeskNamespace("Autodesk.Viewing.Comments"),d=Autodesk.Viewing.Private,e=a.prototype;e.destroy=function(){this.viewer=null},e.createCommentObj=function(a){var b=this.viewer.getState(this.filter);return this.injectInfo(b,a),b},e.injectInfo=function(a,b){a.body=b.message||"",a.status="open",a.jsonVersion="2.0",a.inputSource="Web",a.type="geometry";var c=this.viewer.model.getDocumentNode();if(c&&(c=c.findParentGeom2Dor3D(),a.layoutName=c.data.guid,a.layoutIndex=c.data.order),b.point3d){var d=b.point3d;d instanceof THREE.Vector3&&(d=d.toArray()),this.pushTag(a,{name:"nodeOffset",value:d})}},e.isCommentForCurrentSheet=function(a){var b=this.viewer.model.getDocumentNode();return!b||(b=b.findParentGeom2Dor3D(),b.data.guid===a.layoutName)},e.getManifestNode=function(a){var b=this.viewer.model.getDocumentNode();if(b){return b.getRootNode().findByGuid(a.layoutName)}return null},e.pushTag=function(a,b){Array.isArray(a.tags)||(a.tags=[]),a.tags.push(b)},e.getTag=function(a,b){var c=a.tags;if(c&&Array.isArray(c))for(var d=0,e=c.length;d<e;++d)if(c[d].name===b)return c[d];return null},e.getTagValue=function(a,b,c){var d=this.getTag(a,b);return d?d.value:c||null},e.exportCommentObj=function(a){var b=this;return new Promise(function(c){b.applyGlobalOffset(a),b.getMappingPromise().then(function(d){b.mapObjectSetLmvToExternal(a,d,function(a){c(a)})})})},e.importCommentObj=function(a){var b={};for(var c in this.filter)this.filter.hasOwnProperty(c)&&a.hasOwnProperty(c)&&(b[c]=a[c]);var d=JSON.parse(JSON.stringify(b)),e=this;return new Promise(function(a){e.getMappingPromise().then(function(b){e.mapObjectSetExternalToLmv(d,b),e.removeGlobalOffset(d),a(d)})})},e.applyGlobalOffset=function(a){var b=this.viewer.model.getData().globalOffset;if(b){this.applyOffsetToCamera(a.viewport,b);var c=this.getTag(a,"nodeOffset");return c&&this.applyOffset(c.value,b),!0}return!1},e.removeGlobalOffset=function(a){var b=this.viewer.model.getData().globalOffset;if(b){var c={x:-b.x,y:-b.y,z:-b.z};this.applyOffsetToCamera(a.viewport,c);var d=this.getTag(a,"nodeOffset");return d&&this.applyOffset(d.value,c),!0}return!1},e.applyOffsetToCamera=function(a,b){a&&b&&(this.applyOffset(a.eye,b),this.applyOffset(a.target,b),this.applyOffset(a.pivotPoint,b))},e.applyOffset=function(a,b){if(a){var c=Number(a[0])+b.x,d=Number(a[1])+b.y,e=Number(a[2])+b.z;a[0]="string"==typeof a[0]?c.toString():c,a[1]="string"==typeof a[1]?d.toString():d,a[2]="string"==typeof a[2]?e.toString():e}},e.mapObjectSetLmvToExternal=function(a,c,d){c||d(a),this.viewer.model.is2d()&&d(a);var e=this.getObjectSetElementWithIdType(a.objectSet,"lmv"),f=[].concat(e.id).concat(e.hidden).concat(e.isolated);b(f),this.viewer.model.getBulkProperties(f,["externalId"],function(b){var c={};b.forEach(function(a){c[a.dbId]=a.externalId});var f=JSON.parse(JSON.stringify(e));f.idType="external";var g=function(a){return c[a]};f.id=f.id.map(g),f.hidden=f.hidden.map(g),f.isolated=f.isolated.map(g),a.objectSet.push(f),d(a)},function(){d(a)})},e.mapObjectSetExternalToLmv=function(a,b){if(b){var c=a.objectSet;if(!this.getObjectSetElementWithIdType(c,"lmv")){var d=this.getObjectSetElementWithIdType(c,"external");if(d){var e=function(a){return b[a]},f=JSON.parse(JSON.stringify(d));f.id=f.id.map(e),f.isolated=f.isolated.map(e),f.hidden=f.hidden.map(e),f.idType="lmv",c.unshift(f)}}}},e.getObjectSetElementWithIdType=function(a,b){if(!a||!Array.isArray(a))return null;for(var c=0,d=a.length;c<d;++c)if(a[c].idType===b)return a[c];return null},e.getMappingPromise=function(){if(!this.mappingPromise){var a=this;this.mappingPromise=new Promise(function(b){a.viewer.model.getExternalIdMapping(function(a){d.logger.log("[Autodesk.Comment]Successfully fetched external id mapping."),b(a)},function(){d.logger.error("[Autodesk.Comment]Failed to fetch the external id mapping."),b(null)})})}return this.mappingPromise},c.CommentFactory=a}(),function(){"use strict";function a(a,b,c){this.viewer=a,this.cache=c,this.PATH_STORAGE=null,this.fakeRequest=null,this.init(b)}function b(a,b,c,d,e,f){if(a.fakeRequest)return a.fakeRequest.createRequest(b,c,e,f);var g=a.getToken(),h=new XMLHttpRequest;return h.open(b,c,!0),d&&h.setRequestHeader("Content-Type",d),h.setRequestHeader("Access-Control-Allow-Origin","*"),h.setRequestHeader("Authorization","Bearer "+g),h.onload=e.onLoad,h.onerror=e.onError,h.ontimeout=e.onTimeout,h}function c(a,b,c){return{onLoad:function(d){200==d.currentTarget.status?a(c?d.currentTarget.response:d.currentTarget.responseText):b(d.currentTarget)},onError:function(a){b(a.currentTarget)},onTimeout:function(a){b(a.currentTarget)}}}function d(a,b){b&&b.forEach(function(b){a.setRequestHeader(b.name,b.value)})}function e(a){return window.btoa?window.btoa(a):window.Base64.encode(a)}var f=AutodeskNamespace("Autodesk.Viewing.Comments"),g=(Autodesk.Viewing.Private,a.prototype);f.ENV_TABLE={Local:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Development:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Staging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},Production:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"},AutodeskDevelopment:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},AutodeskStaging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},AutodeskProduction:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"}},g.init=function(a){a=a||{},this.env=Autodesk.Viewing.Private.env,a.fakeServer&&(this.fakeRequest=new f.FakeRequest(a)),this.token=a.token3leg;var b=f.ENV_TABLE[this.env];this.COMMENT_SERVICE_URL=b.COMMENT,this.OBJECT_STORAGE_SERVICE_URL=b.OBJECT_STORAGE;var c=a.urn;if(c)this.setPathStorage(c);else{var d=this.viewer,e=this,g=function(){var a=d.model.getDocumentNode();if(a){var b=a.urn(!0);e.setPathStorage(b)}};d.model?g():d.addEventListener(av.GEOMETRY_LOADED_EVENT,function a(){d.removeEventListener(av.GEOMETRY_LOADED_EVENT,a),g()})}},g.destroy=function(){this.viewer=null,this.fakeRequest=null},g.setPathStorage=function(a){if(a){var b=a.length%4;b>0&&(a+="=".repeat(4-b)),this.PATH_STORAGE=a}},g.listComments=function(){var a=this;return new Promise(function(d,e){b(a,"GET",[a.COMMENT_SERVICE_URL,"resources/",a.PATH_STORAGE].join(""),"text/plain",c(function(b){var c=JSON.parse(b);a.cache.comments=c,d(c)},e)).send()})},g.postComment=function(a){var d=this;return new Promise(function(e,f){b(d,"POST",[d.COMMENT_SERVICE_URL,"resources/",d.PATH_STORAGE].join(""),"text/plain",c(e,f)).send(JSON.stringify(a))})},g.postCommentReply=function(a,d){var f=this;return new Promise(function(g,h){var i=window.encodeURIComponent(e(d));b(f,"POST",[f.COMMENT_SERVICE_URL,"resources/",i].join(""),"text/plain",c(g,h)).send(JSON.stringify(a))})},g.deleteComment=function(a){var d=this;return new Promise(function(f,g){var h=e(a),i=window.encodeURIComponent(h);b(d,"DELETE",[d.COMMENT_SERVICE_URL,"resources/",i].join(""),"text/plain",c(f,g)).send()})},g.fetchLocationForNewOssAttachment=function(a,c){var e=[this.COMMENT_SERVICE_URL,"resources/",this.PATH_STORAGE,"/attachment"].join(""),f=b(this,"POST",e,"application/json",c,"fetchLocationForNewOssAttachment");d(f,a),f.send()},g.getAttachment=function(a,e,f){var g=this;return new Promise(function(h,i){var j=g.extractOssBucketAndId(a),k=[g.OBJECT_STORAGE_SERVICE_URL,"buckets/",j[0],"/objects/",j[1]].join(""),l=c(h,i,e),m=b(g,"GET",k,null,l);d(m,f),e&&(m.responseType="arraybuffer"),m.send()})},g.postAttachment=function(a,c,e,f,g){var h=[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",e,"/objects/",a].join(""),i=b(this,"PUT",h,"text/plain",g);d(i,f),i.send(c)},g.deleteAttachment=function(a,c,d){b(this,"DELETE",[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",c,"/objects/",a].join(""),"text/plain",d).send()},g.extractOssBucketAndId=function(a){var b=a.split("/"),c=b[0],d=c.split(":");return b[0]=d[d.length-1],b},g.getToken=function(){return this.token||Autodesk.Viewing.Private.token.accessToken},f.CommentService=a}(),function(){"use strict";function a(a,d){Autodesk.Viewing.Extension.call(this,a,d||{});var e,f;this.load=function(){var a=this.getCache();if(e=new c.CommentFactory(this.viewer),f=new c.CommentService(this.viewer,this.options,a),a.restoreComment){var b=a.restoreComment;delete a.restoreComment;var d=this,g=function(){var a=function(){d.isCommentForCurrentSheet(b)&&d.restoreComment(b)};d.viewer.getObjectTree(a,a)};this.viewer.model?g():this.viewer.addEventListener(av.GEOMETRY_LOADED_EVENT,function a(){d.viewer.removeEventListener(av.GEOMETRY_LOADED_EVENT,a),g()})}return!0},this.unload=function(){return f&&(f.destroy(),f=null),e&&(e.destroy(),e=null),!0},this.createComment=function(a){var b=a||{};"string"==typeof a&&(b={message:a});var c=e.createCommentObj(b);return e.exportCommentObj(c)},this.isCommentForCurrentSheet=function(a){return e.isCommentForCurrentSheet(a)},this.restoreComment=function(a,b,c){if(!this.isCommentForCurrentSheet(a)){var d=e.getManifestNode(a);if(d){return this.getCache().restoreComment=a,void this.viewer.fireEvent({type:Autodesk.Viewing.LOAD_GEOMETRY_EVENT,data:{item:d.data}})}}var f=this;e.importCommentObj(a).then(function(a){f.viewer.restoreState(a,b,c)})},this.setPathStorage=function(a){if(!a)throw new Error(b+": Invalid path storage");f.setPathStorage(a)},this.comments=function(){return this.getCache().comments||[]},this.getComments=function(){return f.listComments()},this.postComment=function(a){return f.postComment(a)},this.postCommentReply=function(a,b){return f.postCommentReply(a,b)},this.deleteComment=function(a){
return f.deleteComment(a)}}var b="Autodesk.Comments",c=AutodeskNamespace("Autodesk.Viewing.Comments");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,Autodesk.Viewing.theExtensionManager.registerExtension(b,a),c.CommentsExtension=a}(),function(){"use strict";function a(a){this.options=a||{},this.FAKE_SERVER_DELAY=this.options.fakeSeverDelay||200,this.FAKE_NEXT_ID=11}var b=AutodeskNamespace("Autodesk.Viewing.Comments");a.prototype.createRequest=function(a,b,c,d){var e=this;return{notifyCallback:function(a){e.FAKE_SERVER_DELAY?setTimeout(function(){c.onLoad(a)},e.FAKE_SERVER_DELAY):c.onLoad(a)},replyPostComment:function(a){var b=JSON.parse(a);b.id=e.FAKE_NEXT_ID++,b.index=b.id,b.layoutName=b.layoutName||"Another Sheet",b.actor||(b.actor={name:e.options.displayName||"John Doe",id:e.options.oxygenId||"ABCDEFGHIJK"}),b.published=(new Date).toUTCString(),this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(b)}})},replyFetchLocationForNewOssAttachment:function(){var a={attachment:[{url:"urn:adsk.objects:os.object:comments/filename"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(a)}})},send:function(b){switch(a){case"GET":this.notifyCallback({currentTarget:{status:200,responseText:"[]"}});break;case"POST":switch(d){case"fetchLocationForNewOssAttachment":this.replyFetchLocationForNewOssAttachment();break;default:this.replyPostComment(b)}break;case"DELETE":this.notifyCallback({currentTarget:{status:200,responseText:"{}"}});break;case"PUT":try{JSON.parse(b),this.notifyCallback({currentTarget:{status:200,responseText:b}})}catch(a){var c={objects:[{id:"test",key:"test","content-type":"image/png",location:"http://www.autodesk.com"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(c)}})}}},setRequestHeader:function(){}}},b.FakeRequest=a}(),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),b=Autodesk.Viewing;a.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS=5,a.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS=12,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS=15,a.isTouchDevice=function(){return!(!b.isTouchDevice||"function"!=typeof Hammer)&&b.isTouchDevice()},a.createSvgElement=function(a){return document.createElementNS("http://www.w3.org/2000/svg",a)},a.setSvgParentAttributes=function(a){return a.setAttribute("version","1.1"),a.setAttribute("baseProfile","full"),a},a.createMarkupPathSvg=function(){var b=a.createSvgElement("g");b.setAttribute("cursor","inherit"),b.setAttribute("pointer-events","none");var c=a.createSvgElement("path");c.setAttribute("id","markup");var d=a.createSvgElement("path");return d.setAttribute("id","hitarea"),d.setAttribute("fill","transparent"),d.setAttribute("stroke","transparent"),b.markup=c,b.hitarea=d,b.appendChild(c),b.appendChild(d),b},a.setAttributeToMarkupSvg=function(a,b,c){a.markup.setAttribute(b,c)},a.updateMarkupPathSvgHitarea=function(b,c){var d=b.markup,e=b.hitarea,f=c.sizeFromClientToMarkups(0,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;f+=parseFloat(d.getAttribute("stroke-width"))+f;var g=d.getAttribute("fill"),h=d.getAttribute("stroke"),i=""!==h&&"none"!==h,j=""!==g&&"none"!==g;if(e.setAttribute("d",d.getAttribute("d")),e.setAttribute("stroke-width",f),e.setAttribute("transform",d.getAttribute("transform")),!c.navigating){if(i&&j)return void b.setAttribute("pointer-events","painted");if(i)return void b.setAttribute("pointer-events","stroke");if(!j)return void b.setAttribute("pointer-events","fill")}b.setAttribute("pointer-events","none")},a.createMarkupTextSvg=function(){var b=a.createSvgElement("g");b.setAttribute("cursor","default");var c="markup-clipper-"+a.getClipPathId(),d="url(#"+c+")",e=a.createSvgElement("clipPath");e.setAttribute("id",c),e.removeAttribute("pointer-events"),e.rect=a.createSvgElement("rect"),e.appendChild(e.rect);var f=a.createSvgElement("rect");f.setAttribute("id","markup-background");var g=a.createSvgElement("text");g.setAttribute("id","markup"),f.removeAttribute("pointer-events");var h=a.createSvgElement("rect");h.setAttribute("id","hitarea"),h.setAttribute("fill","transparent"),h.setAttribute("stroke","none"),h.setAttribute("stroke-width","0");var i=a.createSvgElement("g");return i.setAttribute("clip-path",d),i.appendChild(e),i.appendChild(f),i.appendChild(g),b.appendChild(i),b.appendChild(h),b.clipper=e,b.background=f,b.markup=g,b.hitarea=h,b},a.setMarkupTextSvgTransform=function(a,b,c){a.clipper.rect.setAttribute("transform",b),a.background.setAttribute("transform",b),a.markup.setAttribute("transform",c),a.hitarea.setAttribute("transform",b)},a.updateMarkupTextSvgHitarea=function(b,c,d,e){var f=b.hitarea,g=e.sizeFromClientToMarkups(0,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;f.setAttribute("x",-g),f.setAttribute("y",-g),f.setAttribute("width",c+2*g),f.setAttribute("height",d+2*g),b.setAttribute("pointer-events",e.navigating?"none":"painted")},a.updateMarkupTextSvgBackground=function(a,b,c,d){var e=a.background;e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("width",b),e.setAttribute("height",c),e.setAttribute("fill",d)},a.updateMarkupTextSvgClipper=function(a,b,c){var d=a.clipper;d.rect.setAttribute("x",0),d.rect.setAttribute("y",0),d.rect.setAttribute("width",b),d.rect.setAttribute("height",c)},a.addSvgMetadata=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","metadata"),d=document.createElement("markup_document");return c.appendChild(d),d.setAttribute("data-model-version",b["data-model-version"]),a.insertBefore(c,a.firstChild),c},a.addMarkupMetadata=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","metadata"),d=document.createElement("markup_element");c.appendChild(d);for(var e in b)b.hasOwnProperty(e)&&d.setAttribute(e,b[e]);return a.insertBefore(c,a.firstChild),c},a.removeAllMetadata=function(a){if(a.getElementsByTagName)for(var b=a.getElementsByTagName("metadata"),c=0;c<b.length;++c){var d=b[c];d.parentNode&&d.parentNode.removeChild(d)}var e=a.children||a.childNodes;if(e)for(c=0;c<e.length;++c)this.removeAllMetadata(e[c])},a.transferChildNodes=function(a,b){for(var c=a.children||a.childNodes,d=[],e=0;e<c.length;++e)d.push(c[e]);d.forEach(function(a){b.appendChild(a)})},a.getClipPathId=function(){for(var a=document.getElementsByTagName("clipPath"),b=a.length,c=0,d=0;d<b;++d){var e=a[d].id;e.indexOf("markup-clipper-")!==-1&&(e=e.replace("markup-clipper-",""),c=Math.max(c,e))}return c+1},a.svgNodeToString=function(a){function b(a,c){var d=a.hitarea,e=d&&d.parentNode;e&&(c.push({hitarea:d,parent:e}),e.removeChild(d));for(var f=a.childNodes,g=f.length,h=0;h<g;++h)b(f.item(h),c)}var c;try{var d=[];b(a,d);c=(new XMLSerializer).serializeToString(a),function(a){for(var b=a.length,c=0;c<b;++c){var d=a[c];d.parent.appendChild(d.hitarea)}}(d)}catch(a){c="",console.warn("svgNodeToString failed to generate string representation of domNode.")}return c},a.stringToSvgNode=function(a){var b=null;try{b=(new DOMParser).parseFromString(a,"text/xml").firstChild}catch(a){b=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return b},a.addTraitEventDispatcher=function(a){a.listeners={},a.addEventListener=function(a,b){void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},a.hasEventListener=function(a,b){if(void 0===this.listeners)return!1;var c=this.listeners;return void 0!==c[a]&&c[a].indexOf(b)!==-1},a.removeEventListener=function(a,b){if(this.listeners[a]instanceof Array)for(var c=this.listeners[a],d=0,e=c.length;d<e;d++)if(c[d]===b){c.splice(d,1);break}},a.fireEvent=function(a){if("string"==typeof a&&(a={type:a}),a.target||(a.target=this),!a.type)throw new Error("event type unknown.");if(this.listeners[a.type]instanceof Array)for(var b=this.listeners[a.type].slice(),c=0;c<b.length;c++)b[c].call(this,a)}},a.removeTraitEventDispatcher=function(a){try{delete a.listeners,delete a.addEventListener,delete a.hasEventListener,delete a.removeEventListener,delete a.fireEvent}catch(a){}},a.worldToClient=function(b,c,d){var e=a.worldToViewport(b,c),f=a.viewportToClient(e.x,e.y,c);return f.z=0,d&&(f.x=Math.floor(f.x)+.5,f.y=Math.floor(f.y)+.5),f},a.clientToWorld=function(b,c,d,e){var f=a.clientToViewport(b,c,e);return f.z=d,f.unproject(e.impl.camera),f},a.clientToViewport=function(a,b,c){return c.impl.clientToViewport(a,b)},a.viewportToClient=function(a,b,c){return c.impl.viewportToClient(a,b)},a.worldToViewport=function(a,b){var c=new THREE.Vector3;return c.x=a.x,c.y=a.y,c.z=a.z,c.project(b.impl.camera),c},a.metersToModel=function(a,b){return 1/b.model.getUnitScale()*a},a.radiansToDegrees=function(a){return a*(180/Math.PI)},a.degreesToRadians=function(a){return a*(Math.PI/180)},a.sign=function(a){return a>=0?1:-1},a.areMarkupsPointsInClientRange=function(a,b,c,d){c=d.sizeFromClientToMarkups(0,c).y;var e=a.x-b.x,f=a.y-b.y;return c*c>=e*e+f*f},a.hideLmvUi=function(b){b.toolbar&&(b.setActiveNavigationTool(),a.dismissLmvHudMessage(),a.hideLmvPanels(!0,b),a.hideLmvToolsAndPanels(b))},a.restoreLmvUi=function(b){b.toolbar&&(a.dismissLmvHudMessage(),a.hideLmvPanels(!1,b),a.showLmvToolsAndPanels(b))},a.hideLmvPanels=function(a,b){var c=b.dockingPanels;if(c)for(var d=0;d<c.length;++d){var e=c[d],f=e.container;f.classList.contains("dockingPanelVisible")&&(f.style.display=a?"none":"block",e.visibilityChanged())}},a.showLmvToolsAndPanels=function(a){a&&a.model&&!a.model.is2d()&&a.displayViewCube(!0,!1);var b=document.getElementsByClassName("homeViewWrapper"),c=document.getElementsByClassName("infoButton"),d=document.getElementsByClassName("toolbar-animationSubtoolbar");if(b.length>0&&(b[0].style.display=""),c.length>0&&(c[0].style.display=""),d.length>0&&(d[0].style.display=""),a.toolbar){for(var e=a.toolbar.container,f=e.children.length,g=0;g<f;++g)e.children[g].style.display="";a.centerToolBar()}},a.hideLmvToolsAndPanels=function(a){a&&a.model&&!a.model.is2d()&&a.displayViewCube(!1,!1);var b=document.getElementsByClassName("homeViewWrapper"),c=document.getElementsByClassName("infoButton"),d=document.getElementsByClassName("toolbar-animationSubtoolbar");if(b.length>0&&(b[0].style.display="none"),c.length>0&&(c[0].style.display="none"),d.length>0){d[0].style.display="none";var e=a.impl.keyFrameAnimator;if(e&&!e.isPaused){e.pauseCameraAnimations(),e.pause();var f=a.modelTools.getControl("toolbar-animationPlay");f&&(f.setIcon("toolbar-animationPauseIcon"),f.setToolTip("Pause"))}}if(a.toolbar)for(var g=a.toolbar.container,h=g.children.length,i=0;i<h;++i)g.children[i].style.display="none"},a.dismissLmvHudMessage=function(){try{for(var a=!0;a;)a=Autodesk.Viewing.Private.HudMessage.dismiss()}catch(a){console.warn("[CO2]Failed to dismiss LMV HudMessage")}},a.createStyle=function(b,c){for(var d={},e=0;e<b.length;++e)d[b[e]]=null;for(var f=a.getStyleDefaultValues(d,c),e=0;e<b.length;++e){var g=b[e];d[g]=f[g].values[f[g].default].value}return d},a.copyStyle=function(a,b){for(var c in b)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},a.cloneStyle=function(a){var b={};for(var c in a)b[c]=a[c];return b},a.getStyleDefaultValues=function(b,c){function d(a,b){return b.sizeFromClientToMarkups(0,a).y}function e(a){return{values:[{name:"100%",value:1},{name:"75%",value:.75},{name:"50%",value:.5},{name:"25%",value:.25},{name:"0%",value:0}],default:a?4:0}}var f=a.cloneStyle(b),g=d(a.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS,c),h=d(a.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,c);for(var i in f)switch(i){case"stroke-width":f[i]=function(a){return{values:[{name:"Thin",value:a/2},{name:"Normal",value:a},{name:"Thick",value:2*a}],default:1}}(g);break;case"stroke-linejoin":f[i]=function(){return{values:[{name:"Miter",value:"miter"},{name:"Round",value:"round"},{name:"Bevel",value:"bevel"}],default:0}}();break;case"font-size":f[i]=function(a){return{values:[{name:"Thin",value:a/2},{name:"Normal",value:a},{name:"Thick",value:2*a}],default:1}}(h);break;case"font-family":f[i]=function(){return{values:[{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Arial Narrow",value:"Arial Narrow"},{name:"Century Gothic",value:"Century Gothic"},{name:"Courier New",value:"Courier New"},{name:"Georgia",value:"Georgia"},{name:"Impact",value:"Impact"},{name:"Lucida Console",value:"Lucida Console"},{name:"Tahoma",value:"Tahoma"},{name:"Verdana",value:"Verdana"}],default:0}}();break;case"font-style":f[i]=function(){return{values:[{name:"Normal",value:"normal"},{name:"Italic",value:"italic"}],default:0}}();break;case"font-weight":f[i]=function(){return{values:[{name:"Normal",value:"normal"},{name:"Bold",value:"bold"}],default:0}}();break;case"stroke-color":case"fill-color":f[i]=function(){return{values:[{name:"red",value:"#ff0000"},{name:"green",value:"#00ff00"},{name:"blue",value:"#0000ff"},{name:"white",value:"#ffffff"},{name:"black",value:"#000000"}],default:0}}();break;case"stroke-opacity":var j=!1;f[i]=e(j);break;case"fill-opacity":var j=!0;f[i]=e(j)}return f},a.composeRGBAString=function(a,b){return!a||!b||b<=0?"none":["rgba("+parseInt("0x"+a.substr(1,2)),",",parseInt("0x"+a.substr(3,2)),",",parseInt("0x"+a.substr(5,2)),",",b,")"].join("")},a.checkLineSegment=function(a,b,c,d,e){function f(a,b){a=Math.round(a),b=Math.round(b);for(var c=0,d=0,e=-h;e<=h;e+=2*h)d+=g(a,b+e)?e:0;for(var f=-h;f<=h;f+=2*h)c+=g(a+f,b)?f:0;return{x:Math.round(a/h+c),y:Math.round((j-b)/h-d)}}function g(a,b){if(a<0||a>=i||b<0||b>=j)return!1;var c=4*(b*i+a);return 255!==k[c]||255!==k[c+1]||255!==k[c+2]}var h=window.devicePixelRatio||1;a*=h,b*=h,c*=h,d*=h;var i=e.width,j=e.height,k=e.buffer;a=Math.round(a),c=Math.round(c),b=Math.round(j-b),d=Math.round(j-d);var l=c-a,m=d-b,n=0!==l?m/l:1,o=a,p=b;if(0!==l&&Math.abs(n)<=1){if(a<=c){for(;o<=c;++o,p+=n)if(g(o,Math.round(p)))return f(o,p)}else for(;o>=c;--o,p-=n)if(g(o,Math.round(p)))return f(o,p)}else if(n=0!==l?1/n:0,b<=d){for(;p<=d;++p,o+=n)if(g(Math.round(o),p))return f(o,p)}else for(;p>=d;--p,o-=n)if(g(Math.round(o),p))return f(o,p)},a.checkPolygon=function(a,b){function c(a,b){for(var c=0,e=0,g=-f;g<=f;g+=2*f)e+=d(a,b+g)?g:0;for(var i=-f;i<=f;i+=2*f)c+=d(a+i,b)?i:0;return{x:Math.round(a/f)+c,y:Math.round((h-b)/f-e)}}function d(a,b){if(a<0||a>=g||b<0||b>=h)return!1;var c=4*(b*g+a);return(255!==i[c]||255!==i[c+1]||255!==i[c+2])&&e(a,b)}function e(b,c){for(var d=!1,e=a.vertexCount,f=0,g=e-1;f<e;g=f++)l[f]>c!=l[g]>c&&b<(k[g]-k[f])*(c-l[f])/(l[g]-l[f])+k[f]&&(d=!d);return d}if(!a||a.verxtexCount<3||!b)return null;for(var f=window.devicePixelRatio||1,g=b.width,h=b.height,i=b.buffer,j=a.vertexCount,k=Float32Array.from(a.xVertices),l=Float32Array.from(a.yVertices),m=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY,q=0;q<j;++q){var r=k[q]=k[q]*f,s=l[q]=h-l[q]*f;m=Math.min(m,r),n=Math.min(n,s),o=Math.max(o,r),p=Math.max(p,s)}if(o<0||m>g||p<0||n>h)return null;var t=Math.round(o-m),u=Math.round(p-n),v=Math.round(.5*(m+o)),w=Math.round(.5*(n+p)),x=v,y=w,z=1,A=1;do{for(var B=x+z,C=y+A;x<B;++x)if(d(x,y))return c(x,y);for(;y<C;++y)if(d(x,y))return c(x,y);for(z<t?(B=x-++z,++z):B=x-z,A<u?(C=y-++A,++A):C=y-A;x>B;--x)if(d(x,y))return c(x,y);for(;y>C;--y)if(d(x,y))return c(x,y)}while(z<t||A<u)},a.createStyleSheet=function(){var a=document.createElement("style");return a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet},a.addRuleToStyleSheet=function(a,b,c,d){"insertRule"in a?a.insertRule(b+"{"+c+"}",d):"addRule"in a&&a.addRule(b,c,d)},a.measureTextLines=function(b,c,d){var e=d.sizeFromMarkupsToClient(0,c["font-size"]).y,f=(new a.DomElementStyle).setAttribute("font-family",c["font-family"]).setAttribute("font-size",e+"px").setAttribute("font-weight",c["font-weight"]?"bold":"").setAttribute("font-style",c["font-style"]?"italic":"").removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString(),g=document.createElement("div");g.setAttribute("style",f),d.viewer.container.appendChild(g);for(var h=[],i=b.length,j=0;j<i;++j)g.innerHTML=b[j],h.push({line:b[j],width:g.clientWidth,height:g.clientHeight});return d.viewer.container.removeChild(g),h},a.createArcTo=function(a,b,c,d,e,f){return f.push(e?"a":"A"),f.push(c),f.push(d),f.push(0),f.push(1),f.push(1),f.push(a),f.push(b),f},a.createEllipsePath=function(b,c,d,e,f,g){var h=.5*d,i=.5*e;g.push(f?"m":"M"),g.push(b),g.push(c),a.createArcTo(d,0,h,i,!0,g),a.createArcTo(-d,0,h,i,!0,g),g.push("z")},a.createRectanglePath=function(a,b,c,d,e,f){f.push(e?"m":"M"),f.push(a),f.push(b),f.push("l"),f.push(c),f.push(0),f.push("l"),f.push(0),f.push(d),f.push("l"),f.push(-c),f.push(0),f.push("z")},a.renderToCanvas=function(b,c,d,e,f){for(var g=e["stroke-width"],h=e["stroke-linejoin"],i=e["stroke-color"],j=e["stroke-opacity"],k=e["fill-color"],l=e["fill-opacity"],m=new THREE.Vector3(0,0,0),n=(new THREE.Matrix4).extractRotation(f),o=180*Math.atan2(n.elements[4],n.elements[0])/Math.PI,p=b.positionFromMarkupsToClient.bind(b),q=b.vectorFromMarkupsToClient.bind(b),r=b.sizeFromMarkupsToClient.bind(b),s=d.length,t=!1,u=0;u<s;)switch(d[u++]){case"M":case"L":m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(f);var v=p(m.x,m.y);d[u++]=v.x,d[u++]=v.y;break;case"m":case"l":m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var v=q(m.x,m.y);d[u++]=v.x,d[u++]=v.y;break;case"c":m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var w=q(m.x,m.y);d[u++]=w.x,d[u++]=w.y,m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var x=q(m.x,m.y);d[u++]=x.x,d[u++]=x.y,m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var y=q(m.x,m.y);d[u++]=y.x,d[u++]=y.y;break;case"a":var z=r(d[u],d[u+1]);d[u++]=z.x,d[u++]=z.y,d[u++]=o,u++,d[u]=1==d[u++]?0:1,m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var y=q(m.x,m.y);d[u++]=y.x,d[u++]=y.y;break;case"Z":case"z":t=!0}c.strokeStyle=a.composeRGBAString(i,j),c.fillStyle=a.composeRGBAString(k,l),c.lineJoin=h,c.lineWidth=b.sizeFromMarkupsToClient(g,0).x,d=new Path2D(d.join(" ")),t&&0!==l&&c.fill(d),c.stroke(d)}}(),function(){"use strict";function a(a,b,c){this.type=b,this.editor=a,this.targetId=c,this.addToHistory=!0,this.selectOnExecution=!0}AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),Autodesk.Viewing.Extensions.Markups.Core.EditAction=a,Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.execute=function(){this.editor.actionManager.execute(this)},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.redo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.undo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.merge=function(a){return!1},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.isIdentity=function(){return!1}}(),function(){"use strict";function a(a){this.historySize=a,this.undoStack=new Array(a),this.redoStack=new Array(a),c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.EVENT_HISTORY_CHANGED="EVENT_HISTORY_CHANGED";var d=a.prototype;d.execute=function(a){var c=this.redoStack,d=this.undoStack;c.splice(0,c.length),a.redo();var e=this.getEditActionGroup();e.isOpen()?e.addAction(a):(e.open(),e.addAction(a),e.close()),d.length>this.historySize&&d.splice(0,1);var f=a.selectOnExecution?a.targetId:-1;this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"execute",targetId:f}})},d.beginActionGroup=function(){var a=this.undoStack,b=a.length,c=null;0===b||a[b-1].isClosed()?(c=this.getEditActionGroup(),c.open()):console.warn("Markups - Undo/Redo - Action edit group already open.")},d.closeActionGroup=function(){var a=this.undoStack,b=a.length;if(0===b)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var c=a[b-1];c.close()||console.warn("Markups - Undo/Redo - Action edit group already closed."),c.isEmpty()&&a.pop()},d.cancelActionGroup=function(){var a=this.undoStack,c=a.length;if(0===c)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var d=a[c-1];if(!d.close())return void console.warn("Markups - Undo/Redo - Action edit group already closed.");d.undo(),a.pop(),this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"cancel",targetId:-1}})},d.undo=function(){var a=this.undoStack,c=this.redoStack;if(0!==a.length){var d=a.pop(),e=d.undo();c.push(d),this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"undo",targetId:e}})}},d.redo=function(){var a=this.undoStack,c=this.redoStack;if(0!==c.length){var d=c.pop(),e=d.redo();a.push(d),this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"redo",targetId:e}})}},d.clear=function(){this.undoStack.splice(0,this.undoStack.length),this.redoStack.splice(0,this.redoStack.length),this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"clear",targetId:-1}})},d.isUndoStackEmpty=function(){return 0===this.undoStack.length},d.isRedoStackEmpty=function(){return 0===this.redoStack.length},d.getEditActionGroup=function(){var a=this.undoStack,c=this.undoStack.length,d=null;return 0===c||a[c-1].isClosed()?(d=new b.EditActionGroup,a.push(d)):d=a[c-1],d},b.EditActionManager=a}(),function(){"use strict";function a(){this.reset()}function b(a){var b=[];for(var c in a){var d=a[c];b.push(c),b.push(":"),b.push(d),b.push("; ")}return b.join("")}var c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=["-ms-","-webkit-","-moz-","-o-"],e=a.prototype;e.reset=function(){return this.attributes={},this.dirty=!1,this.styleString="",this},e.setAttribute=function(a,b,c){if(this.attributes[a]=b,c&&c.allBrowsers){var e=this;d.forEach(function(c){e.attributes[c+a]=b})}return this.dirty=!0,this},e.removeAttribute=function(a){Array.isArray(a)||(a=[a]);var b=this;return a.forEach(function(a){a in b.attributes&&(delete b.attributes[a],b.dirty=!0)}),this},e.getStyleString=function(){return this.dirty&&(this.styleString=b(this.attributes),this.dirty=!1),this.styleString},e.clone=function(){var a=new c.DomElementStyle,b=this.attributes;for(var d in b)a.setAttribute(d,b[d]);return a},c.DomElementStyle=a}(),function(){"use strict";function a(a,b){this.containingDiv=a,this.editor=b,this.selectionLayer=c(),this.frameMargin=10,this.selection={x:0,y:0,width:0,height:0,rotation:0,element:null,active:!1,dragging:!1,resizing:!1,handle:{}},j.bind(this)(),w.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.selectionLayer,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}]],inputClass:Hammer.TouchInput}),this.onHammerDragBinded=this.onHammerDrag.bind(this),this.onHammerDoubleTapBinded=this.onHammerDoubleTap.bind(this),this.hammer.on("dragstart dragmove dragend",this.onHammerDragBinded),this.hammer.on("doubletap",this.onHammerDoubleTapBinded),this.hammer.on("doubletap2",this.onHammerDoubleTapBinded)),o.bind(this)(),p.bind(this)(),r.bind(this)(),q.bind(this)(),this.containingDiv.appendChild(this.selectionLayer),w.addTraitEventDispatcher(this)}function b(a){a.pageX=a.pointers[0].clientX,a.pageY=a.pointers[0].clientY}function c(){var a=document.createElement("div");return a.style.position="absolute",a.style.top=0,a.style.bottom=0,a.style.left=0,a.style.right=0,a.style.overflow="hidden",a.style.visibility="hidden",s(a,!1),a}function d(a,b){var c=document.createElement("div");c.style.position="absolute",c.style.height=a+"px",c.style.width=a+"px",c.style.background=y,c.style.borderColor=x,c.style.borderWidth="1px",c.style.borderStyle="solid",f(c,b),c.className="selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-"+b,c.setAttribute("data-sdp-handle",b);var d=-a-2;switch(b){case"n":c.style.top=d+"px",c.style.left="calc(50% - "+a/2+"px)",c.style.position="relative",c.style.margin=0;break;case"s":c.style.top="calc(100% - "+(a+2)+"px)",c.style.left="calc(50% - "+a/2+"px)",c.style.position="relative",c.style.margin=0;break;case"w":c.style.left=d+"px",c.style.top="50%",c.style.transform="translate3d(0, -50%, 0)";break;case"e":c.style.right=d+"px",c.style.top="50%",c.style.transform="translate3d(0, -50%, 0)";break;case"nw":c.style.top=d+"px",c.style.left=d+"px";break;case"ne":c.style.top=d+"px",c.style.right=d+"px";break;case"sw":c.style.bottom=d+"px",c.style.left=d+"px";break;case"se":c.style.bottom=d+"px",c.style.right=d+"px"}return c}function e(){var a=document.createElement("div");return a.style.position="absolute",a.style.background=y,a.style.border="1px solid rgba(30, 30, 255, 0.25)",a.style.height="18px",a.style.width="18px",a.style.borderRadius="10px",a.style.boxSizing="border-box",a.classList.add("selector-rotate-point"),a.style.left="50%",a.style.transform="translate3d(-50%, 0px, 0px)",a.style.top="-70px",a.classList.add("autodesk-markups-extension-core-make-me-bigger"),a}function f(a,b){var c;switch(b){case"n":case"s":c="ns-resize";break;case"w":case"e":c="ew-resize";break;case"ne":case"sw":c="nesw-resize";break;case"nw":case"se":c="nwse-resize"}a.style.cursor=c}function g(a){["n","s","w","e","nw","ne","sw","se"].forEach(function(b){this.selection.handle[b]=d(16,b),a.appendChild(this.selection.handle[b])}.bind(this))}function h(a){return u(a,".selector-drag-point")}function i(a){return u(a,".selector-rotate-point")}function j(){var a=document.createElement("div");return a.style.position="absolute",a.style.border="1px solid "+x,a.style.zIndex=1,a.style.cursor="move",a.style.boxSizing="border-box",s(a,!0),a.classList.add("selector-box"),g.bind(this)(a),this.selection.rotationHandle=e(),a.appendChild(this.selection.rotationHandle),this.selection.element=a,this.selectionLayer.appendChild(this.selection.element),l.bind(this)(!1),a}function k(a,b){return"translate3d("+a+"px,"+b+"px,0)"}function l(a){this.selection.active=a,this.selection.element.style.display=a?"block":"none"}function m(a,b,c){this.selection.x=a,this.selection.y=b,this.selection.rotation=c;var d=this.markup.getClientSize();d.x+=2*this.frameMargin,d.y+=2*this.frameMargin,this.selection.element.style.msTransform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.msTransformOrigin=d.x/2+"px "+d.y/2+"px",this.selection.element.style.webkitTransform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.webkitTransformOrigin=d.x/2+"px "+d.y/2+"px",this.selection.element.style.transform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.transformOrigin=d.x/2+"px "+d.y/2+"px"}function n(a,b){this.selection.width=a,this.selection.height=b,this.selection.element.style.width=a+"px",this.selection.element.style.height=b+"px"}function o(){this.selection.element.addEventListener("mousedown",this._onRepositionMouseDown.bind(this))}function p(){this.selectionLayer.addEventListener("mousedown",this._onResizeMouseDown.bind(this))}function q(){this.selection.element.addEventListener("mousedown",this._onRotationMouseDown.bind(this))}function r(){var a=function(a){this.selection.dragging=!1;var b=this.editor.editMode;b&&b.onMouseDoubleClick(this.markup)}.bind(this);this.selectionLayer.addEventListener("dblclick",a)}function s(a,b){a.style.pointerEvents=b?"auto":"none"}function t(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}function u(a,b){return a.matches?a.matches(b):a.msMatchesSelector?a.msMatchesSelector(b):a.mozMatchesSelector?a.mozMatchesSelector(b):!!a.webkitMatchesSelector&&a.webkitMatchesSelector(b)}var v=Autodesk.Viewing.Extensions.Markups.Core,w=Autodesk.Viewing.Extensions.Markups.Core.Utils;v.EVENT_EDITFRAME_EDITION_START="EVENT_EDITFRAME_EDITION_START",v.EVENT_EDITFRAME_EDITION_END="EVENT_EDITFRAME_EDITION_END";var x="rgba(30, 30, 255, 0.30)",y="gainsboro",z=a.prototype;z.setSelection=function(a,b,c,d,e){var f=this.frameMargin,g=2*f;n.bind(this)(c+g,d+g),m.bind(this)(a-f,b-f,e),l.bind(this)(!0),this.selectionLayer.style.visibility="visible"},z.setMarkup=function(a){if(this.hammer&&this.hammer.set({enable:null!==a}),this.markup=a,l.bind(this)(!1),a){var b=a.getClientSize(),c=a.getClientPosition(),d=b.x,e=b.y,f=a.getRotation();this.setSelection(c.x-d/2,c.y-e/2,d,e,f),this.enableResizeHandles(),this.enableRotationHandle()}},z.startDrag=function(a){this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),this._onRepositionMouseDown(a,this.editor.getMousePosition())},z.isActive=function(){return this.isDragging()||this.isResizing()||this.isRotating()},z.isDragging=function(){return this.selection.dragging},z.isResizing=function(){return this.selection.resizing},z.isRotating=function(){return this.selection.rotating},z.onMouseMove=function(a){},z.onMouseUp=function(a){},z.onHammerDrag=function(a){function c(a,b,c){var d=b.getBoundingClientRect();a.mousePosition.x=c.pageX-d.left,a.mousePosition.y=c.pageY-d.top}switch(b(a),a.type){case"dragstart":c(this.editor.input,this.editor.svg,a),i(a.target)?this._onRotationMouseDown(a):h(a.target)?this._onResizeMouseDown(a):this.startDrag(a),a.preventDefault();break;case"dragmove":c(this.editor.input,this.editor.svg,a),this.onMouseMove(a),a.preventDefault();break;case"dragend":c(this.editor.input,this.editor.svg,a),this.onMouseUp(a),a.preventDefault()}},z.onHammerDoubleTap=function(a){b(a),function(a,b,c){var d=b.getBoundingClientRect();a.mousePosition.x=c.pageX-d.left,a.mousePosition.y=c.pageY-d.top}(this.editor.input,this.editor.svg,a),this.selection.dragging=!1,this.editor.editMode&&this.editor.editMode.onMouseDoubleClick(this.markup)},z.enableResizeHandles=function(){var a,b=this.markup;if(b.isHeightConstrained()||b.isWidthConstrained()){for(var c in this.selection.handle)(a=this.selection.handle[c])&&(a.style.display="none");b.isHeightConstrained()&&(this.selection.handle.w.style.display="block",this.selection.handle.e.style.display="block"),b.isWidthConstrained()&&(this.selection.handle.n.style.display="block",this.selection.handle.s.style.display="block")}else for(var c in this.selection.handle)(a=this.selection.handle[c])&&(a.style.display="block")},z.enableRotationHandle=function(){var a=this.markup,b=this.selection.rotationHandle,c=a.isRotationConstrained()?"none":"block";b.style.display=c};var A=!1;z._onRepositionMouseDown=function(a,b){A=!0;var c=!(a instanceof MouseEvent);if((c||!h(a.target)&&!i(a.target))&&(b=c?b:this.editor.getMousePosition(),this.initialCursor=b,this.initialPosition=this.markup.getClientPosition(),this.areAxisConstrained=!1,this.axisConstrains=new THREE.Vector2(1,1),this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),!this.selection.dragging)){if(this.selection.dragging=!0,this.editor.beginActionGroup(),a&&a.altKey){var d=this.editor;new v.CloneMarkup(d,d.getId(),this.markup,this.markup.position).execute()}this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_START})}},z._onRepositionMouseMove=function(a){if(A)return void(A=!1);if(this.selection.dragging){var b=this.editor.getMousePosition(),c=this.editor.input.constrainAxis;this.areAxisConstrained!==c&&(this.areAxisConstrained=c,this.axisConstrains=c?new THREE.Vector2(0,0):new THREE.Vector2(1,1),this.initialPosition.x+=b.x-this.initialCursor.x,this.initialPosition.y+=b.y-this.initialCursor.y,this.initialCursor.x=b.x,this.initialCursor.y=b.y);var d={x:b.x-this.initialCursor.x,y:b.y-this.initialCursor.y};0===this.axisConstrains.x&&0===this.axisConstrains.y&&(Math.abs(d.x)>15?(this.axisConstrains.x=1,d.x+=d.x<0?15:-15):Math.abs(d.y)>15&&(this.axisConstrains.y=1,d.y+=d.y<0?15:-15));var e=this.initialPosition.x+d.x*this.axisConstrains.x,f=this.initialPosition.y+d.y*this.axisConstrains.y;m.bind(this)(e,f,this.selection.rotation);var g=this.editor.positionFromClientToMarkups(e,f);new v.SetPosition(this.editor,this.markup,g).execute()}},z._onRepositionMouseUp=function(){this.last=null,this.onMouseMove=function(){},this.onMouseUp=function(){},this.selection.dragging&&(this.editor.closeActionGroup(),this.selection.dragging=!1,this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_END}))},
z._onResizeMouseDown=function(a){var b=a.target;if(h(b)){this.selection.handle.resizing=b;var c=this.selection.handle.resizing.getAttribute("data-sdp-handle");this.containingDiv.style.cursor=c+"-resize";var d=this.editor.getMousePosition(),e=this.markup.getClientPosition(),f=this.markup.getClientSize();this.initial={x:e.x,y:e.y,width:f.x,height:f.y,mouseX:d.x,mouseY:d.y},this.onMouseMove=this._onResizeMouseMove.bind(this),this.onMouseUp=this._onResizeMouseUp.bind(this),this.selection.resizing||(this.selection.resizing=!0,this.editor.beginActionGroup(),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_START}))}},z._onResizeMouseMove=function(a){if(this.selection.resizing){var b=this.editor.getMousePosition(),c=this.initial,d={x:b.x-c.mouseX,y:b.y-c.mouseY},e=new THREE.Vector3(d.x,d.y,0),f=(new THREE.Matrix4).makeRotationZ(-this.selection.rotation);d=e.applyMatrix4(f);var g=c.x,h=c.y,i=c.width,j=c.height,k=new THREE.Vector3,l=this.selection.handle.resizing.getAttribute("data-sdp-handle");if(this.editor.input.keepAspectRatio&&["nw","ne","sw","se"].indexOf(l)!==-1){var m=new THREE.Vector3(d.x,d.y,0);switch(l){case"nw":d.set(-c.width,-c.height,0);break;case"ne":d.set(c.width,-c.height,0);break;case"sw":d.set(c.width,-c.height,0);break;case"se":d.set(c.width,c.height,0)}d.normalize(),d=m.projectOnVector(d)}({n:function(){j-=d.y,k.y=d.y},s:function(){j+=d.y,k.y=d.y},w:function(){i-=d.x,k.x=d.x},e:function(){i+=d.x,k.x=d.x},nw:function(){this.n(),this.w()},ne:function(){this.n(),this.e()},sw:function(){this.s(),this.w()},se:function(){this.s(),this.e()}})[l]();var n=(new THREE.Matrix4).makeRotationZ(this.selection.rotation),o=k.applyMatrix4(n),p=this.editor.positionFromClientToMarkups(g+.5*o.x,h+.5*o.y),q=this.editor.sizeFromClientToMarkups(i,j);new v.SetSize(this.editor,this.markup,p,q.x,q.y).execute()}},z._onResizeMouseUp=function(a){this.selection.resizing=!1,this.selection.handle.resizing=null,this.containingDiv.style.cursor="",this.editor.closeActionGroup(),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_END}),this.onMouseMove=function(){},this.onMouseUp=function(){}};var B,C;z._onRotationMouseDown=function(a){i(a.target)&&(this.editor.beginActionGroup(),this.selection.rotating=!0,C=this.editor.getMousePosition(),B=this.selection.rotation||0,this.onMouseMove=this._onRotationMouseMove.bind(this),this.onMouseUp=this._onRotationMouseUp.bind(this),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_START}))},z._onRotationMouseMove=function(a){if(this.selection.rotating){var b=this.editor.getMousePosition(),c=this.markup.getClientPosition(),d=t(c,b),e=t(c,C),f=d-e+B;if(this.editor.input.snapRotations){var g=w.degreesToRadians(22.5);f=Math.ceil(f/g)*g}m.bind(this)(this.selection.x,this.selection.y,f);new v.SetRotation(this.editor,this.markup,f).execute()}},z._onRotationMouseUp=function(a){this.selection.rotating=!1,B=null,C=null,this.editor.closeActionGroup(),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_END})},v.EditFrame=a}(),function(){"use strict";function a(a,b,d){this.id=a,this.type="",this.editor=b,this.viewer=b.viewer,this.position={x:0,y:0},this.size={x:0,y:0},this.rotation=0,this.style=c.createStyle(d,this.editor),this.style=c.copyStyle(b.getDefaultStyle(),this.style),this.highlightColor="#FAFF3C",this.constraintWidth=!1,this.constraintHeight=!1,this.constraintRotation=!1,this.highlighted=!1,this.selected=!1,c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.MARKUP_TYPE_ARROW="arrow",b.MARKUP_TYPE_TEXT="label",b.MARKUP_TYPE_RECTANGLE="rectangle",b.MARKUP_TYPE_CIRCLE="ellipse",b.MARKUP_TYPE_CLOUD="cloud",b.MARKUP_TYPE_FREEHAND="freehand",b.MARKUP_TYPE_POLYLINE="polyline",b.MARKUP_TYPE_POLYCLOUD="polycloud",b.EVENT_EDITMODE_CHANGED="EVENT_EDITMODE_CHANGED",b.EVENT_EDITMODE_ENTER="EVENT_EDITMODE_ENTER",b.EVENT_EDITMODE_LEAVE="EVENT_EDITMODE_LEAVE",b.EVENT_MARKUP_SELECTED="EVENT_MARKUP_SELECTED",b.EVENT_MARKUP_DRAGGING="EVENT_MARKUP_DRAGGING",b.EVENT_MARKUP_ENTER_EDITION="EVENT_MARKUP_ENTER_EDITION",b.EVENT_MARKUP_CANCEL_EDITION="EVENT_MARKUP_CANCEL_EDITION",b.EVENT_MARKUP_DELETE_EDITION="EVENT_MARKUP_DELETE_EDITION";var d=a.prototype;b.Markup=a,d.destroy=function(){this.unselect(),this.setParent(null)},d.setParent=function(a){var b=this.shape;b.parentNode&&b.parentNode.removeChild(b),a&&a.appendChild(b)},d.clone=function(){var a=Object.create(this.__proto__),b=this.getCloneOverrides();for(var c in this)if(this.hasOwnProperty(c)){var d=this[c];b.hasOwnProperty(c)?a[c]=b[c]:d.clone instanceof Function?a[c]=d.clone():d instanceof Function?a[c]=d.bind(a):d.nodeType?a[c]=d.cloneNode(!0):d instanceof Object?a[c]=JSON.parse(JSON.stringify(d)):a[c]=d}return this.cloneShape(a),a},d.cloneShape=function(a){a.shape.markup=a.shape.childNodes.item(0),a.shape.hitarea=a.shape.childNodes.item(1),a.bindDomEvents()},d.getCloneOverrides=function(){return{viewer:this.viewer,editor:this.editor,hammer:null,listeners:{}}},d.select=function(){this.selected||(this.selected=!0,this.highlighted=!1,this.updateStyle(),this.fireEvent({type:b.EVENT_MARKUP_SELECTED,markup:this}))},d.unselect=function(){this.selected=!1},d.highlight=function(a){this.interactionsDisabled||(this.highlighted=a,this.updateStyle())},d.getStyle=function(){return c.cloneStyle(this.style)},d.setStyle=function(a){c.copyStyle(a,this.style),this.updateStyle()},d.updateStyle=function(){},d.edit=function(){this.fireEvent({type:b.EVENT_MARKUP_ENTER_EDITION,markup:this})},d.cancel=function(){this.fireEvent({type:b.EVENT_MARKUP_CANCEL_EDITION,markup:this})},d.deleteMarkup=function(){this.fireEvent({type:b.EVENT_MARKUP_DELETE_EDITION,markup:this})},d.getEditMode=function(){return console.warn("EditMode of markup type"+this.type+" not defined."),null},d.getClientPosition=function(){var a=this.position;return this.editor.positionFromMarkupsToClient(a.x,a.y)},d.getClientSize=function(){var a=this.size;return this.editor.sizeFromMarkupsToClient(a.x,a.y)},d.setRotation=function(a){this.rotation=a,this.updateStyle()},d.getRotation=function(){return this.rotation},d.setPosition=function(a,b){this.position.x=a,this.position.y=b,this.updateStyle()},d.setSize=function(a,b,c){this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.isWidthConstrained=function(){return this.constraintWidth},d.isHeightConstrained=function(){return this.constraintHeight},d.isRotationConstrained=function(){return this.constraintRotation},d.disableInteractions=function(a){this.interactionsDisabled=a},d.setStrokeWidth=function(a){},d.constrainsToBounds=function(a){},d.onMouseDown=function(a){this.interactionsDisabled||(this.select(),this.editor.editFrame.startDrag(a))},d.generatePoint3d=function(a){function b(b,e){var f=c.checkLineSegment(b.x,b.y,e.x,e.y,a),g=f&&d.clientToWorld(f.x,f.y);return g&&g.point}var d=this.viewer,e=this.generateBoundingPolygon(),f=e.xVertices,g=e.yVertices,h=new THREE.Vector2(f[0]+f[1],g[0]+g[1]).multiplyScalar(.5),i=new THREE.Vector2(f[0]+f[3],g[0]+g[3]).multiplyScalar(.5),j=new THREE.Vector2(f[2]+f[1],g[2]+g[1]).multiplyScalar(.5),k=new THREE.Vector2(f[2]+f[3],g[2]+g[3]).multiplyScalar(.5),l=i.clone().add(j).multiplyScalar(.5);return b(l,j)||b(l,i)||b(l,h)||b(l,k)||function(b){var e=c.checkPolygon(b,a),f=e&&d.clientToWorld(e.x,e.y);return f&&f.point}(e)},d.generateBoundingBox=function(){for(var a={min:{x:0,y:0},max:{x:0,y:0}},b=this.generateBoundingPolygon(),c=b.vertexCount,d=b.xVertices,e=b.yVertices,f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,j=0;j<c;++j){var k=d[j],l=e[j];f=Math.min(f,k),g=Math.min(g,l),h=Math.max(h,k),i=Math.max(i,l)}return a.min.x=f,a.min.y=g,a.max.x=h,a.max.y=i,a},d.generateBoundingPolygon=function(){var a=this.getClientPosition(),b=this.getClientSize();b.x*=.5,b.y*=.5;var c=new THREE.Vector3(-b.x,-b.y).add(a),d=new THREE.Vector3(b.x,-b.y).add(a),e=new THREE.Vector3(b.x,b.y).add(a),f=new THREE.Vector3(-b.x,b.y).add(a);if(0!==this.rotation){var g=(new THREE.Matrix4).makeTranslation(-a.x,-a.y,0),h=(new THREE.Matrix4).makeRotationZ(this.rotation),i=(new THREE.Matrix4).makeTranslation(a.x,a.y,0),j=i.multiply(h).multiply(g);c.applyMatrix4(j),d.applyMatrix4(j),e.applyMatrix4(j),f.applyMatrix4(j)}return{vertexCount:4,xVertices:new Float32Array([c.x,d.x,e.x,f.x]),yVertices:new Float32Array([c.y,d.y,e.y,f.y])}},d.setMetadata=function(){return null},d.bindDomEvents=function(){c.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.shape,{recognizers:[[Hammer.Tap,{event:"singletap",pointers:1,threshold:2}]],inputClass:Hammer.TouchInput}),this.onSingleTapBinded=function(a){this.onMouseDown(a)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded)),this.shape.addEventListener("mousedown",this.onMouseDown.bind(this),!0),this.shape.addEventListener("mouseout",function(){this.highlight(!1)}.bind(this)),this.shape.addEventListener("mouseover",function(){this.highlight(!0)}.bind(this))},d.renderToCanvas=function(a){var b=(new THREE.Matrix4).makeRotationZ(-this.rotation),d=(new THREE.Matrix4).makeTranslation(this.position.x,this.position.y,0),e=d.multiply(b);c.renderToCanvas(this.editor,a,this.getPath(),this.style,e)},d.getPath=function(){},d.getTransform=function(){return["translate(",this.position.x,",",this.position.y,")","rotate(",c.radiansToDegrees(-this.rotation),")"].join(" ")}}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_ARROW,this.constraintHeight=!0,this.head=new THREE.Vector3,this.tail=new THREE.Vector3,this.size.y=3*this.style["stroke-width"],this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeArrow(this.editor)},d.set=function(a,b,c,d){var e=new THREE.Vector2(a,b),f=new THREE.Vector2(c,d),g=f.clone().sub(e).normalize();this.size.x=e.distanceTo(f),this.rotation=Math.acos(g.dot(new THREE.Vector2(1,0))),this.rotation=d>b?2*Math.PI-this.rotation:this.rotation;var h=this.head,i=this.tail;h.set(c,d,0),i.set(a,b,0),this.position.x=i.x+.5*(h.x-i.x),this.position.y=i.y+.5*(h.y-i.y),this.updateStyle()},d.setRotation=function(a){this.rotation=a;var b=Math.cos(-a),c=Math.sin(-a),d=new THREE.Vector2(b,c);d.multiplyScalar(.5*this.size.x);var e=new THREE.Vector2(this.position.x,this.position.y),f=e.clone().sub(d),g=e.clone().add(d);this.head.set(g.x,g.y,0),this.tail.set(f.x,f.y,0),this.updateStyle()},d.setSize=function(a,b,c){var d=Math.cos(-this.rotation),e=Math.sin(-this.rotation),f=new THREE.Vector2(d,e);f.multiplyScalar(.5*b);var g=new THREE.Vector2(a.x,a.y),h=g.clone().sub(f),i=g.clone().add(f);this.head.set(i.x,i.y,0),this.tail.set(h.x,h.y,0),this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=a["stroke-width"],e=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),f=this.getTransform();this.size.y=3*d,this.style["fill-color"]=a["stroke-color"],this.style["fill-opacity"]=a["stroke-opacity"],c.setAttributeToMarkupSvg(b,"d",this.getPath().join(" ")),c.setAttributeToMarkupSvg(b,"stroke-width",d),c.setAttributeToMarkupSvg(b,"stroke",e),c.setAttributeToMarkupSvg(b,"fill",e),c.setAttributeToMarkupSvg(b,"transform",f),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setPosition=function(a,b){var c=this.head,d=this.tail,e=c.x-d.x,f=c.y-d.y,g=a+.5*e,h=b+.5*f;c.x=g,c.y=h,d.x=g-e,d.y=h-f,this.position.x=d.x+.5*(c.x-d.x),this.position.y=d.y+.5*(c.y-d.y),this.updateStyle()},d.generatePoint3d=function(a){var b=this.editor.positionFromMarkupsToClient(this.head.x,this.head.y),d=this.editor.positionFromMarkupsToClient(this.tail.x,this.tail.y),e=b.clone().sub(d).normalize(),f=c.checkLineSegment(b.x,b.y,b.x+200*e.x,b.y+200*e.y,a),g=f&&this.viewer.clientToWorld(f.x,f.y);return g&&g.point},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.head=[this.head.x,this.head.y].join(" "),a.tail=[this.tail.x,this.tail.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.size.x,b=this.size.y,c=b/3,d=this.style["stroke-width"],e=a-3*d,f=a-e,g=.3*d;return["M",.5*-a,.5*-b+c,"l",e,0,"l",-g,-c,"l",f+g,1.5*c,"l",-f-g,1.5*c,"l",g,-c,"l",-e,0,"z"]},b.MarkupArrow=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_CIRCLE,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeCircle(this.editor)},d.set=function(a,b){this.setSize(a,b.x,b.y)},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.size;if(1===a.x||1===a.y)return[""];var b=this.style["stroke-width"],d=a.x,e=a.y,f=d-b,g=e-b,h=.5*b,i=h-.5*d,j=[];return c.createEllipsePath(i,0,f,g,!1,j),j},b.MarkupCircle=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-linejoin","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_CLOUD,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeCloud(this.editor)},d.set=function(a,b){this.setSize(a,b.x,b.y)},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){function a(a,b,c,d,e){return e.push("a"),e.push(c),e.push(d),e.push(0),e.push(1),e.push(1),e.push(a),e.push(b),e}function b(b,c,d,e,f){switch(b){case"LT":return a(c,-d,c,d,f);case"RT":return a(c,d,c,d,f);case"RB":return a(-c,d,c,d,f);case"LB":return a(-c,-d,c,d,f)}}function d(a,b,c,d){var e=2*c,f=Math.abs(b-a-d),g=Math.round(f/e);e+=(f-e*g)/g,c=.5*e;var h=.05*e,i=3.5*c/3;return{count:g,radius:c,diameter:e,p1:{x:h,y:-i},p2:{x:e-h,y:-i},p3:{x:e,y:0}}}var e=this.position,f=this.size,g=this.style["stroke-width"],h=2*g,i=e.x,j=e.y,k=e.x+f.x,l=e.y+f.y,m=5*h,n=[];if(f.x<m||f.y<m){var o=f.x-g,p=f.y-g,q=.5*-f.x,r=0;c.createEllipsePath(q,r,o,p,!1,n)}else{var s=d(i,k,h,g),t=d(j,l,h,g),u=s.diameter,v=t.diameter,w=s.radius,x=t.radius;s=d(i+u,k-u,h,g),t=d(j+v,l-v,h,g);var y=.5*g,q=.5*-f.x+y+w,r=.5*-f.y+y+2*x;n.push("M"),n.push(q),n.push(r),b("LT",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(c.p1.x),b.push(c.p1.y),b.push(c.p2.x),b.push(c.p2.y),b.push(c.p3.x),b.push(c.p3.y);b}(s,n),b("RT",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(-c.p1.y),b.push(c.p1.x),b.push(-c.p2.y),b.push(c.p2.x),b.push(-c.p3.y),b.push(c.p3.x);b}(t,n),b("RB",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(-c.p1.x),b.push(-c.p1.y),b.push(-c.p2.x),b.push(-c.p2.y),b.push(-c.p3.x),b.push(-c.p3.y);b}(s,n),b("LB",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(c.p1.y),b.push(-c.p1.x),b.push(c.p2.y),b.push(-c.p2.x),b.push(c.p3.y),b.push(-c.p3.x);b}(t,n)}return n.push("z"),n},b.MarkupCloud=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_FREEHAND,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeFreehand(this.editor)},d.set=function(a,b,c){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill","none"),c.setAttributeToMarkupSvg(b,"transform",g),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=[],b=this.locations,c=b.length;if(c>1){a.push("M"),a.push(b[0].x),a.push(b[0].y);for(var d=1;d<c;++d){var e=b[d-1],f=b[d];a.push("l"),a.push(f.x-e.x),a.push(f.y-e.y)}}return a},b.MarkupFreehand=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_POLYLINE,this.shape=c.createMarkupPathSvg("path"),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModePolyline(this.editor)},d.set=function(a,b,c,d){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.closed=d,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.style["stroke-width"],e=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),f=this.closed?c.composeRGBAString(a["fill-color"],a["fill-opacity"]):"none",g=this.getTransform();c.setAttributeToMarkupSvg(b,"d",this.getPath().join(" ")),c.setAttributeToMarkupSvg(b,"stroke-width",d),c.setAttributeToMarkupSvg(b,"stroke",e),c.setAttributeToMarkupSvg(b,"fill",f),c.setAttributeToMarkupSvg(b,"transform",g),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=[],b=this.locations,c=b.length;if(0===c)return" ";a.push("M"),a.push(b[0].x),a.push(b[0].y);for(var d=1;d<c;++d){var e=b[d-1],f=b[d];a.push("l"),a.push(f.x-e.x),a.push(f.y-e.y)}return this.closed&&a.push("z"),a},b.MarkupPolyline=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_POLYCLOUD,this.locations=[],this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModePolycloud(this.editor)},d.set=function(a,b,c,d){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.closed=d,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=this.closed?c.composeRGBAString(a["fill-color"],a["fill-opacity"]):"none",h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.style["stroke-width"],b=2*a,c=function(a){switch(a.length){case 0:case 1:return 1;case 2:var b=a[0],c=a[1];return b.y>c.y?1:-1;default:var d=a[0],e=a[1],f=a[2];return(e.x-d.x)*(e.y+d.y)+(f.x-e.x)*(f.y+e.y)<0?1:-1}}(this.locations),d=this.closed,e=[],f=function(a,b){for(var c=a.length,d=[],e=c-(b?0:1),f=0;f<e;++f){var g=a[f],h=a[(f+1)%c],i=h.x-g.x,j=h.y-g.y,k=Math.sqrt(i*i+j*j);d.push({index:f,pointA:new THREE.Vector3(g.x,g.y,0),pointB:new THREE.Vector3(h.x,h.y,0),vecAB:new THREE.Vector3(i/k,j/k,0),vecBA:new THREE.Vector3(-i/k,-j/k,0),length:k})}return d}(this.locations,d),g=function(a,b,c){for(var d=[],e=a.length,f=0;f<e;++f){var g=a[0!==f?f-1:e-1],h=a[f],i=g.vecBA.clone().cross(h.vecAB).z<0;g.length<b||h.length<b||0===f&&!c?d.push({pointA:h.pointA.clone(),pointB:h.pointA.clone(),radius:0,large:!1}):d.push({pointA:h.pointA.clone().add(g.vecBA.clone().multiplyScalar(b)),pointB:h.pointA.clone().add(h.vecAB.clone().multiplyScalar(b)),radius:b,large:i})}return d}(f,b,d),h=g.length;!function(a,b,c){for(var d=2*c,e=a.length,f=0;f<e;++f){var g=a[f],h=b[f],i=b[(f+1)%e];g.bodyA=g.vecAB.clone().multiplyScalar(h.radius).add(g.pointA),g.bodyB=g.vecBA.clone().multiplyScalar(i.radius).add(g.pointB),g.body=g.bodyB.clone().sub(g.bodyA).length(),g.bodyCount=Math.round(g.body/d),g.bodyDiameter=d+(g.body-d*g.bodyCount)/g.bodyCount,g.bodyRadius=.5*g.bodyDiameter}}(f,g,b);for(var i=0;i<h;++i)!function(a,b,c,d){b&&(d.push("M"),d.push(a.pointA.x),d.push(a.pointA.y));var e=1===c?a.large:!a.large;0!==a.radius&&(d.push("a"),d.push(a.radius),d.push(a.radius),d.push(0),d.push(e?1:0),d.push(1===c?1:0),d.push(a.pointB.x-a.pointA.x),d.push(a.pointB.y-a.pointA.y)),d}(g[i],0===i,c,e),function(a,b,c){var d=a.bodyRadius,e=a.bodyDiameter,f=.05*e,g=3.5*d/3,h=new THREE.Vector3(f,b*-g),i=new THREE.Vector3(e-f,b*-g),j=new THREE.Vector3(e,0),k=Math.acos(a.vecAB.x)*(a.vecAB.y<0?-1:1),l=(new THREE.Matrix4).makeRotationZ(k);h.applyMatrix4(l),i.applyMatrix4(l),j.applyMatrix4(l);for(var m=a.bodyCount,n=0;n<m;++n)c.push("c"),c.push(h.x),c.push(h.y),c.push(i.x),c.push(i.y),c.push(j.x),c.push(j.y)}(f[i],c,e);return d&&e.push("z"),e},b.MarkupPolycloud=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_RECTANGLE,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeRectangle(this.editor)},d.set=function(a,b){this.position.x=a.x,this.position.y=a.y,this.size.x=b.x,this.size.y=b.y,this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.style["stroke-width"],b=this.size.x-a,d=this.size.y-a,e=.5*-b,f=.5*-d,g=[];return c.createRectanglePath(e,f,b,d,!1,g),g},b.MarkupRectangle=a}(),function(){"use strict";function a(a,d,e){var f=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.Markup.call(this,a,d,f),this.type=b.MARKUP_TYPE_TEXT,this.shape=c.createMarkupTextSvg(),this.constraintRotation=!0,this.size.x=e.x,this.size.y=e.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.lineHeight=130,this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=100;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var e=a.prototype;e.getEditMode=function(){return new b.EditModeText(this.editor)},e.set=function(a,b,c,d){this.position.x=a.x,this.position.y=a.y,this.size.x=b.x,this.size.y=b.y,this.setText(c,d)},e.setSize=function(a,b,c){this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},e.setStyle=function(a){c.copyStyle(a,this.style),this.updateStyle()},e.setText=function(a){this.currentText=a,this.updateStyle()},e.getText=function(){return this.currentText},e.getTextLines=function(){return this.currentTextLines.concat()},e.updateStyle=function(){function a(){var a=this.style,b=this.shape,e=this.style["font-size"],f=this.style["font-family"],g=this.style["font-weight"],h=this.style["font-style"],i=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),j=c.composeRGBAString(a["fill-color"],a["fill-opacity"]);this.rebuildTextSvg(),c.setAttributeToMarkupSvg(b,"font-family",f),c.setAttributeToMarkupSvg(b,"font-size",e*d),c.setAttributeToMarkupSvg(b,"fill",i),c.setAttributeToMarkupSvg(b,"font-weight",g),c.setAttributeToMarkupSvg(b,"font-style",h);var k=this.editor,l=this.getTransform(),m=this.getTextTransform(),n=this.textSize;c.setMarkupTextSvgTransform(b,l,m),c.updateMarkupTextSvgBackground(b,n.x,n.y,j),c.updateMarkupTextSvgClipper(b,n.x,n.y),c.updateMarkupTextSvgHitarea(b,n.x,n.y,k),this.applyingStyle=!1}this.applyingStyle=this.applyingStyle||!1,this.applyingStyle||(this.applyingStyle=!0,requestAnimationFrame(a.bind(this)))},e.rebuildTextSvg=function(){var a=this.editor.editMode;if(a&&a.type===this.type){var b=c.cloneStyle(a.textInputHelper.style),e=a.textInputHelper.textArea.value;this.currentTextLines=a.textInputHelper.getTextValuesForMarkup(this).lines,a.selectedMarkup!==this&&(a.textInputHelper.textArea.value=e,a.textInputHelper.setStyle(b))}var f=c.createSvgElement("text");f.setAttribute("id","markup"),f.setAttribute("alignment-baseline","middle"),this.shape.childNodes[0].removeChild(this.shape.markup),this.shape.childNodes[0].appendChild(f),this.shape.markup=f;var g=0,h=this.getLineHeight()*d;this.currentTextLines.forEach(function(a){var b=c.createSvgElement("tspan");b.setAttribute("x",0),b.setAttribute("y",g),b.textContent=a,f.appendChild(b),g+=h}.bind(this));var i=this.generateBoundingPolygon(),j=this.editor.sizeFromClientToMarkups(i.xVertices[1]-i.xVertices[0],i.yVertices[2]-i.yVertices[0]);this.textSize.x=Math.min(j.x,this.size.x),this.textSize.y=Math.min(j.y,this.size.y)},e.generateBoundingPolygon=function(){var a=this.getClientPosition(),b=this.getClientSize(),d=function(a,b,d){for(var e={w:0,h:0},a=c.measureTextLines(a,b,d),f=a.length,g=0;g<f;++g){var h=a[g];e.w=Math.max(e.w,h.width),e.h=e.h+h.height}return 0!==e.h&&(e.h+=d.sizeFromMarkupsToClient(0,.25*b["font-size"]).y),e}(this.currentTextLines,this.style,this.editor),e=Math.min(b.x,d.w),f=Math.min(b.y,d.h),g=new THREE.Vector2(.5*-b.x,.5*-b.y).add(a),h=new THREE.Vector2(g.x+e,g.y),i=new THREE.Vector2(h.x,h.y+f),j=new THREE.Vector2(g.x,i.y);return{vertexCount:4,xVertices:new Float32Array([g.x,h.x,i.x,j.x]),yVertices:new Float32Array([g.y,h.y,i.y,j.y])}},e.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.text=String(this.currentText),c.addMarkupMetadata(this.shape,a)},e.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},e.getLineHeight=function(){return this.style["font-size"]},e.renderToCanvas=function(a){var b=this.style["font-family"],d=this.style["font-style"],e=this.style["font-weight"],f=this.style["stroke-color"],g=this.style["stroke-opacity"],h=this.getClientFontSize(),i=this.editor.positionFromMarkupsToClient(this.position.x,this.position.y),j=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y),k=this.editor.sizeFromMarkupsToClient(this.textSize.x,this.textSize.y),l=this.editor.sizeFromMarkupsToClient(0,this.getLineHeight()).y;a.save();var m=this.style["fill-color"],n=this.style["fill-opacity"];a.fillStyle=c.composeRGBAString(m,n),a.translate(i.x,i.y),0!==n&&a.fillRect(j.x*-.5,j.y*-.5,k.x,k.y),a.restore(),a.fillStyle=f,a.strokeStyle=f,a.textBaseline="Alphabetic",a.translate(i.x-.5*j.x,i.y-.5*j.y+l),a.font=d+" "+e+" "+h+"px "+b,a.globalAlpha=g,function(a,b,c,d){var e=0;b.forEach(function(b){e+c>d||(a.fillText(b,0,e),e+=c)})}(a,this.currentTextLines,l,j.y)},e.getTransform=function(){return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},e.getTextTransform=function(){var a=this.getLineHeight();return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-a,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale("+1/d+","+-1/d+")"].join(" ")},
e.cloneShape=function(a){a.shape=c.createMarkupTextSvg(),a.bindDomEvents()},b.MarkupText=a}(),function(){"use strict";function a(){Autodesk.Viewing.ToolInterface.call(this),this.names=["markups.core"],this.panTool=null,this.allowNav=!1,this.coreExt=null,this.hotkeysEnabled=!0;var a=!1,b=!1;this.allowNavigation=function(a){this.allowNav=a},this.setCoreExtension=function(a){this.coreExt=a},this.setHotkeysEnabled=function(a){this.hotkeysEnabled=a},this.activate=function(a,b){this.panTool=b.toolController.getTool("pan"),this.panTool&&this.panTool.activate("pan")},this.deactivate=function(a){this.panTool&&this.panTool.deactivate("pan"),this.panTool=null},this.handleKeyDown=function(c,d){if(!this.hotkeysEnabled)return!0;switch(d){case Autodesk.Viewing.KeyCode.CONTROL:a=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:b=!0;break;case Autodesk.Viewing.KeyCode.x:a&&!this.allowNav&&this.coreExt.cut();break;case Autodesk.Viewing.KeyCode.c:a&&!this.allowNav&&this.coreExt.copy();break;case Autodesk.Viewing.KeyCode.v:a&&!this.allowNav&&this.coreExt.paste();break;case Autodesk.Viewing.KeyCode.d:a&&!this.allowNav&&(this.coreExt.copy(),this.coreExt.paste());break;case Autodesk.Viewing.KeyCode.z:!a||b||this.allowNav?a&&b&&!this.allowNav&&this.coreExt.redo():this.coreExt.undo();break;case Autodesk.Viewing.KeyCode.y:a&&!this.allowNav&&this.coreExt.redo();break;case Autodesk.Viewing.KeyCode.ESCAPE:this.coreExt.onUserCancel();break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var e=this.coreExt.getSelection();e&&this.coreExt.deleteMarkup(e);break;case Autodesk.Viewing.KeyCode.F12:return!1}return!0},this.handleKeyUp=function(c,d){if(!this.hotkeysEnabled)return!0;switch(d){case Autodesk.Viewing.KeyCode.CONTROL:a=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:b=!1}return!0},this.update=function(){return!!(this.allowNav&&this.panTool&&this.panTool.update)&&this.panTool.update()},this.handleSingleClick=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleClick)&&this.panTool.handleSingleClick(a,b)},this.handleDoubleClick=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleClick)&&this.panTool.handleDoubleClick(a,b)},this.handleSingleTap=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleTap)&&this.panTool.handleSingleTap(a)},this.handleDoubleTap=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleTap)&&this.panTool.handleDoubleTap(a)},this.handleWheelInput=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleWheelInput)&&this.panTool.handleWheelInput(a)},this.handleButtonDown=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonDown)&&this.panTool.handleButtonDown(a,b)},this.handleButtonUp=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonUp)&&this.panTool.handleButtonUp(a,b)},this.handleMouseMove=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleMouseMove)&&this.panTool.handleMouseMove(a)},this.handleGesture=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleGesture)&&this.panTool.handleGesture(a)},this.handleBlur=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleBlur)&&this.panTool.handleBlur(a)}}Autodesk.Viewing.Extensions.Markups.Core.MarkupTool=a}(),function(){"use strict";function a(a,d){Autodesk.Viewing.Extension.call(this,a,d),this.options=this.options||{},this.markups=[],this.styles={},this.duringViewMode=!1,this.duringEditMode=!1,this.actionManager=new b.EditActionManager(50),this.actionManager.addEventListener(b.EVENT_HISTORY_CHANGED,this.onEditActionHistoryChanged.bind(this)),this.nextId=0,this.clipboard=new b.Clipboard(this),this.input=new b.InputHandler,c.addTraitEventDispatcher(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onViewerResizeBinded=function(a){var b=this;b.onViewerResize(a),requestAnimationFrame(function(){b.duringViewMode&&b.onViewerResize(a)})}.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.onMarkupEnterEditionBinded=this.onMarkupEnterEdition.bind(this),this.onMarkupCancelEditionBinded=this.onMarkupCancelEdition.bind(this),this.onMarkupDeleteEditionBinded=this.onMarkupDeleteEdition.bind(this),this.onToolChangeBinded=this.onToolChange.bind(this);var e=c.createStyleSheet();c.addRuleToStyleSheet(e,".autodesk-markups-extension-core-make-me-bigger:after",'content:""; position:absolute; top:-10px; bottom:-10px; left:-10px; right:-10px;',0)}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),c=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,b.MarkupsCore=a,b.EVENT_ENTER_EDIT_MODE="EVENT_MARKUP_CORE_ENTER_EDIT_MODE",b.EVENT_LEAVE_EDIT_MODE="EVENT_MARKUP_CORE_LEAVE_EDIT_MODE",b.EVENT_SELECTION_CHANGED="EVENT_MARKUP_SELECTION_CHANGED";var d=a.prototype;d.load=function(){var a=this.svg=c.createSvgElement("svg");c.setSvgParentAttributes(a);var d=new c.DomElementStyle;d.setAttribute("position","absolute"),d.setAttribute("left","0"),d.setAttribute("top","0"),d.setAttribute("transform","scale(1,-1)",{allBrowsers:!0}),d.setAttribute("transformOrigin","0, 0",{allBrowsers:!0}),a.setAttribute("style",d.getStyleString()),this.bounds={x:0,y:0,width:0,height:0},this.input.attachTo(this),this.editFrame=new b.EditFrame(this.viewer.container,this),this.editFrame.addEventListener(b.EVENT_EDITFRAME_EDITION_START,function(){this.disableMarkupInteractions(!0)}.bind(this)),this.editFrame.addEventListener(b.EVENT_EDITFRAME_EDITION_END,function(){this.disableMarkupInteractions(!1)}.bind(this));var e=this.options.markupToolClass||b.MarkupTool;return this.markupTool=new e,this.markupTool.setCoreExtension(this),this.markupTool.setHotkeysEnabled(!this.options.markupDisableHotkeys),this.viewer.toolController.registerTool(this.markupTool),this.snapper=new Autodesk.Viewing.Extensions.Measure.Snapper(this.viewer,{markupMode:!0}),this.viewer.toolController.registerTool(this.snapper),!0},d.unload=function(){this.hide(),this.input.detachFrom(this),this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null);var a=this.svg;return a&&this.onMouseDownBinded&&(a.removeEventListener("mousedown",this.onMouseDownBinded),this.onMouseDownBinded=null),a.parentNode&&a.parentNode.removeChild(a),this.editModeSvgLayerNode=null,this.svg=null,!0},d.toggleEditMode=function(){this.duringEditMode?this.leaveEditMode():this.enterEditMode()},d.enterEditMode=function(){return!!this.duringEditMode||!(!this.duringViewMode&&!this.show())&&(this.editModeSvgLayerNode||(this.editModeSvgLayerNode=c.createSvgElement("g"),this.editModeSvgLayerNode.setAttribute("cursor","default")),this.svg.insertBefore(this.editModeSvgLayerNode,this.svg.firstChild),this.svg.setAttribute("cursor","crosshair"),this.input.enterEditMode(),this.activateTool(!0),this.allowNavigation(!1),this.styles={},this.defaultStyle=null,this.duringEditMode=!0,this.changeEditMode(new b.EditModeArrow(this)),this.actionManager.clear(),this.fireEvent({type:b.EVENT_EDITMODE_ENTER}),!0)},d.leaveEditMode=function(){return!this.duringEditMode||!this.duringViewMode||!!this.viewer&&(this.editMode.destroy(),this.editMode=null,this.duringEditMode=!1,this.snapper.clearOverlay(),this.snapper.clearSnapped(),this.svg.removeChild(this.editModeSvgLayerNode),this.svg.setAttribute("cursor","default"),this.input.leaveEditMode(),this.editFrame.setMarkup(null),this.activateTool(!0),this.allowNavigation(!0),this.fireEvent({type:b.EVENT_EDITMODE_LEAVE}),!0)},d.toggle=function(){this.duringViewMode?this.hide():this.show()},d.show=function(){var a=this.viewer;if(!a||!a.model)return!1;if(this.duringViewMode||this.duringEditMode)return!0;a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded),a.container.appendChild(this.svg),this.input.enterViewMode(),c.hideLmvUi(a),this.onViewerRolloverObject=a.impl.rolloverObject,a.impl.rolloverObject=function(){},this.activateTool(!0);var b=a.impl.camera;return this.onViewerResize({width:b.clientWidth,height:b.clientHeight}),this.clear(),this.svgLayersMap={},this.duringViewMode=!0,this.allowNavigation(!0),!0},d.hide=function(){var a=this.viewer;if(!a||!this.duringViewMode)return!0;if(this.duringEditMode&&!this.leaveEditMode())return!1;a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded);var b=this.svg;return b.parentNode&&b.parentNode.removeChild(b),this.unloadMarkupsAllLayers(),c.removeAllMetadata(b),this.input.leaveViewMode(),c.restoreLmvUi(a),this.viewer.impl.rolloverObject=this.onViewerRolloverObject,this.activateTool(!1),this.duringViewMode=!1,!0},d.clear=function(){for(var a=this.markups;a.length>0;){var b=a[0];this.removeMarkup(b),b.destroy()}var c=this.editModeSvgLayerNode;if(c&&c.childNodes.length>0)for(;c.childNodes.length;)c.removeChild(c.childNodes[0])},d.generateData=function(){this.editMode&&this.editMode.onSave(),c.removeAllMetadata(this.svg);var a=c.createSvgElement("svg");c.transferChildNodes(this.svg,a),c.transferChildNodes(this.editModeSvgLayerNode,this.svg);var b={"data-model-version":"4"},d=c.addSvgMetadata(this.svg,b),e=[d];this.markups.forEach(function(a){var b=a.setMetadata();b&&e.push(b)});var f=c.svgNodeToString(this.svg);return e.forEach(function(a){a.parentNode.removeChild(a)}),c.transferChildNodes(this.svg,this.editModeSvgLayerNode),c.transferChildNodes(a,this.svg),a=null,f},d.generatePoints3d=function(){var a={markups:[],main:null},d=this.markups,e=d.length;if(0===e)return a;for(var f=this.viewer.impl.renderer().readbackTargetId(),g=0;g<e;++g){var h=d[g],i=h.generatePoint3d(f)||null;a.markups.push({id:h.id,type:h.type,point:i||null})}if(1===e){var j=a.markups[0].point;return a.main=j&&j.clone(),a}for(var g=0;g<e;++g){var k=a.markups[g];if(k.type===b.MARKUP_TYPE_ARROW&&null!==k.point)return a.main=k.point.clone(),a}for(var l=Number.POSITIVE_INFINITY,m=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,g=0;g<e;++g){var p=d[g].generateBoundingBox();l=Math.min(l,p.min.x),m=Math.min(m,p.min.y),n=Math.max(n,p.max.x),o=Math.max(o,p.max.y)}var q={};q.vertexCount=4,q.xVertices=new Float32Array([l,n,n,l]),q.yVertices=new Float32Array([m,m,o,o]);var r=c.checkPolygon(q,f),s=r&&this.viewer.clientToWorld(r.x,r.y);return a.main=s&&s.point,a},d.renderToCanvas=function(a){this.markups.forEach(function(b){a.save(),b.renderToCanvas(a),a.restore()})},d.changeEditMode=function(a){var d=this.editMode;d&&d.destroy(),a.addEventListener(b.EVENT_EDITMODE_CREATION_BEGIN,function(){this.disableMarkupInteractions(!0)}.bind(this)),a.addEventListener(b.EVENT_EDITMODE_CREATION_END,function(){this.disableMarkupInteractions(!1)}.bind(this)),a.addEventListener(b.EVENT_MARKUP_DESELECT,function(a){this.fireEvent(a)}.bind(this)),this.editMode=a,this.styles[a.type]=c.cloneStyle(a.getStyle()),this.fireEvent({type:b.EVENT_EDITMODE_CHANGED,target:a})},d.isNavigationAllowed=function(){return!this.viewer.impl.camera.isPerspective},d.allowNavigation=function(a){if(a&&(this.duringEditMode||this.duringViewMode)&&!this.isNavigationAllowed())return!1;var b=this.editMode;this.navigating=a,a?(this.svg.setAttribute("pointer-events","none"),b&&this.selectMarkup(null)):this.svg.setAttribute("pointer-events","painted"),a&&(this.snapper.clearOverlay(),this.snapper.clearSnapped());for(var c=this.markups,d=c.length,e=0;e<d;++e)c[e].updateStyle();this.markupTool.allowNavigation(a),b&&b.notifyAllowNavigation(a)},d.disableMarkupInteractions=function(a){this.markups.forEach(function(b){b.disableInteractions(a)})},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.activateTool=function(a){if(a)this.cachedNavigationTool||(this.cachedNavigationTool=this.viewer.getActiveNavigationTool(),this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)),this.viewer.setActiveNavigationTool(this.markupTool.getName());else{if(this.cachedNavigationTool)this.viewer.setActiveNavigationTool(this.cachedNavigationTool),this.cachedNavigationTool=null;else{var b=this.viewer.getDefaultNavigationToolName();this.viewer.setActiveNavigationTool(b)}this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)}},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.onToolChange=function(a){if(a.toolName===this.markupTool.getName()){if(a.active){var b=this.isNavigationAllowed();this.viewer.setNavigationLockSettings({pan:b,zoom:b,orbit:!1,roll:!1,fov:!1,walk:!1,gotoview:!1})}this.viewer.setNavigationLock(a.active)}},d.changeInputHandler=function(a){this.input.detachFrom(this),a.attachTo(this),this.input=a,this.duringEditMode&&a.enterEditMode(),this.duringViewMode&&a.enterViewMode()},d.copy=function(){this.clipboard.copy()},d.cut=function(){this.clipboard.cut()},d.paste=function(){this.clipboard.paste()},d.undo=function(){this.actionManager.undo()},d.redo=function(){this.actionManager.redo()},d.isUndoStackEmpty=function(){return this.actionManager.isUndoStackEmpty()},d.isRedoStackEmpty=function(){return this.actionManager.isRedoStackEmpty()},d.beginActionGroup=function(){this.actionManager.beginActionGroup()},d.closeActionGroup=function(){this.actionManager.closeActionGroup()},d.cancelActionGroup=function(){this.actionManager.cancelActionGroup()},d.getId=function(){return++this.nextId},d.onEditActionHistoryChanged=function(a){var b=a.data,c=this.editMode,d=c&&c.selectedMarkup&&c.selectedMarkup.id===b.targetId;if("undo"!==b.action&&b.targetId!==-1||"undo"===b.action&&d){var e=this.getMarkup(b.targetId);this.selectMarkup(e)}this.fireEvent(a)},d.getMarkup=function(a){for(var b=this.markups,c=b.length,d=0;d<c;++d)if(b[d].id==a)return b[d];return null},d.selectMarkup=function(a){if(a)if(this.editMode.type===a.type)this.editMode.setSelection(a);else{var b=a.getEditMode();b.setSelection(null),this.changeEditMode(b),this.setStyle(a.getStyle()),this.editMode.setSelection(a)}else this.editMode.setSelection(null)},d.getSelection=function(){return this.editMode.getSelection()},d.deleteMarkup=function(a,b){a.getEditMode().deleteMarkup(a,b)},d.addMarkup=function(a){a.setParent(this.editModeSvgLayerNode),a.addEventListener(b.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),a.addEventListener(b.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),a.addEventListener(b.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),a.addEventListener(b.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded),this.markups.push(a)},d.removeMarkup=function(a){a.setParent(null),a.removeEventListener(b.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),a.removeEventListener(b.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),a.removeEventListener(b.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),a.removeEventListener(b.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded);var c=this.markups,d=c.indexOf(a);d!==-1&&c.splice(d,1);var e=this.editMode;if(e){e.getSelection()===a&&this.selectMarkup(null)}},d.setStyle=function(a){var b=this.styles,d=this.editMode;c.copyStyle(a,b[d.type]),d.setStyle(b[d.type])},d.getStyle=function(){return c.cloneStyle(this.styles[this.editMode.type])},d.getDefaultStyle=function(){var a=["stroke-width","font-size","font-family","font-style","font-weight","stroke-color","stroke-opacity","fill-color","fill-opacity"];return this.defaultStyle=this.defaultStyle||c.createStyle(a,this),this.defaultStyle},d.bringToFront=function(a){this.sendMarkupTo(a,this.markups.length-1)},d.sendToBack=function(a){this.sendMarkupTo(a,0)},d.bringForward=function(a){var b=this.markups.indexOf(a);this.sendMarkupTo(a,b+1)},d.bringBackward=function(a){var b=this.markups.indexOf(a);this.sendMarkupTo(a,b-1)},d.sendMarkupTo=function(a,b){var c=this.markups,d=c.indexOf(a);d===-1||b<0||b>=c.length||(c.splice(d,1),b=d>b?b-1:b,c.splice(b,0,a),a.setParent(null),a.setParent(this.editModeSvgLayerNode))},d.loadMarkups=function(a,b){var d=this,e=d.viewer,f=e.impl.camera,g=function(a,b){var e=d.viewer.impl.camera,f=c.clientToWorld(a,b,0,d.viewer),g=d.viewer.model.getData().globalOffset;return g&&f.sub(g),f.add(e.position),f.applyMatrix4(e.matrixWorldInverse),f.z=0,f},h=c.getClipPathId(),i=function(a){if("markup_element"==a.tagName&&"label"===a.getAttribute("type")){var b=a.parentNode.parentNode.childNodes[1].childNodes[0],c="markup-clipper-"+h++,d="url(#"+c+")";b.setAttribute("id",c),b.parentNode.setAttribute("clip-path",d)}else for(var e=a.childNodes,f=e.length,g=0;g<f;++g)i(e[g])};if(!this.duringViewMode)return!1;if(!b)return console.warn("loadMarkups failed; missing 2nd argument 'layerId'"),!1;var j=c.stringToSvgNode(a);if(!j)return!1;var k=j.childNodes[0].childNodes[0],l=parseFloat(k.getAttribute("data-model-version")),m={x:0,y:0},n=this.viewer.model.getData().globalOffset;if(l<2&&n){var o=g(0,0).sub(function(a,b){var d=c.clientToWorld(a,b,0,e);return d.add(f.position).applyMatrix4(f.matrixWorldInverse),d.z=0,d}(0,0));m.x+=o.x,m.y+=o.y}if(l<4&&n&&!f.isPerspective){var p=this.clientToMarkups(0,0).sub(g(0,0));m.x+=p.x,m.y+=p.y}var q=null;l<4&&f.isPerspective&&(q=1e3),l>=3&&i(j),c.removeAllMetadata(j);var r=this.svgLayersMap[b];r||(r=c.createSvgElement("g"),this.svg.appendChild(r),this.svgLayersMap[b]=r);for(var s=j.childNodes;s.length;){var t=s[0];if("clipPath"!==t.localName){var u=t.getAttribute("transform")||"";0===m.x&&0===m.y||(u="translate("+m.x+", "+m.y+") "+u),q&&(u="scale("+q+", "+q+") "+u),(m||q)&&t.setAttribute("transform",u),r.appendChild(t),t.setAttribute("pointer-events","none")}}return!0},d.unloadMarkups=function(a){if(!a)return console.warn("unloadMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];return!!b&&(this.svg.removeChild(b),delete this.svgLayersMap[a],!0)},d.unloadMarkupsAllLayers=function(){for(var a in this.svgLayersMap)this.svgLayersMap.hasOwnProperty(a)&&this.svg.removeChild(this.svgLayersMap[a]);this.svgLayersMap={}},d.hideMarkups=function(a){if(!a)return console.warn("hideMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];if(!b)return!1;b.setAttribute("visibility","hidden")},d.showMarkups=function(a){if(!a)return console.warn("showMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];if(!b)return!1;b.setAttribute("visibility","visible")},d.positionFromClientToMarkups=function(a,b){return this.clientToMarkups(a,b)},d.positionFromMarkupsToClient=function(a,b){return this.markupsToClient(a,b)},d.vectorFromClientToMarkups=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b);return{x:d.x-c.x,y:d.y-c.y}},d.vectorFromMarkupsToClient=function(a,b){var c=this.markupsToClient(0,0),d=this.markupsToClient(a,b);return{x:d.x-c.x,y:d.y-c.y}},d.sizeFromClientToMarkups=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b);return{x:Math.abs(d.x-c.x),y:Math.abs(d.y-c.y)}},d.sizeFromMarkupsToClient=function(a,b){var c=this.markupsToClient(0,0),d=this.markupsToClient(a,b);return{x:Math.abs(d.x-c.x),y:Math.abs(d.y-c.y)}},d.markupsToClient=function(a,b){var d=this.viewer.impl.camera,e=new THREE.Vector3(a,b,0);if(d.isPerspective){var f=this.viewer.impl.canvas.getBoundingClientRect();e.x=e.x/1e3*(.5*f.height)+.5*f.width,e.y=-e.y/1e3*(.5*f.height)+.5*f.height}else{e.applyMatrix4(d.matrixWorld),e.sub(d.position);var g=this.viewer.model.getData().globalOffset;g&&e.sub(g),e=c.worldToClient(e,this.viewer,!1),e.z=0}return e},d.clientToMarkups=function(a,b){var d=this.viewer.impl.camera,e=new THREE.Vector3(a,b,0);if(d.isPerspective){var f=this.viewer.impl.canvas.getBoundingClientRect();e.x=(e.x-.5*f.width)/(.5*f.height)*1e3,e.y=-(e.y-.5*f.height)/(.5*f.height)*1e3}else{e=c.clientToWorld(e.x,e.y,0,this.viewer);var g=this.viewer.model.getData().globalOffset;g&&e.add(g),e.add(d.position),e.applyMatrix4(d.matrixWorldInverse),e.z=0}return e},d.getSvgViewBox=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b),e=Math.min(c.x,d.x),f=Math.min(c.y,d.y);return[e,f,Math.max(c.x,d.x)-e,Math.max(c.y,d.y)-f].join(" ")},d.getBounds=function(){return this.bounds},d.getMousePosition=function(){return this.viewer.model.is2d()&&this.snapper&&this.snapper.isSnapped()?this.getSnapPosition():this.input.getMousePosition()},d.getSnapPosition=function(){var a,b=this.snapper.getHighlightGeometry(),c=this.snapper.getGeometry();a=b===SNAP_VERTEX?c:this.snapper.nearestPointInPointToEdge(c,this.snapper.getIntersectPoint());var d=this.project(a);return{x:d.x,y:d.y}},d.project=function(a){var b=this.viewer.navigation.getCamera(),c=this.viewer.navigation.getScreenViewport(),d=(new THREE.Vector3).copy(a);return d.project(b),new THREE.Vector3(Math.round((d.x+1)/2*c.width),Math.round((1-d.y)/2*c.height),d.z)},d.onCameraChange=function(a){var b=this.getSvgViewBox(this.bounds.width,this.bounds.height);if("NaN NaN NaN NaN"!==b){this.svg.setAttribute("viewBox",b);var c=this.editMode;if(c){var d=c.getSelection();this.editFrame.setMarkup(d)}}},d.onViewerResize=function(a){this.bounds.x=0,this.bounds.y=0,this.bounds.width=a.width,this.bounds.height=a.height,this.svg.setAttribute("width",this.bounds.width),this.svg.setAttribute("height",this.bounds.height),this.onCameraChange()},d.onMouseMove=function(a){if(!this.navigating){if(this.editFrame.isActive()&&"mousemove"===a.type&&this.editFrame.onMouseMove(a),this.viewer.model.is2d()&&"freehand"!==this.editMode.type){var b=this.input.getMousePosition();this.snapper&&this.snapper.onMouseMove(b)}this.editMode&&this.editMode.onMouseMove(a)}};var e=0,f="";d.onMouseDown=function(a){var b=performance.now();if(!(b-e<400&&f!==a.type)){if(e=b,f=a.type,c.dismissLmvHudMessage(),this.viewer.model.is2d()&&"freehand"!==this.editMode.type){var d=this.input.getMousePosition();this.snapper&&this.snapper.onMouseDown(d)}var g=this.getBounds(),d=this.getMousePosition();d.x>=g.x&&d.x<=g.x+g.width&&d.y>=g.y&&d.y<=g.y+g.height&&this.editMode.onMouseDown(a),this.editMode.creating||a.target!==this.svg||this.selectMarkup(null),this.ignoreNextMouseUp=!1}};var g=0,h="";d.onMouseUp=function(a){var b=performance.now();if(!(b-g<400&&h!==a.type||(g=b,h=a.type,this.navigating)))return this.editFrame.isActive()?void this.editFrame.onMouseUp(a):void(this.ignoreNextMouseUp||this.editMode.onMouseUp(a))},d.onMouseDoubleClick=function(a){this.navigating||this.editFrame.isActive()||this.editMode.onMouseDoubleClick(a)},d.onUserCancel=function(){this.editMode&&(this.editMode.creating?this.editMode.creationCancel():this.editMode.unselect())},d.onMarkupSelected=function(a){this.selectMarkup(a.markup),this.fireEvent(a)},d.onMarkupEnterEdition=function(a){},d.onMarkupCancelEdition=function(a){this.onUserCancel()},d.onMarkupDeleteEdition=function(a){this.removeMarkup(a.markup),this.editMode.deleteMarkup()},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsCore",a)}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"CLONE-MARKUP",c),this.clone=d.clone(),this.clone.id=c,this.position={x:e.x,y:e.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor,b=this.clone,c=this.position;if(!a.getMarkup(this.targetId)){var d=b.clone();d.setPosition(c.x,c.y),a.addMarkup(d)}},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CloneMarkup=a}(),function(){"use strict";function a(a,d,e,f,g){b.EditAction.call(this,a,"CREATE-ARROW",d),this.selectOnExecution=!1,this.tail=f,this.head=e,this.style=c.cloneStyle(g)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupArrow(this.targetId,a);a.addMarkup(c),c.set(this.head.x,this.head.y,this.tail.x,this.tail.y),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateArrow=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-CIRCLE",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupCircle(this.targetId,a);a.addMarkup(c),c.setSize(this.position,this.size.x,this.size.y),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateCircle=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-CLOUD",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupCloud(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateCloud=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-FREEHAND",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupFreehand(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateFreehand=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-POLYCLOUD",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupPolycloud(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreatePolycloud=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-POLYLINE",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupPolyline(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreatePolyline=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-RECTANGLE",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupRectangle(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateRectangle=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-TEXT",d),this.text=g,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=this.position,d=this.size,e=new b.MarkupText(this.targetId,a,d);a.addMarkup(e),e.setSize(c,d.x,d.y),e.setText(this.text),e.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&(this.editor.removeMarkup(a),a.destroy())},b.CreateText=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-ARROW",c.id),this.createArrow=new b.CreateArrow(a,c.id,c.head,c.tail,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createArrow.undo()},c.undo=function(){this.createArrow.redo()},b.DeleteArrow=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-CIRCLE",c.id),this.createCircle=new b.CreateCircle(a,c.id,c.position,c.size,c.rotation,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createCircle.undo()},c.undo=function(){this.createCircle.redo()},b.DeleteCircle=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-CLOUD",c.id),this.createCloud=new b.CreateCloud(a,c.id,c.position,c.size,c.rotation,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createCloud.undo()},c.undo=function(){this.createCloud.redo()},b.DeleteCloud=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-FREEHAND",c.id),this.createFreehand=new b.CreateFreehand(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createFreehand.undo()},c.undo=function(){this.createFreehand.redo()},b.DeleteFreehand=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-POLYCLOUD",c.id),this.createPolycloud=new b.CreatePolyline(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createPolycloud.undo()},c.undo=function(){this.createPolycloud.redo()},b.DeletePolycloud=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-POLYLINE",c.id),this.createPolyline=new b.CreatePolyline(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createPolyline.undo()},c.undo=function(){this.createPolyline.redo()},b.DeletePolyline=a}(),function(){"use strict";var a=Autodesk.Viewing.Extensions.Markups.Core,b=function(b,c){a.EditAction.call(this,b,"DELETE-RECTANGLE",c.id),
this.createRectangle=new a.CreateRectangle(b,c.id,c.position,c.size,c.rotation,c.getStyle())};b.prototype=Object.create(a.EditAction.prototype),b.prototype.constructor=b;var c=b.prototype;c.redo=function(){this.createRectangle.undo()},c.undo=function(){this.createRectangle.redo()},a.DeleteRectangle=b}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-TEXT",c.id);var d={x:c.position.x,y:c.position.y},e={x:c.size.x,y:c.size.y};this.createText=new b.CreateText(a,c.id,d,e,c.getText(),c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createText.undo()},c.undo=function(){this.createText.redo()},b.DeleteText=a}(),function(){"use strict";function a(){this.actions=[],this.closed=!0}var b=Autodesk.Viewing.Extensions.Markups.Core,c=a.prototype;c.open=function(){return!!this.closed&&(this.closed=!1,!0)},c.close=function(){return!this.closed&&(this.closed=!0,!0)},c.undo=function(){for(var a=this.actions,b=a.length-1,c=-1,d=b;d>=0;--d){var e=a[d];e.undo(),e.targetId!==-1&&(c=e.targetId)}return c},c.redo=function(){for(var a=this.actions,b=a.length,c=-1,d=0;d<b;++d){var e=a[d];e.redo(),e.targetId!==-1&&(c=e.targetId)}return c},c.isOpen=function(){return!this.closed},c.isClosed=function(){return this.closed},c.isEmpty=function(){return 0===this.actions.length},c.addAction=function(a){return!this.closed&&(this.actions.push(a),this.compact(),!0)},c.compact=function(){for(var a=this.actions,b=a.length,c=0;c<b;++c){var d=a[c];if(d.isIdentity())a.splice(c,1),--b,--c;else for(var e=c+1;e<b;++e){var f=a[e];if(d.type===f.type&&d.merge(f)){a.splice(e,1),--b,--c;break}}}},b.EditActionGroup=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-ARROW",c.id),this.newHead={x:d.x,y:d.y},this.newTail={x:e.x,y:e.y},this.oldHead={x:c.head.x,y:c.head.y},this.oldTail={x:c.tail.x,y:c.tail.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newHead,this.newTail)},c.undo=function(){this.applyState(this.targetId,this.oldHead,this.oldTail)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newHead=a.newHead,this.newTail=a.newTail,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){(Math.abs(d.head.x-b.x)>=1e-4||Math.abs(d.head.y-b.y)>=1e-4||Math.abs(d.tail.x-c.x)>=1e-4||Math.abs(d.tail.y-c.y)>=1e-4)&&d.set(b.x,b.y,c.x,c.y)}},c.isIdentity=function(){return this.newHead.x===this.oldHead.x&&this.newHead.y===this.oldHead.y&&this.newTail.x===this.oldTail.x&&this.newTail.y===this.oldTail.y},b.SetArrow=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-CIRCLE",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){(Math.abs(d.position.x-b.x)>1e-4||Math.abs(d.size.y-c.y)>1e-4||Math.abs(d.position.y-b.y)>1e-4||Math.abs(d.size.y-c.y)>1e-4)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetCircle=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-CLOUD",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize,this.newStrokeWidth,this.newColor)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize,this.oldStrokeWidth,this.oldColor)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){(Math.abs(d.position.x-b.x)>1e-4||Math.abs(d.size.y-c.y)>1e-4||Math.abs(d.position.y-b.y)>1e-4||Math.abs(d.size.y-c.y)>1e-4)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetCloud=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-FREEHAND",c.id),this.position=d,this.size=e,this.locations=f.concat()}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,!0)},c.isIdentity=function(){return!1},b.SetFreehand=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-POLYCLOUD",c.id),this.position=d,this.size=e,this.locations=f.concat(),this.closed=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.closed)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,this.closed=a.closed,!0)},c.isIdentity=function(){return!1},b.SetPolycloud=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-POLYLINE",c.id),this.position=d,this.size=e,this.locations=f.concat(),this.closed=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.closed)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,this.closed=a.closed,!0)},c.isIdentity=function(){return!1},b.SetPolyline=a}(),function(){"use strict";function a(a,c,d){b.EditAction.call(this,a,"SET-POSITION",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setPosition(this.newPosition.x,this.newPosition.y)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setPosition(this.oldPosition.x,this.oldPosition.y)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,!0)},c.isIdentity=function(){var a=this.newPosition,b=this.oldPosition;return a.x===b.x&&a.y===b.y},b.SetPosition=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-RECTANGLE",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){(Math.abs(d.position.x-b.x)>1e-4||Math.abs(d.size.y-c.y)>1e-4||Math.abs(d.position.y-b.y)>1e-4||Math.abs(d.size.y-c.y)>1e-4)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetRectangle=a}(),function(){"use strict";function a(a,c,d){b.EditAction.call(this,a,"SET-ROTATION",c.id);var e=c.getRotation();this.newRotation={angle:d},this.oldRotation={angle:e}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setRotation(this.newRotation.angle)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setRotation(this.oldRotation.angle)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newRotation=a.newRotation,!0)},c.isIdentity=function(){return this.newRotation.angle===this.oldRotation.angle},b.SetRotation=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-SIZE",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y},this.newWidth=e,this.oldWidth=c.size.x,this.newHeight=f,this.oldHeight=c.size.y}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setSize(this.newPosition,this.newWidth,this.newHeight)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setSize(this.oldPosition,this.oldWidth,this.oldHeight)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newWidth=a.newWidth,this.newHeight=a.newHeight,!0)},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newWidth===this.oldWidth&&this.newHeight===this.oldHeight},b.SetSize=a}(),function(){"use strict";function a(a,d,e){b.EditAction.call(this,a,"SET-STYLE",d.id),this.newStyle=c.cloneStyle(e),this.oldStyle=d.getStyle()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setStyle(this.newStyle)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setStyle(this.oldStyle)},b.SetStyle=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-TEXT",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y},this.newSize={x:e.x,y:e.y},this.oldSize={x:c.size.x,y:c.size.y},this.newText=f,this.oldText=c.getText()}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.newPosition,this.newSize,this.newText)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.oldPosition,this.oldSize,this.oldText)},b.SetText=a}(),function(){"use strict";function a(a){this.editor=a,this.content=null,this.pastePosition={x:0,y:0},c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=a.prototype;d.copy=function(){var a=this.editor.getSelection();a&&(this.content=a.clone(),this.pastePosition.x=a.position.x,this.pastePosition.y=a.position.y)},d.cut=function(){var a=this.editor.getSelection();a&&(this.copy(),this.editor.deleteMarkup(a))},d.paste=function(){var a=this.content;if(a){var c=this.editor,d=this.pastePosition,e=c.sizeFromClientToMarkups(20,20);d.x+=e.x,d.y-=e.y;new b.CloneMarkup(c,c.getId(),a,d).execute()}},b.Clipboard=a}(),function(){"use strict";function a(){this.editor=null,this.mousePosition={x:0,y:0},this.makeSameXY=!1,this.snapRotations=!1,this.keepAspectRatio=!1,this.constrainAxis=!1,this.onWheelBinded=this.onWheel.bind(this),this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onSingleTapBinded=this.onSingleTap.bind(this),this.onDoubleTapBinded=this.onDoubleTap.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.isMouseDown=!1}function b(a,b){var c=a.editor.svg.getBoundingClientRect();a.makeSameXY=b.shiftKey,a.snapRotations=b.shiftKey,a.keepAspectRatio=b.shiftKey,a.constrainAxis=b.shiftKey,a.mousePosition.x=b.clientX-c.left,a.mousePosition.y=b.clientY-c.top}function c(a){a.shiftKey=!1,a.clientX=a.pointers[0].clientX,a.clientY=a.pointers[0].clientY}var d=Autodesk.Viewing.Extensions.Markups.Core,e=Autodesk.Viewing.Extensions.Markups.Core.Utils,f=a.prototype;f.attachTo=function(a){this.editor&&this.detachFrom(this.editor),this.editor=a,e.isTouchDevice()&&(this.hammer=new Hammer.Manager(a.svg,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.get("doubletap2").recognizeWith("doubletap"),this.hammer.get("singletap2").recognizeWith("singletap"),this.hammer.get("singletap").requireFailure("doubletap"))},f.detachFrom=function(a){this.hammer&&this.hammer.destroy(),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded)),this.editor=a},f.enterEditMode=function(){this.hammer&&(this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("singletap2",this.onSingleTapBinded),this.hammer.on("doubletap",this.onDoubleTapBinded),this.hammer.on("doubletap2",this.onDoubleTapBinded)),document.addEventListener("mousemove",this.onMouseMoveBinded,!0),document.addEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.addEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.addEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},f.leaveEditMode=function(){this.hammer&&(this.hammer.off("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("singletap2",this.onSingleTapBinded),this.hammer.off("doubletap",this.onDoubleTapBinded),this.hammer.off("doubletap2",this.onDoubleTapBinded)),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},f.enterViewMode=function(){},f.leaveViewMode=function(){},f.getMousePosition=function(){return{x:this.mousePosition.x,y:this.mousePosition.y}},f.onWheel=function(a){a.preventDefault()},f.onMouseMove=function(a){b(this,a),this.editor.onMouseMove(a),a.preventDefault()},f.onMouseDown=function(a){b(this,a),this.isMouseDown=!0,this.editor.onMouseDown(a),a.preventDefault()},f.onMouseUp=function(a){b(this,a),this.isMouseDown=!1,this.editor.onMouseUp(a),a.preventDefault()},f.onMouseDoubleClick=function(a){b(this,a),this.editor.onMouseDoubleClick(a),a.preventDefault()},f.onTouchDrag=function(a){switch(c(a),a.type){case"dragstart":this.onMouseDown(a);break;case"dragmove":this.onMouseMove(a);break;case"dragend":this.onMouseUp(a)}a.preventDefault()},f.onSingleTap=function(a){c(a),this.onMouseDown(a),this.onMouseUp(a),a.preventDefault()},f.onDoubleTap=function(a){c(a),this.onMouseDoubleClick(a),a.preventDefault()},d.InputHandler=a}(),function(){"use strict";function a(a,b,d){this.editor=a,this.viewer=a.viewer,this.type=b,this.selectedMarkup=null,this.dragging=!1,this.draggingAnnotationIniPosition=null,this.draggingMouseIniPosition=new THREE.Vector2,this.initialX=0,this.initialY=0,this.minSize=9,this.creating=!1,this.size={x:0,y:0},this.style=c.createStyle(d,this.editor),this.style=c.copyStyle(a.getDefaultStyle(),this.style),this.CREATION_METHOD_DRAG="CREATION_METHOD_DRAG",this.CREATION_METHOD_CLICK="CREATION_METHOD_CLICK",this.CREATION_METHOD_CLICKS="CREATION_METHOD_CLICKS",this.creationMethod=this.CREATION_METHOD_DRAG,c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.EVENT_EDITMODE_CREATION_BEGIN="EVENT_EDITMODE_CREATION_BEGIN",b.EVENT_EDITMODE_CREATION_END="EVENT_EDITMODE_CREATION_END",b.EVENT_MARKUP_DESELECT="EVENT_MARKUP_DESELECT";var d=a.prototype;d.destroy=function(){this.unselect(),c.removeTraitEventDispatcher(this)},d.unselect=function(){var a=!1,c=this.selectedMarkup;c&&(c.unselect(),this.selectedMarkup=null,a=!0),this.editor.editFrame.setMarkup(null),a&&this.fireEvent({type:b.EVENT_MARKUP_DESELECT})},d.creationBegin=function(){this.creating||(this.creating=!0,this.fireEvent({type:b.EVENT_EDITMODE_CREATION_BEGIN}))},d.creationEnd=function(){this.creating&&(this.creationMethod!==this.CREATION_METHOD_CLICK&&(this.selectedMarkup&&!this.isMinSizeValid()?this.creationCancel():(this.creationMethod===this.CREATION_METHOD_DRAG&&this.finishDragging(),this.selectedMarkup&&(this.editor.closeActionGroup(),this.unselect()))),this.creating=!1,this.fireEvent({type:b.EVENT_EDITMODE_CREATION_END}))},d.creationCancel=function(){this.editor.cancelActionGroup(),this.creationEnd(),this.selectedMarkup=null},d.setStyle=function(a){this.style=a;var c=this.selectedMarkup;if(c){new b.SetStyle(this.editor,c,a).execute()}},d.getStyle=function(){return this.style},d.setSelection=function(a){this.selectedMarkup!==a&&(this.unselect(),a&&a.select()),this.selectedMarkup=a;var b=this.editor;a&&b.bringToFront(a),this.creating||b.editFrame.setMarkup(a)},d.getSelection=function(){return this.selectedMarkup},d.deleteMarkup=function(a,b){return!1},d.isMinSizeValid=function(){if(0!==this.minSize){var a=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y);return a.x*a.x+a.y*a.y>=this.minSize*this.minSize}return!0},d.startDragging=function(){var a=this.selectedMarkup,b=this.editor.getMousePosition();a&&(this.dragging=!0,this.draggingAnnotationIniPosition=a.getClientPosition(),this.draggingMouseIniPosition.set(b.x,b.y))},d.finishDragging=function(){var a=this.dragging,b=this.selectedMarkup;this.dragging=!1,b&&a&&b.finishDragging()},d.getFinalMouseDraggingPosition=function(){var a=this.editor,b=a.getBounds(),d=a.getMousePosition(),e=this.initialX,f=this.initialY,g=Math.min(Math.max(b.x,d.x),b.x+b.width),h=Math.min(Math.max(b.y,d.y),b.y+b.height);if(g==e&&h==f&&(g++,h++),a.input.makeSameXY){var i=Math.abs(g-e),j=Math.abs(h-f),k=Math.max(i,j);g=e+k*c.sign(g-e),h=f+k*c.sign(h-f)}return{x:g,y:h}},d.notifyAllowNavigation=function(a){},d.onMouseMove=function(a){},d.onMouseDown=function(){},d.onMouseUp=function(a){this.creationMethod===this.CREATION_METHOD_DRAG&&this.creationEnd()},d.onMouseDoubleClick=function(a){this.creationMethod===this.CREATION_METHOD_CLICKS&&this.creationEnd()},d.onSave=function(){this.creating&&this.creationCancel()},d.getDraggingPosition=function(){var a=this.editor.getMousePosition(),b=a.x-this.draggingMouseIniPosition.x,c=a.y-this.draggingMouseIniPosition.y;return{x:this.draggingAnnotationIniPosition.x+b,y:this.draggingAnnotationIniPosition.y+c}},d.isInsideBounds=function(a,b,c){return a>=c.x&&a<=c.x+c.width&&b>=c.y&&b<=c.y+c.height},b.EditMode=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_ARROW,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteArrow(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();if(this.initialX=c.x,this.initialY=c.y,this.size.x=0,this.size.y=0,this.lineSnapped=null,a.snapper){var d=a.snapper.getHighlightGeometry();d!==SNAP_VERTEX&&d!==SNAP_EDGE||(this.lineSnapped=a.snapper.getEdge())}var e=3.5*this.style["stroke-width"],f=a.sizeFromMarkupsToClient(e,0).x,g={x:this.initialX,y:this.initialY},h={x:Math.round(g.x+Math.cos(.25*Math.PI)*f),y:Math.round(g.y+Math.sin(.25*-Math.PI)*f)};(function(a,b,c,d){this.isInsideBounds(b.x,b.y,d)||(b.y=Math.round(a.y+Math.sin(.25*Math.PI)*c),this.isInsideBounds(b.x,b.y,d)||(b.x=Math.round(a.x+Math.cos(.25*-Math.PI)*c),this.isInsideBounds(b.x,b.y,d)||(b.y=Math.round(a.y+Math.sin(.25*-Math.PI)*c))))}).bind(this)(g,h,f,a.getBounds()),a.beginActionGroup(),g=a.positionFromClientToMarkups(g.x,g.y),h=a.positionFromClientToMarkups(h.x,h.y);var i=new THREE.Vector2(h.x-g.x,h.y-g.y);i.lengthSq()<e*e&&(i=i.normalize().multiplyScalar(e),h.x=g.x+i.x,h.y=g.y+i.y);var j=a.getId();new b.CreateArrow(a,j,g,h,this.style).execute(),this.selectedMarkup=a.getMarkup(j),this.creationBegin()}},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.getFinalMouseDraggingPosition(),f=this.initialX,g=this.initialY;if(d.snapper&&!d.snapper.isSnapped()&&this.lineSnapped){var h=d.project(this.lineSnapped.vertices[0]),i=d.project(this.lineSnapped.vertices[1]),j=new THREE.Vector3(e.x,e.y,h.z),k=d.snapper.nearestPointInPointToLine(j,h,i),l=-(h.x-i.x)/(h.y-i.y),m=g-l*f,n=f+1,o=l*n+m,p=new THREE.Vector3(n,o,h.z),q=new THREE.Vector3(f,g,h.z),r=d.snapper.nearestPointInPointToLine(j,q,p);k.distanceTo(j)<=20?(e.x=k.x,e.y=k.y):r.distanceTo(j)<=20&&(e.x=r.x,e.y=r.y)}var s=d.positionFromClientToMarkups(f,g),t=d.positionFromClientToMarkups(e.x,e.y),u=new THREE.Vector2(t.x-s.x,t.y-s.y),v=3.5*c.style["stroke-width"];u.lengthSq()<v*v&&(u=u.normalize().multiplyScalar(v),t.x=s.x+u.x,t.y=s.y+u.y),this.size=d.sizeFromClientToMarkups(e.x-f,e.y-g);new b.SetArrow(d,c,s,t).execute()}},b.EditModeArrow=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_CIRCLE,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteCircle(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.initialX,f=this.initialY,g=this.getFinalMouseDraggingPosition(),h=Math.abs(e-g.x),i=Math.abs(f-g.y),j=d.clientToMarkups(.5*(e+g.x),.5*(f+g.y)),k=this.size=d.sizeFromClientToMarkups(h,i);new b.SetCircle(d,c,j,k).execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId();new b.CreateCircle(a,f,d,e,0,this.style).execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeCircle=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_CLOUD,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteCloud(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.initialX,f=this.initialY,g=this.getFinalMouseDraggingPosition(),h=d.clientToMarkups((e+g.x)/2,(f+g.y)/2),i=this.size=d.sizeFromClientToMarkups(g.x-e,g.y-f);new b.SetCloud(d,c,h,i).execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId();new b.CreateCloud(a,f,d,e,0,this.style).execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeCloud=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_FREEHAND,c),this.style["stroke-opacity"]=.75}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteFreehand(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=d.getMousePosition(),f=this.movements,g=d.clientToMarkups(e.x,e.y);f.push(g);var h=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},i=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},j=h(f,"x"),k=h(f,"y"),l=i(f,"x"),m=i(f,"y"),n=l-j,o=m-k,p={x:j+.5*n,y:k+.5*o},q=this.size={x:n,y:o},r=f.map(function(a){return{x:a.x-p.x,y:a.y-p.y}});new b.SetFreehand(d,c,p,q,r).execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor;a.snapper&&a.snapper.clearSnapped();var c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY);this.movements=[d];var e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId();new b.CreateFreehand(a,f,d,e,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeFreehand=a}(),function(){"use strict";function a(a){var b=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];c.EditMode.call(this,a,c.MARKUP_TYPE_POLYCLOUD,b),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function b(a,b){var c=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},d=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},e=b.style["stroke-width"],f=2*e+.5*e,g=c(a,"x")-f,h=c(a,"y")-f,i=d(a,"x")+f,j=d(a,"y")+f,k=i-g,l=j-h;b.size={x:k,y:l},b.position={x:g+.5*k,y:h+.5*l};var m=b.position;return a.map(function(a){return{x:a.x-m.x,y:a.y-m.y}})}var c=Autodesk.Viewing.Extensions.Markups.Core,d=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(c.EditMode.prototype),a.prototype.constructor=a;var e=a.prototype;e.deleteMarkup=function(a,b){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new c.DeletePolycloud(this.editor,a);return d.addToHistory=!b,d.execute(),!0}return!1},e.onMouseMove=function(a){c.EditMode.prototype.onMouseMove.call(this,a);var e=this.editor,f=this.selectedMarkup;if(f&&this.creating){this.dragging=!0;var g=this.movements;g.splice(g.length-1,1);var h=e.getMousePosition();h=e.clientToMarkups(h.x,h.y),g.length>=2&&d.areMarkupsPointsInClientRange(g[0],h,25,this.editor)&&(h=g[0]),g.push(h);var i=b(g,this);new c.SetPolycloud(e,f,this.position,this.size,i).execute()}},e.onMouseDown=function(){if(c.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var a=this.editor,b=a.getMousePosition();b=a.clientToMarkups(b.x,b.y);var d=this.size=a.sizeFromClientToMarkups(1,1);this.movements=[b,b],a.beginActionGroup();var e=a.getId();new c.CreatePolycloud(a,e,b,d,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=a.getMarkup(e),this.creationBegin()}},e.onMouseUp=function(a){if(c.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var e=this.editor,f=e.getMousePosition(),g=this.movements,h=!1;if(f=e.clientToMarkups(f.x,f.y),!(g.length>1&&d.areMarkupsPointsInClientRange(g[g.length-2],f,25,this.editor))){g.length>2&&d.areMarkupsPointsInClientRange(g[0],f,25,this.editor)&&(f=g[0],h=!0),g.splice(g.length-1,1),h||(g.push(f),g.push(f));var i=this.selectedMarkup,j=b(g,i);new c.SetPolycloud(e,i,i.position,i.size,j,h).execute(),h&&this.creationEnd()}}},e.onMouseDoubleClick=function(a){if(this.creating){var d=this.movements;if(d.splice(Math.max(0,d.length-1)),d.length<2)this.creationCancel();else{var e=this.selectedMarkup,f=b(d,e);new c.SetPolycloud(this.editor,e,e.position,e.size,f,!0).execute(),this.creationEnd()}}},e.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),c.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},e.creationCancel=function(){c.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},c.EditModePolycloud=a}(),function(){"use strict";function a(a){var b=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];c.EditMode.call(this,a,c.MARKUP_TYPE_POLYLINE,b),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function b(a,b){var c=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},d=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},e=c(a,"x"),f=c(a,"y"),g=d(a,"x"),h=d(a,"y"),i=g-e,j=h-f;b.size={x:i,y:j},b.position={x:e+.5*i,y:f+.5*j};var k=b.position;return a.map(function(a){return{x:a.x-k.x,y:a.y-k.y}})}var c=Autodesk.Viewing.Extensions.Markups.Core,d=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(c.EditMode.prototype),a.prototype.constructor=a;var e=a.prototype;e.deleteMarkup=function(a,b){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new c.DeletePolyline(this.editor,a);return d.addToHistory=!b,d.execute(),!0}return!1},e.onMouseMove=function(a){c.EditMode.prototype.onMouseMove.call(this,a);var e=this.editor,f=this.selectedMarkup;if(f&&this.creating){this.dragging=!0;var g=this.movements;g.splice(g.length-1,1);var h=e.getMousePosition();h=e.clientToMarkups(h.x,h.y),g.length>=2&&d.areMarkupsPointsInClientRange(g[0],h,25,this.editor)&&(h=g[0]),g.push(h);var i=b(g,this);new c.SetPolyline(e,f,this.position,this.size,i).execute()}},e.onMouseDown=function(a){if(c.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var b=this.editor,d=b.getMousePosition();d=b.clientToMarkups(d.x,d.y);var e=this.size=b.sizeFromClientToMarkups(1,1);this.movements=[d,d],b.beginActionGroup();var f=b.getId()
;new c.CreatePolyline(b,f,d,e,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=b.getMarkup(f),this.creationBegin()}},e.onMouseUp=function(){if(c.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var a=this.editor,e=a.getMousePosition(),f=this.movements,g=!1;if(e=a.clientToMarkups(e.x,e.y),!(f.length>1&&d.areMarkupsPointsInClientRange(f[f.length-2],e,25,this.editor))){f.length>2&&d.areMarkupsPointsInClientRange(f[0],e,25,this.editor)&&(e=f[0],g=!0),f.splice(f.length-1,1),g||(f.push(e),f.push(e));var h=this.selectedMarkup,i=b(f,h);new c.SetPolyline(a,h,h.position,h.size,i,g).execute(),g&&this.creationEnd()}}},e.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),c.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},e.creationCancel=function(){c.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},e.onMouseDoubleClick=function(a){if(this.creating){var d=this.movements;if(d.splice(Math.max(0,d.length-1)),d.length<2)this.creationCancel();else{var e=this.selectedMarkup,f=b(d,e);new c.SetPolyline(this.editor,e,e.position,e.size,f,this.closed).execute(),this.creationEnd()}}},c.EditModePolyline=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_RECTANGLE,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteRectangle(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.setStyle=function(a){b.EditMode.prototype.setStyle.call(this,a);var c=this.selectedMarkup;if(c){new b.SetRectangle(this.editor,c,c.position,c.size).execute()}},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d,e,f=this.editor,g=this.initialX,h=this.initialY,i=this.getFinalMouseDraggingPosition(),j=f.clientToMarkups((g+i.x)/2,(h+i.y)/2);if(f.snapper&&this.lineSnapped){var k=f.project(this.lineSnapped.vertices[0]),l=f.project(this.lineSnapped.vertices[1]),m=new THREE.Vector3(i.x,i.y,k.z),n=f.snapper.nearestPointInPointToLine(m,k,l);e=m.distanceTo(n);var o=-(k.x-l.x)/(k.y-l.y),p=h-o*g,q=g+1,r=o*q+p,s=new THREE.Vector3(q,r,k.z),t=new THREE.Vector3(g,h,k.z),u=f.snapper.nearestPointInPointToLine(m,t,s);d=m.distanceTo(u)}else d=i.x-g,e=i.y-h;var v=this.size=f.sizeFromClientToMarkups(d,e);new b.SetRectangle(f,c,j,v).execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1),f=0;if(this.lineSnapped=null,a.snapper){if(a.snapper.getHighlightGeometry()===SNAP_EDGE){this.lineSnapped=a.snapper.getEdge();var g=a.project(this.lineSnapped.vertices[0]),h=a.project(this.lineSnapped.vertices[1]),i=h.x-g.x,j=h.y-g.y,k=i&&j?j/i:0;f=this.rotation=Math.atan(k)}}a.beginActionGroup();var l=a.getId();new b.CreateRectangle(a,l,d,e,f,this.style).execute(),this.selectedMarkup=a.getMarkup(l),this.creationBegin()}},b.EditModeRectangle=a}(),function(){"use strict";function a(a){var c=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.EditMode.call(this,a,b.MARKUP_TYPE_TEXT,c);var d=new b.EditorTextInput(this.viewer.container,this.editor);d.addEventListener(d.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.textInputHelper=d,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteText(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.setStyle=function(a){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(a):b.EditMode.prototype.setStyle.call(this,a)},c.notifyAllowNavigation=function(a){a&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},c.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),b.EditMode.prototype.destroy.call(this)},c.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())return void this.textInputHelper.acceptAndExit();if(!this.selectedMarkup){var a=this.editor,c=a.getMousePosition(),d=a.sizeFromMarkupsToClient(0,this.style["font-size"]).y,e=15*d,f=3*d,g=this.size=a.sizeFromClientToMarkups(e,f),h=a.positionFromClientToMarkups(c.x+.5*e,c.y+.5*f);this.creationBegin(),a.beginActionGroup();var i=new b.CreateText(a,a.getId(),h,g,"",this.style);i.execute(),this.creationEnd(),this.selectedMarkup=a.getMarkup(i.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},c.onMouseUp=function(a){},c.onMouseDoubleClick=function(a){a===this.selectedMarkup&&(this.editor.selectMarkup(null),this.textInputHelper&&this.textInputHelper.setActive(a,!1))},c.onHelperTextChange=function(a){var c=a.data,d=c.markup,e=c.style;if(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===c.newText){if(c.firstEdit)return this.editor.cancelActionGroup(),void this.editor.selectMarkup(null);return new b.DeleteText(this.editor,d).execute(),void this.editor.selectMarkup(null)}c.firstEdit||this.editor.beginActionGroup();var f=this.editor.positionFromClientToMarkups(c.newPos.x,c.newPos.y),g=this.editor.sizeFromClientToMarkups(c.width,c.height);new b.SetSize(this.editor,d,f,g.x,g.y).execute(),new b.SetText(this.editor,d,d.position,d.size,c.newText).execute(),new b.SetStyle(this.editor,d,e).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(null)},c.onHistoryChange=function(a){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},c.onSave=function(){if(b.EditMode.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var a=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),a&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},b.EditModeText=a}(),function(){"use strict";function a(a,b){this.parentDiv=a,this.editor=b,this.EVENT_TEXT_CHANGE="EVENT_CO2_TEXT_CHANGE",this.textArea=document.createElement("textarea"),this.textArea.setAttribute("maxlength","260"),this.textArea.setAttribute("data-i18n",f),this.onKeyHandlerBinded=this.onKeyHandler.bind(this),this.textArea.addEventListener("keydown",this.onKeyHandlerBinded),this.styleTextArea=new e.DomElementStyle,this.styleTextArea.setAttribute("position","absolute").setAttribute("overflow-y","hidden"),this.measureDiv=document.createElement("div"),e.addTraitEventDispatcher(this),this.onResizeBinded=this.onWindowResize.bind(this)}function b(a){if(0===a.length)return"";for(var b=a.length-1,c=b;c>=0;--c)if(" "!==a.charAt(c)){b=c;break}return a.substr(0,b+1)}function c(a){if(0===a.length)return"";for(var b=0,c=0;c<a.length;++c)if(" "!==a.charAt(c)){b=c;break}return a.substr(b)}var d=Autodesk.Viewing.Extensions.Markups.Core,e=Autodesk.Viewing.Extensions.Markups.Core.Utils,f="Write Something",g=a.prototype;g.destroy=function(){this.textArea.removeEventListener("keydown",this.onKeyHandlerBinded),this.setInactive()},g.setActive=function(a,b){if(this.textMarkup!==a){var c=Autodesk.Viewing.i18n.translate(f);if(this.textArea.setAttribute("placeholder",c),this.setInactive(),this.parentDiv.appendChild(this.textArea),this.textMarkup=a,this.firstEdit=b||!1,this.initFromMarkup(),window.addEventListener("resize",this.onResizeBinded),!Autodesk.Viewing.isIOSDevice()){var d=this.textArea;window.requestAnimationFrame(function(){d.focus()})}}},g.setInactive=function(){Autodesk.Viewing.isIOSDevice()&&this.textArea.blur(),window.removeEventListener("resize",this.onResizeBinded),this.textMarkup&&(this.textMarkup=null,this.parentDiv.removeChild(this.textArea)),this.style=null},g.isActive=function(){return!!this.textMarkup},g.initFromMarkup=function(){var a=this.textMarkup,b=a.getClientPosition(),c=a.getClientSize(),d=b.x-.5*c.x,e=b.y-.5*c.y,f=a.lineHeight+"%";this.styleTextArea.setAttribute("line-height",f),this.setPosAndSize(d,e,c.x,c.y),this.setStyle(a.getStyle()),this.textArea.value=a.getText()},g.setPosAndSize=function(a,b,c,d){a+c>=this.editor.viewer.container.clientWidth&&(a=this.editor.viewer.container.clientWidth-(c+10)),b+d>=this.editor.viewer.container.clientHeight&&(b=this.editor.viewer.container.clientHeight-(d+10)),a<5&&(a=5,c=this.editor.viewer.container.clientWidth-10),this.styleTextArea.setAttribute("left",a+"px").setAttribute("top",b+"px").setAttribute("width",c+"px").setAttribute("height",d+"px")},g.setStyle=function(a){if(this.style){var b={};this.injectSizeValues(b),this.setPosAndSize(b.newPos.x-.5*b.width,b.newPos.y-.5*b.height,b.width,b.height)}var c=this.editor.sizeFromMarkupsToClient(0,a["font-size"]).y,d=this.styleTextArea.setAttribute("color",a["stroke-color"]).setAttribute("font-family",a["font-family"]).setAttribute("font-size",c+"px").setAttribute("font-weight",a["font-weight"]).setAttribute("font-style",a["font-style"]).getStyleString();this.textArea.setAttribute("style",d),this.style=e.cloneStyle(a)},g.getTextValuesForMarkup=function(a){var b=this.isActive(),c=this.textMarkup,d=this.firstEdit;this.setActive(a,!1);var e=this.getTextValues();return b?this.setActive(c,d):this.setInactive(),e},g.getTextValues=function(){var a=this.textArea.value;return a===f&&(a=""),{text:a,lines:this.generateLines()}},g.acceptAndExit=function(){var a=this.getTextValues(),b={markup:this.textMarkup,style:this.style,firstEdit:this.firstEdit,newText:a.text,newLines:a.lines};this.injectSizeValues(b),this.fireEvent({type:this.EVENT_TEXT_CHANGE,data:b}),this.setInactive()},g.injectSizeValues=function(a){var b=parseFloat(this.textArea.style.width),c=parseFloat(this.textArea.style.height),d=parseFloat(this.textArea.style.left),e=parseFloat(this.textArea.style.top);a.width=b,a.height=c,a.newPos={x:d+.5*b,y:e+.5*c}},g.onWindowResize=function(a){window.requestAnimationFrame(function(){var a=this.textArea.value;this.style=null,this.initFromMarkup(),this.textArea.value=a}.bind(this))},g.onKeyHandler=function(a){var b=a.keyCode;a.shiftKey||13!==b||(a.preventDefault(),this.acceptAndExit())},g.generateLines=function(){var a=this.textArea.value,c=a.split(/\r*\n/),d=this.styleTextArea.clone().removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString();this.measureDiv.setAttribute("style",d),this.parentDiv.appendChild(this.measureDiv);for(var e=parseFloat(this.textArea.style.width),f=[],g=0,h=c.length;g<h;++g){var i=b(c[g]);this.splitLine(i,e,f)}return this.parentDiv.removeChild(this.measureDiv),f},g.splitLine=function(a,b,d){if(""!==a)for(var e="",f=!1;!f;){this.measureDiv.innerHTML=a;var g=this.measureDiv.clientWidth;if(g<=b)d.push(a),this.splitLine(c(e),b,d),f=!0;else{var h=this.getShorterLine(a);1===h.length?(this.splitWord(a,e,b,d),f=!0):(a=h[0],e=h[1]+e)}}},g.getShorterLine=function(a){var b=a.lastIndexOf(" ");if(b===-1)return[a];for(;" "===a.charAt(b-1);)b--;var c=a.substr(b);return[a.substr(0,b),c]},g.splitWord=function(a,b,c,d){for(var e=1;;){var f=a.substr(0,e);this.measureDiv.innerHTML=f;if(this.measureDiv.clientWidth>c){if(1===e)return d.push(f),void this.splitWord(a.substr(1),b,c,d);var g=a.substr(0,e-1);d.push(g);var h=a.substr(e-1);return void this.splitLine(h+b,c,d)}if(++e>a.length)return void d.push(a)}},d.EditorTextInput=a}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.domEvents=[]}var b="Autodesk.Viewing.MarkupsCore",c=AutodeskNamespace("Autodesk.Markups.Gui"),d=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),e=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var f=a.prototype,g=Autodesk.Viewing,h=g.Private;f.load=function(){var a=this.viewer.getExtension(b);return a||(this.viewer.loadExtension(b),a=this.viewer.getExtension(b)),a?(this.core=a,this.viewer.toolbar?this.createToolbarUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(g.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),this.onEditModeEnterBinded=this.onEditModeEnter.bind(this),this.onEditModeLeaveBinded=this.onEditModeLeave.bind(this),this.onEditModeChangeBinded=this.onEditModeChange.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.core.addEventListener(d.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.addEventListener(d.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.addEventListener(d.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.addEventListener(d.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),!0):(h.logger.warn("Missing dependency:",b),!1)},f.unload=function(){return this.unhookAllEvents(),this.core.removeEventListener(d.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.removeEventListener(d.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.removeEventListener(d.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.removeEventListener(d.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),this.onEditModeEnterBinded=null,this.onEditModeLeaveBinded=null,this.onEditModeChangeBinded=null,this.onMarkupSelectedBinded=null,this.destroyToolbarUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(g.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),this.core=null,!0},f.onToolbarCreated=function(){this.viewer.removeEventListener(g.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createToolbarUI()},f.createToolbarUI=function(){var a=this,b=this.viewer,c=b.getToolbar(!0);this.markupToolButton=new Autodesk.Viewing.UI.Button("toolbar-markupTool"),this.markupToolButton.setToolTip("Markup"),this.markupToolButton.setIcon("adsk-icon-markup"),this.markupToolButton.onClick=function(){a.core.enterEditMode()};var d=c.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);d&&d.addControl(this.markupToolButton,{index:0})},f.destroyToolbarUI=function(){if(this.markupToolButton){var a=this.viewer.getToolbar(!1);if(a){var b=a.getControl(g.TOOLBAR.MODELTOOLSID);b&&b.removeControl(this.markupToolButton)}this.markupToolButton=null}},f.onEditModeEnter=function(){h.logger.log("ENTER edit mode"),this.showToolsUi()},f.onEditModeLeave=function(){h.logger.log("LEAVE edit mode"),this.hideToolsUi()},f.onEditModeChange=function(a){if(this.domToolSelect&&!this.ignoreChangeEvent)for(var b=this.core.editMode,c=this.domToolSelect.options,d=0,e=c.length;d<e;d++){var f=c[d];if(f.value===b.type){this.domToolSelect.selectedIndex=d;break}}},f.onMarkupSelected=function(a){var b=a.markup,c=this.core.editMode;this.setStylesUi(c,b)},f.showToolsUi=function(){this.createToolsUi();var a=this.core.isNavigationAllowed();this.setControlVisibility(".lmv-markup-gui-enterNavMode",a,"inline-block"),this.exitNavigationMode(),this.domContent.style.display="block",this.viewer.container.appendChild(this.domRoot)},f.hideToolsUi=function(){this.domRoot&&this.domRoot.parentNode&&this.domRoot.parentNode.removeChild(this.domRoot)},f.createToolsUi=function(){function a(a,b){return['<option value="',b,'">',a,"</option>"].join("")}if(!this.domRoot){var b=['<div class="lmv-markup-gui-toolbar-content">','<button class="lmv-markup-gui-collapse-btn">&lt;-&gt;</button>','<button class="lmv-markup-editmode-done">Exit</button>','<div class="lmv-markup-gui-collapse-content">','<div class="lmv-markup-gui-editMode">','<button class="lmv-markup-gui-enterNavMode">Navigate</button>','<button class="lmv-markup-gui-undo">&#8617;</button>','<button class="lmv-markup-gui-redo">&#8618;</button>',"<br>",'<button class="lmv-markup-gui-delete">Delete</button>','<button class="lmv-markup-gui-duplicate">Duplicate</button>',"<br>",'<button class="lmv-markup-gui-cut">Cut</button>','<button class="lmv-markup-gui-copy">Copy</button>','<button class="lmv-markup-gui-paste">Paste</button>',"<br>","<span>Markup:</span>",'<select class="lmv-markup-tool-select">',a("Arrow",d.MARKUP_TYPE_ARROW),a("Rectangle",d.MARKUP_TYPE_RECTANGLE),a("Circle",d.MARKUP_TYPE_CIRCLE),a("Text",d.MARKUP_TYPE_TEXT),a("Cloud",d.MARKUP_TYPE_CLOUD),a("PolyLine",d.MARKUP_TYPE_POLYLINE),a("Polycloud",d.MARKUP_TYPE_POLYCLOUD),a("Freehand",d.MARKUP_TYPE_FREEHAND),"</select>","<br>",'<div class="lmv-markup-gui-style-options"></div>',"</div>",'<div class="lmv-markup-gui-navMode" style="display:none;">','<button class="lmv-markup-gui-exitNavMode">Back to Markup</button>',"</div>","</div>","</div>"].join("");this.domRoot=document.createElement("div"),this.domRoot.className="lmv-markup-gui-toolbar",this.domRoot.innerHTML=b,this.domContent=this.domRoot.querySelector(".lmv-markup-gui-collapse-content"),this.domToolSelect=this.domRoot.querySelector(".lmv-markup-tool-select"),this.domStylesRoot=this.domRoot.querySelector(".lmv-markup-gui-style-options"),this.hookEvent("click",".lmv-markup-gui-collapse-btn",this.onToggleCollapse.bind(this)),this.hookEvent("click",".lmv-markup-editmode-done",this.onEditModeDone.bind(this)),this.hookEvent("click",".lmv-markup-gui-enterNavMode",this.enterNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-exitNavMode",this.exitNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-undo",this.onUndoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-redo",this.onRedoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-delete",this.onDeleteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-cut",this.onCutClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-copy",this.onCopyClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-paste",this.onPasteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-duplicate",this.onDuplicateClick.bind(this)),this.hookEvent("change",".lmv-markup-tool-select",this.onSelectEditMode.bind(this)),this.hookEvent("change",".lmv-markup-gui-style-select",this.onStyleChange.bind(this)),this.setStylesUi(this.core.editMode)}},f.getEditModeClass=function(a){var b;switch(a){case d.MARKUP_TYPE_ARROW:b="EditModeArrow";break;case d.MARKUP_TYPE_RECTANGLE:b="EditModeRectangle";break;case d.MARKUP_TYPE_CIRCLE:b="EditModeCircle";break;case d.MARKUP_TYPE_TEXT:b="EditModeText";break;case d.MARKUP_TYPE_CLOUD:b="EditModeCloud";break;case d.MARKUP_TYPE_POLYLINE:b="EditModePolyline";break;case d.MARKUP_TYPE_POLYCLOUD:b="EditModePolycloud";break;case d.MARKUP_TYPE_FREEHAND:b="EditModeFreehand"}return b?new(0,d[b])(this.core):null},f.onToggleCollapse=function(){var a=this.domContent.style.display;this.domContent.style.display="none"===a?"block":"none"},f.onEditModeDone=function(){this.core.hide()},f.enterNavigationMode=function(){this.core.allowNavigation(!0),this.setControlVisibility(".lmv-markup-gui-editMode",!1),this.setControlVisibility(".lmv-markup-gui-navMode",!0)},f.exitNavigationMode=function(){this.core.allowNavigation(!1),this.setControlVisibility(".lmv-markup-gui-editMode",!0),this.setControlVisibility(".lmv-markup-gui-navMode",!1)},f.onUndoClick=function(){this.core.undo()},f.onRedoClick=function(){this.core.redo()},f.onDeleteClick=function(){var a=this.core.getSelection();a&&this.core.deleteMarkup(a)},f.onCutClick=function(){this.core.cut()},f.onCopyClick=function(){this.core.copy()},f.onPasteClick=function(){this.core.paste()},f.onDuplicateClick=function(){this.core.getSelection()&&(this.core.copy(),this.core.paste())},f.onSelectEditMode=function(a){var b=a.target.value,c=this.getEditModeClass(b);if(!c)return void h.error("Markup editMode not found for type: "+b);this.ignoreChangeEvent=!0,this.core.changeEditMode(c),this.ignoreChangeEvent=!1,this.setStylesUi(c),this.domToolSelect.blur()},f.onStyleChange=function(a){var b=a.target,c=b.options[b.selectedIndex],d=b.getAttribute("style-key"),e=b.getAttribute("value-type");b.blur();var f=this.core.getSelection(),g=f?f.getStyle():this.core.getStyle();g[d]=function(a,b){return"number"===b?Number(a):"boolean"===b?"true"===a:a}(c.value,e),this.core.setStyle(g)},f.setStylesUi=function(a,b){h.logger.log("set ui for "+a.type);var c=b?b.style:a.style,d=e.getStyleDefaultValues(c,this.core);this.domStylesRoot.innerHTML="";for(var f in d){var g=this.getUiForStyleKey(f,d[f],c[f]);this.domStylesRoot.appendChild(g)}},f.getUiForStyleKey=function(a,b,c){for(var d=b.default,e=[],f=b.values,g=0,h=f.length;g<h;++g){var i=['<option value="',f[g].value,'">',f[g].name,"</option>"].join("");e.push(i),this.valueEquals(f[g].value,c)&&(d=g)}var j=typeof f[0].value,k=document.createElement("div"),l=["<span>",a,"</span>",'<select class="lmv-markup-gui-style-select" style-key="',a,'" value-type="',j,'">',e.join(""),"</select>"].join("");return k.innerHTML=l,k.querySelector("select").selectedIndex=d,k},f.valueEquals=function(a,b){return a===b},f.setControlVisibility=function(a,b,c){var d=this.domRoot.querySelector(a);c||(c="block"),d.style.display=b?c:"none"},f.hookEvent=function(a,b,c){var d=function(a){this.matchesSelector(a.target,b)&&c(a)}.bind(this);this.domRoot.addEventListener(a,d),this.domEvents.push({str:a,handler:d})},f.unhookAllEvents=function(){var a=this.domRoot;this.domEvents.forEach(function(b){a.removeEventListener(b.str,b.handler)}),this.domEvents=[]},f.matchesSelector=function(a,b){return a.matches?a.matches(b):a.msMatchesSelector?a.msMatchesSelector(b):a.mozMatchesSelector?a.mozMatchesSelector(b):!!a.webkitMatchesSelector&&a.webkitMatchesSelector(b)},f.getStyleOptions=function(a){var b=a.getStyle();return c.getStyleDefaultValues(b,this.core)},c.MarkupsGui=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsGui",a)}(),function(){"use strict";var a=Autodesk.Viewing,b=AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"),c=function(b,c){a.Extension.call(this,b,c)};c.prototype=Object.create(a.Extension.prototype),c.prototype.constructor=c,c.prototype.load=function(){var c=this;this.tool=new b.BillboardTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.onExplodeBinded=this.onExplode.bind(this),this.onSectionBinded=this.onSection.bind(this),this.viewer.addEventListener(a.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.addEventListener(a.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.addEventListener(a.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.addEventListener(a.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.HOTKEYS_ID="Autodesk.Billboard.Hotkeys";var d=[{keycodes:[a.theHotkeyManager.KEYCODES.ENTER],onRelease:function(){if(c.tool)return c.tool.enterEditAnnotation()}}];return a.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,d),!0},c.prototype.unload=function(){return a.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.viewer.removeEventListener(a.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.removeEventListener(a.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.removeEventListener(a.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.removeEventListener(a.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.clearAnnotations(),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},c.prototype.isActive=function(){return this.tool.isActive()},c.prototype.enterEditMode=function(){return this.tool.isActive()||this.viewer.toolController.activateTool("billboard"),!0},c.prototype.leaveEditMode=function(){return this.tool.isActive()&&this.viewer.toolController.deactivateTool("billboard"),!0},c.prototype.generateData=function(){return this.tool.generateData()},c.prototype.loadData=function(a){this.tool.loadData(a)},c.prototype.showAnnotations=function(){this.tool&&this.tool.showAnnotations()},c.prototype.hideAnnotations=function(){this.tool&&this.tool.hideAnnotations()},c.prototype.clearAnnotations=function(){this.tool&&this.tool.clearAnnotations()},c.prototype.showNumberMarkers=function(){this.tool&&this.tool.showNumMarkers()},c.prototype.hideNumberMarkers=function(){this.tool&&this.tool.hideNumMarkers()},c.prototype.onExplode=function(a){1*a.scale==0?this.showNumberMarkers():(this.hideAnnotations(),this.hideNumberMarkers())},c.prototype.onSection=function(a){Array.isArray(a.planes)&&a.planes.length>0?(this.hideAnnotations(),this.hideNumberMarkers()):this.showNumberMarkers()},b.BillboardExtension=c,a.theExtensionManager.registerExtension("Autodesk.Billboard",c)}(),function(){"use strict";var a=Autodesk.Viewing,b=(Autodesk.Viewing.Private,AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"));a.ANNOTATION_CREATED_EVENT="annotationCreated",a.ANNOTATION_DELETED_EVENT="annotationDeleted";var c=function(b){a.ToolInterface.call(this),this.names=["billboard"];var c=this,d=!1,e=!1,f=!1,g=1,h=null,i=null,j=null,k=null,l=null;this.annotations=[],this.numMarkers=[],this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0},this.isActive=function(){return d},this.getCursor=function(){return"url(data:;base64,AAABAAEAGBgAAAEAIACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAAAkAABMLAAATCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABJAAAAtAAAAEkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMSEhL/sbGx/wAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEwgICP99fX3//////wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAdCAgI/3p6ev///////////wAAAP8AAADWAAAAqAAAAHwAAABJAAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQEBAT/AAAABAAAABMSEhL/hISE/////////////////+Li4v/W1tb/qKio/319ff9KSkr/EhIS/wAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP9kZGT/AAAAdAAAABMSEhL/sbGx//////////////////r6+v//////////////////////x8fH/3R0dP8dHR3/AAAARAAAAAAAAAAAAAAAAAAAADUzMzP/ra2t///////i4uL/VlZW/wQEBP8AAAD/MzMz/7m5uf///////////4qKiv9kZGT/hISE/7W1tf/t7e3///////////+tra3/MzMz/wAAADUAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/MzMz/wAAADEAAAAAAAAAUCkpKf+5ubn//////wAAAP8AAABmAAAAgwAAALQ4ODj/ioqK/+Li4v//////nZ2d/wAAAJwAAAAAAAAAAAAAAOzv7+///////2RkZP8AAACMAAAANQAAAAAAAAAJAAAAAAAAAFApKSn/ubm5/wAAALQAAAAAAAAAAAAAAAAAAAA1AAAAjGRkZP//////7+/v/wAAAOwAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/ODg4/wAAAP8ICAj/AAAAVwAAADUAAABQCwsL/////wD////U////1P///9T////U////AAcHB///////nZ2d/wAAAJwAAAAAAAAAAAAAADUzMzP/ra2t////////////7e3t/7W1tf+EhIT/VlZW/zMzM/8XFxf/FxcX/wAAAAAAAAD/AAAA/wAAAP8AAAD/AAAAADU1Nf+Ojo7/MzMz/wAAADUAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP/Hx8f/////////////////////////////////ZWVl/wAAAAT////UAAAA/wAAAP/////UAAAAAHFxcf8dHR3/AAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQSEhL/SkpK/319ff+oqKj/zMzM/+jo6P/6+vr/QEBA/wAAAAb////UAAAA/wAAAP/////UAAAAAAAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAASQAAAHwAAACoAAAAzAAAAOwAAAD5AAAA+wAAAAL////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAD////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAACMAAAA9gAAAIwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////UAAAA/wAAAP/////U////1P///9T////UAAAAAAAAAAAAAAD29vb2/0hISP8AAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/3R0dOr////UAAAA/wAAAP/////UdHR06gAAAP/////UAAAAAAAAAAAAAAD///////r6+v9OTk7/AAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP/////UAAAAAAAAAAAAAAD////////////6+vr/Tk5O/wAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////U////1P///9T////U////1P///9T////UAAAAAAAAAAAAAAD/////////////////+vr6/wAAAPkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAA/wAAAP8AAAD/AAAA+QAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD/8f8A/+H/AP/B/wD9gA8A8AADAOAAAQDAAAAAwEAAAMChwADAAhAAwAIQAOAAEQDwABMA/AAfAP/+HwAf8AMAD/ADAAfwAwAD8AMAA///AAP//wA=), auto"},this.activate=function(){d=!0,b.clearSelection(),this.showAnnotations()},this.deactivate=function(){d=!1,this.billboard&&(this.billboard.annotationEditing?(this.billboard.dragging=!1,this.billboard.textArea.value?this.billboard.acceptButton.click():this.billboard.cancelButton.click()):this.destroyBillboard()),this.hideAnnotations()},this.onCameraChange=function(){c.updateBillboard(),c.updateAnnotations(),c.highlightAnnotation()},this.project=function(a){var c=b.navigation.getCamera(),d=b.navigation.getScreenViewport(),e=(new THREE.Vector3).copy(a);return e.project(c),new THREE.Vector3(Math.round((e.x+1)/2*d.width),Math.round((1-e.y)/2*d.height),e.z)},this.unproject=function(a){var c=b.navigation.getCamera(),d=b.navigation.getScreenViewport(),e=new THREE.Vector3;return e.x=a.x/d.width*2-1,e.y=-(a.y/d.height*2-1),e.z=a.z,e.unproject(c),e},this.createBillboard=function(d,e){if(!f){f=!0,this.billboard=document.createElement("div"),this.billboard.className="billboard-container",b.container.appendChild(this.billboard);var g=new THREE.Vector3(0,0,0),h=g.x-d.x,i=g.y-d.y;this.billboard.deltaX=e?e.deltaX:h,this.billboard.deltaY=e?e.deltaY:i,this.setBillboardPosition(d,e),this.moveHandler(this.billboard),this.billboard.intersectPoint=d,this.billboard.show=!0,e&&(this.billboard.annotationEditing=!0);var j=this.billboard.textArea=document.createElement("TEXTAREA");j.className="billboard-textarea",this.billboard.appendChild(j),j.setAttribute("rows","4"),j.setAttribute("maxlength","140"),j.focus(),e&&(j.value=e.childNodes[0].innerHTML);var k=document.createElement("div");k.className="billboard-control",this.billboard.appendChild(k);var l=this.billboard.acceptButton=document.createElement("div");l.className="billboard-button-accept",l.setAttribute("data-i18n","Accept"),l.textContent=a.i18n.translate("Accept"),l.addEventListener("click",function(){if(!c.billboard.dragging&&c.billboard.childNodes[0].value){var a=c.billboard.childNodes[0].value,b=c.billboard.deltaX,f=c.billboard.deltaY;e?c.createAnnotation(d,a,b,f,e.id):c.createAnnotation(d,a,b,f),c.destroyBillboard()}},!1),k.appendChild(l),e||l.classList.add("billboard-button-accept-greyout"),j.addEventListener("input",function(){j.value?l.classList.remove("billboard-button-accept-greyout"):l.classList.add("billboard-button-accept-greyout")});var m=this.billboard.cancelButton=document.createElement("div");m.className="billboard-button-cancel";var n;n=e?"Delete":"Cancel",m.setAttribute("data-i18n",n),m.textContent=a.i18n.translate(n),m.addEventListener("click",function(){c.billboard.dragging||(c.destroyBillboard(),e&&(c.destroyNumMarker(e.id),b.fireEvent({type:a.ANNOTATION_DELETED_EVENT,data:e.commObj})))},!1),k.appendChild(m),
this.drawLeadLine(d,this.billboard),this.drawLeadPoint(d,this.billboard),b.utilities.setPivotPoint(d,!0,!0)}},this.destroyBillboard=function(){f=!1,b.impl.removeMultipleOverlays("billboard-line",this.billboard.line),b.impl.removeMultipleOverlays("billboard-point",this.billboard.point),b.container.removeChild(this.billboard),this.billboard=null},this.setBillboardPosition=function(a,b){var c;b?c=(new THREE.Vector3).copy(b.position):(c=(new THREE.Vector3).copy(a),c.x+=this.billboard.deltaX,c.y+=this.billboard.deltaY),this.billboard.position=c;var d=this.project(c);this.borderCheck(this.billboard,d),this.billboard.style.left=d.x+"px",this.billboard.style.top=d.y+"px"},this.updateBillboardPosition=function(){var a=this.project(this.billboard.position);this.borderCheck(this.billboard,a),this.billboard.style.left=a.x+"px",this.billboard.style.top=a.y+"px"},this.borderCheck=function(a,c){var d=b.navigation.getScreenViewport(),e=a.clientWidth,f=a.clientHeight;c.x<5&&(c.x=0),c.y<5&&(c.y=0),d.width-5<c.x+e&&(c.x=d.width-e),d.height-5<c.y+f&&(c.y=d.height-f)},this.createAnnotation=function(d,e,f,h,i){function j(){function a(){k.dragging?c.highlightAnnotation():k.classList.contains("billboard-annotation-highlight")?c.editAnnotation(d,k):c.highlightAnnotation(k)}var b,e=0;return function(){e++,1==e?b=setTimeout(function(){a(),e=0},250):(clearTimeout(b),e=0)}}var k=document.createElement("div");k.className="billboard-annotation",b.container.appendChild(k);var l=new THREE.Vector3(0,0,0);f=f||l.x-d.x,h=h||l.y-d.y,k.deltaX=f,k.deltaY=h,this.setAnnotationPosition(k,d),this.moveHandler(k),k.intersectPoint=d,k.show=!0,i?(k.id=i,this.annotations[i-1]=k):(k.id=g++,this.annotations.push(k),this.createNumMarker(k));var m=document.createElement("div");m.innerHTML=e,k.appendChild(m),this.drawLeadLine(d,k);var n={message:e,point3d:d},o=b.getExtension("Autodesk.Comments");(k.cPromise=o.createComment(n)).then(function(e){function f(){k.classList.contains("billboard-annotation-highlight")?c.editAnnotation(d,k):o.restoreComment(e,c.filter,!1)}k.commObj=e,k.addEventListener("click",j(),!1),k.addEventListener("dblclick",f,!1),a.isTouchDevice()&&Hammer(k).on("doubletap",f),b.fireEvent({type:a.ANNOTATION_CREATED_EVENT,data:e})},function(a){console.log("Create comments failed:"+a)})},this.destroyAnnotation=function(a){b.impl.removeMultipleOverlays("billboard-line",a.line),b.container.removeChild(a),this.annotations[a.id-1]=void 0},this.editAnnotation=function(a,b){f||(this.destroyAnnotation(b),this.createBillboard(a,b))},this.highlightAnnotation=function(a){for(var b=document.getElementsByClassName("billboard-annotation-highlight"),c=0;c<b.length;c++)b[c].classList.remove("billboard-annotation-highlight");a&&a.classList.add("billboard-annotation-highlight")},this.enterEditAnnotation=function(){for(var a=0;a<this.annotations.length;a++){var b=this.annotations[a];if(b&&b.classList.contains("billboard-annotation-highlight")){this.editAnnotation(b.intersectPoint,b);break}}},this.setAnnotationPosition=function(a,b){var c;f?c=(new THREE.Vector3).copy(this.billboard.position):(c=(new THREE.Vector3).copy(b),c.x+=a.deltaX,c.y+=a.deltaY),a.position=c;var d=this.project(c);a.style.left=d.x+"px",a.style.top=d.y+"px"},this.updateAnnotationPosition=function(a){var b=this.project(a.position);a.style.left=b.x+"px",a.style.top=b.y+"px"},this.drawLeadLine=function(a,b){b.line=[];var c=parseInt(b.style.left,10),d=parseInt(b.style.top,10)+b.childNodes[0].clientHeight,e=this.unproject(new THREE.Vector3(c,d,0));b.line.push(this.drawLine(a,e,2)),b.id?b.line.push(this.drawLine(a,e,1)):b.line.push(this.drawLine(a,e))},this.drawLine=function(a,c,d){h||(h=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1,depthWrite:!1}),i=new THREE.LineBasicMaterial({color:34181,linewidth:2,depthTest:!1,depthWrite:!1}),j=new THREE.LineBasicMaterial({color:16777215,linewidth:4,depthTest:!1,depthWrite:!1}),b.impl.createOverlayScene("billboard-line"));var e=new THREE.Geometry;e.vertices.push(a),e.vertices.push(c);var f;f=1==d?i:2==d?j:h;var g=new THREE.Line(e,f);return b.impl.addOverlay("billboard-line",g),g},this.drawLeadPoint=function(a,b){b.point=[],b.point.push(this.drawPoint(a,0)),b.point.push(this.drawPoint(a,1))},this.drawPoint=function(a,c){k||(k=new THREE.MeshBasicMaterial({color:0,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),l=new THREE.MeshBasicMaterial({color:16777215,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),b.impl.createOverlayScene("billboard-point"));var d=new THREE.Mesh(new THREE.SphereGeometry(1),c?k:l);return d.position.set(a.x,a.y,a.z),this.setPointScale(d,c?4:5),b.impl.addOverlay("billboard-point",d),d},this.setPointScale=function(a,b){var c=this.setScale(a,b);a.scale.x=c,a.scale.y=c,a.scale.z=c},this.setScale=function(a,c){var d=b.navigation,e=d.getCamera(),f=d.getEyeVector(),g=d.getPosition(),h=a.position.clone(),i=e.isPerspective?h.sub(g).dot(f.normalize()):d.getEyeVector().length(),j=d.getVerticalFov(),k=2*i*Math.tan(THREE.Math.degToRad(.5*j)),l=d.getScreenViewport(),m=window.devicePixelRatio||1;return c*k/(l.height*m)},this.createNumMarker=function(a){var d=document.createElement("div");d.className="billboard-marker",this.numMarkers.push(d),d.innerHTML=a.id,b.container.appendChild(d),d.position=a.intersectPoint,this.setNumMarkerPosition(d),d.id=a.id,d.addEventListener("click",function(){var a=c.annotations[this.id-1];a.show?c.hideAnnotation(a):c.showAnnotation(a)})},this.destroyNumMarker=function(a){b.container.removeChild(this.numMarkers[a-1]),this.numMarkers[a-1]=void 0},this.setNumMarkerPosition=function(a){var b=this.project(a.position);a.style.left=b.x-a.offsetWidth/2+"px",a.style.top=b.y-a.offsetHeight/2+"px"},this.updateBillboard=function(){this.billboard&&(this.updateBillboardPosition(),this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.updateAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&(this.updateAnnotationPosition(this.annotations[a]),this.updateLine(this.annotations[a]));for(var a=0;a<this.numMarkers.length;a++)this.numMarkers[a]&&this.setNumMarkerPosition(this.numMarkers[a])},this.updateLine=function(a){var c=a.line;if(b.impl.removeMultipleOverlays("billboard-line",c),a.show===!0){var d=a.intersectPoint;this.drawLeadLine(d,a)}},this.updatePoint=function(a){var c=a.point;b.impl.removeMultipleOverlays("billboard-point",c),a.show===!0&&this.drawLeadPoint(a.intersectPoint,a)},this.showBillboard=function(){this.billboard&&(this.billboard.show=!0,this.billboard.style.display="block",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.hideBillboard=function(){this.billboard&&(this.billboard.show=!1,this.billboard.style.display="none",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.showAnnotation=function(a){a.show=!0,a.style.display="block",this.updateLine(a)},this.showAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&this.showAnnotation(this.annotations[a])},this.hideAnnotation=function(a){a.show=!1,a.style.display="none",this.updateLine(a)},this.hideAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&this.hideAnnotation(this.annotations[a])},this.clearAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&(this.destroyNumMarker(this.annotations[a].id),this.destroyAnnotation(this.annotations[a]));g=1},this.generateData=function(){for(var a=[],c=b.getExtension("Autodesk.Comments"),d=0;d<this.annotations.length;d++)if(this.annotations[d]){var e=this.annotations[d].commObj,f=[this.annotations[d].deltaX,this.annotations[d].deltaY];c.factory.pushTag(e,{name:"textOffset",value:f}),a.push(e)}return a},this.loadData=function(a){for(var c=b.getExtension("Autodesk.Comments"),d=0;d<a.length;d++){c.factory.removeGlobalOffset(a[d]);var e=c.factory.getTagValue(a[d],"nodeOffset"),f=new THREE.Vector3(e[0],e[1],e[2]),g=c.factory.getTagValue(a[d],"textOffset");g?this.createAnnotation(f,a[d].body,g[0],g[1]):this.createAnnotation(f,a[d].body)}},this.showNumMarkers=function(){for(var a=0;a<this.numMarkers.length;a++)this.numMarkers[a]&&(this.numMarkers[a].style.visibility="visible")},this.hideNumMarkers=function(){for(var a=0;a<this.numMarkers.length;a++)this.numMarkers[a]&&(this.numMarkers[a].style.visibility="hidden")},this.moveHandler=function(a){function c(c){"touchmove"===c.type&&(c.screenX=c.touches[0].screenX,c.screenY=c.touches[0].screenY),l+=c.screenX-h,m+=c.screenY-i,f=j+l,g=k+m;var d=b.navigation.getScreenViewport(),e=a.clientWidth,o=a.clientHeight;f<5&&(f=0),g<5&&(g=0),d.width-5<f+e&&(f=d.width-e),d.height-5<g+o&&(g=d.height-o),a.style.left=f+"px",a.style.top=g+"px",n.updateLine(a),h=c.screenX,i=c.screenY,a.dragging=!0}function d(b){var e=n.project(a.intersectPoint),h=n.unproject(new THREE.Vector3(f,g,e.z));a.deltaX=h.x-a.intersectPoint.x,a.deltaY=h.y-a.intersectPoint.y,a.position.copy(h),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",d)}function e(b){"textarea"!==b.target.tagName.toLowerCase()&&("touchstart"===b.type&&(b.screenX=b.touches[0].screenX,b.screenY=b.touches[0].screenY),h=b.screenX,i=b.screenY,l=0,m=0,f=j=a.offsetLeft,g=k=a.offsetTop,a.dragging=!1,window.addEventListener("mousemove",c),window.addEventListener("mouseup",d),window.addEventListener("touchmove",c),window.addEventListener("touchend",d))}var f,g,h,i,j,k,l,m,n=this;a.addEventListener("mousedown",e),a.addEventListener("touchstart",e)},this.handleButtonDown=function(a,b){return e=!0,!1},this.handleButtonUp=function(a,b){return e=!1,!1},this.handleMouseMove=function(a){return!1},this.handleSingleClick=function(a,c){var d=b.impl.hitTest(a.canvasX,a.canvasY,!1);return d&&this.createBillboard(d.intersectPoint),!0},this.handleDoubleClick=function(a,b){return!0},this.handleSingleTap=function(a){return this.handleSingleClick(a)},this.handleDoubleTap=function(a){return!0},this.handleResize=function(){c.updateBillboard(),c.updateAnnotations(),c.highlightAnnotation()}};b.BillboardTool=c}(),function(){"use strict";var a=Autodesk.Viewing,b=a.UI,c=AutodeskNamespace("Autodesk.Viewing.Extensions.BillboardGui"),d=function(b,c){a.Extension.call(this,b,c)};d.populateDefaultOptions=function(a){a.experimental.push("--billboards")},d.prototype=Object.create(a.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){var a=this.viewer.getExtension("Autodesk.Billboard");return a||(this.viewer.loadExtension("Autodesk.Billboard"),a=this.viewer.getExtension("Autodesk.Billboard")),a?(this.core=a,this.viewer.toolbar?this.createToolbarUI():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)),!0):(avp.logger.warn("Missing dependency:","Autodesk.Billboard"),!1)},d.prototype.unload=function(){return this.destroyToolbarUI(),this.core=null,!0},d.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(a.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null,this.createToolbarUI()},d.prototype.createToolbarUI=function(){var c=this,d=this.viewer,e=d.getToolbar(!0);this.billboardToolButton=new b.Button("toolbar-billboardTool"),this.billboardToolButton.setToolTip("Billboard"),this.billboardToolButton.setIcon("adsk-icon-billboard"),this.billboardToolButton.onClick=function(a){var d=c.billboardToolButton.getState();d===b.Button.State.INACTIVE?(c.core.enterEditMode(),c.billboardToolButton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&(c.core.leaveEditMode(),c.billboardToolButton.setState(b.Button.State.INACTIVE))};var f=e.getControl(a.TOOLBAR.MODELTOOLSID);f&&f.addControl(this.billboardToolButton,{index:0})},d.prototype.destroyToolbarUI=function(){if(this.billboardToolButton){var b=this.viewer.getToolbar(!1);if(b){var c=b.getControl(a.TOOLBAR.MODELTOOLSID);c&&c.removeControl(this.billboardToolButton)}this.billboardToolButton=null}},c.BillboardGui=d,a.theExtensionManager.registerExtension("Autodesk.BillboardGui",d)}();var AutodeskNamespace=AutodeskNamespace||function(a){"use strict";var b="undefined"!=typeof window&&null!==window?window:self;return a.split(".").forEach(function(a){b[a]=b[a]||{},b=b[a]}),b};!function(){"use strict";function a(a){return a&&0!==a.length?a.replace(/^#?\?/,"").split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})}):null}function b(a){return"object"!=typeof a||null===a?a:(Object.getOwnPropertyNames&&Object.getOwnPropertyNames(a).forEach(function(c){var d=a[c];"object"!=typeof d||Object.isFrozen(d)||b(d)}),Object.freeze(a))}function c(a,b,c,d){function e(a,b){return function(){var b,d=null,e=null;4===f.readyState&&(b=f.status||a||-1,e=!f.response||"application/json"!==f.getResponseHeader("Content-Type")&&"json"!==f.responseType?f.response:JSON.parse(f.response),g[b]||(g[b]=!0,200!==b&&(d=f.status||a||"unknown error"),d?c(d,null):c(null,e)))}}if(c=c||function(){},!a||!b)return console.error("Invalid URL or Request Headers for the Query Service REST API"),void setTimeout(function(){c("Invalid URL or Request Headers for the Query Service REST API",null)},0);var f=new XMLHttpRequest;f.open("GET",a),Object.keys(b).forEach(function(a){void 0!==b[a]&&null!==b[a]&&f.setRequestHeader(a,b[a])});var g=[];f.onreadystatechange=e(),f.onload=e(),f.onerror=e(null,"Error"),f.ontimeout=e(null,"TimeOut"),f.onabort=e(null,"Abort"),f.timeout=d||N,f.send()}function d(){var a,b,c=+new Date;C&&D&&(b=c-R,R=c,document.hidden?(S+=b,a={documentVisibleDuration:b,totalDocumentVisibleDuration:S,totalDocumentNotVisibleDuration:T},u(C,D,"documentNotVisible",a)):(T+=b,a={documentNotVisibleDuration:b,totalDocumentVisibleDuration:S,totalDocumentNotVisibleDuration:T},u(C,D,"documentVisible",a)))}function e(){var a,b={},c=+new Date;C&&D&&(a=c-R,R=c,document.hidden?T+=a:S+=a,b={totalDocumentVisibleDuration:S,totalDocumentNotVisibleDuration:T},u(C,D,"documentUnloaded",b))}function f(a,b){C=a,D=b}function g(a){var b={};return b[U.TOKEN_HEADER_NAME]=a.token,b[U.AUTHORIZATION_HEADER_NAME]=a.oauth2Token?"Bearer "+a.oauth2Token:void 0,b[U.ANON_SESSION_HEADER_NAME]=a.token||a.oauth2Token?"false":"true",b[U.CLIENT_ID_HEADER_NAME]=a.clientId,b[U.CLIENT_FEATURE_ID_HEADER_NAME]=a.clientFeatureId,b[U.SESSION_ID_HEADER_NAME]=a.sessionId,b[U.EXTRA_USER_ID_HEADER_NAME]=a.userId,b[U.DEBUG_HEADER_NAME]=F,b[U.CONTENT_TYPE_HEADER_NAME]="application/json",b[U.ACCEPT_HEADER_NAME]="application/json",b}function h(a){var b=null;return a[U.AUTHORIZATION_HEADER_NAME]&&"apidev"!==L&&"apistg"!==L&&"apiprod"!==L&&(b="'"+U.AUTHORIZATION_HEADER_NAME+"' header for OAUTH2 not valid for "+L+" endpoint. Use one of apidev/apistg/apiprod endpoints."),!a[U.TOKEN_HEADER_NAME]||"apidev"!==L&&"apistg"!==L&&"apiprod"!==L||(b="'"+U.AUTHORIZATION_HEADER_NAME+"' header for OAUTH1 not valid for "+L+" endpoint."),a[U.TOKEN_HEADER_NAME]&&a[U.AUTHORIZATION_HEADER_NAME]&&(b="'"+U.AUTHORIZATION_HEADER_NAME+"' and '"+U.AUTHORIZATION_HEADER_NAME+"' headers can not coexist."),a[U.EXTRA_USER_ID_HEADER_NAME]&&!a[U.AUTHORIZATION_HEADER_NAME]&&(b="'"+U.AUTHORIZATION_HEADER_NAME+"' OAUTH2 header must be used w/ '"+U.EXTRA_USER_ID_HEADER_NAME+"' header."),a[U.CLIENT_ID_HEADER_NAME]||(b="'"+U.CLIENT_ID_HEADER_NAME+"' header is required for all requests."),a[U.CLIENT_FEATURE_ID_HEADER_NAME]||(b="'"+U.CLIENT_FEATURE_ID_HEADER_NAME+"'header is required for all requests."),"application/json"!==a[U.CONTENT_TYPE_HEADER_NAME]&&(b="'"+U.CONTENT_TYPE_HEADER_NAME+"' header must be application/json for all requests."),a[U.TOKEN_HEADER_NAME]||a[U.AUTHORIZATION_HEADER_NAME]||a[U.SESSION_ID_HEADER_NAME]&&a[U.ANON_SESSION_HEADER_NAME]||(b="'"+U.TOKEN_HEADER_NAME+"' or '"+U.AUTHORIZATION_HEADER_NAME+"' header needs to be a valid value or both '"+U.SESSION_ID_HEADER_NAME+"' and '"+U.ANON_SESSION_HEADER_NAME+"' header need to be specified."),b}function i(a){var b=null,c=null;return a||(b="queryParams: needs to be specified."),a.pid||0===a.pid||(b="queryParams.pid: needs to be a valid Profile Id."),a.pid.length<=0&&(b="queryParams.pid: Profile Id needs to be a string with length greater than zero."),a.query||(c="queryParams.query empty."),a.page&&(a.pageOffset||a.pageSize)&&(c="either queryParams.page or queryParams.pageOffset and queryParams.pageSize must be set."),a.page||a.pageOffset||a.pageSize||(c="queryParams.page, queryParams.pageOffset, queryParams.pageSize empty."),(a.page<0||a.page>100)&&(c="queryParams.page should be a positive integer between 1 and 100"),a.pageOffset<0&&(c="queryParams.pageOffset should be a positive integer greater than 1"),(a.pageSize<0||a.pageSize>100)&&(c="queryParams.pageSize should be a positive integer between 1 and 100"),void 0!==a.language&&""!==a.language&&"string"!=typeof a.language&&(c="queryParams.language should be a language identifier"),{err:b,warn:c}}function j(a,b){var c=a;return b.pid&&(c+="?pid="+b.pid),b.query&&(c+="&query="+encodeURIComponent(b.query)),b.language&&(c+="&language="+encodeURIComponent(b.language)),b.modifier&&(c+="&modifier="+encodeURIComponent(b.modifier)),b.filters&&(c+="&filters="+encodeURIComponent(b.filters)),b.sort&&"relevance"!==b.sort&&(c+="&sort="+encodeURIComponent(b.sort)),b.page&&1!==b.page&&(c+="&page="+encodeURIComponent(""+b.page)),b.pageOffset&&0!==b.pageOffset&&(c+="&offset="+encodeURIComponent(""+b.pageOffset)),b.pageSize&&0!==b.pageSize&&(c+="&pagesize="+encodeURIComponent(""+b.pageSize)),L!==J&&(c+="&env="+encodeURIComponent(L)),c=c.replace(/^\?&/,"?")}function k(a,b,c){return a.indexOf(V.escapeCharacter)===-1?a:a.split(b).join(c)}function l(a){return a=a||"",a=k(a,V.escapeCharacter,W.escapeCharacterEscSeq),a=k(a,V.arrayListItemDelimiter,W.arrayListItemDelimiterEscSeq),a=k(a,V.arrayListValueDelimiter,W.arrayListValueDelimiterEscSeq)}function m(a){return a.map(function(a){for(var b=a[0],c=1;c<a.length;c++)b+=V.arrayListValueDelimiter+a[c];return b}).join(V.arrayListItemDelimiter)}function n(a){return a.map(function(a){if(V.reservedArrayListFilterNames.indexOf(a[0])!==-1&&Array.isArray(a[1])){var b=m(a[1]);return l(a[0])+V.nameValueDelimiter+b}return l(a[0])+V.nameValueDelimiter+l(a[1])}).join(V.listItemDelimiter)}function o(a,b,c){if(!a||!b||!c)return[];for(var d=[],e="",f="",g=!1,h=0;h<a.length;h++)e=a[h],e===c?(g=!g,f+=e):e!==b||g?(f+=e,g=!1):(d.push(f),f="",g=!1);return f.length&&d.push(f),d}function p(a){return o(a,V.arrayListItemDelimiter,V.escapeCharacter).map(function(a){return o(a,V.arrayListValueDelimiter,V.escapeCharacter)})}function q(a){var b=[];return a.map(function(a){return V.reservedArrayListFilterNames.indexOf(a[0])!==-1?(b=p(a[1]),[a[0],b]):a})}function r(a){return a.map(function(a){return o(a,V.nameValueDelimiter,V.escapeCharacter)})}function s(a){return o(a,V.listItemDelimiter,V.escapeCharacter)}function t(a){return a&&a.length?q(r(s(a))):[]}function u(a,b,d,e,f){if(f&&"function"!=typeof f)throw new Error("Callback was not a function");f=f||function(){};var g=M+P.Log+"?queryId="+a+"&type="+encodeURIComponent(d)+"&sessionId="+(b.sessionId||"")+"&userId="+(b.userId||"")+"&clientId="+(b.clientId||"")+"&clientFeatureId="+(b.clientFeatureId||"")+"&body="+encodeURIComponent(JSON.stringify(e))+"&_n="+Math.floor(1e5*Math.random()),h=function(a,b){a&&console.debug("Logged(err:"+(a||"noerr")+" info:"+(b||"-")+"): "+g),f(a)},i={};i[U.CONTENT_TYPE_HEADER_NAME]="text/plain",c(g,i,h)}function v(a,b){var c,d;c={url:document&&document.location&&document.location.href,userAgent:navigator.userAgent,hardwareConcurrency:navigator.hardwareConcurrency,language:navigator.language,maxTouchPoints:navigator.maxTouchPoints,versionInfo:I,performance:null},H||(window&&window.performance?(d=w(),d.searchSDKTimings={fetchStartToSearchSDKLoaded:Q-d.timing.fetchStart,fetchStartToSearchSDKInstantiated:G-d.timing.fetchStart,fetchStartToNow:+new Date-d.timing.fetchStart},d.timingDelta={},d.timing&&(d.timingDelta.navigationStartToDomInteractive=d.timing.domInteractive-d.timing.navigationStart,d.timingDelta.dns=d.timing.domainLookupEnd-d.timing.domainLookupStart,d.timingDelta.htmlDownloadTime=d.timing.responseEnd-d.timing.responseStart,d.timingDelta.tcpConnectionSetup=d.timing.connectEnd-d.timing.connectStart,d.timing.secureConnectionStart&&(d.timingDelta.secureConnectionSetup=d.timing.connectEnd-d.timing.secureConnectionStart),Object.keys(d.timing).forEach(function(a){0!==d.timing[a]&&(d.timingDelta["fetchStartTo"+a[0].toUpperCase()+a.slice(1)]=d.timing[a]-d.timing.fetchStart)})),delete d.timing,c.performance=d):(c.performance={},c.noPerformance=!0),u(a,b,"performance",c)),H=!0}function w(){if(!window||!window.performance)return{};var a=function(a){return window.performance[a]?Object.keys(Object.getPrototypeOf(window.performance[a])).reduce(function(b,c){return window.performance[a][c]>=0&&(b[c]=window.performance[a][c]),b},{}):null};return Object.keys(Object.getPrototypeOf(window.performance)).reduce(function(b,c){return 0!==c.indexOf("onwebkit")&&window.performance[c]&&"object"==typeof window.performance[c]&&(b[c]=a(c)),b},{})}function x(a,b,c){var d,e;c&&(e="SERP",d=[].concat(c.queryResults||[],c.federatedResults||[]),d.forEach(function(c,d){A(c,d+1,a,b,e,"")}))}function y(a,b,c){var d;c&&(d="suggestions",(c.suggestionGroups||[]).forEach(function(c){var e=c.name;c.suggestions.forEach(function(c,f){A(c,f+1,a,b,d,e)})}),(c.textSuggestions||[]).forEach(function(c,e){z(c,e,a,b,d,"")}))}function z(a,b,c,d,e,f){a.logClick=function(){var g={position:b,url:"",querySource:e,subQuerySource:f};a.suggestion&&(g.title=a.suggestion),u(c,d,"click",g)}}function A(a,b,c,d,e,f){a.logClick=function(){var g={position:b,url:"",querySource:e,subQuerySource:f};a.searchResultId&&(g.id=a.searchResultId.id,g.sourceSystem=a.searchResultId.sourceSystem),a.url&&(g.url=a.url),u(c,d,"click",g)}}function B(d){L=d&&K.hasOwnProperty(d)?d:J,M=K[L];var e=this;this.getApiVersion=function(){return I.version},this.getServerMinRestApiVersion=function(){return I.minRestApiVersion},this.getBuildDate=function(){return I.buildDate},this.getBuildNumber=function(){return I.buildNumber},this.getServiceEnvironments=function(){return Object.keys(K)},this.getFilterConfig=function(){return V},this.filterStringToFilterArray=function(a){return t(a)},this.filterArrayToFilterString=function(a){return n(a)},this.getLanguageFromBcp47Code=function(a){return X[a]||"ENU"},this.sanitizeAndHighlightString=function(a,b,c){var d,e,f=!1;return a?(b=b||"<em class='highlight'>",c=c||"</em>",e=document.createElement("div"),e.textContent=a,d=e.innerHTML,d=d.replace(/[\uE000\uE001]/g,function(d,e,g){return""!==d||f?""===d&&f?(f=!1,c):void console.warn("Warning: Incorrect number of highlight tokens in string: "+a):(f=!0,b)}),f&&(d+=c,console.warn("Warning: Incorrect number of highlight tokens in string: "+a)),d):""},this.removeHighlightTokens=function(a){return a?a=a.replace(/[\uE000\uE001]/g,""):""},this.query=function(a,d,e){var k,l=i(a);if(l&&l.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+l),void setTimeout(function(){e("Invalid Query Parameters for the Query Service REST API - "+l.err,null)},0);l&&l.warn&&console.warn("Query Parameters for the Query Service REST API - "+l.warn),k=j(M+P.Query,a);var m=g(d),n=h(m);if(n)return console.error("Invalid Request Headers for the Query Service REST API - "+n),void setTimeout(function(){e("Invalid Request Headers for the Query Service REST API - "+n,null)},0);c(k,m,function(a,c){!a&&c&&(x(c.queryId,d,c),b(c),v(c.queryId,d),f(c.queryId,d)),e(a,c)})},this.findCategories=function(a,b,d){var e,f=i(a);if(f&&f.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+f),void setTimeout(function(){d("Invalid Query Parameters for the Query Service REST API - "+f.err,null)},0);f&&f.warn&&console.warn("Query Parameters for the Query Service REST API - "+f.warn),e=j(M+P.Categories,a);var k=g(b),l=h(k);if(l)return console.error("Invalid Request Headers for the Query Service REST API - "+l),void setTimeout(function(){d("Invalid Query Parameters for the Query Service REST API - "+l,null)},0);c(e,k,d)},this.suggestionTimeoutId=null,this.lastSentSuggestionNum=-1,this.lastDisplayedSuggestionNum=-1,this.suggest=function(a,b,d){var k=function(a,b,d){var k,l,m=i(a);if(m&&m.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+m),void setTimeout(function(){d("Invalid Query Parameters for the Query Service REST API - "+m.err,null)},0);m&&m.warn&&console.warn("Query Parameters for the Query Service REST API - "+m.warn),l=e.lastSentSuggestionNum+1,e.lastSentSuggestionNum=l,k=j(M+P.Suggestions,a);var n=g(b),o=h(n);if(o)return console.error("Invalid Request Headers for the Query Service REST API - "+o),void setTimeout(function(){d("Invalid Request Headers for the Query Service REST API - "+o,null)},0);c(k,n,function(a,c){if(l>e.lastDisplayedSuggestionNum)return e.lastDisplayedSuggestionNum=l,a||(y(c.queryId,b,c),v(c.queryId,b),f(c.queryId,b)),void d(a,c)})};clearTimeout(e.suggestionTimeoutId),e.suggestionTimeoutId=setTimeout(function(){k(a,b,d)},O)},this.logEvent=u,this.queryServiceInfo=function(a,b){var d=M+P.Health,e=g(a),f=h(e);if(f)return console.error("Invalid Request Headers for the Query Service REST API - "+f),void setTimeout(function(){b("Invalid Request Headers for the Query Service REST API - "+f,null)},0);c(d,e,function(a,c){var d,e,f=0,g=!1;if(d=I.minRestApiVersion.split(".").map(function(a){return parseFloat(a)}),!a&&c.versionInfo&&c.versionInfo.version){for(e=c.versionInfo.version.split(".").map(function(a){return parseFloat(a)});f<e.length||f<d.length;)g=g||(d[f]||0)>(e[f]||0),f+=1;g&&console.error("Error: Remote API version ("+c.versionInfo.version+") is older than required ("+I.minRestApiVersion+")")}b(a,c)})},this.queryParamsToUrl=function(a,b,c,d){var e;if(!b||!c||!c.pushState)return console.error("queryParamsToUrl() requres a History object in the urlLocation parameter such as window.history."),!1;e=new URL(b),e.search=new URL(j(M+P.Query,a)).search;try{c.pushState(null,"",e)}catch(a){document.location.hash=e.search}return!0},this.urlParametersToQueryParams=function(b){var c={pid:void 0,query:null,modifier:null,filters:"",sort:"",page:1,language:"",oauth2Token:null,env:null},d={pid:1},e={access_token:"oauth2Token",expires_in:"oauth2TokenExpiresIn"},f=new URL(b);return a((f.search||"").slice(1)+"&"+(f.hash||"").slice(1)).forEach(function(a){void 0===typeof c[a[0]]||d[a[0]]||(c[e[a[0]]||a[0]]=a[1])}),c}}var C,D,E=new AutodeskNamespace("Autodesk.Search"),F=F||!1,G=+new Date,H=!1,I=Object.freeze({version:"3.0.0-0",buildDate:"2016-08-02T16:22:43",buildNumber:"190",minRestApiVersion:"1.38.0"}),J="prod",K=Object.freeze({localdev:"http://search-localdev.api.autodesk.com:8080/qs",dev:"https://dev.search.api.autodesk.com/qs","dev-dr":"https://dev.search-dr.api.autodesk.com/qs",stg:"https://search-staging.api.autodesk.com/qs","stg-dr":"https://search-staging-dr.api.autodesk.com/qs",prod:"https://search.api.autodesk.com/qs","prod-dr":"https://search-dr.api.autodesk.com/qs",apidev:"https://developer-dev.api.autodesk.com/search",apistg:"https://developer-stg.api.autodesk.com/search",apiprod:"https://developer.api.autodesk.com/search"}),L=J,M=K[L],N=null,O=250,P=Object.freeze({Query:"/v3/search",Categories:"/v3/categories",Suggestions:"/v3/suggestions",Log:"/v2/log",Health:"/v2/health"}),Q=+new Date,R=+new Date,S=0,T=0;document.addEventListener&&document.addEventListener("visibilitychange",d,!1),window.addEventListener&&window.addEventListener("beforeunload",e,!1);var U=Object.freeze({TOKEN_HEADER_NAME:"x-ads-token",ANON_SESSION_HEADER_NAME:"x-ads-anon-session",CLIENT_ID_HEADER_NAME:"x-ads-client-id",CLIENT_FEATURE_ID_HEADER_NAME:"x-ads-client-feature-id",SESSION_ID_HEADER_NAME:"x-ads-session-id",DEBUG_HEADER_NAME:"x-ads-debug",EXTRA_USER_ID_HEADER_NAME:"x-ads-ex-user-id",CONTENT_TYPE_HEADER_NAME:"Content-Type",ACCEPT_HEADER_NAME:"Accept",AUTHORIZATION_HEADER_NAME:"Authorization"}),V=b({arrayListItemDelimiter:"'",arrayListValueDelimiter:"*",escapeCharacter:"\\",reservedArrayListFilterNames:["resourceIds"]}),W=b({arrayListItemDelimiterEscSeq:V.escapeCharacter+V.arrayListItemDelimiter,arrayListValueDelimiterEscSeq:V.escapeCharacter+V.arrayListValueDelimiter,escapeCharacterEscSeq:V.escapeCharacter+V.escapeCharacter}),X=b({"pt-BR":"PTB",cs:"CSY",en:"ENU","en-us":"ENU",fr:"FRA",de:"DEU",hu:"HUN",it:"ITA",ja:"JPN",ko:"KOR",pl:"PLK",ru:"RUS","zh-CN":"CHS",es:"ESP","es-ES":"ESP","zh-TW":"CHT"});B.prototype.constructor=B,E.SearchQueryAPI=B}(),function(){"use strict";var a=Autodesk.Viewing.Private,b=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),c=a.ENABLE_INLINE_WORKER||!1,d=a.LMV_WORKER_URL,e=function(){var a=d.indexOf(".min.js")>0;this.propertyWorkerUrl=a?"searchworker.min.js":"searchworker.js",this.propertyWorkerFetchingScript=!1,this.propertyWorkerDataUrl=null,this.propertyWorkerFetchingCbs=[]},f=e.prototype;f.initPropertyWorkerScript=function(b,d){var e=this;if(c&&!this.propertyWorkerDataUrl){if(this.propertyWorkerFetchingCbs.push({successCB:b}),this.propertyWorkerFetchingScript)return;var f=new XMLHttpRequest,g=this.propertyWorkerUrl,h=a.getResourceUrl(this.propertyWorkerUrl);h&&(g=h),f.open("GET",g,!0),f.withCredentials=!1,f.onload=function(){e.propertyWorkerFetchingScript=!1;var a;window.URL=window.URL||window.webkitURL;try{a=new Blob([f.responseText],{type:"application/javascript"})}catch(b){a=new BlobBuilder,a.append(f.responseText),a=a.getBlob()}e.propertyWorkerDataUrl=URL.createObjectURL(a);var b=e.propertyWorkerFetchingCbs.concat();e.propertyWorkerFetchingCbs=[];for(var c=0;c<b.length;++c)b[c].successCB&&b[c].successCB()},e.propertyWorkerFetchingScript=!0,f.send()}else b&&b()},f.initInViewerSearchWorkersScripts=function(a,b){this.initPropertyWorkerScript(a,b)},f.createPropertyWorker=function(){return c?new Worker(this.propertyWorkerDataUrl):new Worker(a.getResourceUrl(this.propertyWorkerUrl))},b.WorkerUtils=new e}(),function(){"use strict";function a(a,b,c){var d,e=a.viewer.model.is2d(),f=function(b,c){return a.isNodeVisible(b,c)};a.inViewerSearchThisView&&(d=function(b,c,d,e){a.highlightNodeInViewer(b,c,d,e,t)},a.inViewerSearchThisView.initialize(a.qsApiService,a.viewerProperties,b,e,a.thisViewDom||q,d,f,c),a.options.uiEnabled&&a.thisViewDom&&a.thisViewDom.addEventListener("click",function(b){var c=b.target.getAttribute("class");c&&c.includes("item-result")&&a.updateRecentSearches(a.inViewerSearchThisView.searchString)})),a.inViewerSearchThisItem&&!a.inViewerSearchThisItem.initialized&&(d=function(b,c,d,e){a.highlightNodeInViewer(b,c,d,e,u)},a.inViewerSearchThisItem.initialize(a.qsApiService,a.viewerProperties,b,a.thisItemDom||r,d,f,c,function(b){a.changeToThisViewTabAndSelectNode(b)}),a.options.uiEnabled&&a.thisItemDom&&a.thisItemDom.addEventListener("click",function(b){var c=b.target.getAttribute("class");c&&(c.includes("item-result")||c.includes("geometry-name"))&&a.updateRecentSearches(a.inViewerSearchThisItem.searchString)})),a.inViewerSearchThisProject&&(a.inViewerSearchThisProject.initialize(a.qsApiService,a.thisProjectDom||s),a.options.uiEnabled&&a.thisProjectDom&&a.thisProjectDom.addEventListener("click",function(b){var c=b.target.getAttribute("class");c&&(c.includes("item-result")||c.includes("category-name"))&&a.updateRecentSearches(a.inViewerSearchThisProject.searchString)}))}function b(a){var b=null;try{b=JSON.parse(a)}catch(a){console.error("JSON parse error: "+a)}return b}function c(a,b,c){var d=b.model.getDocumentNode(),e=d?b.model.getDocumentNode().parent:null;e?setTimeout(function(){c(e)},0):(a.noBubbleData=!0,a.inViewerSearchThisItem&&(delete a.inViewerSearchThisItem,a.inViewerSearchThisItem=null),o.logger.warn("InViewerSearch Extension: no ViewingApplication is being used so relatedItemsTab will not be visible"),setTimeout(function(){c(null)},0))}function d(a){var b
;a.options.uiEnabled&&a.searchToolButton&&a.inViewerSearchPanel&&(b=a.inViewerSearchPanel.isVisible(),a.searchToolButton.setState(b?n.Button.State.ACTIVE:n.Button.State.INACTIVE),a.searchToolButton.setToolTip(m.i18n.translate("Search")))}function e(b,e){var f=b.viewer,g=o.env,h=b.getCurrentGeometry(),i=m.getViewingUrl(),j=b.cacheObj.searchInfoThisItem;b.showingTabs=!1;var k=function(){var a;a=(!b.inViewerSearchThisView||b.inViewerSearchThisView.initialized)&&(!b.inViewerSearchThisItem||b.inViewerSearchThisItem.initialized),a?(b.initialized=!0,b.options.uiEnabled&&b.viewer&&b.viewer.getPropertyPanel&&(b.extensionViewer=b.viewer.getPropertyPanel(!0)),j||d(b),e(!0)):b.inViewerSearchThisView.initialized&&(j||d(b))};c(b,f,function(c){var d,e=[],f="";if(c&&(e=c.getRootNode().search({type:"geometry"}),f=c.findPropertyDbPath()),b.flatGUIDS=e,o.logger.debug("InViewerSearchExtension - has sharedPropertyDBPath: "+f),b.qsApiService){var j={count:{}};d=0,e.forEach(function(a){a.data&&(d+=a.data.size?a.data.size:0,a.data.role&&(j.count[a.data.role]=j.count[a.data.role]+1||1))}),j.size=d;var l=m.getGlobal(),n=l.LMV_VIEWER_VERSION+"."+l.LMV_VIEWER_PATCH;b.qsApiService.initialize(n,g,b.options.clientId,b.options.sessionId),b.qsApiService.logInitEvent(b.viewer.model.myData.urn,j,b.options,"")}b.viewerProperties&&!b.viewerProperties.initialized&&b.viewerProperties.initialize(b.viewer,b.noBubbleData,i,b.flatGUIDS,h,b.options.thresholdSearchMaxNodes,b.qsApiService,f),b.options.uiEnabled&&!b.initialized&&b.createTabs(),a(b,h,k)})}function f(a,b,c){var d=a.searchBarElem;b&&(d.value=b,a.uiSearch(c),a.updateRecentSearches(b))}function g(a,b){var c=document.createElement("li");return c.className="recent-item",c.appendChild(document.createTextNode(b)),c.addEventListener("click",function(){f(a,this.innerText)},!1),c}function h(a,b){var c,d,e,f;c=document.createElement("label"),c.className="recent-label",c.appendChild(document.createTextNode(m.i18n.translate("Recent Searches"))),d=document.createElement("ul"),d.className="recent-searches-list dockingPanelScroll",e=a.getRecentSearches(),e.forEach(function(b){d.appendChild(g(a,b))}),e.length<1&&(f=document.createElement("li"),f.className="recent-item empty-list",f.appendChild(document.createTextNode(m.i18n.translate("Recent Searches Empty"))),d.appendChild(f)),b.appendChild(c),b.appendChild(d)}function i(a,b){var c,d,e,f,g,h=[].slice.call(b.parentElement.children);if(a.enabled){h.forEach(function(a){a.classList.remove("selected")});var i=b.getAttribute("tabId");g=i===u?r:i===t?q:s,b.classList.add("selected"),a.selectedTab=b,a.qsApiService.logTabClickEvent(i),c=b.parentElement.parentElement.children[1],d=[].slice.call(c.children),g===q?(f=a.inViewerSearchThisView,a.highlightNodeInViewer(f.clicked,f.controller.searchResultIds,f.clicked,!1)):g===r&&(e=a.inViewerSearchThisItem,a.highlightNodeInViewer(e.selectedNodeId,e.currentGeoSearchedIds,e.selectedNodeId,!1)),d.forEach(function(a){a.id===g?a.classList.remove("hidden"):a.classList.add("hidden")})}}function j(a,b,c,d,e){var f,g;return f=document.createElement("div"),f.className="tab-item "+c,f.setAttribute("tabId",e),f.addEventListener("click",function(){i(a,this)},!1),g=document.createElement("label"),g.appendChild(document.createTextNode(d)),f.appendChild(g),f}function k(a,b){var c,d,e,f,g,h;h=0,c=document.createElement("div"),d=document.createElement("div"),d.className="tab-content",b.options.loadedModelTab.enabled&&b.inViewerSearchThisView&&(h++,c.appendChild(j(b,q,"this-view",b.options.loadedModelTab.displayName,t)),e=document.createElement("div"),e.id=q,e.className="tab-content-this-view hidden",b.thisViewDom=e,d.appendChild(e)),b.options.relatedItemsTab.enabled&&b.inViewerSearchThisItem&&(h++,c.appendChild(j(b,r,"this-item",b.options.relatedItemsTab.displayName,u)),f=document.createElement("div"),f.className="tab-content-this-item hidden",f.id=r,b.thisItemDom=f,d.appendChild(f)),b.options.serverSearchTab.enabled&&(h++,c.appendChild(j(b,s,"this-project",b.options.serverSearchTab.displayName,v)),g=document.createElement("div"),g.className="tab-content-this-project hidden",g.id=s,b.thisProjectDom=g,d.appendChild(g)),c.className="tab-items tabs-count-"+h,c.childNodes[0].classList.add("selected"),b.selectedTab=c.childNodes[0],d.childNodes[0].classList.remove("hidden"),a.appendChild(c),a.appendChild(d),b.tabContent=d}function l(a){var b=a.getCurrentGeometry(),c=a.viewer.model.is2d();a.options.uiEnabled&&a.viewer&&a.viewer.getPropertyPanel&&(a.extensionViewer=a.viewer.getPropertyPanel(!0)),a.viewerProperties.updateCurrentGeometry(b,function(d,e){var f=a.cacheObj.searchInfoThisItem.node;a.inViewerSearchThisView&&a.inViewerSearchThisView.updateCurrentGeometry(b,e,d,c,f,a.viewer),a.inViewerSearchThisItem&&a.inViewerSearchThisItem.updateCurrentGeometry(b,a.viewer),a.disabledPanel(!0)}),a.addToolbarUI(!0)}var m=Autodesk.Viewing,n=Autodesk.Viewing.UI,o=Autodesk.Viewing.Private,p=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),q="in-viewer-search-this-view",r="in-viewer-search-this-item",s="in-viewer-search-this-project",t="this-view-tab",u="this-item-tab",v="this-project-tab",w=null,x=null,y=Object.freeze({BACKSPACE:8,SPACE:32,ENTER:13});p.InViewerSearchMain=function(a,b,c){this.viewer=a,this.cacheObj=c,this.options=b,this.is2DMode=null,this.initialized=!1,this.toolbarTools=null,this.qsApiService=new p.QsApiService,this.viewerProperties=new p.ViewerPropertiesService(a),this.noBubbleData=!1,this.inViewerSearchPanel=null,this.inViewerSearchThisView=null,this.inViewerSearchThisItem=null,this.inViewerSearchThisProject=null,this.geometryLoadedCallback=null,this.tabsElem=null,this.searchBarElem=null,this.recentSearchesElem=null,this.saveLastQuery=null,this.recentSearches=null,this.flatGUIDS={},this.container=null,this.searchToolButton=null,this.showingTabs=!1,this.initCb=null,this.closeCallback=null,this.workersScriptsInitialized=!1,this.initWorkersScripts=null,this.thisProjectDom=null,this.thisItemDom=null,this.thisViewDom=null,this.extensionViewer=null,this.enabled=!0},p.InViewerSearchMain.prototype.constructor=p.InViewerSearchMain,p.InViewerSearchMain.prototype.load=function(){var a=this,b=this.viewer;if(!(this.options&&this.options.loadedModelTab&&this.options.relatedItemsTab&&this.options.serverSearchTab)||!(this.options.loadedModelTab.enabled||this.options.relatedItemsTab.enabled||this.options.serverSearchTab.enabled))return o.logger.log("InViewerSearch Extension - all search types disabled, nothing to do."),!1;p.WorkerUtils.initInViewerSearchWorkersScripts(function(){a.workersScriptsInitialized=!0,a.initWorkersScripts&&a.initWorkersScripts(),o.logger.info("InViewerSearch Extension: workers fetched.")},function(){o.logger.warn("InViewerSearch Extension: error fetching workers.")}),this.options.loadedModelTab.enabled&&!this.inViewerSearchThisView&&(this.inViewerSearchThisView=new p.InViewerSearchThisView(b,this.options)),this.options.relatedItemsTab.enabled&&!this.inViewerSearchThisItem&&(this.inViewerSearchThisItem=new p.InViewerSearchThisItem(b,this.options,this.cacheObj)),this.options.serverSearchTab.enabled&&!this.inViewerSearchThisProject&&(this.inViewerSearchThisProject=new p.InViewerSearchThisProject(this.options)),this.options.uiEnabled&&!this.inViewerSearchPanel&&(this.inViewerSearchPanel=new p.InViewerSearchPanel(b,"in-viewer-search","Search",this.options,this.qsApiService),this.container=this.inViewerSearchPanel.container,this.inViewerSearchPanel.addEventListener(this.inViewerSearchPanel.closer,"click",this.closeCallback)),this.options.uiEnabled&&!a.searchToolButton&&this.addToolbarUI(),this.onInitialized=function(b){b&&(a.initialized=!0,d(a),a.initCb&&a.initCb())},this.geometryLoadedCallback=function(){a.workersScriptsInitialized?e(a,a.onInitialized):a.initWorkersScripts=function(){e(a,a.onInitialized)}};var c=function(){b.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c),b.getObjectTree(function(){a.geometryLoadedCallback()},function(){o.logger.warn("InViewerSearch Extension - failed getObjectTree"),a.geometryLoadedCallback()})};return b.getObjectTree(function(){a.geometryLoadedCallback()},function(){if(b.model&&b.model.getData){var d=b.model.getData();d&&d.hasOwnProperty("hasObjectProperties")&&a.geometryLoadedCallback()}else b.addEventListener(m.GEOMETRY_LOADED_EVENT,c)}),!0},p.InViewerSearchMain.prototype.update=function(a,b,c){this.viewer=a,this.cacheObj=c,this.options=b;var d=this;this.container.classList.remove("hidden");var e=function(){d.viewer.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,f),l(d),d.cacheObj.inViewerSearch=null},f=function(){a.getObjectTree(function(){e()},function(){o.logger.warn("InViewerSearch Extension - failed getObjectTree"),e()})};return this.viewer.getObjectTree(function(){f()},function(){if(d.viewer.model&&d.viewer.model.getData){var a=d.viewer.model.getData();a&&a.hasOwnProperty("hasObjectProperties")&&f()}else d.viewer.addEventListener(m.GEOMETRY_LOADED_EVENT,f)}),!0},p.InViewerSearchMain.prototype.disabledPanel=function(a){this.container.classList.add("disabled"),a&&this.container.classList.remove("disabled"),this.enabled=a},p.InViewerSearchMain.prototype.addToolbarUI=function(a){var b,c=this,d=this.viewer;if(d.getToolbar){var e=d.getToolbar(!1);this.toolbarTools=e.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),b=new n.Button("toolbar-in-viewer-search"),b.setToolTip(m.i18n.translate("Search")),b.setIcon("adsk-button-icon-search"),a||(b.setToolTip(m.i18n.translate("Loading Search")),b.setState(n.Button.State.DISABLED)),b.addEventListener("click",function(){if(c.inViewerSearchPanel){var a=c.inViewerSearchPanel.isVisible();c.qsApiService.logGeneralEvent(a?"searchWindowClose":"searchWindowOpen"),c.inViewerSearchPanel.setVisible(!a),c.searchBarElem.focus()}},!1),b.addClass("in-viewer-search-button"),c.inViewerSearchPanel&&c.inViewerSearchPanel.addVisibilityListener(function(a){b.setState(a?n.Button.State.ACTIVE:n.Button.State.INACTIVE)}),c.searchToolButton=b,c.toolbarTools.addControl(b)}},p.InViewerSearchMain.prototype.unload=function(){if(this.cacheObj.searchInfoThisItem){this.cacheObj.inViewerSearch=this,this.viewer.getPropertyPanel()&&this.viewer.getPropertyPanel().setVisible(!1);var a=this.viewer.config.extensions;a&&a.indexOf("Autodesk.InViewerSearch")<0&&this.container.classList.add("hidden")}else this.initialized=!1,this.options.uiEnabled&&(this.closeSearch(),this.toolbarTools&&this.toolbarTools.removeControl(this.searchToolButton)),this.geometryLoadedCallback&&this.viewer.removeEventListener(m.GEOMETRY_LOADED_EVENT,this.geometryLoadedCallback),this.inViewerSearchThisView&&this.inViewerSearchThisView.initialized&&this.inViewerSearchThisView.uninitialize(),this.inViewerSearchThisItem&&this.inViewerSearchThisItem.initialized&&this.inViewerSearchThisItem.uninitialize(),this.inViewerSearchThisProject&&this.inViewerSearchThisProject.initialized&&this.inViewerSearchThisProject.uninitialize(),this.inViewerSearchPanel&&this.inViewerSearchPanel.uninitialize(),this.viewerProperties.uninitialize(),delete this.searchToolButton,delete this.inViewerSearchThisView,delete this.inViewerSearchThisItem,delete this.inViewerSearchThisProject,delete this.inViewerSearchPanel,delete this.qsApiService,delete this.viewerProperties;return!0},p.InViewerSearchMain.prototype.getRecentSearches=function(){return this.recentSearches||(this.recentSearches=b(window.localStorage.recentSearches||"[]")),this.recentSearches},p.InViewerSearchMain.prototype.updateRecentSearches=function(a){var b,c,d,e;a&&(b=this,this.recentSearches||this.getRecentSearches(),0!==(c=this.recentSearches.indexOf(a))&&(e=this.recentSearchesElem.children[1],c>0&&(this.recentSearches.splice(c,1),e.removeChild(e.childNodes[c]),c=-1),c<0&&(this.recentSearches=[a].concat(this.recentSearches.slice(0,20)),window.localStorage.recentSearches=JSON.stringify(this.recentSearches),b.options.uiEnabled&&(d=e.children[0],d.className.indexOf("empty-list")>=0&&d.parentNode.removeChild(d),e.insertBefore(g(b,a),e.childNodes[0])))))},p.InViewerSearchMain.prototype.highlightNodeInViewer=function(a,b,c,d,e){var f=this.selectedTab.getAttribute("tabId");if(!e||e===f){this.viewer.model.is2d();this.viewer.navigation.setRequestHomeView(!0),a?(this.viewer.isolate(a),this.viewer.select(a),c&&this.extensionViewer&&this.extensionViewer.container?this.extensionViewer.setVisible(!0):c||this.extensionViewer.setVisible(!1)):(b||(f===t?b=this.inViewerSearchThisView.controller.searchResultIds:f===u&&(b=this.inViewerSearchThisItem.currentGeoSearchedIds)),this.viewer.clearSelection(),this.viewer.isolate(b),this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!1)),d&&this.viewer.fitToView()}},p.InViewerSearchMain.prototype.closeSearch=function(){var a=this;a.hideTabs(),a.inViewerSearchThisView&&a.inViewerSearchThisView.clearSearch(),a.inViewerSearchThisItem&&a.inViewerSearchThisItem.clearSearch(),a.inViewerSearchThisProject&&a.inViewerSearchThisProject.clearSearch(),this.searchBarElem&&(this.searchBarElem.value=""),i(this,this.tabsElem.firstChild.firstChild)},p.InViewerSearchMain.prototype.createTabs=function(){if(this.inViewerSearchPanel&&this.inViewerSearchPanel.scrollContainer){var a,b,c,d=this,e=this.inViewerSearchPanel?this.inViewerSearchPanel.scrollContainer:null,f="onsearch"in document.documentElement;this.searchBarElem||(b=document.createElement("input"),b.className="in-viewer-search-bar",b.id="in-viewer-search-bar",b.type="search",this.options.searchDefaultText&&(b.placeholder=this.options.searchDefaultText),b.addEventListener("keyup",function(a){var c=a.target.value.trim(),e=a.which||a.keyCode;f||e!==y.ENTER?c&&c.length>=3?(e===y.BACKSPACE||e===y.SPACE||e>40&&e<128||e>185&&e<193||e>218&&e<223)&&(clearTimeout(x),x=setTimeout(function(){d.saveLastQuery=!1,d.uiSearch()},200)):d.hideTabs():b.onsearch(a)}),b.onsearch=function(a){var b=a.target.value.trim();clearTimeout(x),b?x=setTimeout(function(){d.saveLastQuery=!0,d.uiSearch()},200):d.hideTabs()},this.searchBarElem=b,a=document.createElement("div"),a.className="recent-searches",h(d,a),this.recentSearchesElem=a,c=document.createElement("div"),c.className="tabs-wrapper hidden",k(c,d),this.tabsElem=c,e&&(e.appendChild(b),this.searchBarElem.focus(),e.appendChild(a),e.appendChild(c)))}},p.InViewerSearchMain.prototype.search=function(a,b,c,d,e){var f=a.trim();f&&(this.qsApiService.generateQueryId(),this.inViewerSearchThisView&&(e||b)&&this.inViewerSearchThisView.search(f,w,b),this.inViewerSearchThisItem&&(e||c)&&this.inViewerSearchThisItem.search(f,c),this.inViewerSearchThisProject&&(e||d)&&this.inViewerSearchThisProject.search(f,d),this.saveLastQuery&&this.updateRecentSearches(f))},p.InViewerSearchMain.prototype.uiSearch=function(a){var b=this.searchBarElem,c=b.value.toLocaleLowerCase();w=a,c?(this.showTabs(),this.search(c,null,null,null,!0)):this.hideTabs()},p.InViewerSearchMain.prototype.showTabs=function(){var a,b;this.showingTabs||(a=this.tabsElem,a.classList.remove("hidden"),b=this.recentSearchesElem,b.classList.add("hidden"),this.showingTabs=!0)},p.InViewerSearchMain.prototype.changeToThisViewTabAndSelectNode=function(a){var b;this.options.loadedModelTab&&this.options.loadedModelTab.enabled&&(b=this.tabsElem,i(this,b.firstChild.firstChild),this.inViewerSearchThisView.selectNode(null,a,!0))},p.InViewerSearchMain.prototype.hideTabs=function(){this.showingTabs&&(this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!1),this.viewer.showAll(),this.viewer.clearSelection(),this.recentSearchesElem.classList.remove("hidden"),this.tabsElem.classList.add("hidden"),this.showingTabs=!1,this.searchBarElem.focus())},p.InViewerSearchMain.prototype.isNodeVisible=function(a,b){if(this.viewer.model&&this.viewer.model.getData()){var c=this.viewer.model.getData();if(this.viewer.model.is2d()){var d=c.fragments.dbId2fragId[a];this.viewer.model.isFragVisible(d)&&b()}else c&&c.instanceTree&&c.instanceTree.nodeAccess.enumNodeFragments(a,function(){b()})}},p.InViewerSearchMain.prototype.getCurrentGeometry=function(){return o.docItemId}}(),function(){"use strict";function a(a,b){var c=0,d=b.length;if(!a)return{message:"params object is missing, it should be an object with the fields categoryName, categoryModifier and page specify."};for(;c<d;){if(!a.hasOwnProperty(b[c]))return{message:b[c]+" is missing in params object."};c++}return null}var b=Autodesk.Viewing,c=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),d={searchDefaultText:"",uiEnabled:!0,clientId:"adsk.viewer.defaultClientId",sessionId:"adsk.viewer.defaultSessionId",thresholdSearchMaxNodes:5e4,loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},serverSearchTab:{enabled:!1,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20}},e=function(a,c){var e;b.Extension.call(this,a,c),this.initialized=!1,this.viewer=a,this.toolbarTools=null,c||(c={}),c.inViewerSearchConfig=c.inViewerSearchConfig||d,this.options=c.inViewerSearchConfig,this.options.thresholdSearchMaxNodes=this.options.thresholdSearchMaxNodes||d.thresholdSearchMaxNodes,e=Autodesk.Viewing.Private.GuiViewer3D&&a instanceof Autodesk.Viewing.Private.GuiViewer3D,this.options.uiEnabled=e&&(void 0===this.options.uiEnabled?d.uiEnabled:this.options.uiEnabled),this.options.serverSearchTab=this.options.serverSearchTab||d.serverSearchTab,this.options.relatedItemsTab=this.options.relatedItemsTab||d.relatedItemsTab,this.options.loadedModelTab=this.options.loadedModelTab||d.loadedModelTab,this.options.serverSearchTab.displayName=this.options.serverSearchTab.displayName||d.serverSearchTab.displayName,this.options.relatedItemsTab.displayName=this.options.relatedItemsTab.displayName||d.relatedItemsTab.displayName,this.options.loadedModelTab.displayName=this.options.loadedModelTab.displayName||d.loadedModelTab.displayName};e.populateDefaultOptions=function(a){a.inViewerSearchConfig={uiEnabled:!0,clientId:void 0,sessionId:void 0,serverSearchTab:{enabled:!0,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50}}},e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=c.InViewerSearchExtension,e.prototype.load=function(){return this.cache=this.getCache(),this.cache&&this.cache.inViewerSearch?this.inViewerSearchMain=this.cache.inViewerSearch:this.inViewerSearchMain=new c.InViewerSearchMain(this.viewer,this.options,this.getCache()),this.inViewerSearchMain&&this.cache&&this.cache.inViewerSearch?(this.cache.inViewerSearch=null,this.inViewerSearchMain.update(this.viewer,this.options,this.cache)):this.inViewerSearchMain.load(),!0},e.prototype.unload=function(){return this.inViewerSearchMain.unload(),this.cache&&this.cache.searchInfoThisItem?this.inViewerSearchMain.disabledPanel():(delete this.inViewerSearchMain,this.inViewerSearchMain=null,this.options.initialized=!1,this.options.inViewerSearchMain=null),!0},e.prototype.addInitListener=function(a){this.inViewerSearchMain&&this.inViewerSearchMain.initialized?setTimeout(function(){a()},0):this.inViewerSearchMain.initCb=a},e.prototype.searchModel=function(a,b,c){var d=a.trim(),e=this.inViewerSearchMain,f=null;return b&&b.page&&(f=b.page),d?e.inViewerSearchThisView?void(f&&1!==f?d!==e.inViewerSearchThisView.searchString?this.search(d,function(){e.inViewerSearchThisView.getPage(f,c)}):e.inViewerSearchThisView.getPage(f,c):e.inViewerSearchThisView.search(d,null,c)):void c({message:"Search model is not enabled."}):void c({message:"Nothing to search."})},e.prototype.searchDocument=function(a,b,c){var d,e,f=a.trim(),g=this.inViewerSearchMain,h=g.inViewerSearchThisItem;return b&&(d=b.page,e=b.geometryId),f?h?void(d&&1!==d?g.inViewerSearchThisItem.getPage(e,d,c):h.search(f,c)):void c({message:"Search document is not enabled."}):void c({message:"Nothing to search"})},e.prototype.queryService=function(b,c,d){var e,f=b.trim(),g=this.inViewerSearchMain;if(!f)return void d({message:"Nothing to search"});if(!g.inViewerSearchThisProject)return void d({message:"Server search is not enabled."});if(c&&Object.keys(c).length){var h=a(c,["categoryName","categoryModifier","page"]);if(h)return void d(h);if((e=c.page)<0)return void d({page:e,message:"Invalid page number, it must be a positive number."});g.inViewerSearchThisProject.getPage({name:c.categoryName,modifier:c.categoryModifier},e,d)}else g.inViewerSearchThisProject.search(f,d)},c.InViewerSearchExtension=e,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.InViewerSearch",e)}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");b.InViewerSearchPanel=function(b,c,d,e,f){var g=this;this.viewer=b,this.qsApiService=f,a.DockingPanel.call(this,b.container,c,d,e),this.container.classList.add("inViewerSearchPanel"),e=e||{},e.heightAdjustment||(e.heightAdjustment=40),e.marginTop||(e.marginTop=0),e.left=!0,this.createScrollContainer(e),this.options=e,this.selectedNodes=[],this.uiCreated=!1,this.addVisibilityListener(function(a){a&&(g.uiCreated||g.createUI(),g.resizeToContent())})},b.InViewerSearchPanel.prototype=Object.create(a.DockingPanel.prototype),b.InViewerSearchPanel.prototype.constructor=b.InViewerSearchPanel,b.InViewerSearchPanel.prototype.createUI=function(){},b.InViewerSearchPanel.prototype.addClass=function(a,b){return null!==this.tree&&this.tree.addClass(a,b)},b.InViewerSearchPanel.prototype.removeClass=function(a,b){return null!==this.tree&&this.tree.removeClass(a,b)},b.InViewerSearchPanel.prototype.initializeCloseHandler=function(a){var b=this;a.setAttribute("id","in-viewer-search-close"),b.addEventListener(a,"click",function(){b.setVisible(!1),b.qsApiService.logGeneralEvent("searchWindowClose")},!1)},a.InViewerSearchPanel=b.InViewerSearchPanel}(),function(){"use strict";function a(a){var b=[],c=[],d=0,e=a.controller;return e.resultCollection.getResultSetArray().forEach(function(f,g){var h=[],i=[];d=0,f.forEach(function(b){var c={dbId:b.dbId,fieldName:b.fieldName,fieldValue:b.fieldValue,nodeName:b.nodeName};h.push(c),d<a.limit&&(i.push(c),d++)});var j=e.resultCollection.getMetaInfo(g);b.push({id:j.guid,name:j.name,results:h,moreResults:f.length>a.limit}),c.push({id:j.guid,name:j.name,results:i,moreResults:h.length>a.limit})}),a.resultsCopy=b,{page:1,results:c,resultCount:e.resultCollection.getResultCount()}}function b(a,b,c,d){var e,f,g;if(b.displayName)e=b.displayName;else{if(!(f=b.nodeName)&&a.currentGeometry===d){var h=a.viewer.model.getData();h&&h.instanceTree&&(f=h.instanceTree.getNodeName(b.dbId))}f||(f=c.viewerProperties.defaultNodeName()),f.indexOf(c.searchedString)>=0||b.hasOwnProperty("fieldName")&&"Name"===b.fieldName?e=c.viewerProperties.highlightText(f,c.searchedString):(g="[object Number]"===Object.prototype.toString.call(b.fieldValue)?String(b.fieldValue):b.fieldValue,e=c.viewerProperties.highlightText(f)+" ("+c.viewerProperties.highlightText(b.fieldName)+": "+c.viewerProperties.highlightText(g,c.searchedString)+")")}return e}function c(a,c,d,e,f){var g,h=document.createElement("li"),i=a.controller;g=b(a,d,i,f),a.currentGeometry===f&&d.dbId===a.selectedNodeId&&(a.selectedNode=h),h.className="item-result dbId_"+d.dbId,h.innerHTML=g,h.setAttribute("adskSearchGeoGuid",f),h.setAttribute("adskSearchDbId",d.dbId),h.setAttribute("adskSearchIndex",e),c.appendChild(h)}function d(a,b,c){var d;b&&b.children.length&&(b.lastChild.className.contains("more-items")||(d=document.createElement("li"),d.className="item-result more-items",d.textContent=o.i18n.translate("Load More"),d.addEventListener("click",function(b){a.qsApi.logLoadMoreClickEvent(c,"thisItem"),a.loadMoreItems(c,b)},!1),b.appendChild(d)))}function e(a,b,d){var e,f,g=0,h=0,i=a.geoPages;if(e=document.createElement("ul"),e.className="geometry-result-list",f=Math.min(b.length,a.limit),i[d]=f,d===a.currentGeometry){var j=0,k={};h=b.length,b.forEach(function(b){a.isNodeVisible(b.dbId,function(){k.hasOwnProperty(b.dbId)||(k[b.dbId]=1,g++,a.currentGeomResults.push(b),j<f&&(a.currentGeoSearchedIds.push(b.dbId),c(a,e,b,j,d),i[d]=j+1),j++)})})}else b.slice(0,f).forEach(function(b,f){d===a.currentGeometry&&a.currentGeoSearchedIds.push(b.dbId),c(a,e,b,f,d)});return{resultListDom:e,countInvisible:h-g}}function f(a,b,c){var d;return d=document.createElement("label"),d.className="geometry-name",d.setAttribute("adskGeomId",b.guid),d.setAttribute("adskGeomIndex",c),d.addEventListener("click",function(b){var c=b.currentTarget.getAttribute("adskGeomId"),d=parseInt(b.currentTarget.getAttribute("adskGeomIndex"),10);a.qsApi.logResultGeomClickEvent(d+1,c,a.currentGeometry===c,"thisItem"),a.toggleGeometry(b)},!1),d.textContent=b.name,d}function g(a,b,c){var d;return d=document.createElement("div"),d.className="geometry-results geometry_"+b.guid,d.className=d.className+(c>3?" collapsed":""),b.guid===a.currentGeometry&&(d.classList.add("hidden"),d.setAttribute("adskCheckedForVisibleNodes",!0)),d}function h(a,b,c,d,h,i){var j,k,l,m,n=a.controller,o=d.guid;return l=e(a,c,o),m=l.resultListDom,k=f(a,d,h),j=g(a,d,n.geometriesCount),o===a.currentGeometry&&m.children.length>0&&j.className.indexOf("hidden")>=0&&j.classList.remove("hidden"),n.bruteSearch&&h<n.geometriesCount-1?b.insertBefore(j,b.childNodes[h]):b.appendChild(j),j.appendChild(k),j.appendChild(m),a.geometriesContainer[o]=j,i-=l.countInvisible}function i(a,b){var c,d,e;b&&(c=b.getAttribute("term"),d=b.getAttribute("ctx"),e=o.i18n.translate("Results Count"),e=e.split("{0}").join(a),e=e.split("{1}").join(c),e=e.split("{2}").join(d),b.textContent=e)}function j(a,b,c,e,f,g,j,k){var l,m,n,p,q=f.guid;b.textContent="",n=document.createElement("div"),n.id="result-count-this-item-wrapper",n.className="result-count",m=o.i18n.translate("Results Count").split("{0}").join(g).split("{1}").join(c).split("{2}").join(a.options.relatedItemsTab.displayName),l=document.createElement("span"),l.id="result-count-this-item",l.setAttribute("term",c),l.setAttribute("ctx",a.options.relatedItemsTab.displayName),l.textContent=m,a.resultCountDom=l,n.appendChild(l),b.appendChild(n),p=document.createElement("div"),p.className="geometries-results-container dockingPanelScroll",j||(p.className=p.className+" too-many-geometries"),b.appendChild(p);var r;g=h(a,p,e,f,k,g),a.geoPages[q]>=a.limit&&(r=a.geometriesContainer[q],e.length>a.geoPages[q]&&d(a,r.children[1],q)),a.controller.resultCollection.setResultCount(g),i(g,a.resultCountDom)}function k(a,b,e,f,g,j){var k,l,m,n,o,p=a.controller,q=f.guid;if(e&&e.length){if(a.geometriesContainer.hasOwnProperty(q)){if(a.geoPages[q]<a.limit)if(o=a.geometriesContainer[q],k=o.children[1],l=e.length,m=a.geoPages[q],n=0,m>0&&(n=m),l>a.limit?(a.geoPages[q]=a.limit,l=a.limit):a.geoPages[q]=a.geoPages[q]+(l-m),q===a.currentGeometry){var r=0,s={};e.forEach(function(b){g--,a.isNodeVisible(b.dbId,function(){s.hasOwnProperty(b.dbId)||(o.className.indexOf("hidden")>=0&&o.classList.remove("hidden"),s[b.dbId]=1,g++,a.currentGeomResults.push(b),n<=r&&r<l&&(a.currentGeoSearchedIds.push(b.dbId),c(a,k,b,r,q),a.geoPages[q]=r),r++)})})}else e.slice(n,l).forEach(function(b,d){c(a,k,b,d,q)})}else g=h(a,b,e,f,j,g);if(a.geoPages[q]>=a.limit){p.resultCollection.getResultSetLength(q)>a.geoPages[q]&&(o=a.geometriesContainer[q],d(a,o.children[1],q))}}a.controller.resultCollection.setResultCount(g),i(g,a.resultCountDom)}function l(a,b,c){a.innerHTML="";var d=document.createElement("p");d.className="no-results-this-item",d.textContent=o.i18n.translate("No Results").split("{0}").join(b).split("{1}").join(c),a.appendChild(d)}function m(a,b,c){function d(){var a=(new Date).getTime()-g;p.logger.log("Execution time INIT: "+a),b.logTimeEvent("initTime",a,"thisItem"),f.initialized=!0}function e(a,c){h=(new Date).getTime();var d=f.viewerProperties.areAllGeometriesLoaded();f.viewerProperties.bruteSearch(a,function(a,g,i,j){var k,l,m,n;f.lastSearchedString===a&&(f.resultCollection.setResultSetArray(g),f.searchInItemEnded=i,f.searchedString=a,f.geometriesCount++,f.bruteSearch=!0,m=new ResultCollection,e&&i&&(b.logSearchResponseTime("bruteSearchTime",a,(new Date).getTime()-h,"thisItem"),b.logSearchResults(f.resultCollection.getResultCount(),a,"bruteSearch","thisItem")),j?(n=g.getResultSetIndex(j),k=g.getResultSet(n),l=g.getMetaInfo(n),k&&m.setResultSet(l,k),c(m,d,i,j)):c(g,d,i,j))})}var f=this,g=null,h=null;f.initialized=!1,f.searchInItemEnded=!1,f.isBigModel=!1,f.bigAmountGeometries=!1,f.viewerProperties=a,f.searchedString="",f.lastSearchedString="",f.geometriesCount=0,f.bruteSearch=!1,f.resultCollection=new ResultCollection,f.initializeAttributes=function(a,b){f.initialized=!1,f.isBigModel?(p.logger.log("Using Brute Force in This Item"),d(),b()):(p.logger.log("Using Fullproof in This Item"),f.viewerProperties.getGeometriesAttributes(function(){d(),b()}))},f.initialize=function(a){g=(new Date).getTime();var b=function(b,c,e){if(f.loadingGeom=b,f.bigAmountGeometries=e,f.isBigModel=f.viewerProperties.hasTooManyNodes(),1===f.viewerProperties.getTotalCountGeometries())return d(),void a();c&&f.initializeAttributes(b,function(){e||a()}),e&&a()};f.viewerProperties.initPropertyDatabases(!c,b)},f.doSearch=function(a,c){if(f.resultCollection.resetResultCollection(),f.searchInItemEnded=!1,f.lastSearchedString=a,f.geometriesCount=0,f.bruteSearch=!1,f.isBigModel=f.viewerProperties.hasTooManyNodes(),f.isBigModel||!f.initialized)p.logger.log("Using Brute Force in This Item"),e(a,c);else{p.logger.log("Using Fullproof in This Item");var d=+new Date,g=f.viewerProperties.areAllGeometriesLoaded();f.viewerProperties.doSearch(a,function(a,e,h){f.lastSearchedString===a&&(f.resultCollection.copyResultCollection(e),f.searchInItemEnded=h,f.searchedString=a,f.geometriesCount=e.getResultSetArrayLength(),h&&(b.logSearchResponseTime("searchTime",a,new Date-d,"thisItem"),b.logSearchResults(f.resultCollection.getResultCount(),a,"fullproof-StringSearch","thisItem")),c(e,g,h))})}}}var n,o=Autodesk.Viewing,p=Autodesk.Viewing.Private,q=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");q.InViewerSearchThisItem=function(a,b,c){n=this,this.viewer=a,this.options=b,this.container=null,this.initialized=!1,this.controller=null,this.qsApi=null,this.searchString=null,this.geoPages={},this.currentGeometry=null,this.limit=b.relatedItemsTab.pageSize,this.clicked=null,this.cacheObj=c,this.loading=null,this.stillLoadingAlertElemId="this-item-loading-alert",this.stillLoadingAlertElem=null,this.geometriesContainer={},this.resultCountDom=null,this.currentGeoSearchedIds=[],this.selectedNode=null,this.selectedNodeId=null,this.highlightNodeInViewer=null,this.enabled=!0,this.isNodeVisible=null,this.currentGeomResults=[],this.listeners=[]},q.InViewerSearchThisItem.prototype.constructor=q.InViewerSearchThisItem,q.InViewerSearchThisItem.prototype.initialize=function(a,b,c,d,e,f,g){var h=this;this.qsApi=a,this.highlightNodeInViewer=e,this.currentGeometry=c,this.isNodeVisible=f,this.options.uiEnabled&&(this.container=d,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler)),this.controller=new m(b,a,this.options.loadedModelTab.enabled),this.controller.initialize(function(){h.initialized=!0,g(),h.listeners&&h.listeners.length&&(h.listeners.forEach(function(a){a()}),h.listeners=[])})},q.InViewerSearchThisItem.prototype.uninitialize=function(){this.options.uiEnabled&&this.container.removeEventListener("click",this.clickHandler),this.controller&&(this.controller=null)};var r=function(a){var b,c,d,e=a.target,f=!1;if(n.enabled){for(;e&&this.container!==e&&!f;)(f=e.hasAttribute("adskSearchDbId"))||(e=e.parentNode);f&&(b=e.getAttribute("adskSearchGeoGuid"),c=parseInt(e.getAttribute("adskSearchDbId"),10),
d=parseInt(e.getAttribute("adskSearchIndex"),10),"click"===a.type?n.currentGeometry===b?setTimeout(function(){n.qsApi.logResultClickEvent(d+1,c,!0,"thisItem"),n.selectNode(e,c)},0):n.loadGeometryInViewer(b,c,d,e):"dblclick"===a.type?n.currentGeometry===b&&setTimeout(function(){n.selectNode(e,c),n.viewer.fitToView()},0):a.type)}};q.InViewerSearchThisItem.prototype.clickHandler=function(a){a&&(n.mouseClickTimeout&&(clearTimeout(n.mouseClickTimeout),n.mouseClickTimeout=null),n.mouseClickTimeout=setTimeout(function(){r.call(n,a)},200))},q.InViewerSearchThisItem.prototype.selectNode=function(a,b){this.selectedNode&&(this.selectedNode.classList.remove("selected"),this.selectedNode=null),this.selectedNodeId===b?(this.selectedNodeId=null,this.selectedNode=null):(this.selectedNodeId=b,this.selectedNode=a,a.classList.add("selected")),this.highlightNodeInViewer(this.selectedNodeId,this.currentGeoSearchedIds,this.selectedNodeId,!1)},q.InViewerSearchThisItem.prototype.toggleLoadingMessage=function(a){var b,c=this.loading;a&&!c?(c=document.createElement("div"),c.className="loading this-item-loading",b=document.createElement("span"),b.textContent=o.i18n.translate("Loading"),c.appendChild(b),this.container.appendChild(c),this.loading=c):!a&&c&&(c.parentNode&&c.parentNode.removeChild(c),this.loading=null)},q.InViewerSearchThisItem.prototype.search=function(b,c){var d=this,e=(d.controller,b.trim());if(!this.initialized){var f=function(){d.search(b,c)};return void this.listeners.push(f)}this.clearSearch(),e&&(this.searchString=e,this.options.uiEnabled&&this.toggleLoadingMessage(!0),this.controller.doSearch(e,function(b,f,g,h){if(d.options.uiEnabled)d.showResults(e,b,f,h);else if(g){var i=a(d);c(i)}}))},q.InViewerSearchThisItem.prototype.loadGeometryInViewer=function(a,b,c,d){var e=this.cacheObj,f=this.controller,g=f.viewerProperties.getGeometry(a),h=g?g.data:{guid:a};this.selectedNode&&this.selectedNode.classList.remove("selected"),this.selectedNode=d,this.selectedNodeId=b,this.viewer.getPropertyPanel().setVisible(!1),this.qsApi.logResultClickEvent(c+1,b,!1,"thisItem"),e.searchInfoThisItem={node:b,str:this.searchString};var i=function(){p.logger.error("Error loading geometry")},j=function(){p.logger.log("success loading geometry")};this.enabled=!1,this.viewer.fireEvent({type:o.LOAD_GEOMETRY_EVENT,data:{item:h,onSuccessCb:j,onErrorCb:i}})},q.InViewerSearchThisItem.prototype.toggleGeometry=function(a){a.target.parentElement.className.indexOf("collapsed")===-1?a.target.parentElement.classList.add("collapsed"):a.target.parentElement.classList.remove("collapsed")},q.InViewerSearchThisItem.prototype.showResults=function(a,b,c,d){var e,f,g,h,i=this.controller,m=this,n=m.container,p=n.children.length>1,q=this.stillLoadingAlertElem,r=null;b&&b.getResultSetArrayLength()?(g=i.viewerProperties.getSortedGeometries(),i.viewerProperties.prepHighlighter(a),m.toggleLoadingMessage(!1),g.forEach(function(d){(e=b.getResultSetIndex(d.guid))>=0&&(f=i.resultCollection.getResultCount(),h=b.getResultSet(e),p?(r=n.children[1],k(m,r,h,d,f,e,i.bruteSearch)):(j(m,n,a,h,d,f,c,e,i.bruteSearch),p=!0))})):i.searchInItemEnded&&(m.toggleLoadingMessage(!1),l(n,a,m.options.relatedItemsTab.displayName)),c||!i.searchInItemEnded||q||(q=document.createElement("div"),q.id=m.stillLoadingAlertElemId,q.className="alert-geometries-loading",q.textContent=o.i18n.translate("Geometries Loading"),this.stillLoadingAlertElem=q,n.appendChild(q))},q.InViewerSearchThisItem.prototype.clearSearch=function(){this.container&&this.options.uiEnabled&&(this.container.innerHTML="",this.geometriesContainer={},this.stillLoadingAlertElem=null,this.resultCountDom=null,this.currentGeoSearchedIds=[]),this.geoPages={},this.currentGeomResults=[],this.toggleLoadingMessage(!1)},q.InViewerSearchThisItem.prototype.getPage=function(a,b,c){var d,e,f,g,h,i,j=this.controller,k=this;if(!this.initialized){var l=function(){k.getPage(a,b,c)};return void this.listeners.push(l)}if(b<1)return h={message:"Invalid page number, it must be a positive number."},void c(h);var m=k.limit*(b-1);if(g={id:"",name:"",results:[],moreResults:!1},a){if(!(d=k.resultsCopy[j.resultCollection.getResultSetIndex(a)]))return h={page:b,results:[],message:"The geometry "+a+" doesn't exists."},void c(h);e=d.results,f=e.slice(m,m+k.limit),g={id:d.guid,name:d.name,results:f,moreResults:e.length>m+k.limit},h={page:b,results:[g],resultCount:j.resultCollection.getResultCount()}}else i=k.resultsCopy.map(function(a){return{id:a.id,name:a.name,results:a.results.slice(m,m+k.limit),moreResults:a.results.length>m+k.limit}}),h={page:b,results:i,resultCount:j.resultCollection.getResultCount()};c(h)},q.InViewerSearchThisItem.prototype.loadMoreItems=function(a,b){var e,f,g,h,i,j=this.controller,k=this,l=k.geoPages[a],m=l;e=j.resultCollection.getResultSet(a),a===this.currentGeometry&&(e=k.currentGeomResults),f=e.slice(l,l+k.limit),k.geoPages[a]=k.geoPages[a]+k.limit,g=this.geometriesContainer[a],h=g.children[1],b.target.parentNode.removeChild(b.target),i=e.length>k.geoPages[a],f.forEach(function(b){k.currentGeoSearchedIds.push(b.dbId),c(k,h,b,m,a),m++}),i&&d(k,h,a),f.length&&k.highlightNodeInViewer(k.selectedNodeId,k.currentGeoSearchedIds,k.selectedNodeId,!1)},q.InViewerSearchThisItem.prototype.updateCurrentGeometry=function(a){var b=this.controller,e=this;this.currentGeometry=a;var f=this.selectedNodeId;this.geoPages[this.currentGeometry]=0;var g=b.resultCollection.getResultSet(this.currentGeometry),h=b.resultCollection.getResultCount();this.currentGeomResults=[],this.currentGeoSearchedIds=[];var j={},k=0,l=this.geometriesContainer[this.currentGeometry],m=!l.hasAttribute("adskCheckedForVisibleNodes");if(l&&m){var n=l.children[1];n.innerHTML="",g&&g.length&&g.forEach(function(a){h--,e.isNodeVisible(a.dbId,function(){j.hasOwnProperty(a.dbId)||(j[a.dbId]=1,h++,e.currentGeomResults.push(a),k<e.limit&&(e.currentGeoSearchedIds.push(a.dbId),c(e,n,a,k,e.currentGeometry),e.geoPages[e.currentGeometry]=k),k++)})}),e.currentGeomResults.length||l.classList.add("hidden"),l.setAttribute("adskCheckedForVisibleNodes",!0),console.log("count "+h),b.resultCollection.setResultCount(h),i(h,e.resultCountDom);e.currentGeomResults.length>e.limit&&d(e,n,this.currentGeometry),this.selectedNodeId=null,this.selectNode(this.selectedNode,f),this.enabled=!0}else this.selectedNodeId=null,this.selectNode(this.selectedNode,f),this.enabled=!0;this.cacheObj.searchInfoThisItem=null}}(),function(){"use strict";function a(a,b,c,d){var e=a;try{d?e=d(c):c.url&&(0===c.url.search(/^https?:\/\//i)?e=c.url:(e=b+"/"+c.url,e=e.replace(/([^:]\/)\/+/g,"$1")))}catch(a){e=null}return e||a}function b(a,b,c){var e,f;a.textContent="",f=document.createElement("p"),f.className="no-results-this-project",e=d.i18n.translate("No Results"),e=e.split("{0}").join(b),e=e.split("{1}").join(c),f.textContent=e,a.appendChild(f)}function c(a){function b(b,c){var d=[];b&&(b.forEach(function(b){var c;b.suggestionCount>0&&(c={modifier:b.modifier,name:b.displayName,categoryResults:[],moreItems:b.suggestionCount>3},b.suggestions.forEach(function(b){var d={name:a.sanitizeAndHighlightString(b.title,"<b>","</b>"),logClick:b.logClick,url:b.url,resultData:b};c.categoryResults.push(d)}),e.count=e.count+b.suggestionCount,d.push(c),e.categoriesIndex[c.name]=d.length-1)}),e.categories=d),c(e.categories)}function c(c,d,e){c?(a.logErrorEvent("Error getting suggestions: "+c,"in_viewer_search_this_project","handleResult","thisProject"),e([])):d&&d.suggestionGroups&&b(d.suggestionGroups,e)}function d(b,c,d){var f,h,i;b?(a.logErrorEvent("Error getting more item results: "+b,"in_viewer_search_this_project","loadMoreResults","thisProject"),d(b,null,null)):c&&c.queryResults&&(f=[],i=e.categories[e.categoriesIndex[g]].categoryResults,c.queryResults.forEach(function(b){var c={name:a.sanitizeAndHighlightString(b.title,"<b>","</b>"),logClick:b.logClick,url:b.url,resultData:b};f.push(c),i.push(c)}),h=c.queryResultCount>i.length,d(null,f,h))}var e=this,f={},g="",h={};e.categories=null,e.categoriesIndex={},e.count=0,e.projectResults=null,e.search=function(b,d,g,i,j,k){1===j&&(e.categories=null,e.count=0,h={}),f={query:d,sort:g,filters:i};var l=+new Date;a.search(b,d,g,i,j,function(b,e){a.logSearchResponseTime("searchTime",d,new Date-l,"thisProject"),c(b,e,k)},"thisProject")},e.uninitialize=function(){},e.getMoreResults=function(b,c,e,i,j){var k=2;g=c,c&&h.hasOwnProperty(c.name)&&(k=h[c.name]),j&&(k=j),a.getMoreResults(b,e,f.query,f.sort,f.filters,k,function(a,b){d(a,b,i)}),j||(h[c.name]=k+1)}}var d=Autodesk.Viewing,e=Autodesk.Viewing.Private,f=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");f.InViewerSearchThisProject=function(a){this.options=a,this.initialized=!1,this.controller=null,this.qsApi=null,this.container=null,this.contextMenu=null,this.urlCb=null,this.loadingId="this-project-loading",this.listeners=[],this.searchParams=null,a&&a.serverSearchTab&&a.serverSearchTab.parameters&&(this.searchParams=a.serverSearchTab.parameters),this.loadingElementDom=null,self.categoriesContainerDom=null},f.InViewerSearchThisProject.prototype.constructor=f.InViewerSearchThisProject,f.InViewerSearchThisProject.prototype.initialize=function(a,b){var d=this,f=+new Date;if(this.qsApi=a,!d.options||!d.options.serverSearchTab||!d.searchParams)return void e.logger.warn("Error initializing server search tab: missing options.");this.urlCb=d.searchParams.urlCallback,this.baseURL=d.searchParams.baseURL?d.searchParams.baseURL.replace(/\/$/g,""):"",this.fallbackURL=d.searchParams.fallbackURL,this.controller=new c(a),this.options.uiEnabled&&(this.container=b,window.addEventListener("click",function(){d.contextMenu&&d.contextMenu.classList.add("hidden")},!1)),a.logTimeEvent("initTime",new Date-f,"thisProject"),this.initialized=!0,this.listeners&&this.listeners.length&&(this.listeners.forEach(function(a){a()}),this.listeners=[])},f.InViewerSearchThisProject.prototype.uninitialize=function(){this.controller&&this.controller.uninitialize()},f.InViewerSearchThisProject.prototype.openMenu=function(b,c){var f,g,h,i=this.contextMenu,j=a(this.fallbackURL,this.baseURL,c,this.urlCb),k=this.container,l=k.getBoundingClientRect();c.logClick(),b.stopPropagation(),i.textContent="",j?(f=document.createElement("div"),f.className="menu-item open-another-window",f.innerHTML="<a href='"+j+"' target='_blank'>"+d.i18n.translate("Open Another Window")+"</a>",g=document.createElement("div"),g.className="menu-item open-this-window",g.innerHTML="<a href='"+j+"' target='_self'>"+d.i18n.translate("Open This Window")+"</a>",i.appendChild(f),i.appendChild(g),h=b.pageX-l.left+b.currentTarget.offsetLeft-10,h>195&&(h-=145),i.style.top=b.pageY-7+"px",i.style.left=h+"px",i.className=i.className.replace(" hidden","")):e.logger.warn("The url for "+c.name+" is empty")},f.InViewerSearchThisProject.prototype.toggleCategory=function(a){a.target.parentElement.className.indexOf("collapsed")===-1?a.target.parentElement.classList.add("collapsed"):a.target.parentElement.classList.remove("collapsed")},f.InViewerSearchThisProject.prototype.toggleLoadingMessage=function(a){var b=this.loadingElementDom;a&&!b?(b=document.createElement("div"),b.id=this.loadingId,b.className="loading",b.innerHTML="<span>"+d.i18n.translate("Loading")+"</span>",this.loadingElementDom=b,this.container.appendChild(b)):!a&&b&&(b.parentNode&&b.parentNode.removeChild(b),this.loadingElementDom=null)},f.InViewerSearchThisProject.prototype.loadMoreItems=function(a,b){var c=this,d=this.controller,e=a.target.parentElement;this.toggleLoadingMessage(!0),d.getMoreResults(this.searchParams.pid,b.name,b.modifier,function(b,d,f){var g;f||a.target.parentNode.removeChild(a.target),c.toggleLoadingMessage(!1),b||(d.forEach(function(a){var b=document.createElement("li");b.innerHTML=a.name,b.className="item-result",b.addEventListener("click",function(b){c.openMenu(b,a)},!1),f?e.insertBefore(b,e.childNodes[e.childElementCount-1]):e.appendChild(b)}),g=this.categoriesContainerDom,g.scrollTop=g.scrollTop+70)})},f.InViewerSearchThisProject.prototype.getPage=function(a,b,c){var d=this;if(!this.initialized){var e=function(){d.getPage(a,b,c)};return void this.listeners.push(e)}var f=this.controller;this.options.uiEnabled&&this.toggleLoadingMessage(!0),f.getMoreResults(this.searchParams.pid,a.name,a.modifier,function(a,d,e){c({page:b,results:d,resultsCount:f.count,moreItems:e,message:a})},b)},f.InViewerSearchThisProject.prototype.showResults=function(a,c){var e,f,g,h,i=this,j=this.container,k=this.controller;this.toggleLoadingMessage(!1),j.textContent="",i.qsApi.logSearchResults(k.count,a,"elasticsearch","thisProject"),k.count>0?(e=document.createElement("div"),e.className="result-count",f=d.i18n.translate("Results Count"),f=f.split("{0}").join(k.count),f=f.split("{1}").join(a),f=f.split("{2}").join(i.options.serverSearchTab.displayName),g=document.createElement("span"),g.id="result-count-this-project",g.textContent=f,e.appendChild(g),j.appendChild(e),h=document.createElement("div"),h.className="categories-results-container dockingPanelScroll",j.appendChild(h),i.categoriesContainerDom=h,i.contextMenu=document.createElement("div"),i.contextMenu.className="context-menu hidden",j.appendChild(i.contextMenu),c.forEach(function(a,b){var c,e,f,g;c=document.createElement("div"),c.id="category_"+a.name,c.className="category-results",e=document.createElement("label"),e.className="category-name",e.setAttribute("adskCatId",a.name),e.setAttribute("adskCatIndex",b.toString()),e.addEventListener("click",function(a){var b=a.currentTarget.getAttribute("adskCatId"),c=parseInt(a.currentTarget.getAttribute("adskCatIndex"),10);i.qsApi.logResultGeomClickEvent(c+1,b,!1,"thisProject"),i.toggleCategory(a)},!1),e.innerText=a.name,c.appendChild(e),f=document.createElement("ul"),f.className="category-result-list",[].slice.call(a.categoryResults).forEach(function(a,b){var c=document.createElement("li");c.className="item-result",c.innerHTML=a.name,c.setAttribute("adskItemId",a.url),c.setAttribute("adskItemIndex",b.toString()),c.addEventListener("click",function(b){var c=b.currentTarget.getAttribute("adskItemId"),d=parseInt(b.currentTarget.getAttribute("adskItemIndex"),10);i.qsApi.logResultClickEvent(d+1,c,!1,"thisProject"),i.openMenu(b,a)},!1),f.appendChild(c)}),a.moreItems&&(g=document.createElement("li"),g.className="more-items item-result",g.textContent=d.i18n.translate("Load More"),g.addEventListener("click",function(b){i.qsApi.logLoadMoreClickEvent(a.name,"thisProject"),i.loadMoreItems(b,a)},!1),f.appendChild(g)),c.appendChild(f),h.appendChild(c)})):b(j,a,i.options.serverSearchTab.displayName)},f.InViewerSearchThisProject.prototype.search=function(a,b){var c=this;if(!this.initialized){var d=function(){c.search(a,b)};return void this.listeners.push(d)}var e=this.controller,f=a.trim();if(this.clearSearch(),!this.searchParams.pid||!this.searchParams.filters)return void c.displayMessage("This feature has not been configured.");f&&(this.searchString=f,this.options.uiEnabled&&this.toggleLoadingMessage(!0),this.controller.search(this.searchParams.pid,f,"dateModifiedDescending",this.searchParams.filters,1,function(a){c.options.uiEnabled?c.showResults(f,a):b({page:1,results:a,resultCount:e.count})}))},f.InViewerSearchThisProject.prototype.displayMessage=function(a){var b,c;this.container&&this.options.uiEnabled&&(b=this.container,this.toggleLoadingMessage(!1),b.textContent="",c=document.createElement("p"),c.className="display-message",c.textContent=a,b.appendChild(c))},f.InViewerSearchThisProject.prototype.clearSearch=function(){var a;this.container&&this.options.uiEnabled&&(a=this.container,a.textContent="",this.toggleLoadingMessage(!1))}}(),function(){"use strict";function a(a){a.nodeNotVisibleAlert&&(a.viewer.container.removeChild(a.nodeNotVisibleAlert),a.nodeNotVisibleAlert=null,clearTimeout(a.nodeNotVisibleAlertTimer))}function b(a){a.noVisibleNodesAlert&&(a.viewer.container.removeChild(a.noVisibleNodesAlert),a.noVisibleNodesAlert=null,clearTimeout(a.noVisibleNodesAlertTimer))}function c(a,b,c,d){var e=document.createElement("li");e.innerHTML=b.displayNameSanitized,e.setAttribute("adskSearchDbId",b.dbId),e.setAttribute("adskSearchIndex",d),e.className="item-result dbId_"+b.dbId,a.highlightNode===b.dbId&&(a.selectedNode=e,e.className+=" selected",a.selectNode(e,b.dbId,!0)),a.resultsDom=e,c.appendChild(e)}function d(a,b,c){var d,e;a.textContent="",e=j.i18n.translate("No Results").split("{0}").join(b).split("{1}").join(c),d=document.createElement("p"),d.className="no-results-this-view",d.textContent=e,a.appendChild(d)}function e(a,b,c,d){var e,f,g;if(!(f=b.nodeName)){var h=a.viewer.model.getData();f=h&&h.instanceTree?h.instanceTree.getNodeName(b.dbId):c.viewerProperties.defaultNodeName(),b.nodeName=f}return f&&f.indexOf(d)>=0||b.hasOwnProperty("fieldName")&&"Name"===b.fieldName?g=c.viewerProperties.highlightText(f,d):b.hasOwnProperty("fieldName")&&b.hasOwnProperty("fieldValue")?(e="[object Number]"===Object.prototype.toString.call(b.fieldValue)?String(b.fieldValue):b.fieldValue,g=c.viewerProperties.highlightText(f)+" ("+c.viewerProperties.highlightText(b.fieldName)+": "+c.viewerProperties.highlightText(e,d)+")"):g=c.viewerProperties.highlightText(f),g}function f(a,b){var c,d,e,f;(f=b.resultCountDOM)&&(c=f.getAttribute("term"),d=f.getAttribute("ctx"),e=j.i18n.translate("Results Count"),e=e.split("{0}").join(a),e=e.split("{1}").join(c),e=e.split("{2}").join(d),f.textContent=e)}function g(a,b,d){var g,h,i,k,l,m=a.container,n=a.controller,o=d?d.length:0,p=a.limit,q=a.offset,r=q+p;o<p&&(r=q+o),o&&(a.options.uiEnabled&&(a.toggleLoadingMessage(!1),a.resultList||(m.textContent="",g=document.createElement("div"),g.className="result-count",h=document.createElement("span"),h.id="result-count-this-view",h.setAttribute("term",b),h.setAttribute("ctx",a.options.loadedModelTab.displayName),i=j.i18n.translate("Results Count"),h.textContent=i.split("{0}").join(o).split("{1}").join(b).split("{2}").join(a.options.loadedModelTab.displayName),a.resultCountDOM=h,g.appendChild(h),m.appendChild(g),a.resultList=document.createElement("ul"),a.resultList.className="search-result-list dockingPanelScroll",a.resultList.addEventListener("scroll",function(){this.scrollTop>a.scrollOffset&&(a.loadMoreResults(),a.scrollOffset=a.scrollOffset+a.limitScroll)}),m.appendChild(a.resultList))),n.viewerProperties.prepHighlighter(b),d.slice(q,o).forEach(function(d,f){d.hasOwnProperty("dbId")||(d={fieldName:d.name,fieldValue:d.value,dbId:d.id,nodeName:d.nodeName}),a.isNodeVisible(d.dbId,function(){n.searchedIds.hasOwnProperty(d.dbId)||(k=e(a,d,n,b),l={displayNameSanitized:k,dbId:d.dbId,fieldName:d.fieldName,fieldValue:d.fieldValue,nodeName:d.nodeName},n.resultSetArray.push(l),n.searchResultIds.push(d.dbId),n.searchedIds[d.dbId]=1,n.resultCount++,a.options.uiEnabled&&n.resultCount<=p&&q<r&&(c(a,l,a.resultList,f),q+=1))})}),a.offset=q,a.options.uiEnabled&&f(n.resultCount,a))}function h(a,b,c){function d(){var b=(new Date).getTime()-g;k.logger.log("Execution time INIT: "+b),a.logTimeEvent("initTime",b,"thisView"),f.initialized=!0}function e(b,c){var d=(new Date).getTime(),e=function(e){f.searchEnded=!0,a.logSearchResponseTime("bruteSearchTime",b,(new Date).getTime()-d,"thisView"),a.logSearchResults(e.length,b,"bruteSearch","thisView"),c(b,e,!0)},g=function(){f.searchEnded=!0,a.logErrorEvent("LMV search bruteForceSearch failed","in_viewer_search_this_view","bruteSearch","thisView"),c(b,null,!0)};f.viewerProperties.bruteSearchCurrent(b,e,g)}var f=this,g=null;f.initialized=!1,f.searchResultIds=[],f.searchedIds={},f.resultCount=0,f.resultSetArray=[],f.searchEnded=null,f.viewerProperties=b,f.isBigModel=!1,f.isSharedPropertyDb=!1,f.currentGeometry=c,f.initializeAllAttributes=function(a){g=(new Date).getTime(),f.isBigModel=f.viewerProperties.hasTooManyNodes(!0),f.currentGeometry||(f.isBigModel=!0),f.isBigModel?(k.logger.log("Using Brute Force in This View"),d(),a()):(k.logger.log("Using Fullproof in This View"),f.viewerProperties.getCurrentGeometryAttributes(function(){d(),a()}))},f.doSearch=function(b,c){var d;f.searchResultIds=[],f.searchedIds={},f.resultCount=0,f.resultSetArray=[],f.searchEnded=!1,f.isBigModel?e(b,c):(d=(new Date).getTime(),f.viewerProperties.doSearch(b,function(b,e,g){var h=[];e.getResultCount()&&e.hasResultSet(f.currentGeometry)&&(h=e.getResultSet(f.currentGeometry)),c(b,h,g),g&&(a.logSearchResponseTime("searchTime",b,(new Date).getTime()-d,"thisView"),a.logSearchResults(f.resultCount.length,b,"fullproof-StringSearch","thisView"))}))}}var i,j=Autodesk.Viewing,k=Autodesk.Viewing.Private,l=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");l.InViewerSearchThisView=function(a,b){i=this,this.options=b,this.viewer=a,this.container=null,this.initialized=!1,this.controller=null,this.resultList=null,this.clicked=null,this.is2DMode=null,this.qsApi=null,this.searchString=null,this.highlightNode=null,this.scrollOffset=500,this.limitScroll=200,this.limit=b.loadedModelTab.pageSize,this.offset=0,this.mouseClickTimeout=null,this.loadingId="this-view-loading",this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null,this.highlightNodeInViewer=null,this.fittedToView=!1,this.isNodeVisible=null,this.listeners=[]},l.InViewerSearchThisView.prototype.constructor=l.InViewerSearchThisView,l.InViewerSearchThisView.prototype.initialize=function(c,d,e,f,g,i,j,k){var l=this;this.qsApi=c,this.highlightNodeInViewer=i,this.is2DMode=f,this.isNodeVisible=j,this.options.uiEnabled&&(this.container=g,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler),this.container.addEventListener("hover",this.clickHandler),window.addEventListener("click",function(){a(l),b(l)},!1)),this.controller=new h(c,d,e),this.controller.initializeAllAttributes(function(){l.initialized=!0,k(),l.listeners&&l.listeners.length&&(l.listeners.forEach(function(a){a()}),l.listeners=[])})},l.InViewerSearchThisView.prototype.uninitialize=function(){this.options.uiEnabled&&(this.container.removeEventListener("click",this.clickHandler),this.container.removeEventListener("dblclick",this.clickHandler),this.container.removeEventListener("hover",this.clickHandler)),this.controller&&(this.controller=null)};var m=function(a){for(var b,c,d=a.target,e=!1;d&&this.container!==d&&!e;)(e=d.hasAttribute("adskSearchDbId"))||(d=d.parentNode);e&&(b=parseInt(d.getAttribute("adskSearchDbId"),10),c=parseInt(d.getAttribute("adskSearchIndex"),10),"click"===a.type?setTimeout(function(){i.showNodeProperties(a,b,c)},0):"dblclick"===a.type?setTimeout(function(){i.showNodeProperties(a,b,c,!0),i.viewer.fitToView()},0):"hover"===a.type&&i.viewer.impl.rolloverObjectNode(b))};l.InViewerSearchThisView.prototype.clickHandler=function(a){a&&(clearTimeout(i.mouseClickTimeout),i.mouseClickTimeout=setTimeout(function(){m.call(i,a)},200))},l.InViewerSearchThisView.prototype.search=function(a,b,c){var d=this;if(!this.initialized){var e=function(){d.search(a,b,c)};return void this.listeners.push(e)}var f=this.controller,h=a.trim();this.clearSearch(),h&&(this.searchString=h,d.resultList=null,this.options.uiEnabled&&(this.toggleLoadingMessage(!0),this.highlightNode=b),this.controller.doSearch(h,function(a,b,e){if(d.options.uiEnabled)d.showResults(a,b,e);else if(g(d,a,b),e){var h={page:1,results:f.resultSetArray.slice(0,d.limit),resultCount:f.resultCount,moreResults:f.resultCount>d.limit};c(h)}}))};var n=function(a,b){var c;c=a.selectedNode,c&&c.classList.remove("selected"),b&&(a.selectedNode=b,b&&b.classList.add("selected"))};l.InViewerSearchThisView.prototype.showNodeProperties=function(a,b,c,d){var e=this;this.qsApi.logResultClickEvent(c+1,b,!0,"thisView"),this.clicked===b?(this.clicked=null,this.highlightNodeInViewer(null,this.controller.searchResultIds,!!d,!1),d?n(e,a.target):n(e,null)):this.selectNode(a.target,b,!1)},l.InViewerSearchThisView.prototype.selectNode=function(a,b,c){var d,e,f,g=this,h=!1,i=this.controller;if(this.clicked=b,!a&&this.container.children.length>1)for(e=this.container.children[1].children,length=e.length,d=0,f="/\bdbId_"+b+"\b/";!h&&d<length;)e[d].className.match(f)&&(h=!0,a=e[d]),d++;this.highlightNodeInViewer(this.clicked,this.controller.searchResultIds,!0,!1),n(g,a),c&&a&&a.parentNode&&(a.parentNode.scrollTop=a.offsetTop),a||(i.searchResultIds.length?i.searchResultIds.indexOf(b)<0&&(this.clicked=null,this.showAlertNodeNotVisible()):(this.clicked=null,this.showAlertNoVisibleNodes()))},l.InViewerSearchThisView.prototype.clearSearch=function(){this.offset=0,this.scrollOffset=500,this.limitScroll=200,this.clicked=null,this.selectedNode=null,this.highlightNode=null,this.options.uiEnabled&&(this.container&&(this.container.textContent=""),this.controller&&this.controller.searchResultIds&&this.controller.searchResultIds.length>0&&(this.toggleLoadingMessage(!1),this.controller.searchResultIds=[],this.controller.resultSetArray=[],this.controller.resultCount=0,this.resultList=null),this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null,this.resultList=null)},l.InViewerSearchThisView.prototype.toggleLoadingMessage=function(a){var b=this.loadingDom;a&&!b?(b=document.createElement("div"),b.id=this.loadingId,b.className="loading",b.textContent=j.i18n.translate("Loading"),this.loadingDom=b,this.container.appendChild(b)):b&&(b.parentNode&&b.parentNode.removeChild(b),this.loadingDom=null)},l.InViewerSearchThisView.prototype.loadMoreResults=function(){var a,b,d=this.controller,e=this,f=this.offset,g=d.resultCount;if(g>f){for(a=f+e.limit,b=f;b<a;b++)g>b&&c(e,d.resultSetArray[b],e.resultList,b);e.offset=f+e.limit}},l.InViewerSearchThisView.prototype.getPage=function(a,b){var c=this;if(!this.initialized){var d=function(){c.getPage(a,b)};return void this.listeners.push(d)}var e,f,g=this.controller;if(a<1)return f={page:a,message:"Invalid page number, it must be a positive number.",moreResults:!1},void b(f);var h=c.limit*(a-1);if(g.resultCount<h)return f={page:a,results:[],resultCount:g.resultCount,moreResults:!1,message:"That page doesn't exists."},void b(f);e=g.resultSetArray.slice(h,h+c.limit),f={page:a,results:e,resultCount:g.resultCount,moreResults:g.resultCount>h+c.limit},b(f)},l.InViewerSearchThisView.prototype.showAlertNodeNotVisible=function(){var b=this;this.nodeNotVisibleAlert=document.createElement("div"),this.nodeNotVisibleAlert.className="alert-node-not-visible",this.nodeNotVisibleAlert.textContent=j.i18n.translate("Selected Node Result Not Visible"),this.viewer.container.appendChild(this.nodeNotVisibleAlert),this.nodeNotVisibleAlertTimer=setTimeout(function(){a(b)},7e3)},l.InViewerSearchThisView.prototype.showAlertNoVisibleNodes=function(){var a=this;this.noVisibleNodesAlert=document.createElement("div"),this.noVisibleNodesAlert.className="alert-no-visible-nodes",this.noVisibleNodesAlert.textContent=j.i18n.translate("No Visible Node Results For Geometry"),this.viewer.container.appendChild(this.noVisibleNodesAlert),this.noVisibleNodesAlertTimer=setTimeout(function(){b(a)},7e3)},l.InViewerSearchThisView.prototype.showResults=function(a,b,c){var e=this,f=this.controller,h=e.container;g(e,a,b),c&&(f.resultCount<1||!e.resultList.childNodes.length)&&(e.toggleLoadingMessage(!1),d(h,a,e.options.loadedModelTab.displayName)),c&&e.highlightNode&&(f.searchedIds.hasOwnProperty(e.highlightNode)||this.selectNode(null,e.highlightNode,!1)),f.searchResultIds&&f.searchResultIds.length&&this.highlightNodeInViewer(e.highlightNode,null,e.highlightNode,!1),c&&(f.searchedIds={}),f.searchEnded=c},l.InViewerSearchThisView.prototype.updateCurrentGeometry=function(a,b,c,d,e){var f=this.controller;this.clearSearch(),this.is2DMode=d,this.highlightNode=e;var g=f.viewerProperties.hasTooManyNodes(!0);f.isBigModel&&!g&&(f.initialized=!1,f.viewerProperties.getCurrentGeometryAttributes(function(){f.initialized=!0})),f.currentGeometry=a,f.searchResultIds=[],f.searchedIds={},f.resultCount=0,f.resultSetArray=[];var h=[];b&&b.hasResultSet(a)&&(h=b.getResultSet(a)),this.showResults(c,h,!0)}}(),function(){"use strict";function a(a){return l?(l.indexOf("autodesk")>=0?(i.token=null,i.oauth2Token=d.token.accessToken):(i.token=d.token.getAccessToken?d.token.getAccessToken():null,i.oauth2Token=null),a&&(i.clientFeatureId=f+(a?"."+a:"")),i):i}function b(a){a&&d.logger.log("InViewerSearch Extension: recieved "+a)}function c(){var a=!!window.chrome&&!!window.chrome.webstore;if(a)return"Chrome";var b=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;if(b)return"Opera";if("undefined"!=typeof InstallTrigger)return"Firefox";if(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0)return"Safari";var c=!!document.documentMode;return c?"Internet Explorer":c||!window.StyleMedia?!a&&!b||!window.CSS?"Unknown":"Blink":"Edge"}var d=Autodesk.Viewing.Private,e=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),f="adsk.viewer";e.QsApiService=function(){this.qsAPI=null};var g=e.QsApiService.prototype,h={pid:"",query:"",sort:"",page:1,filters:"",language:"ENU",modifier:null},i={},j=null,k=null,l=null,m=null,n=Object.freeze({development:"apidev",staging:"apistg",production:"apiprod",autodeskstaging:"apistg",autodeskdevelopment:"apidev",autodeskproduction:"apiprod"});g.initialize=function(a,b,c,d){i={token:null,oauth2Token:null,clientId:c,sessionId:d,clientFeatureId:""},m=a,l=b.toLowerCase(),this.qsAPI=new Autodesk.Search.SearchQueryAPI(n[l])},g.generateQueryId=function(){var a=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(a+=performance.now()),k="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)})},g.search=function(b,c,e,f,g,i,k){this.qsAPI||d.logger.log("InViewerSearch Extension: QsApi not initialized"),j=c,h.pid=b,h.page=g,h.query=c,h.sort=e,h.filters=f;var l=a(k);this.qsAPI.suggest(h,l,i)},g.getMoreResults=function(b,c,e,f,g,i,k){this.qsAPI||d.logger.log("InViewerSearch Extension: QsApi not initialized"),j=e,h.pid=b,h.page=i,h.query=e,h.sort=f,h.filters=g,h.modifier=c;var l=a();this.qsAPI.query(h,l,k)},g.logEvent=function(a,c,d){this.qsAPI&&this.qsAPI.logEvent(k,c,a,d,b)},g.logInitEvent=function(b,d,e,f){var g={viewerVersion:m,id:b,modelInfo:d,url:window.location.href,browser:c(),userAgent:window.navigator.userAgent,options:e},h=a(f);this.logEvent("inViewer.initialization",h,g)},g.logGeneralEvent=function(b,c){var d="inViewer."+b,e=a(c);this.logEvent(d,e,"")},g.logTimeEvent=function(b,c,d){var e="inViewer."+b,f={};f[b+"DurationMs"]=c;var g=a(d);this.logEvent(e,g,f)},g.logSearchResponseTime=function(b,c,d,e){var f="inViewer."+b,g={queryString:c};g[b+"DurationMs"]=d;var h=a(e);this.logEvent(f,h,g)},g.logSearchResults=function(b,c,d,e){var f={resultCount:b,queryString:c,algorithm:d},g=a(e);this.logEvent("inViewer.searchResults",g,f)},g.logTabClickEvent=function(b){var c=a(b);this.logEvent("inViewer.tabClick",c,null)},g.logResultClickEvent=function(a,b,c,d){this.logResultComponentClickEvent("inViewer.resultClick",a,b,c,d)},g.logResultGeomClickEvent=function(a,b,c,d){this.logResultComponentClickEvent("inViewer.resultGeomClick",a,b,c,d)},g.logResultComponentClickEvent=function(b,c,d,e,f){var g={position:c,nodeId:d,clickedCurrentGeometry:e},h=a(f);this.logEvent(b,h,g)},g.logLoadMoreClickEvent=function(b,c){var d={id:b},e=a(c);this.logEvent("inViewer.loadMoreClick",e,d)},g.logErrorEvent=function(b,c,d,e){var f={file:c,method:d,querySource:"inViewer",message:b},g=a(e);this.logEvent("inViewer.error",g,f)},g.sanitizeAndHighlightString=function(a,b,c){return this.qsAPI.sanitizeAndHighlightString(a,b,c)}}(),function(){"use strict";function a(a){var b=null;return a?([].slice.call(a).forEach(function(a){b||(b=a.urn())&&(b=b.substr(0,b.lastIndexOf("/")+1),b.indexOf("output/Resource")>0&&(b=b.substr(0,b.lastIndexOf("Resource")+9)))}),
b||h.logger.warn("InViewerSearch Extension: No URN found for geometry")):h.logger.warn("InViewerSearch Extension: No URN to retrieve from in getUrnFromChildren()"),b}function b(a,b){var c=a.name.toUpperCase(),d=b.name.toUpperCase();return c<d?-1:c>d?1:0}function c(a){if(!a.model)return 0;var b=a.model.getData();return b.instanceTree&&b.instanceTree.objectCount?b.instanceTree.objectCount:b.instanceTree&&b.instanceTree.children?b.instanceTree.children.length:0}function d(a){return a.replace(B,"\\$&")}function e(a,b,c){var d,e=new Uint16Array(a),f=e.length,g=[];if(f){var h="",i=Math.pow(2,16)-1;for(d=0;d<f;d+=i)d+i>f&&(i=f-d),h+=String.fromCharCode.apply(null,e.subarray(d,d+i));g=JSON.parse(h),g?b&&b(g):c&&c("buffer was invalid")}return g}function f(a){var b,c=new ResultCollection,d=a.meta?a.meta:null,f=a.resultSetIndex,g=a.results?a.results:null;return d&&Object.keys(d),Object.keys(f).forEach(function(a){b=f[a],c.setResultSet({guid:d[b].guid,name:d[b].name},e(g[b]))}),c}var g=Autodesk.Viewing,h=Autodesk.Viewing.Private,i=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");i.ViewerPropertiesService=function(){this.worker=void 0,this.viewerpropertiesworker=void 0,this.initialized=!1,this.viewer=null,this.isGeometry=!1,this.isSearchInProgress=!1,this.isSearchInProgressTimer=null,this.searchingString="",this.cbSecond=null};var j,k,l,m=i.ViewerPropertiesService.prototype,n={},o=null,p=null,q=null,r=0,s=null,t=0,u=null,v=!1,w={},x=!1,y=null,z=null,A=[],B=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,C=0;m.uninitialize=function(){void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,self.viewerpropertiesworker=void 0),this.initialized=!1},m.initialize=function(a,b,c,d,e,f,k,l){if(this.viewer=a,s=k,b)void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,this.viewerpropertiesworker=void 0);else{n={};var m=this.viewer.model.myData.acmSessionId;p=d,o=e,p.forEach(function(a){a.data.guid===o&&(q=a)}),t=0,u=l,v=!!u,r=d.length,h.logger.info("Number of geometries: "+r);var x=g.isNodeJS?null:"domain="+encodeURIComponent(window.location.origin);w={url:"",itemUrl:g.getItemApi(),headers:{},basePath:a.model.myData.basePath,auth:!0,viewing_url:c,queryParams:x+(m&&x?"&":"")+(m?"acmsession="+m:"")},j=f,void 0===this.viewerpropertiesworker?(this.worker=i.WorkerUtils.createPropertyWorker(),this.viewerpropertiesworker=this.worker):this.worker=this.viewerpropertiesworker,this.worker.postMessage({operation:"SET_DEBUG",enable:h.ENABLE_DEBUG,level:h.logger.level})}this.initialized=!0},m.getSortedGeometries=function(){if(A&&A.length)return A;var a=[];return p.forEach(function(b){a.push(b.data)}),A=a.sort(b)},m.initPropertyDatabases=function(b,c){var d,e=this,f=[],g=0;(l=b)||(g=1);var i=function(a){var b=a.data;if(!b.assetRequest)switch(b.operation){case"PROP_DB_CREATED":h.logger.log("Received PROP_DB_CREATED for "+b.guid+" containing "+b.objCount+" nodes"),(l||b.guid!==o)&&(t++,n[b.guid].objCount=b.objCount,t===C&&e.worker.removeEventListener("message",i),c(n,t===C,!1));break;case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":h.logger.info("Indexing is still on going and brute force search is in progress");break;case"GEOMETRIES_ATTR_ERR":case"GEOMETRY_ATTR_ERR":case"GEOMETRIES_ATTR_OK":case"GEOMETRY_ATTR_OK":h.logger.info("Indexing is still on going");break;default:h.logger.warn("Received unexpected event, "+b.operation+", for "+b.str)}};u?(p.forEach(function(a){d=a.data.guid,t<300&&(n.hasOwnProperty(d)||(n[d]={geometry:a.data,hasSharedProperties:!0,objCount:0,propdb_loaded:!0}),t++,C++)}),c(n,r>1,!1)):(p.forEach(function(b){var c,d=b.data.guid;(l||d!==o)&&g<300&&(n.hasOwnProperty(d)||(n[d]={geometry:b.data},c=a(b.children),f.push({urn:c,geo:b.data}),g++))}),C=f.length,C?(e.worker.addEventListener("message",i),e.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:f,context:w})):c(n,!0,!1))},m.initSharedPropertyDatabase=function(a){var b=this,c="_sharedPropertyDatabase_",d=function(e){var f=e.data;if(!f.assetRequest)switch(f.operation){case"PROP_DB_CREATED":h.logger.log("Received PROP_DB_CREATED for "+f.guid+" containing "+f.objCount),f.guid===c&&(n[c].objCount=f.objCount,n[c].loading=!1,b.worker.removeEventListener("message",d),n[c].sharedDbInit&&n[c].sharedDbInit(),a());break;default:h.logger.warn("Received unexpected event, "+f.operation+", for "+f.str)}};n.hasOwnProperty(c)?n[c].loading?n[c].sharedDbInit=a:a():(n[c]={isShared:!0,loading:!0},n[o]={isShared:!0,geometry:q.data},b.worker.addEventListener("message",d),b.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:u,geo:{guid:c}}],context:w}))},m.initCurrentPropertyDatabase=function(b,c){var d,e,f=this;if(u)this.initSharedPropertyDatabase(function(){var a=q;n.hasOwnProperty(b)||(n[b]={geometry:a.data,hasSharedProperties:!0,objCount:0,propdb_loaded:!0}),c()});else{var g=function(a){var b=a.data;if(!b.assetRequest)switch(b.operation){case"PROP_DB_CREATED":n[b.guid].objCount=b.objCount,b.guid===o&&(t++,C++,f.worker.removeEventListener("message",g),c());break;default:h.logger.warn("An unexpected message was received: "+b.operation)}};n.hasOwnProperty(b)?c():(d=q||{},n[o]={geometry:d.data,propdb_loaded:!0},e=a(d.children),f.worker.addEventListener("message",g),f.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:e,geo:d.data}],context:w}))}},m.getCurrentGeometryAttributes=function(a){var b=this;n.hasOwnProperty(o)&&n[o].propdb_loaded||this.initCurrentPropertyDatabase(o,function(){b.getGeometryAttributes(o,function(){a()})})},m.getGeometryAttributes=function(a,b){var c=this,d=function(e){var f=e.data;switch(f.operation){case"GEOMETRY_ATTR_OK":c.worker.removeEventListener("message",d),b();break;case"GEOMETRY_ATTR_ERR":c.worker.removeEventListener("message",d),h.logger.warn("InViewerSearch Extension: No attributes found for: "+a),b();break;default:h.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(f.operation||"")+" Error: "+(f.error||"")+" Place: "+(f.place||"")+" Method: "+(f.method||""))}};this.worker.addEventListener("message",d),this.worker.postMessage({operation:"GEOMETRY_ATTR",guid:a,sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v})},m.getGeometriesAttributes=function(a){var b=this,c=function(d){var e=d.data;switch(e.operation){case"GEOMETRIES_ATTR_OK":a(),b.worker.removeEventListener("message",c);break;case"GEOMETRIES_ATTR_ERR":h.logger.info("InViewerSearch Extension: No attributes found for: "+e.geometry.guid),e.ended&&(a(),b.worker.removeEventListener("message",c));break;default:h.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(e.operation||"")+" Error: "+(e.error||"")+" Place: "+(e.place||"")+" Method: "+(e.method||""))}};!l&&v?a({},v,!0):(this.worker.addEventListener("message",c),this.worker.postMessage({operation:"GEOMETRIES_ATTR",sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v,loadAll:l}))},m.getGeometry=function(a){var b=null;return p.forEach(function(c){c.data.guid===a&&(b=c)}),b},m.orderGeometriesByName=function(a){var b=[];return this.getSortedGeometries().forEach(function(c){a.hasResultSet(c.guid)&&b.push(a.getResultSetArray(c.guid))}),b},m.getTotalCountGeometries=function(){return r>300?300:r},m.areMoreGeometriesToLoad=function(){return r>300},m.areAllGeometriesLoaded=function(){return t===C},m.updateCurrentGeometry=function(a,b){o=a;var c=this,d=function(a){var e,g=a.data;switch(g.operation){case"UPDATE_CURRENT_OK":c.worker.removeEventListener("message",d),e=f(g),b(g.str,e,g.ended);break;default:h.logger.warn("Received unexpected event, "+g.operation+", for "+g.str)}};this.worker.addEventListener("message",d),this.worker.postMessage({operation:"UPDATE_CURRENT",current:o})},m.hasTooManyNodes=function(a){var b=c(this.viewer);if(!v&&!a){if(this.getTotalCountGeometries()>100)return!0;Object.keys(n).forEach(function(a){a!==o&&n[a].objCount&&(b+=n[a].objCount)})}return h.logger.log("Total number of nodes in model: "+b),j<b},m.bruteSearchCurrent=function(a,b,c){var d=function(a){x=!1,b(a),y&&(y(a),y=null)},e=function(){x=!1,h.logger.warn("A call to viewer native search failed for query string: "+a),c(),z&&z()};if(o&&!n.hasOwnProperty(o)){t++,C++;var f=q||{};n[o]={geometry:f.data}}x?(y=b,z=c):(x=!0,this.viewer.search(a,d,e,[],!0))},m.bruteSearch=function(a,b){var c=this,d=this.getSortedGeometries(),e=function(a){var d,g=a.data;switch(g.operation){case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":d=f(g),c.cbSecond&&c.cbSecond(g.str,d,g.ended),b(g.str,d,g.ended,g.geometry),g.ended&&(c.worker.removeEventListener("message",e),c.cbSecond=null,c.isSearchInProgress=!1,c.searchingString=null,h.logger.debug("The last "+g.operation+" messgage received for query '"+g.str+"' Ready for another search"));break;case"PROP_DB_CREATED":h.logger.log("Property DB is created. Passing the message through.");break;default:h.logger.warn("Received unexpected event, "+g.operation+", for "+g.str)}},g=function(b){var e={geometry:o,results:b};c.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:a,results:e,sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v,geometries:d})},i=function(){c.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:a,results:{geometry:o,results:[]},sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v,geometries:d})};this.worker.addEventListener("message",e),this.bruteSearchCurrent(a,g,i),v||this.worker.postMessage({operation:"BRUTE_SEARCH",str:a,currentGeo:o,geometries:d})},m.highlightText=function(a,b){return"[object String]"!==Object.prototype.toString.call(a)&&h.logger.warn("Error: Non-string sent to highlightText(). Check type, and if correct, convert to String() first."),b?a.replace(k,'<span class="bolder">$1</span>'):a},m.prepHighlighter=function(a){k=new RegExp("("+d(a)+")","gi")},m.doSearch=function(a,b){var c,d=this,e=function(a){var c,g=a.data;switch(g.operation){case"SEARCH_RESULT":c=f(g),d.cbSecond&&d.cbSecond(g.str,c,g.ended),b(g.str,c,g.ended),g.ended&&(d.worker.removeEventListener("message",e),d.cbSecond=null,d.isSearchInProgress=!1,d.searchingString=null,h.logger.debug("The last "+g.operation+" messgage received for query '"+g.str+"' Ready for another search"));break;case"OLD_SEARCH_RESULT":d.worker.removeEventListener("message",e),d.isSearchInProgress=!1;break;case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":h.logger.info("Indexing is still building and brute force search is in progress");break;default:h.logger.warn("Received unexpected event, "+g.operation+", for "+g.str)}};clearTimeout(d.isSearchInProgressTimer),d.isSearchInProgress===!0?a===d.searchingString?d.cbSecond=b:d.isSearchInProgressTimer=setTimeout(function(){d.doSearch(a,b)},100):(v&&(c={},Object.keys(n).forEach(function(a){"_sharedPropertyDatabase_"!==a&&(c[a]={guid:n[a].geometry.guid,name:n[a].geometry.name})})),h.logger.debug("Submitting a new search request for query '"+a+"'"),d.isSearchInProgress=!0,d.searchingString=a,d.worker.addEventListener("message",e),d.worker.postMessage({operation:"SEARCH",str:a,isSharedPropertyDb:v,geometries:c}))},m.defaultNodeName=function(){return"Untitled Node"}}(),ResultCollection.prototype.resetResultCollection=function(){this.partialResults=[],this.resultIDArray={},this.resultSetArray=[],this.resultArrayBufferArray=[],this.metaInfoArray=[],this.resultSetIndex={},this.resultCount=0},ResultCollection.prototype.getResultCount=function(){return this.resultCount},ResultCollection.prototype.setResultCount=function(a){this.resultCount=a},ResultCollection.prototype.getResultSetArray=function(){return this.resultSetArray},ResultCollection.prototype.recalcResultCount=function(){var a,b;for(this.resultCount=0,b=this.resultSetArray.length,a=0;a<b;a++)this.resultCount+=this.resultSetArray[a].length},ResultCollection.prototype.getResultSetIndex=function(a){return this.resultSetIndex.hasOwnProperty(a)?this.resultSetIndex[a]:-1},ResultCollection.prototype.hasResult=function(a,b){return!(!this.resultIDArray.hasOwnProperty(a)||this.resultIDArray[a].indexOf(b)<0)},ResultCollection.prototype.trackResult=function(a,b){return this.resultIDArray.hasOwnProperty(a)?!(this.resultIDArray[a].indexOf(b)>=0)&&(this.resultIDArray[a].push(b),!0):(this.resultIDArray[a]=[],this.resultIDArray[a].push(b),!0)},ResultCollection.prototype.getResultSetIndexArray=function(){return this.resultSetIndex},ResultCollection.prototype.addResult=function(a,b,c){return!!this.trackResult(a.guid,b)&&(this.resultSetIndex.hasOwnProperty(a.guid)?(this.resultSetArray[this.resultSetIndex[a.guid]].push(c),this.resultCount++):this.setResultSet({guid:a.guid,name:a.name},[c]),!0)},ResultCollection.prototype.setResultSet=function(a,b){a&&a.guid&&(this.resultSetIndex.hasOwnProperty(a.guid)?this.resultSetArray[this.resultSetIndex(a.guid)]=b:(this.metaInfoArray.push(a),this.resultSetArray.push(b),this.resultSetIndex[a.guid]=this.resultSetArray.length-1),this.recalcResultCount())},ResultCollection.prototype.replaceResultSet=function(a,b){return!(this.resultSetArray.length<=a||!b)&&(this.resultSetArray[a]=b,this.recalcResultCount(),!0)},ResultCollection.prototype.getResultSet=function(a){if("number"==typeof a){if(!this.resultSetArray||this.resultSetArray.length<=a)return null}else{if("string"!=typeof a)return null;if((a=this.getResultSetIndex(a))<0)return null}return this.resultSetArray[a]},ResultCollection.prototype.hasResultSet=function(a){if("number"==typeof a){if(!this.resultSetArray||this.resultSetArray.length<=a)return!1}else{if("string"!=typeof a)return!1;if((a=this.getResultSetIndex(a))<0)return!1}return!0},ResultCollection.prototype.setResultSetArray=function(a){this.resultSetArray=a.resultSetArray,this.resultSetIndex=a.resultSetIndex,this.resultCount=a.resultCount,this.partialResults=[],this.resultIDArray={},this.resultArrayBufferArray=[],this.metaInfoArray=[]},ResultCollection.prototype.getMetaInfo=function(a){return this.metaInfoArray.length<=a?null:this.metaInfoArray[a]},ResultCollection.prototype.getMetaInfo=function(a){return"number"!=typeof a?null:!this.metaInfoArray||this.metaInfoArray.length<=a?null:this.metaInfoArray[a]},ResultCollection.prototype.getMetaInfoArray=function(){return this.metaInfoArray},ResultCollection.prototype.getResultArrayBuffer=function(a){return this.resultArrayBufferArray.length<=a?null:this.resultArrayBufferArray[a]},ResultCollection.prototype.addResultArrayBuffer=function(a){return this.resultArrayBufferArray.push(a)},ResultCollection.prototype.getResultArrayBufferArray=function(){return this.resultArrayBufferArray},ResultCollection.prototype.getResultSetLength=function(a){if("number"==typeof a){if(!this.resultSetArray||this.resultSetArray.length<=a)return-1}else{if("string"!=typeof a)return-1;if((a=this.getResultSetIndex(a))<0)return-1}return this.resultSetArray[a].length},ResultCollection.prototype.getResultSetArrayLength=function(){return this.resultSetArray?this.resultSetArray.length:0},ResultCollection.prototype.getMetaInfoArrayLength=function(){return this.metaInfoArray?this.metaInfoArray.length:0},ResultCollection.prototype.getResultArrayBufferArrayLength=function(){return this.resultArrayBufferArray?this.resultArrayBufferArray.length:0},ResultCollection.prototype.copyResultCollection=function(a,b,c){var d,e,f;if(void 0!==c&&null!==c||(c=!0),this.resultCount=a.resultCount,this.resultSetArray=a.resultSetArray,this.resultSetIndex=a.resultSetIndex,this.metaInfoArray=a.metaInfoArray,this.resultIDArray=a.resultIDArray,b)for(this.resultArrayBufferArray=[],a.resultArrayBufferArray=[],d=a.getResultSetArrayLength(),e=0;e<d;e++)f=this.arrayToArrayBuffer(this.resultSetArray[e],!0),a.addResultArrayBuffer(f.arrayBuffer),this.addResultArrayBuffer(f.arrayBufferStore);if(!b&&c)for(this.resultArrayBufferArray=[],d=this.getResultSetArrayLength(),e=0;e<d;e++)this.resultArrayBufferArray.push(this.arrayToArrayBuffer(this.resultSetArray[e]))},ResultCollection.prototype.arrayToArrayBuffer=function(a,b){var c,d,e,f=JSON.stringify(a),g=f.length,h=new ArrayBuffer(2*g),i=new Uint16Array(h);for(b&&(c=new ArrayBuffer(2*g),d=new Uint16Array(c)),e=0;e<g;e++)i[e]=f.charCodeAt(e),b&&(d[e]=f.charCodeAt(e));return b?{arrayBuffer:h,arrayBufferStore:c}:h},ResultCollection.prototype.copyArrayBuffer=function(a){var b,c,d,e,f;if(this.resultArrayBufferArray.length<=a)return null;for(b=this.resultArrayBufferArray[a].byteLength,c=new ArrayBuffer(b),d=new Uint16Array(this.resultArrayBufferArray[a]),e=new Uint16Array(c),f=0;f<b;f++)e[f]=d[f];return c},ResultCollection.prototype.generateArrayBufferArray=function(){var a,b,c=[];if(this.resultCount)for(a=this.getResultArrayBufferArrayLength(),b=0;b<a;b++)c.push(this.copyArrayBuffer(b));return c},ResultCollection.prototype.loadResultCollectionFromObject=function(a){this.partialResults=a.partialResults,this.resultIDArray=a.resultIDArray,this.resultSetArray=a.resultSetArray,this.resultArrayBufferArray=a.resultArrayBufferArray,this.metaInfoArray=a.metaInfoArray,this.resultSetIndex=a.resultSetIndex,this.resultCount=a.resultCount},void 0==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(a,b,c,d,e,f,g,h){this.save(),this.translate(a,b),this.rotate(e),this.scale(c,d),this.arc(0,0,1,f,g,h),this.restore()}),"function"!=typeof Path2D&&function(){function a(a){if(this.ops_=[],void 0!=a)if("string"==typeof a)try{this.ops_=parser.parse(a)}catch(a){}else{if(!a.hasOwnProperty("ops_"))throw"Error: "+typeof a+"is not a valid argument to Path";this.ops_=a.ops_.slice(0)}}parser=function(){function a(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function b(b){function c(a){return ub!==a&&(ub>a&&(ub=0,vb={line:1,column:1,seenCR:!1}),function(a,c,d){var e,f;for(e=c;e<d;e++)f=b.charAt(e),"\n"===f?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}(vb,ub,a),ub=a),vb}function d(a){sb<wb||(sb>wb&&(wb=sb,xb=[]),xb.push(a))}function e(d,e,f){var g=c(f),h=f<b.length?b.charAt(f):null;return null!==e&&function(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}(e),new a(null!==d?d:function(a,b){var c,d,e,f=new Array(a.length);for(e=0;e<a.length;e++)f[e]=a[e].description;return c=a.length>1?f.slice(0,-1).join(", ")+" or "+f[a.length-1]:f[0],d=b?'"'+function(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}(b)+'"':"end of input","Expected "+c+" but "+d+" found."}(e,h),e,h,f,g.line,g.column)}function f(){var a,b,c,d,e;for(a=sb,b=[],c=S();c!==la;)b.push(c),c=S();if(b!==la)if(c=g(),c===la&&(c=pa),c!==la){for(d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(tb=a,b=qa(c),a=b):(sb=a,a=oa)}else sb=a,a=oa;else sb=a,a=oa;return a}function g(){var a,b,c,d,e;if(a=sb,(b=h())!==la){for(c=sb,d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(e=g(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function h(){var a,b,c,d,e;if(a=sb,(b=k())!==la){for(c=sb,d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(e=i(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function i(){var a,b,c,d,e;if(a=sb,(b=j())!==la){for(c=sb,d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(e=i(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function j(){var a;return a=m(),a===la&&(a=n())===la&&(a=p())===la&&(a=r())===la&&(a=s())===la&&(a=v())===la&&(a=y())===la&&(a=B())===la&&(a=D()),a}function k(){var a,c,e,f;if(a=sb,ra.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(sa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=l(),f!==la?(tb=a,c=ta(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function l(){var a,b,c,d,e;return a=sb,b=G(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=o(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function m(){var a,c;return a=sb,va.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(wa)),c!==la&&(tb=a,c=xa()),a=c}function n(){var a,c,e,f;if(a=sb,ya.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(za)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=o(),f!==la?(tb=a,c=Aa(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function o(){var a,b,c,d,e;return a=sb,b=G(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=o(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function p(){var a,c,e,f;if(a=sb,Ba.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(Ca)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=q(),f!==la?(tb=a,c=Da(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function q(){var a,b,c,d,e;return a=sb,b=H(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=q(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function r(){var a,c,e,f;if(a=sb,Ea.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(Fa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=q(),f!==la?(tb=a,c=Ga(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function s(){var a,c,e,f;if(a=sb,Ha.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(Ia)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=t(),f!==la?(tb=a,c=Ja(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function t(){var a,b,c,d,e;return a=sb,b=u(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=t(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function u(){var a,b,c,d,e,f;return a=sb,b=G(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=G(),d!==la?(e=L(),e===la&&(e=pa),e!==la?(f=G(),f!==la?(tb=a,b=Ka(b,d,f),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function v(){var a,c,e,f;if(a=sb,La.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(Ma)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=w(),f!==la?(tb=a,c=Na(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function w(){var a,b,c,d,e;return a=sb,b=x(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=w(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function x(){var a,b,c,d;return a=sb,b=G(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=G(),d!==la?(tb=a,b=Oa(b,d),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function y(){var a,c,e,f;if(a=sb,Pa.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(Qa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=z(),f!==la?(tb=a,c=Ra(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function z(){var a,b,c,d,e;return a=sb,b=A(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=z(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function A(){var a,b,c,d;return a=sb,b=G(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=G(),d!==la?(tb=a,b=Oa(b,d),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function B(){var a,c,e,f;if(a=sb,Sa.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(Ta)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=C(),f!==la?(tb=a,c=Ua(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function C(){var a,b,c,d,e;return a=sb,b=G(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=C(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function D(){var a,c,e,f;if(a=sb,Va.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(Wa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=E(),f!==la?(tb=a,c=Xa(c,f),a=c):(sb=a,a=oa)):(sb=a,a=oa)}else sb=a,a=oa;return a}function E(){var a,b,c,d,e;return a=sb,b=F(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=E(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function F(){var a,b,c,d,e,f,g,h,i,j,k,l;return a=sb,b=I(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=I(),d!==la?(e=L(),e===la&&(e=pa),e!==la?(f=J(),f!==la?(g=L(),g!==la?(h=K(),h!==la?(i=L(),i===la&&(i=pa),i!==la?(j=K(),j!==la?(k=L(),k===la&&(k=pa),k!==la?(l=G(),l!==la?(tb=a,b=Ya(b,d,f,h,j,l),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function G(){var a,b,c,d;return a=sb,b=H(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=H(),d!==la?(tb=a,b=Za(b,d),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function H(){var a,b;return a=sb,b=J(),b!==la&&(tb=a,b=$a(b)),a=b}function I(){var a;return a=N(),a===la&&(a=R()),a}function J(){var a,b,c;return a=sb,b=Q(),b===la&&(b=pa),b!==la?(c=N(),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa),a===la&&(a=sb,b=Q(),b===la&&(b=pa),b!==la?(c=R(),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa)),a}function K(){var a;return 48===b.charCodeAt(sb)?(a=_a,sb++):(a=la,0===yb&&d(ab)),a===la&&(49===b.charCodeAt(sb)?(a=bb,sb++):(a=la,0===yb&&d(cb))),a}function L(){var a,b,c,d,e;if(a=sb,b=[],(c=S())!==la)for(;c!==la;)b.push(c),c=S();else b=oa;if(b!==la)if(c=M(),c===la&&(c=pa),c!==la){for(d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(b=[b,c,d],a=b):(sb=a,a=oa)}else sb=a,a=oa;else sb=a,a=oa;if(a===la)if(a=sb,(b=M())!==la){for(c=[],d=S();d!==la;)c.push(d),d=S();c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function M(){var a;return 44===b.charCodeAt(sb)?(a=db,sb++):(a=la,0===yb&&d(eb)),a}function N(){var a,b,c;return a=sb,b=O(),b!==la?(c=P(),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa),a===la&&(a=sb,b=R(),b!==la?(c=P(),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa)),a}function O(){var a,c,e,f;return a=sb,c=R(),c===la&&(c=pa),c!==la?(46===b.charCodeAt(sb)?(e=fb,sb++):(e=la,0===yb&&d(gb)),e!==la?(f=R(),f!==la?(c=[c,e,f],a=c):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a===la&&(a=sb,c=R(),c!==la?(46===b.charCodeAt(sb)?(e=fb,sb++):(e=la,0===yb&&d(gb)),e!==la?(c=[c,e],a=c):(sb=a,a=oa)):(sb=a,a=oa)),a}function P(){var a,c,e,f;return a=sb,hb.test(b.charAt(sb))?(c=b.charAt(sb),sb++):(c=la,0===yb&&d(ib)),c!==la?(e=Q(),e===la&&(e=pa),e!==la?(f=R(),f!==la?(c=[c,e,f],a=c):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function Q(){var a;return 43===b.charCodeAt(sb)?(a=jb,sb++):(a=la,0===yb&&d(kb)),a===la&&(45===b.charCodeAt(sb)?(a=lb,sb++):(a=la,0===yb&&d(mb))),a}function R(){var a,c,e;if(a=sb,c=[],nb.test(b.charAt(sb))?(e=b.charAt(sb),sb++):(e=la,0===yb&&d(ob)),e!==la)for(;e!==la;)c.push(e),nb.test(b.charAt(sb))?(e=b.charAt(sb),sb++):(e=la,0===yb&&d(ob));else c=oa;return c!==la&&(tb=a,c=pb(c)),a=c}function S(){var a;return qb.test(b.charAt(sb))?(a=b.charAt(sb),sb++):(a=la,0===yb&&d(rb)),a}function T(a,b){return"mlazhvcsqt".indexOf(a)===-1?zb=b:(zb[0]+=b[0],zb[1]+=b[1]),Db=a,zb.slice(0)}function U(a,b){for(var c=[],d=zb.slice(0),e=0;e<b.length;e+=2){zb=d.slice(0);var f=T(a,b.slice(e,e+2));c=c.concat(f),e==b.length-4&&(Ab=f.slice(0))}return c}function V(){"CcSsQqTt".indexOf(Db)==-1&&(Ab=zb.slice(0));var a=[0,0];return a[0]=2*zb[0]-Ab[0],a[1]=2*zb[1]-Ab[1],a}function W(a,b){var c=[b,0];return"H"==a&&(c[1]=zb[1]),T(a,c)}function X(a,b){var c=[0,b];return"V"==a&&(c[0]=zb[0]),T(a,c)}function Y(a,b){var c=[a];if(b&&b.length>1)for(var d=b[1],e=0;e<d.length;e++)c.push(d[e]);return c}function Z(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))}function $(a,b){return a[0]*b[0]+a[1]*b[1]}function _(a,b){return $(a,b)/(Z(a)*Z(b))}function aa(a,b){var c=1;return a[0]*b[1]-a[1]*b[0]<0&&(c=-1),c*Math.acos(_(a,b))}function ba(a,b){var c=Math.cos(b),d=Math.sin(b);return[c*a[0]+d*a[1],-1*d*a[0]+c*a[1]]}function ca(a,b){var c=Math.cos(b),d=Math.sin(b);return[c*a[0]-d*a[1],d*a[0]+c*a[1]]}function da(a,b){return[(a[0]-b[0])/2,(a[1]-b[1])/2]}function ea(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2]}function fa(a,b){return[a[0]*b[0],a[1]*b[1]]}function ga(a,b){return[a*b[0],a*b[1]]}function ha(a,b){return[a[0]+b[0],a[1]+b[1]]}function ia(a,b,c,d,e,f,g){if(0==b||0==c)return void Bb.push({type:"lineTo",args:g});var d=d*(Math.PI/180);b=Math.abs(b),c=Math.abs(c);var h=ba(da(a,g),d),i=fa(h,h),j=Math.pow(b,2),k=Math.pow(c,2),l=Math.sqrt(i[0]/j+i[1]/k);l>1&&(b*=l,c*=l,j=Math.pow(b,2),k=Math.pow(c,2));var m=Math.sqrt((j*k-j*i[1]-k*i[0])/(j*i[1]+k*i[0]));e==f&&(m*=-1);var n=ga(m,[b*h[1]/c,-c*h[0]/b]),o=ha(ca(n,d),ea(a,g)),p=[(h[0]-n[0])/b,(h[1]-n[1])/c],q=[(-1*h[0]-n[0])/b,(-1*h[1]-n[1])/c],r=aa([1,0],p),s=aa(p,q),t=r,u=r+s;Bb.push({type:"save",args:[]},{type:"translate",args:[o[0],o[1]]},{type:"rotate",args:[d]},{type:"scale",args:[b,c]},{type:"arc",args:[0,0,1,t,u,1-f]},{type:"restore",args:[]})}var ja,ka=arguments.length>1?arguments[1]:{},la={},ma={svg_path:f},na=f,oa=la,pa=null,qa=function(a){return Bb},ra=/^[Mm]/,sa={type:"class",value:"[Mm]",description:"[Mm]"},ta=function(a,b){var c=a;Cb&&(c="M",Cb=!1),Bb.push({type:"moveTo",args:T(c,b[0])});for(var d=1;d<b.length;d++)Bb.push({type:"lineTo",args:T(a,b[d])})},ua=function(a,b){return Y(a,b)},va=/^[Zz]/,wa={type:"class",value:"[Zz]",description:"[Zz]"},xa=function(){Bb.push({type:"closePath",args:[]})},ya=/^[Ll]/,za={type:"class",value:"[Ll]",description:"[Ll]"},Aa=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"lineTo",args:T(a,b[c])})},Ba=/^[Hh]/,Ca={type:"class",value:"[Hh]",description:"[Hh]"},Da=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"lineTo",args:W(a,b[c])})},Ea=/^[Vv]/,Fa={type:"class",value:"[Vv]",description:"[Vv]"},Ga=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"lineTo",args:X(a,b[c])})},Ha=/^[Cc]/,Ia={type:"class",value:"[Cc]",description:"[Cc]"},Ja=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"bezierCurveTo",args:U(a,b[c])})},Ka=function(a,b,c){return a.concat(b,c)},La=/^[Ss]/,Ma={type:"class",value:"[Ss]",description:"[Ss]"},Na=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"bezierCurveTo",args:V().concat(U(a,b[c]))})},Oa=function(a,b){return a.concat(b)},Pa=/^[Qq]/,Qa={type:"class",value:"[Qq]",description:"[Qq]"},Ra=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"quadraticCurveTo",args:U(a,b[c])})},Sa=/^[Tt]/,Ta={type:"class",value:"[Tt]",description:"[Tt]"},Ua=function(a,b){for(var c=0;c<b.length;c++){var d=V();Bb.push({type:"quadraticCurveTo",args:d.concat(U(a,b[c]))}),Ab=d.slice(0)}},Va=/^[Aa]/,Wa={type:"class",value:"[Aa]",description:"[Aa]"},Xa=function(a,b){for(var c=0;c<b.length;c++){var d=[zb.slice()],e=[T(a,b[c].slice(-2))];absArgs=d.concat(b[c].slice(0,-2),e),ia.apply(this,absArgs)}},Ya=function(a,b,c,d,e,f){return[parseFloat(a),parseFloat(b),parseFloat(c.join("")),parseInt(d),parseInt(e),f[0],f[1]]},Za=function(a,b){return[a,b]},$a=function(a){return parseFloat(a.join(""))},_a="0",ab={type:"literal",value:"0",description:'"0"'},bb="1",cb={type:"literal",value:"1",description:'"1"'},db=",",eb={type:"literal",value:",",description:'","'},fb=".",gb={type:"literal",value:".",description:'"."'},hb=/^[eE]/,ib={type:"class",value:"[eE]",description:"[eE]"},jb="+",kb={type:"literal",value:"+",description:'"+"'},lb="-",mb={type:"literal",value:"-",description:'"-"'},nb=/^[0-9]/,ob={type:"class",value:"[0-9]",description:"[0-9]"},pb=function(a){return a.join("")},qb=/^[ \t\n\r]/,rb={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},sb=0,tb=0,ub=0,vb={line:1,column:1,seenCR:!1},wb=0,xb=[],yb=0;if("startRule"in ka){if(!(ka.startRule in ma))throw new Error("Can't start parsing from rule \""+ka.startRule+'".');na=ma[ka.startRule]}
var zb=[0,0],Ab=[0,0],Bb=[],Cb=!0,Db="";if((ja=na())!==la&&sb===b.length)return ja;throw ja!==la&&sb<b.length&&d({type:"end",description:"end of input"}),e(null,xb,wb)}return function(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}(a,Error),{SyntaxError:a,parse:b}}();for(var b=["closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","rect","arc","arcTo","ellipse","isPointInPath","isPointInStroke"],c=0;c<b.length;c++){var d=b[c];a.prototype[d]=function(a){return function(){this.ops_.push({type:a,args:Array.prototype.slice.call(arguments,0)})}}(d)}a.prototype.addPath=function(a,b){var c=!1;b&&b.hasOwnProperty("a")&&b.hasOwnProperty("b")&&b.hasOwnProperty("c")&&b.hasOwnProperty("d")&&b.hasOwnProperty("e")&&b.hasOwnProperty("f")&&(c=!0,this.ops_.push({type:"save",args:[]}),this.ops_.push({type:"transform",args:[b.a,b.b,b.c,b.d,b.e,b.f]})),this.ops_=this.ops_.concat(a.ops_),c&&this.ops_.push({type:"restore",args:[]})},original_fill=CanvasRenderingContext2D.prototype.fill,original_stroke=CanvasRenderingContext2D.prototype.stroke,original_clip=CanvasRenderingContext2D.prototype.clip,original_is_point_in_path=CanvasRenderingContext2D.prototype.isPointInPath,original_is_point_in_stroke=CanvasRenderingContext2D.prototype.isPointInStroke,CanvasRenderingContext2D.prototype.fill=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}original_fill.apply(this,Array.prototype.slice.call(arguments,1))}else original_fill.apply(this,arguments)},CanvasRenderingContext2D.prototype.stroke=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}original_stroke.call(this)}else original_stroke.call(this)},CanvasRenderingContext2D.prototype.clip=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}original_clip.apply(this,Array.prototype.slice.call(arguments,1))}else original_clip.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInPath=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}return original_is_point_in_path.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_path.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInStroke=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}return original_is_point_in_stroke.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_stroke.apply(this,arguments)},Path2D=a}(),function(a,b){"use strict";var c,d=a.document;c=function(){var b,c,e,f,g,h,i,j,k,l,m,n,o,p={},q={},r=!1,s={ENTER:13,ESC:27,SPACE:32},t=[];return q={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},o=function(){var a,b,c=!1,e=d.createElement("fakeelement"),f={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(a in f)if(void 0!==e.style[a]){b=f[a],c=!0;break}return{type:b,supported:c}},b=function(a){return d.getElementById(a)},p={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:void 0,addListeners:function(a){var b,h,i,j,k,l=void 0!==e,m=void 0!==c,o=void 0!==n,p="",q=this;b=function(b){return void 0!==b.preventDefault&&b.preventDefault(),i(b),void 0!==n&&(p=n.value),"function"==typeof a&&(void 0!==n?a(!0,p):a(!0)),!1},h=function(b){return void 0!==b.preventDefault&&b.preventDefault(),i(b),"function"==typeof a&&a(!1),!1},i=function(a){q.hide(),q.unbind(d.body,"keyup",j),q.unbind(f,"focus",k),l&&q.unbind(e,"click",b),m&&q.unbind(c,"click",h)},j=function(a){var c=a.keyCode;(c===s.SPACE&&!o||o&&c===s.ENTER)&&b(a),c===s.ESC&&m&&h(a)},k=function(a){o?n.focus():!m||q.buttonReverse?e.focus():c.focus()},this.bind(f,"focus",k),this.bind(g,"focus",k),l&&this.bind(e,"click",b),m&&this.bind(c,"click",h),this.bind(d.body,"keyup",j),this.transition.supported||this.setFocus()},bind:function(a,b,c){"function"==typeof a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},handleErrors:function(){if(void 0!==a.onerror){var b=this;return a.onerror=function(a,c,d){b.error("["+a+" on line "+d+" of "+c+"]",0)},!0}return!1},appendButtons:function(a,b){return this.buttonReverse?b+a:a+b},build:function(a){var b="",c=a.type,d=a.message,e=a.cssClass||"";switch(b+='<div class="alertify-dialog">',b+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===p.buttonFocus&&(b+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===c&&(b+='<div id="alertify-form">'),b+='<article class="alertify-inner">',b+=q.message.replace("{{message}}",d),"prompt"===c&&(b+=q.input),b+=q.buttons.holder,b+="</article>","prompt"===c&&(b+="</div>"),b+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',b+="</div>",c){case"confirm":b=b.replace("{{buttons}}",this.appendButtons(q.buttons.cancel,q.buttons.ok)),b=b.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":b=b.replace("{{buttons}}",this.appendButtons(q.buttons.cancel,q.buttons.submit)),b=b.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":b=b.replace("{{buttons}}",q.buttons.ok),b=b.replace("{{ok}}",this.labels.ok)}return k.className="alertify alertify-"+c+" "+e,j.className="alertify-cover",b},close:function(a,b){var c,d,e=b&&!isNaN(b)?+b:this.delay,f=this;this.bind(a,"click",function(){c(a)}),d=function(a){a.stopPropagation(),f.unbind(this,f.transition.type,d),l.removeChild(this),l.hasChildNodes()||(l.className+=" alertify-logs-hidden")},c=function(a){void 0!==a&&a.parentNode===l&&(f.transition.supported?(f.bind(a,f.transition.type,d),a.className+=" alertify-log-hide"):(l.removeChild(a),l.hasChildNodes()||(l.className+=" alertify-logs-hidden")))},0!==b&&setTimeout(function(){c(a)},e)},dialog:function(a,b,c,e,f){i=d.activeElement;var g=function(){l&&null!==l.scrollTop&&j&&null!==j.scrollTop||g()};if("string"!=typeof a)throw new Error("message must be a string");if("string"!=typeof b)throw new Error("type must be a string");if(void 0!==c&&"function"!=typeof c)throw new Error("fn must be a function");return this.init(),g(),t.push({type:b,message:a,callback:c,placeholder:e,cssClass:f}),r||this.setup(),this},extend:function(a){if("string"!=typeof a)throw new Error("extend method must have exactly one paramter");return function(b,c){return this.log(b,a,c),this}},hide:function(){var a,b=this;t.splice(0,1),t.length>0?this.setup(!0):(r=!1,a=function(c){c.stopPropagation(),b.unbind(k,b.transition.type,a)},this.transition.supported?(this.bind(k,this.transition.type,a),k.className="alertify alertify-hide alertify-hidden"):k.className="alertify alertify-hide alertify-hidden alertify-isHidden",j.className="alertify-cover alertify-cover-hidden",i.focus())},init:function(){d.createElement("nav"),d.createElement("article"),d.createElement("section"),null==b("alertify-cover")&&(j=d.createElement("div"),j.setAttribute("id","alertify-cover"),j.className="alertify-cover alertify-cover-hidden",d.body.appendChild(j)),null==b("alertify")&&(r=!1,t=[],k=d.createElement("section"),k.setAttribute("id","alertify"),k.setAttribute("style","z-index : 999999999"),k.className="alertify alertify-hidden",d.body.appendChild(k)),null==b("alertify-logs")&&(l=d.createElement("section"),l.setAttribute("id","alertify-logs"),l.className="alertify-logs alertify-logs-hidden",d.body.appendChild(l)),d.body.setAttribute("tabindex","0"),this.transition=o()},log:function(a,b,c){var d=function(){l&&null!==l.scrollTop||d()};return this.init(),d(),l.className="alertify-logs",this.notify(a,b,c),this},notify:function(a,b,c){var e=d.createElement("article");e.className="alertify-log"+("string"==typeof b&&""!==b?" alertify-log-"+b:""),e.innerHTML=a,l.appendChild(e),setTimeout(function(){e.className=e.className+" alertify-log-show"},50),this.close(e,c)},set:function(a){var b;if("object"!=typeof a&&a instanceof Array)throw new Error("args must be an object");for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},setFocus:function(){n?(n.focus(),n.select()):h.focus()},setup:function(a){var d,i=t[0],j=this;r=!0,d=function(a){a.stopPropagation(),j.setFocus(),j.unbind(k,j.transition.type,d)},this.transition.supported&&!a&&this.bind(k,this.transition.type,d),k.innerHTML=this.build(i),f=b("alertify-resetFocus"),g=b("alertify-resetFocusBack"),e=b("alertify-ok")||void 0,c=b("alertify-cancel")||void 0,h="cancel"===p.buttonFocus?c:"none"===p.buttonFocus?b("alertify-noneFocus"):e,n=b("alertify-text")||void 0,m=b("alertify-form")||void 0,"string"==typeof i.placeholder&&""!==i.placeholder&&(n.value=i.placeholder),a&&this.setFocus(),this.addListeners(i.callback)},unbind:function(a,b,c){"function"==typeof a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}},{alert:function(a,b,c){return p.dialog(a,"alert",b,"",c),this},confirm:function(a,b,c){return p.dialog(a,"confirm",b,"",c),this},extend:p.extend,init:p.init,log:function(a,b,c){return p.log(a,b,c),this},prompt:function(a,b,c,d){return p.dialog(a,"prompt",b,c,d),this},success:function(a,b){return p.log(a,"success",b),this},error:function(a,b){return p.log(a,"error",b),this},set:function(a){p.set(a)},hide:function(a){p.hide(a)},labels:p.labels,debug:p.handleErrors}},void 0===a.alertify&&(a.alertify=new c)}(this),function(){var a=Autodesk.Viewing,b=(a.Private,""),c=!1,d=!1,e=!0;a.HTTP_REQUEST_HEADERS={},a.getApiEndpoint=function(){return b},a.setApiEndpoint=function(a,c,f){b=a,d=c,(e=f)||(d=!1)},a.getViewingUrl=function(a){return e?(a||b)+"/viewingservice/v1":(a||b)+"/derivativeservice/v2"},a.getUseCredentials=function(){return c},a.setUseCredentials=function(a){c=a},a.getManifestApi=function(b){var c=a.getViewingUrl(b);return d?c+"/bubbles/":e?c+"/":c+"/manifest/"},a.getItemApi=function(b){return e?a.getViewingUrl(b)+"/items/":a.getViewingUrl(b)+"/derivatives/"},a.getThumbnailApi=function(b){return a.getViewingUrl(b)+"/thumbnails/"},a.makeOssPath=function(a,c,d){return(a||b)+"/oss/v2/buckets/"+c+"/objects/"+encodeURIComponent(decodeURIComponent(d))}}(),function(){var a=Autodesk.Viewing,b=a.Private,c=a.getGlobal();c.PROTEIN_ROOT=null,c.PRISM_ROOT=null,c.LOCALIZATION_REL_PATH="",c.LMV_VIEWER_VERSION="2.13",c.LMV_VIEWER_PATCH="6",c.LMV_BUILD_TYPE="Production",c.LMV_RESOURCE_VERSION=null,c.LMV_RESOURCE_ROOT="",c.LMV_THIRD_PARTY_COOKIE=void 0,"v"===LMV_VIEWER_VERSION.charAt(0)&&(LMV_VIEWER_VERSION=LMV_VIEWER_VERSION.substr(1)),c.stderr=function(){console.warn('"stderr" is deprecated; please use "Autodesk.Viewing.Private.logger" instead')},b.env=null,b.docItemId=null,b.token={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},b.memoryOptimizedSvfLoading=!1,b.forceMemoryOptimizedModeOnSvfLoading=!1,b.assets=[],b.offline=!1,b.offlineResourcePrefix=null;var d={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},e={local:"",dev:"https://viewing-dev.api.autodesk.com",stg:"https://viewing-staging.api.autodesk.com",prod:"https://viewing.api.autodesk.com"},f={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},g={stg:{CLIENT_ID:"lmv-stag",CLIENT_KEY:"kjemi1rwAgsqIqyvDUtc9etPD6MsAzbV",ENDPOINT:"https://ase-stg.autodesk.com"},prod:{CLIENT_ID:"lmv-prod",CLIENT_KEY:"iaoUM2CRGydfn703yfPq4MAogZi8I5u4",ENDPOINT:"https://ase.autodesk.com"}};b.EnvironmentConfigurations={Local:{ROOT:"",LMV:d.local},Development:{ROOT:e.dev,LMV:d.dev,bubbleManifest:!0},Staging:{ROOT:e.stg,LMV:d.stg,bubbleManifest:!0},Production:{ROOT:e.prod,LMV:d.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:f.dev,LMV:d.dev},AutodeskStaging:{ROOT:f.stg,LMV:d.stg},AutodeskProduction:{ROOT:f.prod,LMV:d.prod}},b.initializeEnvironmentVariable=function(a){var c;if(a&&a.env&&(c=a.env),c||(c=b.getParameterByName("env")),a&&a.offlineResourcePrefix&&(b.offlineResourcePrefix=a.offlineResourcePrefix),a&&a.offline&&"true"===a.offline&&(b.offline=!0),!c)switch(window.location.hostname){case"viewing-dev.api.autodesk.com":c="Development";break;case"viewing-staging.api.autodesk.com":c="Staging";break;case"viewing.api.autodesk.com":c="Production";break;case"developer-dev.api.autodesk.com":c="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":c="AutodeskStaging";break;case"developer.api.autodesk.com":c="AutodeskProduction";break;case"localhost.autodesk.com":c="Local";break;case"":c="Local";break;case"127.0.0.1":c="Local";break;default:c="AutodeskProduction"}b.ENABLE_TRACE&&("undefined"!=typeof window&&console.log("Host name : "+window.location.hostname),console.log("Environment initialized as : "+c)),b.env=c},b.initializeServiceEndPoints=function(c){var d=c.endpoint,e=c.bubbleManifest,f=!c.useDerivativeServiceV2;if(!d){var g=b.EnvironmentConfigurations[b.env];d=g.ROOT,e=g.bubbleManifest&&f}if(a.setApiEndpoint(d,e,f),!a.isNodeJS){var h=["viewer3D.js","viewer3D.min.js","firefly.js","firefly.min.js"];c&&c.hasOwnProperty("libraryName")&&h.push(c.libraryName);for(var i,j,k=0;k<h.length;k++){var l=b.getScript(h[k]);j=l?l.src:"";var m=j.indexOf(h[k]);if(m>=0){i=j.substr(0,m);break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION;var n=b.getParameterByNameFromPath("v",j);n&&n.length&&n!=LMV_RESOURCE_VERSION?(console.warn("Version string mismatch between requested and actual version: "+n+" vs. "+LMV_RESOURCE_VERSION+". Using "+n),LMV_RESOURCE_VERSION=n):n&&n.length||(LMV_RESOURCE_VERSION=null,console.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION)),LMV_RESOURCE_ROOT=i||LMV_RESOURCE_ROOT}},b.initLoadContext=function(b){b=b||{},b.auth=a.getUseCredentials(),b.endpoint=a.getApiEndpoint(),b.headers||(b.headers={});for(var c in a.HTTP_REQUEST_HEADERS)b.headers[c]=a.HTTP_REQUEST_HEADERS[c];return b},b.refreshCookie=function(c,d,e){var f=new XMLHttpRequest;if(f.onload=d,f.onerror=e,f.ontimeout=e,0===b.env.indexOf("Autodesk")){var g=b.EnvironmentConfigurations[b.env].ROOT;f.open("POST",g+"/utility/v1/settoken",!0),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.withCredentials=!0,f.send("access-token="+c),a.isIE11&&(b.accessToken=c)}else{var c={oauth:{token:c}};f.open("POST",a.getViewingUrl()+"/token",!0),f.setRequestHeader("Content-Type","application/json"),f.withCredentials=!0,f.send(JSON.stringify(c))}},b.refreshRequestHeader=function(b){a.HTTP_REQUEST_HEADERS.Authorization="Bearer "+b},b.refreshToken=function(a,c,d){b.token.accessToken=a,void 0===LMV_THIRD_PARTY_COOKIE?b.refreshCookie(a,c,d):function(){LMV_THIRD_PARTY_COOKIE?b.refreshCookie(a,c,d):(b.refreshRequestHeader(a),c())}()},b.initializeAuth=function(c,d){function e(a,f){g=a,b.refreshToken(g,b.token.tokenRefreshInterval?null:c);var h=f-60;h<=0&&(h=f),b.token.tokenRefreshInterval=1e3*h,setTimeout(function(){d.getAccessToken(e)},b.token.tokenRefreshInterval)}var f=d?d.shouldInitializeAuth:void 0;if(void 0===f){f="false"!==b.getParameterByName("auth").toLowerCase()}if("Local"==b.env||!f)return setTimeout(c,0),a.setUseCredentials(void 0!==d.useCredentials&&d.useCredentials),a.getUseCredentials();a.isNodeJS&&(LMV_THIRD_PARTY_COOKIE=!1),a.setUseCredentials(void 0===d.useCredentials||d.useCredentials);var g;return d&&d.getAccessToken?(b.token.getAccessToken=d.getAccessToken,"string"==typeof(g=d.getAccessToken(e))&&g&&b.refreshToken(g,c)):d&&d.accessToken?(g=d.accessToken,b.refreshToken(g,c)):(g=b.getParameterByName("accessToken"),g||(g="9AMaRKBoPCIBy61JmQ8OLLLyRblS",b.logger.warn("Warning : no access token is provided. Use built in token : "+g)),b.refreshToken(g,c)),a.getUseCredentials()},b.initializeLogger=function(c){var d={eventCallback:c?c.eventCallback:void 0};if(b.logger.initialize(d),!(c&&c.hasOwnProperty("useADP")&&0==c.useADP||a.isNodeJS)){var e="https://ase-cdn.autodesk.com/adp/v1.0.3/js/adp-web-analytics-sdk.min.js",f=function(){if("undefined"==typeof Adp)return void b.logger.warn("Autodesk Data Platform SDK not found");var a;switch(LMV_BUILD_TYPE){case"Production":a=g.prod;break;default:a=g.stg}var c={product:{name:"LMV",line_name:"LMV",key:a.CLIENT_ID,id:a.CLIENT_KEY,id_provider:"appkey",build_id:LMV_VIEWER_VERSION+"."+LMV_VIEWER_PATCH,build_tag:LMV_BUILD_TYPE}},d={server:a.ENDPOINT,enable_geo_data:!1,enable_browser_data:!0,enable_session_messages:!0};b.logger.adp=new Adp(c,d)};"undefined"!=typeof requirejs?requirejs([e],function(a){window.Adp=a,f()}):b.loadDependency("Adp",e,f)}},b.initializeProtein=function(){if((!b.ENABLE_DEBUG||"Local"!=b.env||a.getUseCredentials())&&!b.offline){var c=new XMLHttpRequest;c.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",!0),c.responseType="json",c.onload=function(a){var d=c.response.url;d&&d.length&&(d=d.replace("http://","https://"),PROTEIN_ROOT=d+"/",b.logger.info("Protein root is: "+PROTEIN_ROOT))},c.send();var d=new XMLHttpRequest;d.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",!0),d.responseType="json",d.onload=function(a){var c=d.response.url;c&&c.length&&(c=c.replace("http://","https://"),PRISM_ROOT=c+"/",b.logger.info("Prism root is: "+PRISM_ROOT))},d.send()}},b.getParameterByName=function(a){return"undefined"==typeof window?"":b.getParameterByNameFromPath(a,window.location.href)},b.getParameterByNameFromPath=function(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},b.urlIsApiViewingOrDev=function(a){return a.indexOf("developer.api.autodesk.com")!==-1||a.indexOf("developer-stg.api.autodesk.com")!==-1||a.indexOf("developer-dev.api.autodesk.com")!==-1||a.indexOf("viewing.api.autodesk.com")!==-1||a.indexOf("viewing-staging.api.autodesk.com")!==-1||a.indexOf("viewing-dev.api.autodesk.com")!==-1},b.getDemoDocumentURN=function(){var a;switch(b.env){case"Development":a="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ==";break;case"Staging":a="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm";break;case"Production":a="FIXME";break;default:a="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return a},b.setLanguage=function(a,b){var c={lng:a,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};LOCALIZATION_REL_PATH="res/locales/"+a+"/",Autodesk.Viewing.i18n.init(c,function(a){Autodesk.Viewing.i18n.clearDebugLocString(),b&&b()})},b.initializeLocalization=function(a){var c=a&&a.language||navigator.language,d=c.split("-");c=d.length>1?d[0].toLowerCase()+"-"+d[1].toUpperCase():d[0].toLowerCase();var e=["cs","de","en","es","fr","it","ja","ko","pl","pt-BR","ru","tr","zh-HANS","zh-HANT"];e.indexOf(c)===-1&&(c=c.indexOf("zh-CN")>-1?"zh-HANS":c.indexOf("zh-TW")>-1?"zh-HANT":d.length>1&&e.indexOf(d[0])>-1?d[0]:"en"),b.setLanguage(c)},b.initializeUserInfo=function(a){a&&a.userInfo&&(b.setUserName(a.userInfo.name),a.comment2Token&&(b.comment2Token=a.comment2Token))},b.getScript=function(a){a=a.toLowerCase();var b=document.getElementsByTagName("SCRIPT");if(b&&b.length>0)for(var c=0;c<b.length;++c)if(b[c].src&&b[c].src.toLowerCase().indexOf(a)!==-1)return b[c];return null},b.getResourceUrl=function(a){var b=LMV_RESOURCE_VERSION;return LMV_RESOURCE_ROOT+a+(b?"?v="+b:"")},b.loadDependency=function(a,c,d){if(void 0===window[a]){var e=document.createElement("SCRIPT");e.src=c.indexOf("://")>0?c:b.getResourceUrl(c),document.head.appendChild(e),d&&(e.onload=d)}else d&&d()},Autodesk.Viewing.createInitializerOptions=function(){return{env:"AutodeskProduction",getAccessToken:void 0,language:void 0,webGLHelpLink:null}},Autodesk.Viewing.createViewerConfig=function(){var c={extensions:[],sharedPropertyDbPath:void 0,canvasConfig:void 0,startOnInitialize:!0,experimental:[]};return Autodesk.Viewing.theExtensionManager.popuplateOptions(c),a.Viewer3D&&a.Viewer3D.populateConfigOptions(c),b.GuiViewer3D&&b.GuiViewer3D.populateConfigOptions(c),c},b.isExperimentalFlagEnabled=function(a,b){return!(!b||!Array.isArray(b.experimental))&&b.experimental.indexOf(a)!==-1},Autodesk.Viewing.Initializer=function(c,d){function e(){b.initializeLegacyNamespaces(!1),THREE.warn=b.logger.warn.bind(b.logger),init_three_dds_loader(),init_three_pvr_loader(),b.initializeAuth(d,c),b.initializeLocalization(c),b.initializeUserInfo(c)}a.isNodeJS?(b.initializeEnvironmentVariable(c),b.initializeServiceEndPoints(c),b.initializeLogger(c),b.initializeAuth(d,c)):(b.WEBGL_HELP_LINK=c?c.webGLHelpLink:null,b.initializeEnvironmentVariable(c),b.initializeServiceEndPoints(c),b.initializeLogger(c),b.initializeProtein(),b.initWorkerScript(),b.loadDependency("THREE","three.min.js",function(){b.loadDependency("WGS","wgs.min.js",e)}))}}();